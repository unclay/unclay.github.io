{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/eleven/source/css/style.less","path":"css/style.less","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"d1850a0bef9cf79a52ab59c56b2d5d6337d0fd6a","modified":1521342292000},{"_id":"themes/eleven/.DS_Store","hash":"42dea73e9920b1ad510ce0e72cff38c0f1caf693","modified":1521251784000},{"_id":"themes/eleven/_config.yml","hash":"a4b8e57e8ad41482b61979a66026ac77da6a5371","modified":1521341863000},{"_id":"themes/eleven/package.json","hash":"21f82e2aba3167663a4b106bd4577484c43e2ef7","modified":1521341127000},{"_id":"themes/eleven/package-lock.json","hash":"163e160bb4d4b4a7df4d6acda99496fbdfb7ea53","modified":1521251862000},{"_id":"source/_posts/Proxy.md","hash":"2f33c89969cb5c7aa9d3207f0fcc545400d0d2e7","modified":1519969323000},{"_id":"source/_posts/closure.md","hash":"68b116d8b284c8b85e512d61ce58657f8a41da49","modified":1510907652000},{"_id":"source/_posts/components-start.md","hash":"83232250713f10ad7e8ab045d9439cccf017f281","modified":1506064061000},{"_id":"source/_posts/css-background.md","hash":"3d13c5d32e65ed323e600b3f99cc989b296b48f3","modified":1504853687000},{"_id":"source/_posts/css-box-and-graph.md","hash":"d6316d2a9c1424fea020b7cc436fb35fb4f43e35","modified":1504853685000},{"_id":"source/_posts/css-pseudo-class-one.md","hash":"bb52a4eeef0c2e390d446501ec327f4a85342793","modified":1519969323000},{"_id":"source/_posts/css-horizontal-vertical-center.md","hash":"262f79385e8bbae4339d85d58c0b0dba201358a1","modified":1502176970000},{"_id":"source/_posts/css-clearfix-md.md","hash":"36e618b017a1b8b192e8b89e13cc7114dc81d856","modified":1504853674000},{"_id":"source/_posts/design-pattern-singleton-pattern.md","hash":"d09038018a4b25ca3cf333b99e9c8e2755b433e2","modified":1513319316000},{"_id":"source/_posts/fe-intro.md","hash":"5e0d910937d21ccc9c45fa91074ea88fd81e1b9c","modified":1512114604000},{"_id":"source/_posts/git.md","hash":"736d1ec64712c25dedc4a3c89fc94c87521aa7f0","modified":1512114604000},{"_id":"source/_posts/css-word-break.md","hash":"af1c4a42a8c30a9360db5b6f755240ff5c76fe9b","modified":1503028182000},{"_id":"source/_posts/how-to-create-a-nodejs-spider.md","hash":"d568f266ae7988f70699171def04ea46d1ebcb73","modified":1513319306000},{"_id":"source/_posts/js-array.md","hash":"7dc7cb066f22a02ba1a629616dd57e8531359a32","modified":1513921783000},{"_id":"source/_posts/js-equal-and-implicitcoercion.md","hash":"f276649c04984a9e7cace12735a0c507aea2124c","modified":1509100956000},{"_id":"source/_posts/js-error-type.md","hash":"4c9ed42e90c170eeacc9a4d6e59ca097f24cd880","modified":1512114604000},{"_id":"source/_posts/module-and-requirejs.md","hash":"516b7a2f0c138d4250c91373df7dde76cf99309b","modified":1505814847000},{"_id":"source/_posts/nodejs-start.md","hash":"5f52c41ee359b0ce70a48bb52b1ce230f0441344","modified":1513926976000},{"_id":"source/_posts/monitor-errorlog-partone.md","hash":"32c9f6197027c76208b04fdf221f8e7addbcfc72","modified":1519969323000},{"_id":"source/_posts/note-style.md","hash":"aa81dff6ea01c4425b961cae46fe11d72fb1e0af","modified":1504854051000},{"_id":"source/_posts/npm-install-module-from-github.md","hash":"7a52d25622c931d4cad2aabb0c92d2fd50056dd8","modified":1519969324000},{"_id":"source/_posts/optimize-browser-rendering.md","hash":"412e6c77990028b781e06fd8016f92a62a49c224","modified":1504853588000},{"_id":"source/_posts/npm.md","hash":"a80c75b5928765dab6d0726d32b9868f0b181753","modified":1512114604000},{"_id":"source/_posts/puppeteer-getting-started.md","hash":"10b1f9857385f886416ecfeac5bae2e4a3131701","modified":1521258169000},{"_id":"source/_posts/requirejs-qa.md","hash":"321a4b4bdaf1b922b8afa99e8ff84824504eed8a","modified":1510907652000},{"_id":"source/_posts/reviwe-source-account.md","hash":"3ebb6423b4f2141e368b0036c32d4a643433978c","modified":1519969324000},{"_id":"source/_posts/something-about-canvas.md","hash":"3112f02670c95e4ae1d9a0a27cd08ab4272292b9","modified":1513319306000},{"_id":"source/_posts/source-ivf-assistant.md","hash":"3da2e82a42d8f201ee311a9d7156802995cc966e","modified":1510908346000},{"_id":"source/_posts/upload.md","hash":"cc139f7443f7624daa65af5f66ca697865e559d6","modified":1509100956000},{"_id":"source/_posts/vue-ali-health.md","hash":"e296219d1d1c1cc2831ce46ec002abb59ffe0187","modified":1505814821000},{"_id":"source/_posts/vue-demo-dev-server.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 10.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 11.md","hash":"4fb94f3e91ef2b3f7b5fbad73783cb209568de42","modified":1521300949000},{"_id":"source/_posts/vue-demo-dev-server的副本 12.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 14.md","hash":"290cbf70d7b78c60117f52dfba8d1fca7476ceb7","modified":1521300952000},{"_id":"source/_posts/vue-demo-dev-server的副本 13.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 16.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 15.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 17.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 18.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 19.md","hash":"ab67bc41f82eb9589bed92391676bdd5719d912f","modified":1521300955000},{"_id":"source/_posts/vue-demo-dev-server的副本 2.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 21.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 20.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 23.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 22.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 24.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 25.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 26.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 27.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 28.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 3.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 29.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 30.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 31.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 33.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 35.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 32.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 34.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 36.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 6.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 4.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 7.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 5.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/about/index.md","hash":"26fb66e3cb2b5c21aaa7968f1eccd84fc7ee8227","modified":1521342648000},{"_id":"source/_posts/vue-demo-dev-server的副本 9.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/_posts/vue-demo-dev-server的副本 8.md","hash":"0772365e98cef0ee5b6f735c280738380545924a","modified":1513319603000},{"_id":"source/bak/hello-world - 副本 (10).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (11).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (2).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (3).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (5).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (4).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (7).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (6).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (8).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本 (9).md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world - 副本.md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"source/bak/hello-world.md","hash":"f285bc88d3414d0c4a916cd886fccd6424567cbc","modified":1521104508000},{"_id":"themes/eleven/languages/default.yml","hash":"f92db30b818ae4aac54d65fa8cc8f822170aaa0c","modified":1521341643000},{"_id":"themes/eleven/languages/zh-CN.yml","hash":"15d13ac0217cf2968998564e53da832ff545e75e","modified":1521341653000},{"_id":"themes/eleven/layout/about.ejs","hash":"4527846f1d65a1a99d130d22cb54c3e49be7fb51","modified":1521341595000},{"_id":"themes/eleven/layout/index.ejs","hash":"a1e773009138ca4415337ead32cbee6708f21462","modified":1521104601000},{"_id":"themes/eleven/layout/archive.ejs","hash":"72fdc319d394f73aa92d3dfde6e384c329de8529","modified":1521307157000},{"_id":"themes/eleven/layout/layout.ejs","hash":"8706056d7a38b5d3bee1792d447d8f2523344028","modified":1521307561000},{"_id":"themes/eleven/layout/post.ejs","hash":"e44c09a04cb327696e872fd196c9227f61f562d5","modified":1521252175000},{"_id":"themes/eleven/layout/_partial/footer.ejs","hash":"af5205fefcc4cddd458f70a68127e30f6f41ac4b","modified":1521341518000},{"_id":"themes/eleven/layout/_partial/head.ejs","hash":"e608b86d82bf823cb05396b50f8f37cebe22b756","modified":1521307245000},{"_id":"themes/eleven/layout/_partial/header.ejs","hash":"f9c141ce55f3073be141b9391e3e2d81cc2ce73e","modified":1521305035000},{"_id":"themes/eleven/layout/_partial/paginator.ejs","hash":"058db85a8691d0d3276faed00625ff1828c4e4bd","modified":1521300359000},{"_id":"themes/eleven/node_modules/github-markdown-css/github-markdown.css","hash":"c5cb70d18007a29462e21a2b3e643b05f2db10cd","modified":1514724793000},{"_id":"themes/eleven/node_modules/github-markdown-css/license","hash":"5aaf48196ddd4d007a3067aa7f30303ca8e4b29c","modified":1496344655000},{"_id":"themes/eleven/node_modules/github-markdown-css/package.json","hash":"d7902ecec709c61d4b7551fefd61dd38bf1a4225","modified":1521251862000},{"_id":"themes/eleven/node_modules/github-markdown-css/readme.md","hash":"44a0b748822f37a225dfcd2dd4efbd88e9d3b9e3","modified":1508050465000},{"_id":"themes/eleven/source/css/_var.less","hash":"a4dd103ea31e2091ce08b31bdd0862dce555acdb","modified":1521340590000},{"_id":"themes/eleven/source/css/style.less","hash":"1adb5b0840b7f17c528efdf321778468ca09184a","modified":1521340280000},{"_id":"themes/eleven/source/css/_partial/archive.less","hash":"dc9160d062c9373e18c7ca7300a193d75f23023f","modified":1521340800000},{"_id":"themes/eleven/source/css/_partial/highlight.less","hash":"ff062b33c0ba739d0d3facc0dd2f966cb69c8dda","modified":1521300904000},{"_id":"themes/eleven/source/css/_partial/paginator.less","hash":"d16084e799d4e5c21ea8a72d0b82f2dd2a0d86db","modified":1521340717000},{"_id":"themes/eleven/source/css/_partial/markdown.less","hash":"c5cb70d18007a29462e21a2b3e643b05f2db10cd","modified":1521252499000},{"_id":"themes/eleven/source/css/_partial/post.less","hash":"72dfa23ac793e602d62f67e65a75dfdd4405fa66","modified":1521340579000},{"_id":"themes/eleven/source/css/_partial/common/footer.less","hash":"60e1a87008437775b9bd4c63f9191c4f3fc30292","modified":1521340879000},{"_id":"themes/eleven/source/css/_partial/common/header.less","hash":"7af362e067e8453aa076a3182827e77035400a0b","modified":1521340155000}],"Category":[],"Data":[],"Page":[{"title":"about","_content":"\nasdfas","source":"about/index.md","raw":"---\ntitle: about\n---\n\nasdfas","date":"2018-03-18T03:10:48.000Z","updated":"2018-03-18T03:10:48.000Z","path":"about/index.html","_id":"cjew84oah0001uo2eab8n7f4z","comments":1,"layout":"page","content":"<p>asdfas</p>\n","site":{"data":{}},"excerpt":"","more":"<p>asdfas</p>\n"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (10).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (10).html","comments":1,"layout":"page","_id":"cjew84oaj0003uo2e1vrn3rhs","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (11).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (11).html","comments":1,"layout":"page","_id":"cjew84oap0006uo2egux64xzd","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (2).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (2).html","comments":1,"layout":"page","_id":"cjew84oaw0008uo2ex94mtu0d","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (3).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (3).html","comments":1,"layout":"page","_id":"cjew84ob0000buo2e5thgau77","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (5).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (5).html","comments":1,"layout":"page","_id":"cjew84obb000euo2eh41w9fwb","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (4).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (4).html","comments":1,"layout":"page","_id":"cjew84obj000huo2ebw1wfiux","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (7).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (7).html","comments":1,"layout":"page","_id":"cjew84obm000kuo2ehcq3moo2","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (6).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (6).html","comments":1,"layout":"page","_id":"cjew84obr000muo2ethx3cl5v","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (8).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (8).html","comments":1,"layout":"page","_id":"cjew84obu000puo2e3tgl1t6s","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本 (9).md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本 (9).html","comments":1,"layout":"page","_id":"cjew84obw000ruo2en6ux3fxs","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world - 副本.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world - 副本.html","comments":1,"layout":"page","_id":"cjew84oc0000uuo2eibcfs69z","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"bak/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!-- more -->\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","date":"2018-03-16T11:17:15.000Z","updated":"2018-03-15T09:01:48.000Z","path":"bak/hello-world.html","comments":1,"layout":"page","_id":"cjew84oc3000xuo2e59p7dc6w","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>\n<a id=\"more\"></a>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"noopener\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"noopener\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"noopener\">GitHub</a>.</p>","more":"<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>"}],"Post":[{"title":"Proxy","date":"2018-01-25T16:00:00.000Z","_content":"### 概述\nProxy是程序开发中一种常见的设计模式。这种类型的代理和ES6 proxy要做的就很类似了，涉及到使用类(B)去包装类(A)并拦截/控制对(A)的访问。\n当你想进行以下操作时proxy模式通常会很有用：\n+ 拦截或控制对某个对象的访问\n+ 通过隐藏事务或辅助逻辑来减小方法/类的复杂性\n+ 防止在未经验证/准备的情况下执行重度依赖资源的操作\n<!--more-->\nProxy 用于修改某些操作的默认行为，等同于在语言层面做出修改，所以属于一种“元编程”（meta programming），即对编程语言进行编程。\n\nProxy 可以理解成，在目标对象之前架设一层“拦截”，外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写。Proxy 这个词的原意是代理，用在这里表示由它来“代理”某些操作，可以译为“代理器”。\n\n### ES6中的Proxy\nProxy构造器可以在全局对象上访问到。通过它，你可以有效的拦截针对对象的各种操作，收集访问的信息，并按你的意愿返回任何值。从这个角度来说，proxy和中间件有很多相似之处。\n\n具体来说，proxy允许你拦截许多对象上常用的方法和属性，最常见的有get，set，ownKeys, has，apply。关于使用proxy可以拦截的方法的完整列表，请[参考规范](http://www.ecma-international.org/ecma-262/6.0/#sec-proxy-object-internal-methods-and-internal-slots)。Proxy还可以配置成随时停止接受请求，有效的取消所有针对被代理的目标对象的访问。\n\n### Proxy的实现\n```javascript\nvar target = {};\nvar handler = {};\nvar proxy = new Proxy(target, handler);\n\nproxy.name = \"proxy\";\nconsole.log(proxy.name);        // \"proxy\"\nconsole.log(target.name);       // \"proxy\"\n\ntarget.name = \"target\";\nconsole.log(proxy.name);        // \"target\"\nconsole.log(target.name);       // \"target\"\n```\nproxy将所有操作直接转发到目标。当\"proxy\"分配给proxy.name属性，target.name就创建了。代理本身并不存储此属性；它只是将操作转发到目标同样，proxy.name以及target.name是相同的，因为它们都是引用target.name。这也意味着设置target.name一个新的值，proxy.name将反映出相同的变化。\nhandler是一个空对象，没有任何拦截效果，访问proxy就等同于访问target。\n\n### get方法\n```javascript\n//定义一个对象person\nvar person = {\"name\":\"张飞\"};\n//创建一个代理对象proxy，代理person的读写操作\nvar proxy = new Proxy(person,{\n  get:function(target,property){\n    return \"赵云\"\n  }\n});\n\nproxy.name;//赵云\n```\n先定义一个对象，含有name属性，值为“张飞”,创建一个代理对象proxy，对象person的操作都交给代理对象proxy，如果你要读取person对象的name属性，就要用proxy.name，而不是person的name。我们看到的结果是：“赵云”，而不是person对象重点张飞，因为代理过程中，get方法实现了拦截的作用，不管你读取什么属性，我都返回“赵云”。\n\n### set方法\n通过设置set“拦截器”，我们可以在设置值之前添加自定义验证。 如果该值不符合验证，我们可以抛出一个错误！\n```javascript\n//定义一个对象，含有RMB和dollar属性值\nvar cash = {\"RMB\":2000,\"dollar\":0};\n//创建一个Proxy代理实例\nvar account = new Proxy(cash,{\n  //编写get处理程序\n  get:function(target, property){\n    //判断余额是否大于0\n    if(target[property] > 0){\n      //有余额，就返回余额值\n      return target[property];\n    }else{\n      //没钱了\n      return \"余额不足\";\n    }    \n  },\n  //编写set处理程序\n  set:function(target,property,value){\n    //存入的数额必须是一个数字类型\n    if(!Number.isInteger(value)){\n      return \"请设置正确的数值\";\n    }\n    //修改属性的值\n    target[property] = value;\n  }\n});\naccount.RMB;\n//结果：2000\naccount.dollar;\n//结果：余额不足\n\n//修改dollar属性的值，值是字符串类型\naccount.dollar = \"五百\";\naccount.dollar;\n//结果：余额不足\n//修改dollar属性的值，值是数字类型\naccount.dollar = 500;\naccount.dollar;\n//结果：500\n\n```\n### ownKeys方法\nownKeys方法用来拦截对象自身属性的读取操作。具体来说，拦截以下操作。\n```javascript\n//定义一个对象serve，有三个属性\nlet serve = {\"name\":\"抽血\",\"price\":400,\"need\":\"空腹\"};\n\n//创建一个代理对象\nlet proxy = new Proxy(serve,{\n  //ownKeys过滤对对象的属性遍历\n  ownKeys:function(target){\n    return [\"name\",\"price\"]\n  }\n});\n\nObject.keys(serve);\n//结果：[\"name\", \"price\",\"need\"]\n\nObject.keys(proxy);\n//结果：[\"name\", \"price\"]\n```\n### has方法\nhas方法用来拦截HasProperty操作，即判断对象是否具有某个属性时，这个方法会生效。\n```javascript\nvar goods = {\n  \"name\":\"大米\",\n  \"weight\":30\n};\n\nvar proxy = new Proxy(goods, {\n  has: function(target, prop) {\n    if(target[prop] === undefined){\n      return false;\n    }else{\n      return true;\n    }\n  }\n});\n\n\"name\" in proxy;//结果：true\n\"height\" in proxy;//结果：false\n\n```\n### apply()方法\n除了对象类型的变量可以被代理，函数也可以被代理。如果被代理的变量是一个函数，那么还会支持一个拦截程序：apply调用。\napply方法拦截函数的调用、call和apply操作。\napply方法可以接受三个参数，分别是目标对象、目标对象的上下文对象（this）和目标对象的参数数组。\n```javascript\n//创建一个函数fn\nlet fn = function(){\n  alert('这是在app');\n};\n//创建一个代理实例，代理函数fn\nlet proxy = new Proxy(fn,{\n  apply:function(){\n    alert('这是在微信');\n  }\n});\nproxy();//结果：这是在微信\n```\n\n### 参考及应用\n[ECMAScript 6 入门(第三版)-阮一峰](http://es6.ruanyifeng.com/)\n[Understanding ECMAScript 6](https://leanpub.com/understandinges6/read#)\n[Javascript Proxy对象 简介](http://www.zcfy.cc/article/an-intro-to-javascript-proxy-objects-camp-vanilla)\n[探索两种优雅的表单验证——策略设计模式和ES6的Proxy代理模式](https://github.com/jawil/blog/issues/19)\n[6种ES6 proxies的使用案例](http://www.zcfy.cc/article/6-compelling-use-cases-for-es6-proxies-888.html)","source":"_posts/Proxy.md","raw":"---\ntitle: Proxy\ndate: 2018-01-26\ntags: javascript\n---\n### 概述\nProxy是程序开发中一种常见的设计模式。这种类型的代理和ES6 proxy要做的就很类似了，涉及到使用类(B)去包装类(A)并拦截/控制对(A)的访问。\n当你想进行以下操作时proxy模式通常会很有用：\n+ 拦截或控制对某个对象的访问\n+ 通过隐藏事务或辅助逻辑来减小方法/类的复杂性\n+ 防止在未经验证/准备的情况下执行重度依赖资源的操作\n<!--more-->\nProxy 用于修改某些操作的默认行为，等同于在语言层面做出修改，所以属于一种“元编程”（meta programming），即对编程语言进行编程。\n\nProxy 可以理解成，在目标对象之前架设一层“拦截”，外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写。Proxy 这个词的原意是代理，用在这里表示由它来“代理”某些操作，可以译为“代理器”。\n\n### ES6中的Proxy\nProxy构造器可以在全局对象上访问到。通过它，你可以有效的拦截针对对象的各种操作，收集访问的信息，并按你的意愿返回任何值。从这个角度来说，proxy和中间件有很多相似之处。\n\n具体来说，proxy允许你拦截许多对象上常用的方法和属性，最常见的有get，set，ownKeys, has，apply。关于使用proxy可以拦截的方法的完整列表，请[参考规范](http://www.ecma-international.org/ecma-262/6.0/#sec-proxy-object-internal-methods-and-internal-slots)。Proxy还可以配置成随时停止接受请求，有效的取消所有针对被代理的目标对象的访问。\n\n### Proxy的实现\n```javascript\nvar target = {};\nvar handler = {};\nvar proxy = new Proxy(target, handler);\n\nproxy.name = \"proxy\";\nconsole.log(proxy.name);        // \"proxy\"\nconsole.log(target.name);       // \"proxy\"\n\ntarget.name = \"target\";\nconsole.log(proxy.name);        // \"target\"\nconsole.log(target.name);       // \"target\"\n```\nproxy将所有操作直接转发到目标。当\"proxy\"分配给proxy.name属性，target.name就创建了。代理本身并不存储此属性；它只是将操作转发到目标同样，proxy.name以及target.name是相同的，因为它们都是引用target.name。这也意味着设置target.name一个新的值，proxy.name将反映出相同的变化。\nhandler是一个空对象，没有任何拦截效果，访问proxy就等同于访问target。\n\n### get方法\n```javascript\n//定义一个对象person\nvar person = {\"name\":\"张飞\"};\n//创建一个代理对象proxy，代理person的读写操作\nvar proxy = new Proxy(person,{\n  get:function(target,property){\n    return \"赵云\"\n  }\n});\n\nproxy.name;//赵云\n```\n先定义一个对象，含有name属性，值为“张飞”,创建一个代理对象proxy，对象person的操作都交给代理对象proxy，如果你要读取person对象的name属性，就要用proxy.name，而不是person的name。我们看到的结果是：“赵云”，而不是person对象重点张飞，因为代理过程中，get方法实现了拦截的作用，不管你读取什么属性，我都返回“赵云”。\n\n### set方法\n通过设置set“拦截器”，我们可以在设置值之前添加自定义验证。 如果该值不符合验证，我们可以抛出一个错误！\n```javascript\n//定义一个对象，含有RMB和dollar属性值\nvar cash = {\"RMB\":2000,\"dollar\":0};\n//创建一个Proxy代理实例\nvar account = new Proxy(cash,{\n  //编写get处理程序\n  get:function(target, property){\n    //判断余额是否大于0\n    if(target[property] > 0){\n      //有余额，就返回余额值\n      return target[property];\n    }else{\n      //没钱了\n      return \"余额不足\";\n    }    \n  },\n  //编写set处理程序\n  set:function(target,property,value){\n    //存入的数额必须是一个数字类型\n    if(!Number.isInteger(value)){\n      return \"请设置正确的数值\";\n    }\n    //修改属性的值\n    target[property] = value;\n  }\n});\naccount.RMB;\n//结果：2000\naccount.dollar;\n//结果：余额不足\n\n//修改dollar属性的值，值是字符串类型\naccount.dollar = \"五百\";\naccount.dollar;\n//结果：余额不足\n//修改dollar属性的值，值是数字类型\naccount.dollar = 500;\naccount.dollar;\n//结果：500\n\n```\n### ownKeys方法\nownKeys方法用来拦截对象自身属性的读取操作。具体来说，拦截以下操作。\n```javascript\n//定义一个对象serve，有三个属性\nlet serve = {\"name\":\"抽血\",\"price\":400,\"need\":\"空腹\"};\n\n//创建一个代理对象\nlet proxy = new Proxy(serve,{\n  //ownKeys过滤对对象的属性遍历\n  ownKeys:function(target){\n    return [\"name\",\"price\"]\n  }\n});\n\nObject.keys(serve);\n//结果：[\"name\", \"price\",\"need\"]\n\nObject.keys(proxy);\n//结果：[\"name\", \"price\"]\n```\n### has方法\nhas方法用来拦截HasProperty操作，即判断对象是否具有某个属性时，这个方法会生效。\n```javascript\nvar goods = {\n  \"name\":\"大米\",\n  \"weight\":30\n};\n\nvar proxy = new Proxy(goods, {\n  has: function(target, prop) {\n    if(target[prop] === undefined){\n      return false;\n    }else{\n      return true;\n    }\n  }\n});\n\n\"name\" in proxy;//结果：true\n\"height\" in proxy;//结果：false\n\n```\n### apply()方法\n除了对象类型的变量可以被代理，函数也可以被代理。如果被代理的变量是一个函数，那么还会支持一个拦截程序：apply调用。\napply方法拦截函数的调用、call和apply操作。\napply方法可以接受三个参数，分别是目标对象、目标对象的上下文对象（this）和目标对象的参数数组。\n```javascript\n//创建一个函数fn\nlet fn = function(){\n  alert('这是在app');\n};\n//创建一个代理实例，代理函数fn\nlet proxy = new Proxy(fn,{\n  apply:function(){\n    alert('这是在微信');\n  }\n});\nproxy();//结果：这是在微信\n```\n\n### 参考及应用\n[ECMAScript 6 入门(第三版)-阮一峰](http://es6.ruanyifeng.com/)\n[Understanding ECMAScript 6](https://leanpub.com/understandinges6/read#)\n[Javascript Proxy对象 简介](http://www.zcfy.cc/article/an-intro-to-javascript-proxy-objects-camp-vanilla)\n[探索两种优雅的表单验证——策略设计模式和ES6的Proxy代理模式](https://github.com/jawil/blog/issues/19)\n[6种ES6 proxies的使用案例](http://www.zcfy.cc/article/6-compelling-use-cases-for-es6-proxies-888.html)","slug":"Proxy","published":1,"updated":"2018-03-02T05:42:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oac0000uo2eukrdnt51","content":"<h3 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h3><p>Proxy是程序开发中一种常见的设计模式。这种类型的代理和ES6 proxy要做的就很类似了，涉及到使用类(B)去包装类(A)并拦截/控制对(A)的访问。<br>当你想进行以下操作时proxy模式通常会很有用：</p>\n<ul>\n<li>拦截或控制对某个对象的访问</li>\n<li>通过隐藏事务或辅助逻辑来减小方法/类的复杂性</li>\n<li>防止在未经验证/准备的情况下执行重度依赖资源的操作<a id=\"more\"></a>\nProxy 用于修改某些操作的默认行为，等同于在语言层面做出修改，所以属于一种“元编程”（meta programming），即对编程语言进行编程。</li>\n</ul>\n<p>Proxy 可以理解成，在目标对象之前架设一层“拦截”，外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写。Proxy 这个词的原意是代理，用在这里表示由它来“代理”某些操作，可以译为“代理器”。</p>\n<h3 id=\"ES6中的Proxy\"><a href=\"#ES6中的Proxy\" class=\"headerlink\" title=\"ES6中的Proxy\"></a>ES6中的Proxy</h3><p>Proxy构造器可以在全局对象上访问到。通过它，你可以有效的拦截针对对象的各种操作，收集访问的信息，并按你的意愿返回任何值。从这个角度来说，proxy和中间件有很多相似之处。</p>\n<p>具体来说，proxy允许你拦截许多对象上常用的方法和属性，最常见的有get，set，ownKeys, has，apply。关于使用proxy可以拦截的方法的完整列表，请<a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-proxy-object-internal-methods-and-internal-slots\" target=\"_blank\" rel=\"noopener\">参考规范</a>。Proxy还可以配置成随时停止接受请求，有效的取消所有针对被代理的目标对象的访问。</p>\n<h3 id=\"Proxy的实现\"><a href=\"#Proxy的实现\" class=\"headerlink\" title=\"Proxy的实现\"></a>Proxy的实现</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> target = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> handler = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(target, handler);</span><br><span class=\"line\"></span><br><span class=\"line\">proxy.name = <span class=\"string\">\"proxy\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(proxy.name);        <span class=\"comment\">// \"proxy\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(target.name);       <span class=\"comment\">// \"proxy\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">target.name = <span class=\"string\">\"target\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(proxy.name);        <span class=\"comment\">// \"target\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(target.name);       <span class=\"comment\">// \"target\"</span></span><br></pre></td></tr></table></figure>\n<p>proxy将所有操作直接转发到目标。当”proxy”分配给proxy.name属性，target.name就创建了。代理本身并不存储此属性；它只是将操作转发到目标同样，proxy.name以及target.name是相同的，因为它们都是引用target.name。这也意味着设置target.name一个新的值，proxy.name将反映出相同的变化。<br>handler是一个空对象，没有任何拦截效果，访问proxy就等同于访问target。</p>\n<h3 id=\"get方法\"><a href=\"#get方法\" class=\"headerlink\" title=\"get方法\"></a>get方法</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个对象person</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"张飞\"</span>&#125;;</span><br><span class=\"line\"><span class=\"comment\">//创建一个代理对象proxy，代理person的读写操作</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(person,&#123;</span><br><span class=\"line\">  get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target,property</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"赵云\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">proxy.name;<span class=\"comment\">//赵云</span></span><br></pre></td></tr></table></figure>\n<p>先定义一个对象，含有name属性，值为“张飞”,创建一个代理对象proxy，对象person的操作都交给代理对象proxy，如果你要读取person对象的name属性，就要用proxy.name，而不是person的name。我们看到的结果是：“赵云”，而不是person对象重点张飞，因为代理过程中，get方法实现了拦截的作用，不管你读取什么属性，我都返回“赵云”。</p>\n<h3 id=\"set方法\"><a href=\"#set方法\" class=\"headerlink\" title=\"set方法\"></a>set方法</h3><p>通过设置set“拦截器”，我们可以在设置值之前添加自定义验证。 如果该值不符合验证，我们可以抛出一个错误！<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个对象，含有RMB和dollar属性值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cash = &#123;<span class=\"string\">\"RMB\"</span>:<span class=\"number\">2000</span>,<span class=\"string\">\"dollar\"</span>:<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\"><span class=\"comment\">//创建一个Proxy代理实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> account = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(cash,&#123;</span><br><span class=\"line\">  <span class=\"comment\">//编写get处理程序</span></span><br><span class=\"line\">  get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target, property</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//判断余额是否大于0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target[property] &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      <span class=\"comment\">//有余额，就返回余额值</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> target[property];</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//没钱了</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"余额不足\"</span>;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//编写set处理程序</span></span><br><span class=\"line\">  set:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target,property,value</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//存入的数额必须是一个数字类型</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"built_in\">Number</span>.isInteger(value))&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"请设置正确的数值\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//修改属性的值</span></span><br><span class=\"line\">    target[property] = value;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">account.RMB;</span><br><span class=\"line\"><span class=\"comment\">//结果：2000</span></span><br><span class=\"line\">account.dollar;</span><br><span class=\"line\"><span class=\"comment\">//结果：余额不足</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//修改dollar属性的值，值是字符串类型</span></span><br><span class=\"line\">account.dollar = <span class=\"string\">\"五百\"</span>;</span><br><span class=\"line\">account.dollar;</span><br><span class=\"line\"><span class=\"comment\">//结果：余额不足</span></span><br><span class=\"line\"><span class=\"comment\">//修改dollar属性的值，值是数字类型</span></span><br><span class=\"line\">account.dollar = <span class=\"number\">500</span>;</span><br><span class=\"line\">account.dollar;</span><br><span class=\"line\"><span class=\"comment\">//结果：500</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"ownKeys方法\"><a href=\"#ownKeys方法\" class=\"headerlink\" title=\"ownKeys方法\"></a>ownKeys方法</h3><p>ownKeys方法用来拦截对象自身属性的读取操作。具体来说，拦截以下操作。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个对象serve，有三个属性</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> serve = &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"抽血\"</span>,<span class=\"string\">\"price\"</span>:<span class=\"number\">400</span>,<span class=\"string\">\"need\"</span>:<span class=\"string\">\"空腹\"</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建一个代理对象</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(serve,&#123;</span><br><span class=\"line\">  <span class=\"comment\">//ownKeys过滤对对象的属性遍历</span></span><br><span class=\"line\">  ownKeys:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"string\">\"name\"</span>,<span class=\"string\">\"price\"</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys(serve);</span><br><span class=\"line\"><span class=\"comment\">//结果：[\"name\", \"price\",\"need\"]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys(proxy);</span><br><span class=\"line\"><span class=\"comment\">//结果：[\"name\", \"price\"]</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"has方法\"><a href=\"#has方法\" class=\"headerlink\" title=\"has方法\"></a>has方法</h3><p>has方法用来拦截HasProperty操作，即判断对象是否具有某个属性时，这个方法会生效。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> goods = &#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>:<span class=\"string\">\"大米\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"weight\"</span>:<span class=\"number\">30</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(goods, &#123;</span><br><span class=\"line\">  has: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target, prop</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target[prop] === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\"name\"</span> <span class=\"keyword\">in</span> proxy;<span class=\"comment\">//结果：true</span></span><br><span class=\"line\"><span class=\"string\">\"height\"</span> <span class=\"keyword\">in</span> proxy;<span class=\"comment\">//结果：false</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"apply-方法\"><a href=\"#apply-方法\" class=\"headerlink\" title=\"apply()方法\"></a>apply()方法</h3><p>除了对象类型的变量可以被代理，函数也可以被代理。如果被代理的变量是一个函数，那么还会支持一个拦截程序：apply调用。<br>apply方法拦截函数的调用、call和apply操作。<br>apply方法可以接受三个参数，分别是目标对象、目标对象的上下文对象（this）和目标对象的参数数组。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建一个函数fn</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'这是在app'</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//创建一个代理实例，代理函数fn</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(fn,&#123;</span><br><span class=\"line\">  apply:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'这是在微信'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">proxy();<span class=\"comment\">//结果：这是在微信</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"参考及应用\"><a href=\"#参考及应用\" class=\"headerlink\" title=\"参考及应用\"></a>参考及应用</h3><p><a href=\"http://es6.ruanyifeng.com/\" target=\"_blank\" rel=\"noopener\">ECMAScript 6 入门(第三版)-阮一峰</a><br><a href=\"https://leanpub.com/understandinges6/read#\" target=\"_blank\" rel=\"noopener\">Understanding ECMAScript 6</a><br><a href=\"http://www.zcfy.cc/article/an-intro-to-javascript-proxy-objects-camp-vanilla\" target=\"_blank\" rel=\"noopener\">Javascript Proxy对象 简介</a><br><a href=\"https://github.com/jawil/blog/issues/19\" target=\"_blank\" rel=\"noopener\">探索两种优雅的表单验证——策略设计模式和ES6的Proxy代理模式</a><br><a href=\"http://www.zcfy.cc/article/6-compelling-use-cases-for-es6-proxies-888.html\" target=\"_blank\" rel=\"noopener\">6种ES6 proxies的使用案例</a></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h3><p>Proxy是程序开发中一种常见的设计模式。这种类型的代理和ES6 proxy要做的就很类似了，涉及到使用类(B)去包装类(A)并拦截/控制对(A)的访问。<br>当你想进行以下操作时proxy模式通常会很有用：</p>\n<ul>\n<li>拦截或控制对某个对象的访问</li>\n<li>通过隐藏事务或辅助逻辑来减小方法/类的复杂性</li>\n<li>防止在未经验证/准备的情况下执行重度依赖资源的操作","more":"Proxy 用于修改某些操作的默认行为，等同于在语言层面做出修改，所以属于一种“元编程”（meta programming），即对编程语言进行编程。</li>\n</ul>\n<p>Proxy 可以理解成，在目标对象之前架设一层“拦截”，外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写。Proxy 这个词的原意是代理，用在这里表示由它来“代理”某些操作，可以译为“代理器”。</p>\n<h3 id=\"ES6中的Proxy\"><a href=\"#ES6中的Proxy\" class=\"headerlink\" title=\"ES6中的Proxy\"></a>ES6中的Proxy</h3><p>Proxy构造器可以在全局对象上访问到。通过它，你可以有效的拦截针对对象的各种操作，收集访问的信息，并按你的意愿返回任何值。从这个角度来说，proxy和中间件有很多相似之处。</p>\n<p>具体来说，proxy允许你拦截许多对象上常用的方法和属性，最常见的有get，set，ownKeys, has，apply。关于使用proxy可以拦截的方法的完整列表，请<a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-proxy-object-internal-methods-and-internal-slots\" target=\"_blank\" rel=\"noopener\">参考规范</a>。Proxy还可以配置成随时停止接受请求，有效的取消所有针对被代理的目标对象的访问。</p>\n<h3 id=\"Proxy的实现\"><a href=\"#Proxy的实现\" class=\"headerlink\" title=\"Proxy的实现\"></a>Proxy的实现</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> target = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> handler = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(target, handler);</span><br><span class=\"line\"></span><br><span class=\"line\">proxy.name = <span class=\"string\">\"proxy\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(proxy.name);        <span class=\"comment\">// \"proxy\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(target.name);       <span class=\"comment\">// \"proxy\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">target.name = <span class=\"string\">\"target\"</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(proxy.name);        <span class=\"comment\">// \"target\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(target.name);       <span class=\"comment\">// \"target\"</span></span><br></pre></td></tr></table></figure>\n<p>proxy将所有操作直接转发到目标。当”proxy”分配给proxy.name属性，target.name就创建了。代理本身并不存储此属性；它只是将操作转发到目标同样，proxy.name以及target.name是相同的，因为它们都是引用target.name。这也意味着设置target.name一个新的值，proxy.name将反映出相同的变化。<br>handler是一个空对象，没有任何拦截效果，访问proxy就等同于访问target。</p>\n<h3 id=\"get方法\"><a href=\"#get方法\" class=\"headerlink\" title=\"get方法\"></a>get方法</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个对象person</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"张飞\"</span>&#125;;</span><br><span class=\"line\"><span class=\"comment\">//创建一个代理对象proxy，代理person的读写操作</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(person,&#123;</span><br><span class=\"line\">  get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target,property</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"赵云\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">proxy.name;<span class=\"comment\">//赵云</span></span><br></pre></td></tr></table></figure>\n<p>先定义一个对象，含有name属性，值为“张飞”,创建一个代理对象proxy，对象person的操作都交给代理对象proxy，如果你要读取person对象的name属性，就要用proxy.name，而不是person的name。我们看到的结果是：“赵云”，而不是person对象重点张飞，因为代理过程中，get方法实现了拦截的作用，不管你读取什么属性，我都返回“赵云”。</p>\n<h3 id=\"set方法\"><a href=\"#set方法\" class=\"headerlink\" title=\"set方法\"></a>set方法</h3><p>通过设置set“拦截器”，我们可以在设置值之前添加自定义验证。 如果该值不符合验证，我们可以抛出一个错误！<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个对象，含有RMB和dollar属性值</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> cash = &#123;<span class=\"string\">\"RMB\"</span>:<span class=\"number\">2000</span>,<span class=\"string\">\"dollar\"</span>:<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\"><span class=\"comment\">//创建一个Proxy代理实例</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> account = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(cash,&#123;</span><br><span class=\"line\">  <span class=\"comment\">//编写get处理程序</span></span><br><span class=\"line\">  get:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target, property</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//判断余额是否大于0</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target[property] &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      <span class=\"comment\">//有余额，就返回余额值</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> target[property];</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//没钱了</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"余额不足\"</span>;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//编写set处理程序</span></span><br><span class=\"line\">  set:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target,property,value</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//存入的数额必须是一个数字类型</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!<span class=\"built_in\">Number</span>.isInteger(value))&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"请设置正确的数值\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//修改属性的值</span></span><br><span class=\"line\">    target[property] = value;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">account.RMB;</span><br><span class=\"line\"><span class=\"comment\">//结果：2000</span></span><br><span class=\"line\">account.dollar;</span><br><span class=\"line\"><span class=\"comment\">//结果：余额不足</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//修改dollar属性的值，值是字符串类型</span></span><br><span class=\"line\">account.dollar = <span class=\"string\">\"五百\"</span>;</span><br><span class=\"line\">account.dollar;</span><br><span class=\"line\"><span class=\"comment\">//结果：余额不足</span></span><br><span class=\"line\"><span class=\"comment\">//修改dollar属性的值，值是数字类型</span></span><br><span class=\"line\">account.dollar = <span class=\"number\">500</span>;</span><br><span class=\"line\">account.dollar;</span><br><span class=\"line\"><span class=\"comment\">//结果：500</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"ownKeys方法\"><a href=\"#ownKeys方法\" class=\"headerlink\" title=\"ownKeys方法\"></a>ownKeys方法</h3><p>ownKeys方法用来拦截对象自身属性的读取操作。具体来说，拦截以下操作。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个对象serve，有三个属性</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> serve = &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"抽血\"</span>,<span class=\"string\">\"price\"</span>:<span class=\"number\">400</span>,<span class=\"string\">\"need\"</span>:<span class=\"string\">\"空腹\"</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//创建一个代理对象</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(serve,&#123;</span><br><span class=\"line\">  <span class=\"comment\">//ownKeys过滤对对象的属性遍历</span></span><br><span class=\"line\">  ownKeys:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"string\">\"name\"</span>,<span class=\"string\">\"price\"</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys(serve);</span><br><span class=\"line\"><span class=\"comment\">//结果：[\"name\", \"price\",\"need\"]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys(proxy);</span><br><span class=\"line\"><span class=\"comment\">//结果：[\"name\", \"price\"]</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"has方法\"><a href=\"#has方法\" class=\"headerlink\" title=\"has方法\"></a>has方法</h3><p>has方法用来拦截HasProperty操作，即判断对象是否具有某个属性时，这个方法会生效。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> goods = &#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>:<span class=\"string\">\"大米\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"weight\"</span>:<span class=\"number\">30</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(goods, &#123;</span><br><span class=\"line\">  has: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target, prop</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(target[prop] === <span class=\"literal\">undefined</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\"name\"</span> <span class=\"keyword\">in</span> proxy;<span class=\"comment\">//结果：true</span></span><br><span class=\"line\"><span class=\"string\">\"height\"</span> <span class=\"keyword\">in</span> proxy;<span class=\"comment\">//结果：false</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"apply-方法\"><a href=\"#apply-方法\" class=\"headerlink\" title=\"apply()方法\"></a>apply()方法</h3><p>除了对象类型的变量可以被代理，函数也可以被代理。如果被代理的变量是一个函数，那么还会支持一个拦截程序：apply调用。<br>apply方法拦截函数的调用、call和apply操作。<br>apply方法可以接受三个参数，分别是目标对象、目标对象的上下文对象（this）和目标对象的参数数组。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建一个函数fn</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'这是在app'</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//创建一个代理实例，代理函数fn</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> proxy = <span class=\"keyword\">new</span> <span class=\"built_in\">Proxy</span>(fn,&#123;</span><br><span class=\"line\">  apply:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'这是在微信'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">proxy();<span class=\"comment\">//结果：这是在微信</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"参考及应用\"><a href=\"#参考及应用\" class=\"headerlink\" title=\"参考及应用\"></a>参考及应用</h3><p><a href=\"http://es6.ruanyifeng.com/\" target=\"_blank\" rel=\"noopener\">ECMAScript 6 入门(第三版)-阮一峰</a><br><a href=\"https://leanpub.com/understandinges6/read#\" target=\"_blank\" rel=\"noopener\">Understanding ECMAScript 6</a><br><a href=\"http://www.zcfy.cc/article/an-intro-to-javascript-proxy-objects-camp-vanilla\" target=\"_blank\" rel=\"noopener\">Javascript Proxy对象 简介</a><br><a href=\"https://github.com/jawil/blog/issues/19\" target=\"_blank\" rel=\"noopener\">探索两种优雅的表单验证——策略设计模式和ES6的Proxy代理模式</a><br><a href=\"http://www.zcfy.cc/article/6-compelling-use-cases-for-es6-proxies-888.html\" target=\"_blank\" rel=\"noopener\">6种ES6 proxies的使用案例</a></p>"},{"title":"Closure","date":"2017-11-02T16:00:00.000Z","_content":"\n\njavascript 闭包是一个抽象的词,但在我们实际项目却是经常用到的。因此，今天就来了解一下什么是闭包吧~\n\n<!-- more -->\n\n### 释义\n \n  函数对象可以通过作用域链相互关联起来，函数体内部变量都可以保存在函数作用域内\n\n  简单的说就是内部函数可以访问它们所在的外部函数中声明的所有局部变量、参数和声明的其他内部函数。\n  当其中一个这样的内部函数在包含它们的外部函数之外被调用时，就会形成闭包。\n\n  <img src=\"/img/closure/closure.gif\" alt=\"closure\" />\n  <center>(闭包关联到函数和变量)</center>\n\n\n  实现闭包需要满足以下3个条件\n\n  1. 访问所在作用域;\n  2. 函数嵌套;\n  3. 在所在作用域外被调用;\n\n\n### 简单的展现形式 \n  \n\n  ```js\n\n    var fn1 = function(){\n\n      var max = 10;\n\n      function fn2(n){\n        if (n > max) {\n          console.log(n++)\n        }\n      }\n      \n      return fn2\n    }\n   \n    var fn = fn1();\n    fn(15)\n\n  ```\n\n### 特性\n\n  + 作为函数变量的一个引用。当函数返回时，其处于激活状态。\n  + 闭包就是当一个函数返回时，并没有释放资源的栈区。\n\n### 优点\n\n  + 逻辑连续，当闭包作为另一个函数调用参数时，避免脱离当前逻辑而单独编写额外逻辑。\n  + 方便调用上下文的局部变量\n  + 加强封装性，是第2点的延伸，可以达到对变量的保护作用。\n\n### 缺点\n  + 由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。\n  + 闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。\n\n### 用途\n\n  1. 匿名自执行函数\n\n  ```js\n    var data= {    \n        table : [],    \n        tree : {}    \n    };    \n         \n    (function(dm){    \n        for(var i = 0; i < dm.table.rows; i++){    \n           var row = dm.table.rows[i];    \n           for(var j = 0; j < row.cells; i++){    \n               drawCell(i, j);    \n           }    \n        }    \n           \n    })(data);\n  ```\n  2. 结果缓存\n\n  ```js\n    var CachedSearchBox = (function(){    \n        var cache = {},    \n           count = [];    \n        return {    \n           attachSearchBox : function(dsid){    \n               if(dsid in cache){//如果结果在缓存中    \n                  return cache[dsid];//直接返回缓存中的对象    \n               }    \n               var fsb = new uikit.webctrl.SearchBox(dsid);//新建    \n               cache[dsid] = fsb;//更新缓存    \n               if(count.length > 100){//保正缓存的大小<=100    \n                  delete cache[count.shift()];    \n               }    \n               return fsb;          \n           },    \n         \n           clearSearchBox : function(dsid){    \n               if(dsid in cache){    \n                  cache[dsid].clearSelection();      \n               }    \n           }    \n        };    \n    })();    \n        \n    CachedSearchBox.attachSearchBox(\"input\"); \n  ```\n\n  3. 封装\n\n   ```js\n    var person = function(){    \n      //变量作用域为函数内部，外部无法访问    \n      var name = \"default\";       \n         \n      return {    \n         getName : function(){    \n             return name;    \n         },    \n         setName : function(newName){    \n             name = newName;    \n         }    \n      }    \n    }();   \n\n    console.log(person.name);//直接访问，结果为undefined    \n    console.log(person.getName());    \n    person.setName(\"abruzzi\");    \n    console.log(person.getName()); \n  ```\n\n  4. 实现类和继承  \n\n   ```js\n    function Person(){    \n      var name = \"default\";       \n         \n      return {    \n         getName : function(){    \n             return name;    \n         },    \n         setName : function(newName){    \n             name = newName;    \n         }    \n      }    \n    };\n    var p = new Person();\n    p.setName(\"Tom\");\n    console.log(p.getName());\n    var Jack = function(){};\n    //继承自Person\n    Jack.prototype = new Person();\n    //添加私有方法\n    Jack.prototype.Say = function(){\n        console.log(\"Hello,my name is Jack\");\n    };\n    var j = new Jack();\n    j.setName(\"Jack\");\n    j.Say();\n    console.log(j.getName()); \n  ```\n\n\n\n## 参考资料及拓展阅读\n\n  深入理解javascript原型和闭包 http://www.cnblogs.com/wangfupeng1988/p/3994065.html\n  Javascript闭包的几种用法 http://www.cnblogs.com/wyaocn/p/5807032.html\n\n","source":"_posts/closure.md","raw":"---\ntitle: Closure\ndate: 2017-11-03\ntags:\n - javascript\n---\n\n\njavascript 闭包是一个抽象的词,但在我们实际项目却是经常用到的。因此，今天就来了解一下什么是闭包吧~\n\n<!-- more -->\n\n### 释义\n \n  函数对象可以通过作用域链相互关联起来，函数体内部变量都可以保存在函数作用域内\n\n  简单的说就是内部函数可以访问它们所在的外部函数中声明的所有局部变量、参数和声明的其他内部函数。\n  当其中一个这样的内部函数在包含它们的外部函数之外被调用时，就会形成闭包。\n\n  <img src=\"/img/closure/closure.gif\" alt=\"closure\" />\n  <center>(闭包关联到函数和变量)</center>\n\n\n  实现闭包需要满足以下3个条件\n\n  1. 访问所在作用域;\n  2. 函数嵌套;\n  3. 在所在作用域外被调用;\n\n\n### 简单的展现形式 \n  \n\n  ```js\n\n    var fn1 = function(){\n\n      var max = 10;\n\n      function fn2(n){\n        if (n > max) {\n          console.log(n++)\n        }\n      }\n      \n      return fn2\n    }\n   \n    var fn = fn1();\n    fn(15)\n\n  ```\n\n### 特性\n\n  + 作为函数变量的一个引用。当函数返回时，其处于激活状态。\n  + 闭包就是当一个函数返回时，并没有释放资源的栈区。\n\n### 优点\n\n  + 逻辑连续，当闭包作为另一个函数调用参数时，避免脱离当前逻辑而单独编写额外逻辑。\n  + 方便调用上下文的局部变量\n  + 加强封装性，是第2点的延伸，可以达到对变量的保护作用。\n\n### 缺点\n  + 由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。\n  + 闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。\n\n### 用途\n\n  1. 匿名自执行函数\n\n  ```js\n    var data= {    \n        table : [],    \n        tree : {}    \n    };    \n         \n    (function(dm){    \n        for(var i = 0; i < dm.table.rows; i++){    \n           var row = dm.table.rows[i];    \n           for(var j = 0; j < row.cells; i++){    \n               drawCell(i, j);    \n           }    \n        }    \n           \n    })(data);\n  ```\n  2. 结果缓存\n\n  ```js\n    var CachedSearchBox = (function(){    \n        var cache = {},    \n           count = [];    \n        return {    \n           attachSearchBox : function(dsid){    \n               if(dsid in cache){//如果结果在缓存中    \n                  return cache[dsid];//直接返回缓存中的对象    \n               }    \n               var fsb = new uikit.webctrl.SearchBox(dsid);//新建    \n               cache[dsid] = fsb;//更新缓存    \n               if(count.length > 100){//保正缓存的大小<=100    \n                  delete cache[count.shift()];    \n               }    \n               return fsb;          \n           },    \n         \n           clearSearchBox : function(dsid){    \n               if(dsid in cache){    \n                  cache[dsid].clearSelection();      \n               }    \n           }    \n        };    \n    })();    \n        \n    CachedSearchBox.attachSearchBox(\"input\"); \n  ```\n\n  3. 封装\n\n   ```js\n    var person = function(){    \n      //变量作用域为函数内部，外部无法访问    \n      var name = \"default\";       \n         \n      return {    \n         getName : function(){    \n             return name;    \n         },    \n         setName : function(newName){    \n             name = newName;    \n         }    \n      }    \n    }();   \n\n    console.log(person.name);//直接访问，结果为undefined    \n    console.log(person.getName());    \n    person.setName(\"abruzzi\");    \n    console.log(person.getName()); \n  ```\n\n  4. 实现类和继承  \n\n   ```js\n    function Person(){    \n      var name = \"default\";       \n         \n      return {    \n         getName : function(){    \n             return name;    \n         },    \n         setName : function(newName){    \n             name = newName;    \n         }    \n      }    \n    };\n    var p = new Person();\n    p.setName(\"Tom\");\n    console.log(p.getName());\n    var Jack = function(){};\n    //继承自Person\n    Jack.prototype = new Person();\n    //添加私有方法\n    Jack.prototype.Say = function(){\n        console.log(\"Hello,my name is Jack\");\n    };\n    var j = new Jack();\n    j.setName(\"Jack\");\n    j.Say();\n    console.log(j.getName()); \n  ```\n\n\n\n## 参考资料及拓展阅读\n\n  深入理解javascript原型和闭包 http://www.cnblogs.com/wangfupeng1988/p/3994065.html\n  Javascript闭包的几种用法 http://www.cnblogs.com/wyaocn/p/5807032.html\n\n","slug":"closure","published":1,"updated":"2017-11-17T08:34:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oai0002uo2epzjiyunw","content":"<p>javascript 闭包是一个抽象的词,但在我们实际项目却是经常用到的。因此，今天就来了解一下什么是闭包吧~</p>\n<a id=\"more\"></a>\n<h3 id=\"释义\"><a href=\"#释义\" class=\"headerlink\" title=\"释义\"></a>释义</h3><p>  函数对象可以通过作用域链相互关联起来，函数体内部变量都可以保存在函数作用域内</p>\n<p>  简单的说就是内部函数可以访问它们所在的外部函数中声明的所有局部变量、参数和声明的其他内部函数。<br>  当其中一个这样的内部函数在包含它们的外部函数之外被调用时，就会形成闭包。</p>\n<p>  <img src=\"/img/closure/closure.gif\" alt=\"closure\"><br>  <center>(闭包关联到函数和变量)</center></p>\n<p>  实现闭包需要满足以下3个条件</p>\n<ol>\n<li>访问所在作用域;</li>\n<li>函数嵌套;</li>\n<li>在所在作用域外被调用;</li>\n</ol>\n<h3 id=\"简单的展现形式\"><a href=\"#简单的展现形式\" class=\"headerlink\" title=\"简单的展现形式\"></a>简单的展现形式</h3>  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn1 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> max = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn2</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &gt; max) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(n++)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn2</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"keyword\">var</span> fn = fn1();</span><br><span class=\"line\">fn(<span class=\"number\">15</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h3><ul>\n<li>作为函数变量的一个引用。当函数返回时，其处于激活状态。</li>\n<li>闭包就是当一个函数返回时，并没有释放资源的栈区。</li>\n</ul>\n<h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>逻辑连续，当闭包作为另一个函数调用参数时，避免脱离当前逻辑而单独编写额外逻辑。</li>\n<li>方便调用上下文的局部变量</li>\n<li>加强封装性，是第2点的延伸，可以达到对变量的保护作用。</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。</li>\n<li>闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。</li>\n</ul>\n<h3 id=\"用途\"><a href=\"#用途\" class=\"headerlink\" title=\"用途\"></a>用途</h3><ol>\n<li><p>匿名自执行函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data= &#123;    </span><br><span class=\"line\">    table : [],    </span><br><span class=\"line\">    tree : &#123;&#125;    </span><br><span class=\"line\">&#125;;    </span><br><span class=\"line\">     </span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">dm</span>)</span>&#123;    </span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; dm.table.rows; i++)&#123;    </span><br><span class=\"line\">       <span class=\"keyword\">var</span> row = dm.table.rows[i];    </span><br><span class=\"line\">       <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; row.cells; i++)&#123;    </span><br><span class=\"line\">           drawCell(i, j);    </span><br><span class=\"line\">       &#125;    </span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">       </span><br><span class=\"line\">&#125;)(data);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>结果缓存</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> CachedSearchBox = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> cache = &#123;&#125;,    </span><br><span class=\"line\">       count = [];    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">       attachSearchBox : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">dsid</span>)</span>&#123;    </span><br><span class=\"line\">           <span class=\"keyword\">if</span>(dsid <span class=\"keyword\">in</span> cache)&#123;<span class=\"comment\">//如果结果在缓存中    </span></span><br><span class=\"line\">              <span class=\"keyword\">return</span> cache[dsid];<span class=\"comment\">//直接返回缓存中的对象    </span></span><br><span class=\"line\">           &#125;    </span><br><span class=\"line\">           <span class=\"keyword\">var</span> fsb = <span class=\"keyword\">new</span> uikit.webctrl.SearchBox(dsid);<span class=\"comment\">//新建    </span></span><br><span class=\"line\">           cache[dsid] = fsb;<span class=\"comment\">//更新缓存    </span></span><br><span class=\"line\">           <span class=\"keyword\">if</span>(count.length &gt; <span class=\"number\">100</span>)&#123;<span class=\"comment\">//保正缓存的大小&lt;=100    </span></span><br><span class=\"line\">              <span class=\"keyword\">delete</span> cache[count.shift()];    </span><br><span class=\"line\">           &#125;    </span><br><span class=\"line\">           <span class=\"keyword\">return</span> fsb;          </span><br><span class=\"line\">       &#125;,    </span><br><span class=\"line\">     </span><br><span class=\"line\">       clearSearchBox : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">dsid</span>)</span>&#123;    </span><br><span class=\"line\">           <span class=\"keyword\">if</span>(dsid <span class=\"keyword\">in</span> cache)&#123;    </span><br><span class=\"line\">              cache[dsid].clearSelection();      </span><br><span class=\"line\">           &#125;    </span><br><span class=\"line\">       &#125;    </span><br><span class=\"line\">    &#125;;    </span><br><span class=\"line\">&#125;)();    </span><br><span class=\"line\">    </span><br><span class=\"line\">CachedSearchBox.attachSearchBox(<span class=\"string\">\"input\"</span>);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>封装</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">  <span class=\"comment\">//变量作用域为函数内部，外部无法访问    </span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">     </span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">     getName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">         <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">     &#125;,    </span><br><span class=\"line\">     setName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>&#123;    </span><br><span class=\"line\">         name = newName;    </span><br><span class=\"line\">     &#125;    </span><br><span class=\"line\">  &#125;    </span><br><span class=\"line\">&#125;();   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name);<span class=\"comment\">//直接访问，结果为undefined    </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());    </span><br><span class=\"line\">person.setName(<span class=\"string\">\"abruzzi\"</span>);    </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>实现类和继承  </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">     </span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">     getName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">         <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">     &#125;,    </span><br><span class=\"line\">     setName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>&#123;    </span><br><span class=\"line\">         name = newName;    </span><br><span class=\"line\">     &#125;    </span><br><span class=\"line\">  &#125;    </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">p.setName(<span class=\"string\">\"Tom\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p.getName());</span><br><span class=\"line\"><span class=\"keyword\">var</span> Jack = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\"><span class=\"comment\">//继承自Person</span></span><br><span class=\"line\">Jack.prototype = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"><span class=\"comment\">//添加私有方法</span></span><br><span class=\"line\">Jack.prototype.Say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Hello,my name is Jack\"</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> j = <span class=\"keyword\">new</span> Jack();</span><br><span class=\"line\">j.setName(<span class=\"string\">\"Jack\"</span>);</span><br><span class=\"line\">j.Say();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(j.getName());</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"参考资料及拓展阅读\"><a href=\"#参考资料及拓展阅读\" class=\"headerlink\" title=\"参考资料及拓展阅读\"></a>参考资料及拓展阅读</h2><p>  深入理解javascript原型和闭包 <a href=\"http://www.cnblogs.com/wangfupeng1988/p/3994065.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/wangfupeng1988/p/3994065.html</a><br>  Javascript闭包的几种用法 <a href=\"http://www.cnblogs.com/wyaocn/p/5807032.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/wyaocn/p/5807032.html</a></p>\n","site":{"data":{}},"excerpt":"<p>javascript 闭包是一个抽象的词,但在我们实际项目却是经常用到的。因此，今天就来了解一下什么是闭包吧~</p>","more":"<h3 id=\"释义\"><a href=\"#释义\" class=\"headerlink\" title=\"释义\"></a>释义</h3><p>  函数对象可以通过作用域链相互关联起来，函数体内部变量都可以保存在函数作用域内</p>\n<p>  简单的说就是内部函数可以访问它们所在的外部函数中声明的所有局部变量、参数和声明的其他内部函数。<br>  当其中一个这样的内部函数在包含它们的外部函数之外被调用时，就会形成闭包。</p>\n<p>  <img src=\"/img/closure/closure.gif\" alt=\"closure\"><br>  <center>(闭包关联到函数和变量)</center></p>\n<p>  实现闭包需要满足以下3个条件</p>\n<ol>\n<li>访问所在作用域;</li>\n<li>函数嵌套;</li>\n<li>在所在作用域外被调用;</li>\n</ol>\n<h3 id=\"简单的展现形式\"><a href=\"#简单的展现形式\" class=\"headerlink\" title=\"简单的展现形式\"></a>简单的展现形式</h3>  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> fn1 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> max = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn2</span>(<span class=\"params\">n</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &gt; max) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(n++)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> fn2</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"keyword\">var</span> fn = fn1();</span><br><span class=\"line\">fn(<span class=\"number\">15</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h3><ul>\n<li>作为函数变量的一个引用。当函数返回时，其处于激活状态。</li>\n<li>闭包就是当一个函数返回时，并没有释放资源的栈区。</li>\n</ul>\n<h3 id=\"优点\"><a href=\"#优点\" class=\"headerlink\" title=\"优点\"></a>优点</h3><ul>\n<li>逻辑连续，当闭包作为另一个函数调用参数时，避免脱离当前逻辑而单独编写额外逻辑。</li>\n<li>方便调用上下文的局部变量</li>\n<li>加强封装性，是第2点的延伸，可以达到对变量的保护作用。</li>\n</ul>\n<h3 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点\"></a>缺点</h3><ul>\n<li>由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。</li>\n<li>闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。</li>\n</ul>\n<h3 id=\"用途\"><a href=\"#用途\" class=\"headerlink\" title=\"用途\"></a>用途</h3><ol>\n<li><p>匿名自执行函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data= &#123;    </span><br><span class=\"line\">    table : [],    </span><br><span class=\"line\">    tree : &#123;&#125;    </span><br><span class=\"line\">&#125;;    </span><br><span class=\"line\">     </span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">dm</span>)</span>&#123;    </span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; dm.table.rows; i++)&#123;    </span><br><span class=\"line\">       <span class=\"keyword\">var</span> row = dm.table.rows[i];    </span><br><span class=\"line\">       <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; row.cells; i++)&#123;    </span><br><span class=\"line\">           drawCell(i, j);    </span><br><span class=\"line\">       &#125;    </span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">       </span><br><span class=\"line\">&#125;)(data);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>结果缓存</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> CachedSearchBox = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> cache = &#123;&#125;,    </span><br><span class=\"line\">       count = [];    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">       attachSearchBox : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">dsid</span>)</span>&#123;    </span><br><span class=\"line\">           <span class=\"keyword\">if</span>(dsid <span class=\"keyword\">in</span> cache)&#123;<span class=\"comment\">//如果结果在缓存中    </span></span><br><span class=\"line\">              <span class=\"keyword\">return</span> cache[dsid];<span class=\"comment\">//直接返回缓存中的对象    </span></span><br><span class=\"line\">           &#125;    </span><br><span class=\"line\">           <span class=\"keyword\">var</span> fsb = <span class=\"keyword\">new</span> uikit.webctrl.SearchBox(dsid);<span class=\"comment\">//新建    </span></span><br><span class=\"line\">           cache[dsid] = fsb;<span class=\"comment\">//更新缓存    </span></span><br><span class=\"line\">           <span class=\"keyword\">if</span>(count.length &gt; <span class=\"number\">100</span>)&#123;<span class=\"comment\">//保正缓存的大小&lt;=100    </span></span><br><span class=\"line\">              <span class=\"keyword\">delete</span> cache[count.shift()];    </span><br><span class=\"line\">           &#125;    </span><br><span class=\"line\">           <span class=\"keyword\">return</span> fsb;          </span><br><span class=\"line\">       &#125;,    </span><br><span class=\"line\">     </span><br><span class=\"line\">       clearSearchBox : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">dsid</span>)</span>&#123;    </span><br><span class=\"line\">           <span class=\"keyword\">if</span>(dsid <span class=\"keyword\">in</span> cache)&#123;    </span><br><span class=\"line\">              cache[dsid].clearSelection();      </span><br><span class=\"line\">           &#125;    </span><br><span class=\"line\">       &#125;    </span><br><span class=\"line\">    &#125;;    </span><br><span class=\"line\">&#125;)();    </span><br><span class=\"line\">    </span><br><span class=\"line\">CachedSearchBox.attachSearchBox(<span class=\"string\">\"input\"</span>);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>封装</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> person = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">  <span class=\"comment\">//变量作用域为函数内部，外部无法访问    </span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">     </span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">     getName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">         <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">     &#125;,    </span><br><span class=\"line\">     setName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>&#123;    </span><br><span class=\"line\">         name = newName;    </span><br><span class=\"line\">     &#125;    </span><br><span class=\"line\">  &#125;    </span><br><span class=\"line\">&#125;();   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.name);<span class=\"comment\">//直接访问，结果为undefined    </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());    </span><br><span class=\"line\">person.setName(<span class=\"string\">\"abruzzi\"</span>);    </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(person.getName());</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>实现类和继承  </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Person</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"string\">\"default\"</span>;       </span><br><span class=\"line\">     </span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;    </span><br><span class=\"line\">     getName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;    </span><br><span class=\"line\">         <span class=\"keyword\">return</span> name;    </span><br><span class=\"line\">     &#125;,    </span><br><span class=\"line\">     setName : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newName</span>)</span>&#123;    </span><br><span class=\"line\">         name = newName;    </span><br><span class=\"line\">     &#125;    </span><br><span class=\"line\">  &#125;    </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">p.setName(<span class=\"string\">\"Tom\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(p.getName());</span><br><span class=\"line\"><span class=\"keyword\">var</span> Jack = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\"><span class=\"comment\">//继承自Person</span></span><br><span class=\"line\">Jack.prototype = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\"><span class=\"comment\">//添加私有方法</span></span><br><span class=\"line\">Jack.prototype.Say = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Hello,my name is Jack\"</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> j = <span class=\"keyword\">new</span> Jack();</span><br><span class=\"line\">j.setName(<span class=\"string\">\"Jack\"</span>);</span><br><span class=\"line\">j.Say();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(j.getName());</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"参考资料及拓展阅读\"><a href=\"#参考资料及拓展阅读\" class=\"headerlink\" title=\"参考资料及拓展阅读\"></a>参考资料及拓展阅读</h2><p>  深入理解javascript原型和闭包 <a href=\"http://www.cnblogs.com/wangfupeng1988/p/3994065.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/wangfupeng1988/p/3994065.html</a><br>  Javascript闭包的几种用法 <a href=\"http://www.cnblogs.com/wyaocn/p/5807032.html\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/wyaocn/p/5807032.html</a></p>"},{"title":"组件从零开始","date":"2017-09-19T16:00:00.000Z","_content":"\n## 思考需求\n\n### 需求效果\n+ 服务器端加载\n+ 浏览器端加载（requirejs）\n\n<!--more-->\n\n### 加载方式\n```js\n// server\nconst bzLogin = require('bz-login');\n\n// client-html\nrequire(['mod/bz-login/0.1.0/bz-login'], function (bzLogin) {\n}\n  \n// client-js\ndefine(function (require, exports, module) {\n  var bzLogin = require('mod/bz-login/0.1.0/bz-login');\n  var bzShare = require('mod/bz-share/0.1.0/bz-share-debug');\n});\n```\n\n### 从新开始\n\n基础骨架搭建\n\n#### 初始化配置\n\n```bash\n$ npm init\n```\n\n创建package配置包，同时定义打包脚本npm run build\n```json\n// package.json\n{\n  \"name\": \"bz-login\",\n  \"version\": \"0.1.0\",\n  \"description\": \"播种网登录模块\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"build\": \"node ./build/build.js\"\n  },\n  \"author\": \"Garwi\",\n  \"license\": \"MIT\"\n}\n```\n\n#### 目录\n\n创建构建脚本目录build，以及源文件目录src\n\n```directory\n﹀ project\n  ﹥ build\n      build.js\n  ﹥ src\n      index.js\n     package.json\n     README.md\n```\n\n#### 源码开发\n\n实际的业务逻辑开发，这里不一一列举\n\n```js\n// src/index.js\nfunction afterAppLogin () {\n  // login\n}\nexport default {\n  afterAppLogin,\n  afterAllLogin,\n  isApp,\n  isAndroidApp,\n  isIosApp,\n  getLink,\n};\n```\n\n#### 代码检查\n\n开发完通过攻击检查代码，安装eslint，同时配置npm run eslint脚本\n```js\n// package.json\n{\n  \"name\": \"bz-login\",\n  \"scripts\": {\n    \"build\": \"node ./build/build.js\",\n    \"lint\": \"eslint ./src/index.js\"\n  },\n  \"devDependencies\": {\n    \"eslint\": \"^4.5.0\",\n    \"eslint-config-airbnb-base\": \"^11.3.2\",\n    \"eslint-plugin-import\": \"^2.7.0\",\n  }\n}\n```\n\n```js\n// .eslintrc\n{\n  \"extends\": \"airbnb-base\",\n  \"rules\": {\n    \"no-console\": 0,\n    \"no-alert\": 0,\n    \"no-unused-expressions\": [2, {\n      \"allowShortCircuit\": true\n    }],\n    \"no-underscore-dangle\": 0\n  },\n  \"globals\": {\n    \"$\": true,\n    \"window\": true,\n    \"document\": true\n  }\n}\n```\n\n#### 打包压缩\n\n工具库选型，需要自己更加实际项目去寻找各个各样的工具库\n+ rollup 打包（vue）\n+ uglify-js 代码压缩\n+ zlib 文件压缩\n\n#### 简化入库步骤\n\n打包完成后，需要手动复制打包完的文件到对应的版本库目录，繁琐无意义的操作。  \n优化：打包时自动打包到版本库目录（前提需要指定版本库目录）\n\n```bash\n$ npm config set bz-mod 'D:\\source'\n$ npm run build\n```\n\n需要配置bz-mod目录才能执行打包命令\n```js\n// build/config.js\nlet modulePath = process.env.npm_config_bz_mod;\nif (typeof modulePath === 'undefined') {\n  console.log('请先配置模块所在目录');\n  console.log('Example: npm config set bz-mod \"D:\\\\source\"');\n  throw new Error('没有配置模块路径');\n} else if (!exists(modulePath)) {\n  throw new Error('模块目录不存在，请检查配置的模块目录是否正确');\n} else {\n  modulePath = path.join(modulePath, name);\n  if (!exists(modulePath)) {\n    fs.mkdirSync(modulePath);\n  }\n  \n  modulePath = path.join(modulePath, version);\n  if (!exists(modulePath)) {\n    fs.mkdirSync(modulePath);\n  }\n}\n```\n\n实际打包代码\n```js\n// build/build.js\n\nconst fs = require('fs');\nconst path = require('path');\nconst zlib = require('zlib');\nconst rollup = require('rollup');\nconst uglify = require('uglify-js');\nconst builds = require('./config').getAllBuilds();\n\nbuild(builds);\n\nfunction build (builds) {\n  let built = 0;\n  const total = builds.length;\n  const next = () => {\n    buildEntry(builds[built]).then(() => {\n      built++;\n      if (built < total) {\n        next();\n      }\n    }).catch(logError);\n  };\n  next();\n}\n\nfunction buildEntry (config) {\n  const isProd = !/debug\\.js$/.test(config.output.file);\n  return rollup.rollup(config)\n    .then(bundle => bundle.generate(config.output))\n    .then(({ code }) => {\n      if (isProd) {\n        var minified = uglify.minify(code).code;\n        return write(config.output.file, minified, true);\n      } else {\n        return write(config.output.file, code);\n      }\n    });\n}\n\n// 输出文件并显示文件大小\nfunction write (dest, code, zip) {\n  fs.writeFile(dest, code, err => {\n    zlib.gzip(code, (err, zipped) => {});\n  });\n}\n```","source":"_posts/components-start.md","raw":"---\ntitle: 组件从零开始\ndate: 2017-09-20\ntags:\n - tutorial\n - components\n---\n\n## 思考需求\n\n### 需求效果\n+ 服务器端加载\n+ 浏览器端加载（requirejs）\n\n<!--more-->\n\n### 加载方式\n```js\n// server\nconst bzLogin = require('bz-login');\n\n// client-html\nrequire(['mod/bz-login/0.1.0/bz-login'], function (bzLogin) {\n}\n  \n// client-js\ndefine(function (require, exports, module) {\n  var bzLogin = require('mod/bz-login/0.1.0/bz-login');\n  var bzShare = require('mod/bz-share/0.1.0/bz-share-debug');\n});\n```\n\n### 从新开始\n\n基础骨架搭建\n\n#### 初始化配置\n\n```bash\n$ npm init\n```\n\n创建package配置包，同时定义打包脚本npm run build\n```json\n// package.json\n{\n  \"name\": \"bz-login\",\n  \"version\": \"0.1.0\",\n  \"description\": \"播种网登录模块\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"build\": \"node ./build/build.js\"\n  },\n  \"author\": \"Garwi\",\n  \"license\": \"MIT\"\n}\n```\n\n#### 目录\n\n创建构建脚本目录build，以及源文件目录src\n\n```directory\n﹀ project\n  ﹥ build\n      build.js\n  ﹥ src\n      index.js\n     package.json\n     README.md\n```\n\n#### 源码开发\n\n实际的业务逻辑开发，这里不一一列举\n\n```js\n// src/index.js\nfunction afterAppLogin () {\n  // login\n}\nexport default {\n  afterAppLogin,\n  afterAllLogin,\n  isApp,\n  isAndroidApp,\n  isIosApp,\n  getLink,\n};\n```\n\n#### 代码检查\n\n开发完通过攻击检查代码，安装eslint，同时配置npm run eslint脚本\n```js\n// package.json\n{\n  \"name\": \"bz-login\",\n  \"scripts\": {\n    \"build\": \"node ./build/build.js\",\n    \"lint\": \"eslint ./src/index.js\"\n  },\n  \"devDependencies\": {\n    \"eslint\": \"^4.5.0\",\n    \"eslint-config-airbnb-base\": \"^11.3.2\",\n    \"eslint-plugin-import\": \"^2.7.0\",\n  }\n}\n```\n\n```js\n// .eslintrc\n{\n  \"extends\": \"airbnb-base\",\n  \"rules\": {\n    \"no-console\": 0,\n    \"no-alert\": 0,\n    \"no-unused-expressions\": [2, {\n      \"allowShortCircuit\": true\n    }],\n    \"no-underscore-dangle\": 0\n  },\n  \"globals\": {\n    \"$\": true,\n    \"window\": true,\n    \"document\": true\n  }\n}\n```\n\n#### 打包压缩\n\n工具库选型，需要自己更加实际项目去寻找各个各样的工具库\n+ rollup 打包（vue）\n+ uglify-js 代码压缩\n+ zlib 文件压缩\n\n#### 简化入库步骤\n\n打包完成后，需要手动复制打包完的文件到对应的版本库目录，繁琐无意义的操作。  \n优化：打包时自动打包到版本库目录（前提需要指定版本库目录）\n\n```bash\n$ npm config set bz-mod 'D:\\source'\n$ npm run build\n```\n\n需要配置bz-mod目录才能执行打包命令\n```js\n// build/config.js\nlet modulePath = process.env.npm_config_bz_mod;\nif (typeof modulePath === 'undefined') {\n  console.log('请先配置模块所在目录');\n  console.log('Example: npm config set bz-mod \"D:\\\\source\"');\n  throw new Error('没有配置模块路径');\n} else if (!exists(modulePath)) {\n  throw new Error('模块目录不存在，请检查配置的模块目录是否正确');\n} else {\n  modulePath = path.join(modulePath, name);\n  if (!exists(modulePath)) {\n    fs.mkdirSync(modulePath);\n  }\n  \n  modulePath = path.join(modulePath, version);\n  if (!exists(modulePath)) {\n    fs.mkdirSync(modulePath);\n  }\n}\n```\n\n实际打包代码\n```js\n// build/build.js\n\nconst fs = require('fs');\nconst path = require('path');\nconst zlib = require('zlib');\nconst rollup = require('rollup');\nconst uglify = require('uglify-js');\nconst builds = require('./config').getAllBuilds();\n\nbuild(builds);\n\nfunction build (builds) {\n  let built = 0;\n  const total = builds.length;\n  const next = () => {\n    buildEntry(builds[built]).then(() => {\n      built++;\n      if (built < total) {\n        next();\n      }\n    }).catch(logError);\n  };\n  next();\n}\n\nfunction buildEntry (config) {\n  const isProd = !/debug\\.js$/.test(config.output.file);\n  return rollup.rollup(config)\n    .then(bundle => bundle.generate(config.output))\n    .then(({ code }) => {\n      if (isProd) {\n        var minified = uglify.minify(code).code;\n        return write(config.output.file, minified, true);\n      } else {\n        return write(config.output.file, code);\n      }\n    });\n}\n\n// 输出文件并显示文件大小\nfunction write (dest, code, zip) {\n  fs.writeFile(dest, code, err => {\n    zlib.gzip(code, (err, zipped) => {});\n  });\n}\n```","slug":"components-start","published":1,"updated":"2017-09-22T07:07:41.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oan0005uo2eeyoj2kqs","content":"<h2 id=\"思考需求\"><a href=\"#思考需求\" class=\"headerlink\" title=\"思考需求\"></a>思考需求</h2><h3 id=\"需求效果\"><a href=\"#需求效果\" class=\"headerlink\" title=\"需求效果\"></a>需求效果</h3><ul>\n<li>服务器端加载</li>\n<li>浏览器端加载（requirejs）</li>\n</ul>\n<a id=\"more\"></a>\n<h3 id=\"加载方式\"><a href=\"#加载方式\" class=\"headerlink\" title=\"加载方式\"></a>加载方式</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// server</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> bzLogin = <span class=\"built_in\">require</span>(<span class=\"string\">'bz-login'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// client-html</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'mod/bz-login/0.1.0/bz-login'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">bzLogin</span>) </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">// client-js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require, exports, module</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bzLogin = <span class=\"built_in\">require</span>(<span class=\"string\">'mod/bz-login/0.1.0/bz-login'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bzShare = <span class=\"built_in\">require</span>(<span class=\"string\">'mod/bz-share/0.1.0/bz-share-debug'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"从新开始\"><a href=\"#从新开始\" class=\"headerlink\" title=\"从新开始\"></a>从新开始</h3><p>基础骨架搭建</p>\n<h4 id=\"初始化配置\"><a href=\"#初始化配置\" class=\"headerlink\" title=\"初始化配置\"></a>初始化配置</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm init</span><br></pre></td></tr></table></figure>\n<p>创建package配置包，同时定义打包脚本npm run build<br><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// package.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"bz-login\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.1.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"播种网登录模块\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"main\"</span>: <span class=\"string\">\"index.js\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"node ./build/build.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"author\"</span>: <span class=\"string\">\"Garwi\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"MIT\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h4><p>创建构建脚本目录build，以及源文件目录src</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ project</span><br><span class=\"line\">  ﹥ build</span><br><span class=\"line\">      build.js</span><br><span class=\"line\">  ﹥ src</span><br><span class=\"line\">      index.js</span><br><span class=\"line\">     package.json</span><br><span class=\"line\">     README.md</span><br></pre></td></tr></table></figure>\n<h4 id=\"源码开发\"><a href=\"#源码开发\" class=\"headerlink\" title=\"源码开发\"></a>源码开发</h4><p>实际的业务逻辑开发，这里不一一列举</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/index.js</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">afterAppLogin</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// login</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  afterAppLogin,</span><br><span class=\"line\">  afterAllLogin,</span><br><span class=\"line\">  isApp,</span><br><span class=\"line\">  isAndroidApp,</span><br><span class=\"line\">  isIosApp,</span><br><span class=\"line\">  getLink,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"代码检查\"><a href=\"#代码检查\" class=\"headerlink\" title=\"代码检查\"></a>代码检查</h4><p>开发完通过攻击检查代码，安装eslint，同时配置npm run eslint脚本<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// package.json</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"bz-login\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: <span class=\"string\">\"node ./build/build.js\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"lint\"</span>: <span class=\"string\">\"eslint ./src/index.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"eslint\"</span>: <span class=\"string\">\"^4.5.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"eslint-config-airbnb-base\"</span>: <span class=\"string\">\"^11.3.2\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"eslint-plugin-import\"</span>: <span class=\"string\">\"^2.7.0\"</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// .eslintrc</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"extends\"</span>: <span class=\"string\">\"airbnb-base\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"rules\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"no-console\"</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"string\">\"no-alert\"</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"string\">\"no-unused-expressions\"</span>: [<span class=\"number\">2</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">\"allowShortCircuit\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;],</span><br><span class=\"line\">    <span class=\"string\">\"no-underscore-dangle\"</span>: <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"globals\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"$\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"window\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"document\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"打包压缩\"><a href=\"#打包压缩\" class=\"headerlink\" title=\"打包压缩\"></a>打包压缩</h4><p>工具库选型，需要自己更加实际项目去寻找各个各样的工具库</p>\n<ul>\n<li>rollup 打包（vue）</li>\n<li>uglify-js 代码压缩</li>\n<li>zlib 文件压缩</li>\n</ul>\n<h4 id=\"简化入库步骤\"><a href=\"#简化入库步骤\" class=\"headerlink\" title=\"简化入库步骤\"></a>简化入库步骤</h4><p>打包完成后，需要手动复制打包完的文件到对应的版本库目录，繁琐无意义的操作。<br>优化：打包时自动打包到版本库目录（前提需要指定版本库目录）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm config <span class=\"built_in\">set</span> bz-mod <span class=\"string\">'D:\\source'</span></span><br><span class=\"line\">$ npm run build</span><br></pre></td></tr></table></figure>\n<p>需要配置bz-mod目录才能执行打包命令<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/config.js</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> modulePath = process.env.npm_config_bz_mod;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> modulePath === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'请先配置模块所在目录'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Example: npm config set bz-mod \"D:\\\\source\"'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'没有配置模块路径'</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!exists(modulePath)) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'模块目录不存在，请检查配置的模块目录是否正确'</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  modulePath = path.join(modulePath, name);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!exists(modulePath)) &#123;</span><br><span class=\"line\">    fs.mkdirSync(modulePath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  modulePath = path.join(modulePath, version);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!exists(modulePath)) &#123;</span><br><span class=\"line\">    fs.mkdirSync(modulePath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>实际打包代码<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/build.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> zlib = <span class=\"built_in\">require</span>(<span class=\"string\">'zlib'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> rollup = <span class=\"built_in\">require</span>(<span class=\"string\">'rollup'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> uglify = <span class=\"built_in\">require</span>(<span class=\"string\">'uglify-js'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> builds = <span class=\"built_in\">require</span>(<span class=\"string\">'./config'</span>).getAllBuilds();</span><br><span class=\"line\"></span><br><span class=\"line\">build(builds);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">build</span> (<span class=\"params\">builds</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> built = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> total = builds.length;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> next = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    buildEntry(builds[built]).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      built++;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (built &lt; total) &#123;</span><br><span class=\"line\">        next();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;).catch(logError);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buildEntry</span> (<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isProd = !<span class=\"regexp\">/debug\\.js$/</span>.test(config.output.file);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> rollup.rollup(config)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">bundle</span> =&gt;</span> bundle.generate(config.output))</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">&#123; code &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isProd) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minified = uglify.minify(code).code;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> write(config.output.file, minified, <span class=\"literal\">true</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> write(config.output.file, code);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输出文件并显示文件大小</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span> (<span class=\"params\">dest, code, zip</span>) </span>&#123;</span><br><span class=\"line\">  fs.writeFile(dest, code, err =&gt; &#123;</span><br><span class=\"line\">    zlib.gzip(code, (err, zipped) =&gt; &#123;&#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"思考需求\"><a href=\"#思考需求\" class=\"headerlink\" title=\"思考需求\"></a>思考需求</h2><h3 id=\"需求效果\"><a href=\"#需求效果\" class=\"headerlink\" title=\"需求效果\"></a>需求效果</h3><ul>\n<li>服务器端加载</li>\n<li>浏览器端加载（requirejs）</li>\n</ul>","more":"<h3 id=\"加载方式\"><a href=\"#加载方式\" class=\"headerlink\" title=\"加载方式\"></a>加载方式</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// server</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> bzLogin = <span class=\"built_in\">require</span>(<span class=\"string\">'bz-login'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// client-html</span></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'mod/bz-login/0.1.0/bz-login'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">bzLogin</span>) </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">// client-js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require, exports, module</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bzLogin = <span class=\"built_in\">require</span>(<span class=\"string\">'mod/bz-login/0.1.0/bz-login'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> bzShare = <span class=\"built_in\">require</span>(<span class=\"string\">'mod/bz-share/0.1.0/bz-share-debug'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"从新开始\"><a href=\"#从新开始\" class=\"headerlink\" title=\"从新开始\"></a>从新开始</h3><p>基础骨架搭建</p>\n<h4 id=\"初始化配置\"><a href=\"#初始化配置\" class=\"headerlink\" title=\"初始化配置\"></a>初始化配置</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm init</span><br></pre></td></tr></table></figure>\n<p>创建package配置包，同时定义打包脚本npm run build<br><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// package.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"bz-login\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.1.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"播种网登录模块\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"main\"</span>: <span class=\"string\">\"index.js\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"node ./build/build.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"author\"</span>: <span class=\"string\">\"Garwi\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"MIT\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h4><p>创建构建脚本目录build，以及源文件目录src</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ project</span><br><span class=\"line\">  ﹥ build</span><br><span class=\"line\">      build.js</span><br><span class=\"line\">  ﹥ src</span><br><span class=\"line\">      index.js</span><br><span class=\"line\">     package.json</span><br><span class=\"line\">     README.md</span><br></pre></td></tr></table></figure>\n<h4 id=\"源码开发\"><a href=\"#源码开发\" class=\"headerlink\" title=\"源码开发\"></a>源码开发</h4><p>实际的业务逻辑开发，这里不一一列举</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/index.js</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">afterAppLogin</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// login</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  afterAppLogin,</span><br><span class=\"line\">  afterAllLogin,</span><br><span class=\"line\">  isApp,</span><br><span class=\"line\">  isAndroidApp,</span><br><span class=\"line\">  isIosApp,</span><br><span class=\"line\">  getLink,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"代码检查\"><a href=\"#代码检查\" class=\"headerlink\" title=\"代码检查\"></a>代码检查</h4><p>开发完通过攻击检查代码，安装eslint，同时配置npm run eslint脚本<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// package.json</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"bz-login\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: <span class=\"string\">\"node ./build/build.js\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"lint\"</span>: <span class=\"string\">\"eslint ./src/index.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"eslint\"</span>: <span class=\"string\">\"^4.5.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"eslint-config-airbnb-base\"</span>: <span class=\"string\">\"^11.3.2\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"eslint-plugin-import\"</span>: <span class=\"string\">\"^2.7.0\"</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// .eslintrc</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"extends\"</span>: <span class=\"string\">\"airbnb-base\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"rules\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"no-console\"</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"string\">\"no-alert\"</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"string\">\"no-unused-expressions\"</span>: [<span class=\"number\">2</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">\"allowShortCircuit\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;],</span><br><span class=\"line\">    <span class=\"string\">\"no-underscore-dangle\"</span>: <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"globals\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"$\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"window\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"document\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"打包压缩\"><a href=\"#打包压缩\" class=\"headerlink\" title=\"打包压缩\"></a>打包压缩</h4><p>工具库选型，需要自己更加实际项目去寻找各个各样的工具库</p>\n<ul>\n<li>rollup 打包（vue）</li>\n<li>uglify-js 代码压缩</li>\n<li>zlib 文件压缩</li>\n</ul>\n<h4 id=\"简化入库步骤\"><a href=\"#简化入库步骤\" class=\"headerlink\" title=\"简化入库步骤\"></a>简化入库步骤</h4><p>打包完成后，需要手动复制打包完的文件到对应的版本库目录，繁琐无意义的操作。<br>优化：打包时自动打包到版本库目录（前提需要指定版本库目录）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm config <span class=\"built_in\">set</span> bz-mod <span class=\"string\">'D:\\source'</span></span><br><span class=\"line\">$ npm run build</span><br></pre></td></tr></table></figure>\n<p>需要配置bz-mod目录才能执行打包命令<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/config.js</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> modulePath = process.env.npm_config_bz_mod;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> modulePath === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'请先配置模块所在目录'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Example: npm config set bz-mod \"D:\\\\source\"'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'没有配置模块路径'</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!exists(modulePath)) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'模块目录不存在，请检查配置的模块目录是否正确'</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  modulePath = path.join(modulePath, name);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!exists(modulePath)) &#123;</span><br><span class=\"line\">    fs.mkdirSync(modulePath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  modulePath = path.join(modulePath, version);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!exists(modulePath)) &#123;</span><br><span class=\"line\">    fs.mkdirSync(modulePath);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>实际打包代码<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/build.js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> zlib = <span class=\"built_in\">require</span>(<span class=\"string\">'zlib'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> rollup = <span class=\"built_in\">require</span>(<span class=\"string\">'rollup'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> uglify = <span class=\"built_in\">require</span>(<span class=\"string\">'uglify-js'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> builds = <span class=\"built_in\">require</span>(<span class=\"string\">'./config'</span>).getAllBuilds();</span><br><span class=\"line\"></span><br><span class=\"line\">build(builds);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">build</span> (<span class=\"params\">builds</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> built = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> total = builds.length;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> next = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    buildEntry(builds[built]).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      built++;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (built &lt; total) &#123;</span><br><span class=\"line\">        next();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;).catch(logError);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">buildEntry</span> (<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isProd = !<span class=\"regexp\">/debug\\.js$/</span>.test(config.output.file);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> rollup.rollup(config)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">bundle</span> =&gt;</span> bundle.generate(config.output))</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">&#123; code &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isProd) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> minified = uglify.minify(code).code;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> write(config.output.file, minified, <span class=\"literal\">true</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> write(config.output.file, code);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输出文件并显示文件大小</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span> (<span class=\"params\">dest, code, zip</span>) </span>&#123;</span><br><span class=\"line\">  fs.writeFile(dest, code, err =&gt; &#123;</span><br><span class=\"line\">    zlib.gzip(code, (err, zipped) =&gt; &#123;&#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>"},{"title":"CSS Background 属性解析","date":"2017-08-16T08:35:01.000Z","_content":"\n### background 全家桶简写形式\n `background: [background-color] [background-image] [background-attachment] [background-repeat]  [background-position] /[ background-size] [background-origin] [background-clip]`\n<!--more-->\n### CSS1常见属性\n\n* background-color 定义背景颜色\n    支持 英文颜色名词| rgb() | 十六进制颜色值 | transparent\n\n* background-image 定义背景图\n  `none` | `url`\n\n* background-position 定义背景图位置\n  支持 英文方位名词 | 长度值 | 百分比\n\n* background-repeat  定义背景图重复\n  `no-repaet` | `repeat` | `repeat-x` | `repeat-y`\n\n* background-attachment  定义背景图像是否固定或者随着页面的其余部分滚动\n  `inherit` | `scroll` | `fixed`\n\n## CSS3 background 新增属性\n\n* background-size 定义背景图片的尺寸\n  `contain` | `cover` | 长度值 ｜ 百分比\n\n* background-origin 定义背景图片的定位区域\n  `border-box` | `padding-box` | `content-box`\n\n* background-clip 定义背景的绘制区域\n  `border-box` | `padding-box` | `content-box` | `text`\n\n* background-blend-mode 定义背景图的混合模式\n  `normal`;           //正常\n  `multiply`;        //正片叠底\n  `screen`;          //滤色\n  `overlay`;         //叠加\n  `darken`;          //变暗\n  `lighten`;         //变亮\n  `color-dodge`;     //颜色减淡\n  `color-burn`;      //颜色加深\n  `hard-light`;      //强光\n  `soft-light`;      //柔光\n  `difference`;      //差值\n  `exclusion`;       //排除\n  `hue`;             //色相\n  `saturation`;      //饱和度\n  `color`;           //颜色\n  `luminosity`;      //亮度\n\n### 在css3中的对background 进行增强的属性\n  * background-color \n    `currentColor` 当前的标签所继承的文字颜色\n\n  * background-image 支持多背景用英文逗号隔开，增加渐变色属性\n    `linear-gradient` 使用线性渐变创建背景图像\n    `radial-gradient` 使用重复的线性渐变创建背景图像\n    `repeating-linear-gradient` 使用重复的线性渐变创建背景图像\n    `repeating-radial-gradient` 使用重复的径向(放射性)渐变创建背景图像\n\n  * background-repeat\n    `space` 图片以相同的间距平铺且填充整个标签元素 (相当于两端对齐而且background-position 属性会被忽略)\n    `round` 图片自动缩放直到适应且填充整个标签元素\n\n  * background-attachmen\n    `local` 背景相对于元素的内容固定 \n\n**********************************************************\n**** END ****\n\n\n**********************************************************\n\n\n### 示例演示\n\n[background](/demo/css-background.html)\n\n\n### 关于兼容请看参考文档\n\n[参考文档](https://developer.mozilla.org/zh-CN/docs/Web/CSS/background);\n[currentColor 实例](http://www.zhangxinxu.com/study/201410/css3-icons-currentcolor.html);\n\n\n\n\n\n\n\n\n\n","source":"_posts/css-background.md","raw":"---\ntitle: CSS Background 属性解析\ndate: 2017-08-16 16:35:01\ntags:\n - css\n---\n\n### background 全家桶简写形式\n `background: [background-color] [background-image] [background-attachment] [background-repeat]  [background-position] /[ background-size] [background-origin] [background-clip]`\n<!--more-->\n### CSS1常见属性\n\n* background-color 定义背景颜色\n    支持 英文颜色名词| rgb() | 十六进制颜色值 | transparent\n\n* background-image 定义背景图\n  `none` | `url`\n\n* background-position 定义背景图位置\n  支持 英文方位名词 | 长度值 | 百分比\n\n* background-repeat  定义背景图重复\n  `no-repaet` | `repeat` | `repeat-x` | `repeat-y`\n\n* background-attachment  定义背景图像是否固定或者随着页面的其余部分滚动\n  `inherit` | `scroll` | `fixed`\n\n## CSS3 background 新增属性\n\n* background-size 定义背景图片的尺寸\n  `contain` | `cover` | 长度值 ｜ 百分比\n\n* background-origin 定义背景图片的定位区域\n  `border-box` | `padding-box` | `content-box`\n\n* background-clip 定义背景的绘制区域\n  `border-box` | `padding-box` | `content-box` | `text`\n\n* background-blend-mode 定义背景图的混合模式\n  `normal`;           //正常\n  `multiply`;        //正片叠底\n  `screen`;          //滤色\n  `overlay`;         //叠加\n  `darken`;          //变暗\n  `lighten`;         //变亮\n  `color-dodge`;     //颜色减淡\n  `color-burn`;      //颜色加深\n  `hard-light`;      //强光\n  `soft-light`;      //柔光\n  `difference`;      //差值\n  `exclusion`;       //排除\n  `hue`;             //色相\n  `saturation`;      //饱和度\n  `color`;           //颜色\n  `luminosity`;      //亮度\n\n### 在css3中的对background 进行增强的属性\n  * background-color \n    `currentColor` 当前的标签所继承的文字颜色\n\n  * background-image 支持多背景用英文逗号隔开，增加渐变色属性\n    `linear-gradient` 使用线性渐变创建背景图像\n    `radial-gradient` 使用重复的线性渐变创建背景图像\n    `repeating-linear-gradient` 使用重复的线性渐变创建背景图像\n    `repeating-radial-gradient` 使用重复的径向(放射性)渐变创建背景图像\n\n  * background-repeat\n    `space` 图片以相同的间距平铺且填充整个标签元素 (相当于两端对齐而且background-position 属性会被忽略)\n    `round` 图片自动缩放直到适应且填充整个标签元素\n\n  * background-attachmen\n    `local` 背景相对于元素的内容固定 \n\n**********************************************************\n**** END ****\n\n\n**********************************************************\n\n\n### 示例演示\n\n[background](/demo/css-background.html)\n\n\n### 关于兼容请看参考文档\n\n[参考文档](https://developer.mozilla.org/zh-CN/docs/Web/CSS/background);\n[currentColor 实例](http://www.zhangxinxu.com/study/201410/css3-icons-currentcolor.html);\n\n\n\n\n\n\n\n\n\n","slug":"css-background","published":1,"updated":"2017-09-08T06:54:47.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oat0007uo2ezzn1via7","content":"<h3 id=\"background-全家桶简写形式\"><a href=\"#background-全家桶简写形式\" class=\"headerlink\" title=\"background 全家桶简写形式\"></a>background 全家桶简写形式</h3><p> <code>background: [background-color] [background-image] [background-attachment] [background-repeat]  [background-position] /[ background-size] [background-origin] [background-clip]</code><br><a id=\"more\"></a></p>\n<h3 id=\"CSS1常见属性\"><a href=\"#CSS1常见属性\" class=\"headerlink\" title=\"CSS1常见属性\"></a>CSS1常见属性</h3><ul>\n<li><p>background-color 定义背景颜色<br>  支持 英文颜色名词| rgb() | 十六进制颜色值 | transparent</p>\n</li>\n<li><p>background-image 定义背景图<br><code>none</code> | <code>url</code></p>\n</li>\n<li><p>background-position 定义背景图位置<br>支持 英文方位名词 | 长度值 | 百分比</p>\n</li>\n<li><p>background-repeat  定义背景图重复<br><code>no-repaet</code> | <code>repeat</code> | <code>repeat-x</code> | <code>repeat-y</code></p>\n</li>\n<li><p>background-attachment  定义背景图像是否固定或者随着页面的其余部分滚动<br><code>inherit</code> | <code>scroll</code> | <code>fixed</code></p>\n</li>\n</ul>\n<h2 id=\"CSS3-background-新增属性\"><a href=\"#CSS3-background-新增属性\" class=\"headerlink\" title=\"CSS3 background 新增属性\"></a>CSS3 background 新增属性</h2><ul>\n<li><p>background-size 定义背景图片的尺寸<br><code>contain</code> | <code>cover</code> | 长度值 ｜ 百分比</p>\n</li>\n<li><p>background-origin 定义背景图片的定位区域<br><code>border-box</code> | <code>padding-box</code> | <code>content-box</code></p>\n</li>\n<li><p>background-clip 定义背景的绘制区域<br><code>border-box</code> | <code>padding-box</code> | <code>content-box</code> | <code>text</code></p>\n</li>\n<li><p>background-blend-mode 定义背景图的混合模式<br><code>normal</code>;           //正常<br><code>multiply</code>;        //正片叠底<br><code>screen</code>;          //滤色<br><code>overlay</code>;         //叠加<br><code>darken</code>;          //变暗<br><code>lighten</code>;         //变亮<br><code>color-dodge</code>;     //颜色减淡<br><code>color-burn</code>;      //颜色加深<br><code>hard-light</code>;      //强光<br><code>soft-light</code>;      //柔光<br><code>difference</code>;      //差值<br><code>exclusion</code>;       //排除<br><code>hue</code>;             //色相<br><code>saturation</code>;      //饱和度<br><code>color</code>;           //颜色<br><code>luminosity</code>;      //亮度</p>\n</li>\n</ul>\n<h3 id=\"在css3中的对background-进行增强的属性\"><a href=\"#在css3中的对background-进行增强的属性\" class=\"headerlink\" title=\"在css3中的对background 进行增强的属性\"></a>在css3中的对background 进行增强的属性</h3><ul>\n<li><p>background-color<br><code>currentColor</code> 当前的标签所继承的文字颜色</p>\n</li>\n<li><p>background-image 支持多背景用英文逗号隔开，增加渐变色属性<br><code>linear-gradient</code> 使用线性渐变创建背景图像<br><code>radial-gradient</code> 使用重复的线性渐变创建背景图像<br><code>repeating-linear-gradient</code> 使用重复的线性渐变创建背景图像<br><code>repeating-radial-gradient</code> 使用重复的径向(放射性)渐变创建背景图像</p>\n</li>\n<li><p>background-repeat<br><code>space</code> 图片以相同的间距平铺且填充整个标签元素 (相当于两端对齐而且background-position 属性会被忽略)<br><code>round</code> 图片自动缩放直到适应且填充整个标签元素</p>\n</li>\n<li><p>background-attachmen<br><code>local</code> 背景相对于元素的内容固定 </p>\n</li>\n</ul>\n<hr>\n<p><strong><strong> END </strong></strong></p>\n<hr>\n<h3 id=\"示例演示\"><a href=\"#示例演示\" class=\"headerlink\" title=\"示例演示\"></a>示例演示</h3><p><a href=\"/demo/css-background.html\">background</a></p>\n<h3 id=\"关于兼容请看参考文档\"><a href=\"#关于兼容请看参考文档\" class=\"headerlink\" title=\"关于兼容请看参考文档\"></a>关于兼容请看参考文档</h3><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/background\" target=\"_blank\" rel=\"noopener\">参考文档</a>;<br><a href=\"http://www.zhangxinxu.com/study/201410/css3-icons-currentcolor.html\" target=\"_blank\" rel=\"noopener\">currentColor 实例</a>;</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"background-全家桶简写形式\"><a href=\"#background-全家桶简写形式\" class=\"headerlink\" title=\"background 全家桶简写形式\"></a>background 全家桶简写形式</h3><p> <code>background: [background-color] [background-image] [background-attachment] [background-repeat]  [background-position] /[ background-size] [background-origin] [background-clip]</code><br>","more":"</p>\n<h3 id=\"CSS1常见属性\"><a href=\"#CSS1常见属性\" class=\"headerlink\" title=\"CSS1常见属性\"></a>CSS1常见属性</h3><ul>\n<li><p>background-color 定义背景颜色<br>  支持 英文颜色名词| rgb() | 十六进制颜色值 | transparent</p>\n</li>\n<li><p>background-image 定义背景图<br><code>none</code> | <code>url</code></p>\n</li>\n<li><p>background-position 定义背景图位置<br>支持 英文方位名词 | 长度值 | 百分比</p>\n</li>\n<li><p>background-repeat  定义背景图重复<br><code>no-repaet</code> | <code>repeat</code> | <code>repeat-x</code> | <code>repeat-y</code></p>\n</li>\n<li><p>background-attachment  定义背景图像是否固定或者随着页面的其余部分滚动<br><code>inherit</code> | <code>scroll</code> | <code>fixed</code></p>\n</li>\n</ul>\n<h2 id=\"CSS3-background-新增属性\"><a href=\"#CSS3-background-新增属性\" class=\"headerlink\" title=\"CSS3 background 新增属性\"></a>CSS3 background 新增属性</h2><ul>\n<li><p>background-size 定义背景图片的尺寸<br><code>contain</code> | <code>cover</code> | 长度值 ｜ 百分比</p>\n</li>\n<li><p>background-origin 定义背景图片的定位区域<br><code>border-box</code> | <code>padding-box</code> | <code>content-box</code></p>\n</li>\n<li><p>background-clip 定义背景的绘制区域<br><code>border-box</code> | <code>padding-box</code> | <code>content-box</code> | <code>text</code></p>\n</li>\n<li><p>background-blend-mode 定义背景图的混合模式<br><code>normal</code>;           //正常<br><code>multiply</code>;        //正片叠底<br><code>screen</code>;          //滤色<br><code>overlay</code>;         //叠加<br><code>darken</code>;          //变暗<br><code>lighten</code>;         //变亮<br><code>color-dodge</code>;     //颜色减淡<br><code>color-burn</code>;      //颜色加深<br><code>hard-light</code>;      //强光<br><code>soft-light</code>;      //柔光<br><code>difference</code>;      //差值<br><code>exclusion</code>;       //排除<br><code>hue</code>;             //色相<br><code>saturation</code>;      //饱和度<br><code>color</code>;           //颜色<br><code>luminosity</code>;      //亮度</p>\n</li>\n</ul>\n<h3 id=\"在css3中的对background-进行增强的属性\"><a href=\"#在css3中的对background-进行增强的属性\" class=\"headerlink\" title=\"在css3中的对background 进行增强的属性\"></a>在css3中的对background 进行增强的属性</h3><ul>\n<li><p>background-color<br><code>currentColor</code> 当前的标签所继承的文字颜色</p>\n</li>\n<li><p>background-image 支持多背景用英文逗号隔开，增加渐变色属性<br><code>linear-gradient</code> 使用线性渐变创建背景图像<br><code>radial-gradient</code> 使用重复的线性渐变创建背景图像<br><code>repeating-linear-gradient</code> 使用重复的线性渐变创建背景图像<br><code>repeating-radial-gradient</code> 使用重复的径向(放射性)渐变创建背景图像</p>\n</li>\n<li><p>background-repeat<br><code>space</code> 图片以相同的间距平铺且填充整个标签元素 (相当于两端对齐而且background-position 属性会被忽略)<br><code>round</code> 图片自动缩放直到适应且填充整个标签元素</p>\n</li>\n<li><p>background-attachmen<br><code>local</code> 背景相对于元素的内容固定 </p>\n</li>\n</ul>\n<hr>\n<p><strong><strong> END </strong></strong></p>\n<hr>\n<h3 id=\"示例演示\"><a href=\"#示例演示\" class=\"headerlink\" title=\"示例演示\"></a>示例演示</h3><p><a href=\"/demo/css-background.html\">background</a></p>\n<h3 id=\"关于兼容请看参考文档\"><a href=\"#关于兼容请看参考文档\" class=\"headerlink\" title=\"关于兼容请看参考文档\"></a>关于兼容请看参考文档</h3><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/background\" target=\"_blank\" rel=\"noopener\">参考文档</a>;<br><a href=\"http://www.zhangxinxu.com/study/201410/css3-icons-currentcolor.html\" target=\"_blank\" rel=\"noopener\">currentColor 实例</a>;</p>"},{"title":"盒子模型及常见图形","date":"2017-08-08T16:00:00.000Z","_content":"\n## 盒子模型\n\n![css-box](/img/css-box/index.png)\n<!--more-->\n盒子模型是由4个盒子组成，分别为\n`margin` => `margin-box`\n`border` => `border-box`\n`padding` => `padding-box`\n`content` => `content-box`\n\n所以理论上，`box-sizing: margin-box|border-box|padding-box|content-box;`\n但是实际上浏览器厂商是没有全部支持的，只支持了部分。\n\n```css\n.box1 { box-sizing: margin-box; } /* 完全不支持 */\n.box2 { box-sizing: border-box; } /* 完全支持 */\n.box3 { box-sizing: padding-box; } /* Firefox曾经支持过, Firefox 50中被移除 */\n.box4 { box-sizing: content-box; } /* 默认值 */\n```\n\n\n## box-sizing属性\n\n+ content-box\n`width` = `content`\n\n+ ~~padding-box~~\n~~`width` = `content` + `padding`~~\n\n+ border-box\n`width` = `content` + `padding` + `border`\n\n\n\n## box-sizing图解\n\n<img src=\"/img/css-box/content_box.png\" alt=\"content-box\" />\n<img src=\"/img/css-box/border_box.png\" alt=\"border-box\" />\n```css\n.content-box {\n  box-sizing: content-box;\n  padding: 20px;\n  width: 260px; \n  border: 20px solid rgb(200, 189, 255);\n  background-color: rgb(150, 189, 255);\n}\n.border-box {\n  box-sizing: border-box;\n  padding: 20px;\n  width: 260px; \n  border: 20px solid rgb(200, 189, 255);\n  background-color: rgb(150, 189, 255);\n}\n```\n\n\n## 常见圆形\n\n[css-box-and-graph](/demo/css-box-and-graph.html)\n\n\n参考：https://developer.mozilla.org/zh-CN/docs/Web/CSS/box-sizing\n\n\n","source":"_posts/css-box-and-graph.md","raw":"---\ntitle: 盒子模型及常见图形\ndate: 2017-08-09\ntags:\n - css\n---\n\n## 盒子模型\n\n![css-box](/img/css-box/index.png)\n<!--more-->\n盒子模型是由4个盒子组成，分别为\n`margin` => `margin-box`\n`border` => `border-box`\n`padding` => `padding-box`\n`content` => `content-box`\n\n所以理论上，`box-sizing: margin-box|border-box|padding-box|content-box;`\n但是实际上浏览器厂商是没有全部支持的，只支持了部分。\n\n```css\n.box1 { box-sizing: margin-box; } /* 完全不支持 */\n.box2 { box-sizing: border-box; } /* 完全支持 */\n.box3 { box-sizing: padding-box; } /* Firefox曾经支持过, Firefox 50中被移除 */\n.box4 { box-sizing: content-box; } /* 默认值 */\n```\n\n\n## box-sizing属性\n\n+ content-box\n`width` = `content`\n\n+ ~~padding-box~~\n~~`width` = `content` + `padding`~~\n\n+ border-box\n`width` = `content` + `padding` + `border`\n\n\n\n## box-sizing图解\n\n<img src=\"/img/css-box/content_box.png\" alt=\"content-box\" />\n<img src=\"/img/css-box/border_box.png\" alt=\"border-box\" />\n```css\n.content-box {\n  box-sizing: content-box;\n  padding: 20px;\n  width: 260px; \n  border: 20px solid rgb(200, 189, 255);\n  background-color: rgb(150, 189, 255);\n}\n.border-box {\n  box-sizing: border-box;\n  padding: 20px;\n  width: 260px; \n  border: 20px solid rgb(200, 189, 255);\n  background-color: rgb(150, 189, 255);\n}\n```\n\n\n## 常见圆形\n\n[css-box-and-graph](/demo/css-box-and-graph.html)\n\n\n参考：https://developer.mozilla.org/zh-CN/docs/Web/CSS/box-sizing\n\n\n","slug":"css-box-and-graph","published":1,"updated":"2017-09-08T06:54:45.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oay0009uo2ewr5t71dl","content":"<h2 id=\"盒子模型\"><a href=\"#盒子模型\" class=\"headerlink\" title=\"盒子模型\"></a>盒子模型</h2><p><img src=\"/img/css-box/index.png\" alt=\"css-box\"><br><a id=\"more\"></a><br>盒子模型是由4个盒子组成，分别为<br><code>margin</code> =&gt; <code>margin-box</code><br><code>border</code> =&gt; <code>border-box</code><br><code>padding</code> =&gt; <code>padding-box</code><br><code>content</code> =&gt; <code>content-box</code></p>\n<p>所以理论上，<code>box-sizing: margin-box|border-box|padding-box|content-box;</code><br>但是实际上浏览器厂商是没有全部支持的，只支持了部分。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box1</span> &#123; <span class=\"attribute\">box-sizing</span>: margin-box; &#125; <span class=\"comment\">/* 完全不支持 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123; <span class=\"attribute\">box-sizing</span>: border-box; &#125; <span class=\"comment\">/* 完全支持 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box3</span> &#123; <span class=\"attribute\">box-sizing</span>: padding-box; &#125; <span class=\"comment\">/* Firefox曾经支持过, Firefox 50中被移除 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box4</span> &#123; <span class=\"attribute\">box-sizing</span>: content-box; &#125; <span class=\"comment\">/* 默认值 */</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"box-sizing属性\"><a href=\"#box-sizing属性\" class=\"headerlink\" title=\"box-sizing属性\"></a>box-sizing属性</h2><ul>\n<li><p>content-box<br><code>width</code> = <code>content</code></p>\n</li>\n<li><p><del>padding-box</del><br><del><code>width</code> = <code>content</code> + <code>padding</code></del></p>\n</li>\n<li><p>border-box<br><code>width</code> = <code>content</code> + <code>padding</code> + <code>border</code></p>\n</li>\n</ul>\n<h2 id=\"box-sizing图解\"><a href=\"#box-sizing图解\" class=\"headerlink\" title=\"box-sizing图解\"></a>box-sizing图解</h2><p><img src=\"/img/css-box/content_box.png\" alt=\"content-box\"><br><img src=\"/img/css-box/border_box.png\" alt=\"border-box\"><br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.content-box</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: content-box;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">260px</span>; </span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">20px</span> solid <span class=\"built_in\">rgb</span>(200, 189, 255);</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(150, 189, 255);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.border-box</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">260px</span>; </span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">20px</span> solid <span class=\"built_in\">rgb</span>(200, 189, 255);</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(150, 189, 255);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"常见圆形\"><a href=\"#常见圆形\" class=\"headerlink\" title=\"常见圆形\"></a>常见圆形</h2><p><a href=\"/demo/css-box-and-graph.html\">css-box-and-graph</a></p>\n<p>参考：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/box-sizing\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/box-sizing</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"盒子模型\"><a href=\"#盒子模型\" class=\"headerlink\" title=\"盒子模型\"></a>盒子模型</h2><p><img src=\"/img/css-box/index.png\" alt=\"css-box\"><br>","more":"<br>盒子模型是由4个盒子组成，分别为<br><code>margin</code> =&gt; <code>margin-box</code><br><code>border</code> =&gt; <code>border-box</code><br><code>padding</code> =&gt; <code>padding-box</code><br><code>content</code> =&gt; <code>content-box</code></p>\n<p>所以理论上，<code>box-sizing: margin-box|border-box|padding-box|content-box;</code><br>但是实际上浏览器厂商是没有全部支持的，只支持了部分。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box1</span> &#123; <span class=\"attribute\">box-sizing</span>: margin-box; &#125; <span class=\"comment\">/* 完全不支持 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box2</span> &#123; <span class=\"attribute\">box-sizing</span>: border-box; &#125; <span class=\"comment\">/* 完全支持 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box3</span> &#123; <span class=\"attribute\">box-sizing</span>: padding-box; &#125; <span class=\"comment\">/* Firefox曾经支持过, Firefox 50中被移除 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.box4</span> &#123; <span class=\"attribute\">box-sizing</span>: content-box; &#125; <span class=\"comment\">/* 默认值 */</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"box-sizing属性\"><a href=\"#box-sizing属性\" class=\"headerlink\" title=\"box-sizing属性\"></a>box-sizing属性</h2><ul>\n<li><p>content-box<br><code>width</code> = <code>content</code></p>\n</li>\n<li><p><del>padding-box</del><br><del><code>width</code> = <code>content</code> + <code>padding</code></del></p>\n</li>\n<li><p>border-box<br><code>width</code> = <code>content</code> + <code>padding</code> + <code>border</code></p>\n</li>\n</ul>\n<h2 id=\"box-sizing图解\"><a href=\"#box-sizing图解\" class=\"headerlink\" title=\"box-sizing图解\"></a>box-sizing图解</h2><p><img src=\"/img/css-box/content_box.png\" alt=\"content-box\"><br><img src=\"/img/css-box/border_box.png\" alt=\"border-box\"><br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.content-box</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: content-box;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">260px</span>; </span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">20px</span> solid <span class=\"built_in\">rgb</span>(200, 189, 255);</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(150, 189, 255);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.border-box</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">260px</span>; </span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">20px</span> solid <span class=\"built_in\">rgb</span>(200, 189, 255);</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgb</span>(150, 189, 255);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"常见圆形\"><a href=\"#常见圆形\" class=\"headerlink\" title=\"常见圆形\"></a>常见圆形</h2><p><a href=\"/demo/css-box-and-graph.html\">css-box-and-graph</a></p>\n<p>参考：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/box-sizing\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Web/CSS/box-sizing</a></p>"},{"title":"一些css伪类选择器","date":"2018-02-09T02:26:27.000Z","_content":"几个特殊且实用的伪类选择器。\n\n<!--more-->\n\n---\n\n## :root\n\n`:root` 匹配文档的根元素。\n应用到HTML，`:root`即表示为`<html>`元素\n\n\n```css\n:root {\n  --main-color: red;\n};\n\ndiv {\n  background: var(--main-color); // 等同 background:red\n}\n```\n\n适用于声明全局CSS变量时。\n\n---\n\n## :empty\n\n`:empty` 代表没有子元素的元素。\n这里的子元素只计算元素节点及文本（包括空格），注释、运行指令不考虑在内。\n\n```css\ndiv{\n  height:20px;\n  background:#ffcc00;\n}\ndiv:empty{\n  background:#fff;\n}\n```\n```html\n<!-- background: #ffcc00 -->\n<div>1</div>\n<div> </div>\n<!-- background: #fff -->\n<div></div>\n```\n\n适用于判断列表/内容为空时显示样式。\n\n---\n\n## :target\n\n`:target`可用于选取当前活动的目标元素。需要一个id去匹配文档URI的片段标识符。\nURL末尾带有锚名称 #，指向文档内某个具体的元素。这个被链接的元素就是目标元素(target element)。\n\n```css\n#content1,\n#content2 {\n  display:none;\n}\n\n#content1:target,\n#content2:target {\n  display:block;\n}\n```\n```html\n<div id=\"content1\">列表1</div>\n<div id=\"content2\">列表2</div>\n<ul class='nav'>\n  <li><a href=\"#content1\">列表1内容</a></li>\n  <li><a href=\"#content2\">列表2内容</a></li>\n</ul>\n```\n\n![demo](/img/css-pseudo-class-one/2.gif)\n\n适用于纯CSS的导航栏Tab切换。\n\n---\n\n## :not\n\n`:not(X)` 匹配不符合参数选择器X描述的元素。X不能包含另外一个否定选择器。\n\n\n* 不会增加选择器的优先级，它的优先级即为它参数选择器的优先级\n* `:not(*)` 匹配任何非元素的元素，因此这个规则将永远不会被应用。\n* 只会应用在一个元素上，不能用它在排除所有祖先元素。举例：`body :not(table) a` 将依旧会应用在table内部的`<a>`上, 因为`<tr>`将会被`:not()` 这部分选择器匹配。\n\n```css\nbody :not(p) {\n  color: green;\n}\np:not(.test) {\n  color: red;\n}\n```\n```html\n<!-- color: red -->\n<p>Some text.</p>\n<!-- 浏览器默认颜色 -->\n<p class=\"test\">Some other text.</p>\n<!-- color: green -->\n<span>One more text<span>\n```\n\n![demo](/img/css-pseudo-class-one/5.png)\n\n适用：\n  * weui的按钮样式有使用到\n  * 列表某些特定位置样式，如头尾部的边\n\n---\n\n## :first-line\n\n`:first-line`选取指定选择器的首行。\n\n可配合使用样式：\n* 字体属性\n* 颜色属性\n* 背景属性\n* word-spacing\n* letter-spacing\n* text-decoration\n* vertical-align\n* text-transform\n* line-height\n* clear\n\n```css\np:first-line {\n  background-color:yellow;\n}\n```\n```html\n<p>第一行文字<br/>第二行文字<br/>第三行文字</p>\n```\n\n![demo](/img/css-pseudo-class-one/3.png)\n\n---\n\n## :first-letter\n\n`:first-letter`选择器用于选取指定选择器的首字母。\n\n可配合使用样式：\n* 字体属性\n* 颜色属性\n* 背景属性\n* 外边距属性\n* 内边距属性\n* 边框属性\n* text-decoration\n* vertical-align（只有在 float 为 'none' 时）\n* text-transform\n* line-height\n* float\n* clear\n\n```css\np:first-letter {\n  font-size:200%;\n  color:#8A2BE2;\n}\n```\n```html\n<p>选择器用于选取指定选择器的首字母</p>\n```\n\n![demo](/img/css-pseudo-class-one/4.png)\n\n---\n\n## 配合`:before/:after` 使用的 `content`\n\n`content`与 `:before`及`:after`伪元素配合使用，来插入生成内容。\n\n```css\ndiv:after{\n  content: attr(data-msg);\n  position: absolute;\n  left: 20px;\n  top: 30px;\n  border: 1px solid green;\n}\n<!-- 显示没有文本值但是 href 属性具有链接的 a 元素的链接 -->\na:empty::before {\n  content: attr(href);\n}\n```\n```html\n<div data-msg=\"Open this file in Github Desktop\">test</div>\n<a href=\"www.baidu.com\"></a>\n```\n\n![exam](/img/css-pseudo-class-one/6.png)\n\n适用于文字提示。↓↓↓\n![exam](/img/css-pseudo-class-one/1.jpg)\n\n---\n\n上述伪类选择器皆兼容IE9+\n","source":"_posts/css-pseudo-class-one.md","raw":"---\ntitle: 一些css伪类选择器\ndate: 2018-02-09 10:26:27\ntags:\n - css\n---\n几个特殊且实用的伪类选择器。\n\n<!--more-->\n\n---\n\n## :root\n\n`:root` 匹配文档的根元素。\n应用到HTML，`:root`即表示为`<html>`元素\n\n\n```css\n:root {\n  --main-color: red;\n};\n\ndiv {\n  background: var(--main-color); // 等同 background:red\n}\n```\n\n适用于声明全局CSS变量时。\n\n---\n\n## :empty\n\n`:empty` 代表没有子元素的元素。\n这里的子元素只计算元素节点及文本（包括空格），注释、运行指令不考虑在内。\n\n```css\ndiv{\n  height:20px;\n  background:#ffcc00;\n}\ndiv:empty{\n  background:#fff;\n}\n```\n```html\n<!-- background: #ffcc00 -->\n<div>1</div>\n<div> </div>\n<!-- background: #fff -->\n<div></div>\n```\n\n适用于判断列表/内容为空时显示样式。\n\n---\n\n## :target\n\n`:target`可用于选取当前活动的目标元素。需要一个id去匹配文档URI的片段标识符。\nURL末尾带有锚名称 #，指向文档内某个具体的元素。这个被链接的元素就是目标元素(target element)。\n\n```css\n#content1,\n#content2 {\n  display:none;\n}\n\n#content1:target,\n#content2:target {\n  display:block;\n}\n```\n```html\n<div id=\"content1\">列表1</div>\n<div id=\"content2\">列表2</div>\n<ul class='nav'>\n  <li><a href=\"#content1\">列表1内容</a></li>\n  <li><a href=\"#content2\">列表2内容</a></li>\n</ul>\n```\n\n![demo](/img/css-pseudo-class-one/2.gif)\n\n适用于纯CSS的导航栏Tab切换。\n\n---\n\n## :not\n\n`:not(X)` 匹配不符合参数选择器X描述的元素。X不能包含另外一个否定选择器。\n\n\n* 不会增加选择器的优先级，它的优先级即为它参数选择器的优先级\n* `:not(*)` 匹配任何非元素的元素，因此这个规则将永远不会被应用。\n* 只会应用在一个元素上，不能用它在排除所有祖先元素。举例：`body :not(table) a` 将依旧会应用在table内部的`<a>`上, 因为`<tr>`将会被`:not()` 这部分选择器匹配。\n\n```css\nbody :not(p) {\n  color: green;\n}\np:not(.test) {\n  color: red;\n}\n```\n```html\n<!-- color: red -->\n<p>Some text.</p>\n<!-- 浏览器默认颜色 -->\n<p class=\"test\">Some other text.</p>\n<!-- color: green -->\n<span>One more text<span>\n```\n\n![demo](/img/css-pseudo-class-one/5.png)\n\n适用：\n  * weui的按钮样式有使用到\n  * 列表某些特定位置样式，如头尾部的边\n\n---\n\n## :first-line\n\n`:first-line`选取指定选择器的首行。\n\n可配合使用样式：\n* 字体属性\n* 颜色属性\n* 背景属性\n* word-spacing\n* letter-spacing\n* text-decoration\n* vertical-align\n* text-transform\n* line-height\n* clear\n\n```css\np:first-line {\n  background-color:yellow;\n}\n```\n```html\n<p>第一行文字<br/>第二行文字<br/>第三行文字</p>\n```\n\n![demo](/img/css-pseudo-class-one/3.png)\n\n---\n\n## :first-letter\n\n`:first-letter`选择器用于选取指定选择器的首字母。\n\n可配合使用样式：\n* 字体属性\n* 颜色属性\n* 背景属性\n* 外边距属性\n* 内边距属性\n* 边框属性\n* text-decoration\n* vertical-align（只有在 float 为 'none' 时）\n* text-transform\n* line-height\n* float\n* clear\n\n```css\np:first-letter {\n  font-size:200%;\n  color:#8A2BE2;\n}\n```\n```html\n<p>选择器用于选取指定选择器的首字母</p>\n```\n\n![demo](/img/css-pseudo-class-one/4.png)\n\n---\n\n## 配合`:before/:after` 使用的 `content`\n\n`content`与 `:before`及`:after`伪元素配合使用，来插入生成内容。\n\n```css\ndiv:after{\n  content: attr(data-msg);\n  position: absolute;\n  left: 20px;\n  top: 30px;\n  border: 1px solid green;\n}\n<!-- 显示没有文本值但是 href 属性具有链接的 a 元素的链接 -->\na:empty::before {\n  content: attr(href);\n}\n```\n```html\n<div data-msg=\"Open this file in Github Desktop\">test</div>\n<a href=\"www.baidu.com\"></a>\n```\n\n![exam](/img/css-pseudo-class-one/6.png)\n\n适用于文字提示。↓↓↓\n![exam](/img/css-pseudo-class-one/1.jpg)\n\n---\n\n上述伪类选择器皆兼容IE9+\n","slug":"css-pseudo-class-one","published":1,"updated":"2018-03-02T05:42:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ob7000duo2e330xmrjg","content":"<p>几个特殊且实用的伪类选择器。</p>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"root\"><a href=\"#root\" class=\"headerlink\" title=\":root\"></a>:root</h2><p><code>:root</code> 匹配文档的根元素。<br>应用到HTML，<code>:root</code>即表示为<code>&lt;html&gt;</code>元素</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-pseudo\">:root</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">--main-color</span>: red;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">  background: var(--main-color); // 等同 background:red</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>适用于声明全局CSS变量时。</p>\n<hr>\n<h2 id=\"empty\"><a href=\"#empty\" class=\"headerlink\" title=\":empty\"></a>:empty</h2><p><code>:empty</code> 代表没有子元素的元素。<br>这里的子元素只计算元素节点及文本（包括空格），注释、运行指令不考虑在内。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>:<span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>:<span class=\"number\">#ffcc00</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">:empty</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>:<span class=\"number\">#fff</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- background: #ffcc00 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- background: #fff --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>适用于判断列表/内容为空时显示样式。</p>\n<hr>\n<h2 id=\"target\"><a href=\"#target\" class=\"headerlink\" title=\":target\"></a>:target</h2><p><code>:target</code>可用于选取当前活动的目标元素。需要一个id去匹配文档URI的片段标识符。<br>URL末尾带有锚名称 #，指向文档内某个具体的元素。这个被链接的元素就是目标元素(target element)。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#content1</span>,</span><br><span class=\"line\"><span class=\"selector-id\">#content2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#content1</span><span class=\"selector-pseudo\">:target</span>,</span><br><span class=\"line\"><span class=\"selector-id\">#content2</span><span class=\"selector-pseudo\">:target</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content1\"</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content2\"</span>&gt;</span>列表2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">'nav'</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#content1\"</span>&gt;</span>列表1内容<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#content2\"</span>&gt;</span>列表2内容<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/2.gif\" alt=\"demo\"></p>\n<p>适用于纯CSS的导航栏Tab切换。</p>\n<hr>\n<h2 id=\"not\"><a href=\"#not\" class=\"headerlink\" title=\":not\"></a>:not</h2><p><code>:not(X)</code> 匹配不符合参数选择器X描述的元素。X不能包含另外一个否定选择器。</p>\n<ul>\n<li>不会增加选择器的优先级，它的优先级即为它参数选择器的优先级</li>\n<li><code>:not(*)</code> 匹配任何非元素的元素，因此这个规则将永远不会被应用。</li>\n<li>只会应用在一个元素上，不能用它在排除所有祖先元素。举例：<code>body :not(table) a</code> 将依旧会应用在table内部的<code>&lt;a&gt;</code>上, 因为<code>&lt;tr&gt;</code>将会被<code>:not()</code> 这部分选择器匹配。</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> <span class=\"selector-pseudo\">:not(p)</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: green;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-pseudo\">:not(.test)</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- color: red --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Some text.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 浏览器默认颜色 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"test\"</span>&gt;</span>Some other text.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- color: green --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>One more text<span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/5.png\" alt=\"demo\"></p>\n<p>适用：</p>\n<ul>\n<li>weui的按钮样式有使用到</li>\n<li>列表某些特定位置样式，如头尾部的边</li>\n</ul>\n<hr>\n<h2 id=\"first-line\"><a href=\"#first-line\" class=\"headerlink\" title=\":first-line\"></a>:first-line</h2><p><code>:first-line</code>选取指定选择器的首行。</p>\n<p>可配合使用样式：</p>\n<ul>\n<li>字体属性</li>\n<li>颜色属性</li>\n<li>背景属性</li>\n<li>word-spacing</li>\n<li>letter-spacing</li>\n<li>text-decoration</li>\n<li>vertical-align</li>\n<li>text-transform</li>\n<li>line-height</li>\n<li>clear</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-pseudo\">:first-line</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>:yellow;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>第一行文字<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span>第二行文字<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span>第三行文字<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/3.png\" alt=\"demo\"></p>\n<hr>\n<h2 id=\"first-letter\"><a href=\"#first-letter\" class=\"headerlink\" title=\":first-letter\"></a>:first-letter</h2><p><code>:first-letter</code>选择器用于选取指定选择器的首字母。</p>\n<p>可配合使用样式：</p>\n<ul>\n<li>字体属性</li>\n<li>颜色属性</li>\n<li>背景属性</li>\n<li>外边距属性</li>\n<li>内边距属性</li>\n<li>边框属性</li>\n<li>text-decoration</li>\n<li>vertical-align（只有在 float 为 ‘none’ 时）</li>\n<li>text-transform</li>\n<li>line-height</li>\n<li>float</li>\n<li>clear</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-pseudo\">:first-letter</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>:<span class=\"number\">200%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:<span class=\"number\">#8A2BE2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>选择器用于选取指定选择器的首字母<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/4.png\" alt=\"demo\"></p>\n<hr>\n<h2 id=\"配合-before-after-使用的-content\"><a href=\"#配合-before-after-使用的-content\" class=\"headerlink\" title=\"配合:before/:after 使用的 content\"></a>配合<code>:before/:after</code> 使用的 <code>content</code></h2><p><code>content</code>与 <code>:before</code>及<code>:after</code>伪元素配合使用，来插入生成内容。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">:after</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(data-msg);</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid green;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;!<span class=\"selector-tag\">--</span> 显示没有文本值但是 <span class=\"selector-tag\">href</span> 属性具有链接的 <span class=\"selector-tag\">a</span> 元素的链接 <span class=\"selector-tag\">--</span>&gt;</span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:empty</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(href);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-msg</span>=<span class=\"string\">\"Open this file in Github Desktop\"</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"www.baidu.com\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/6.png\" alt=\"exam\"></p>\n<p>适用于文字提示。↓↓↓<br><img src=\"/img/css-pseudo-class-one/1.jpg\" alt=\"exam\"></p>\n<hr>\n<p>上述伪类选择器皆兼容IE9+</p>\n","site":{"data":{}},"excerpt":"<p>几个特殊且实用的伪类选择器。</p>","more":"<hr>\n<h2 id=\"root\"><a href=\"#root\" class=\"headerlink\" title=\":root\"></a>:root</h2><p><code>:root</code> 匹配文档的根元素。<br>应用到HTML，<code>:root</code>即表示为<code>&lt;html&gt;</code>元素</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-pseudo\">:root</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">--main-color</span>: red;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-tag\">div</span> &#123;</span><br><span class=\"line\">  background: var(--main-color); // 等同 background:red</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>适用于声明全局CSS变量时。</p>\n<hr>\n<h2 id=\"empty\"><a href=\"#empty\" class=\"headerlink\" title=\":empty\"></a>:empty</h2><p><code>:empty</code> 代表没有子元素的元素。<br>这里的子元素只计算元素节点及文本（包括空格），注释、运行指令不考虑在内。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>:<span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>:<span class=\"number\">#ffcc00</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">:empty</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>:<span class=\"number\">#fff</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- background: #ffcc00 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- background: #fff --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>适用于判断列表/内容为空时显示样式。</p>\n<hr>\n<h2 id=\"target\"><a href=\"#target\" class=\"headerlink\" title=\":target\"></a>:target</h2><p><code>:target</code>可用于选取当前活动的目标元素。需要一个id去匹配文档URI的片段标识符。<br>URL末尾带有锚名称 #，指向文档内某个具体的元素。这个被链接的元素就是目标元素(target element)。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-id\">#content1</span>,</span><br><span class=\"line\"><span class=\"selector-id\">#content2</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:none;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-id\">#content1</span><span class=\"selector-pseudo\">:target</span>,</span><br><span class=\"line\"><span class=\"selector-id\">#content2</span><span class=\"selector-pseudo\">:target</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:block;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content1\"</span>&gt;</span>列表1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"content2\"</span>&gt;</span>列表2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">'nav'</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#content1\"</span>&gt;</span>列表1内容<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#content2\"</span>&gt;</span>列表2内容<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/2.gif\" alt=\"demo\"></p>\n<p>适用于纯CSS的导航栏Tab切换。</p>\n<hr>\n<h2 id=\"not\"><a href=\"#not\" class=\"headerlink\" title=\":not\"></a>:not</h2><p><code>:not(X)</code> 匹配不符合参数选择器X描述的元素。X不能包含另外一个否定选择器。</p>\n<ul>\n<li>不会增加选择器的优先级，它的优先级即为它参数选择器的优先级</li>\n<li><code>:not(*)</code> 匹配任何非元素的元素，因此这个规则将永远不会被应用。</li>\n<li>只会应用在一个元素上，不能用它在排除所有祖先元素。举例：<code>body :not(table) a</code> 将依旧会应用在table内部的<code>&lt;a&gt;</code>上, 因为<code>&lt;tr&gt;</code>将会被<code>:not()</code> 这部分选择器匹配。</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> <span class=\"selector-pseudo\">:not(p)</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: green;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-pseudo\">:not(.test)</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- color: red --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Some text.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 浏览器默认颜色 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">class</span>=<span class=\"string\">\"test\"</span>&gt;</span>Some other text.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- color: green --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>One more text<span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/5.png\" alt=\"demo\"></p>\n<p>适用：</p>\n<ul>\n<li>weui的按钮样式有使用到</li>\n<li>列表某些特定位置样式，如头尾部的边</li>\n</ul>\n<hr>\n<h2 id=\"first-line\"><a href=\"#first-line\" class=\"headerlink\" title=\":first-line\"></a>:first-line</h2><p><code>:first-line</code>选取指定选择器的首行。</p>\n<p>可配合使用样式：</p>\n<ul>\n<li>字体属性</li>\n<li>颜色属性</li>\n<li>背景属性</li>\n<li>word-spacing</li>\n<li>letter-spacing</li>\n<li>text-decoration</li>\n<li>vertical-align</li>\n<li>text-transform</li>\n<li>line-height</li>\n<li>clear</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-pseudo\">:first-line</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>:yellow;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>第一行文字<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span>第二行文字<span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span>第三行文字<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/3.png\" alt=\"demo\"></p>\n<hr>\n<h2 id=\"first-letter\"><a href=\"#first-letter\" class=\"headerlink\" title=\":first-letter\"></a>:first-letter</h2><p><code>:first-letter</code>选择器用于选取指定选择器的首字母。</p>\n<p>可配合使用样式：</p>\n<ul>\n<li>字体属性</li>\n<li>颜色属性</li>\n<li>背景属性</li>\n<li>外边距属性</li>\n<li>内边距属性</li>\n<li>边框属性</li>\n<li>text-decoration</li>\n<li>vertical-align（只有在 float 为 ‘none’ 时）</li>\n<li>text-transform</li>\n<li>line-height</li>\n<li>float</li>\n<li>clear</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span><span class=\"selector-pseudo\">:first-letter</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>:<span class=\"number\">200%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>:<span class=\"number\">#8A2BE2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>选择器用于选取指定选择器的首字母<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/4.png\" alt=\"demo\"></p>\n<hr>\n<h2 id=\"配合-before-after-使用的-content\"><a href=\"#配合-before-after-使用的-content\" class=\"headerlink\" title=\"配合:before/:after 使用的 content\"></a>配合<code>:before/:after</code> 使用的 <code>content</code></h2><p><code>content</code>与 <code>:before</code>及<code>:after</code>伪元素配合使用，来插入生成内容。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span><span class=\"selector-pseudo\">:after</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(data-msg);</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">left</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">30px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid green;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;!<span class=\"selector-tag\">--</span> 显示没有文本值但是 <span class=\"selector-tag\">href</span> 属性具有链接的 <span class=\"selector-tag\">a</span> 元素的链接 <span class=\"selector-tag\">--</span>&gt;</span><br><span class=\"line\"><span class=\"selector-tag\">a</span><span class=\"selector-pseudo\">:empty</span><span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"built_in\">attr</span>(href);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-msg</span>=<span class=\"string\">\"Open this file in Github Desktop\"</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"www.baidu.com\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/css-pseudo-class-one/6.png\" alt=\"exam\"></p>\n<p>适用于文字提示。↓↓↓<br><img src=\"/img/css-pseudo-class-one/1.jpg\" alt=\"exam\"></p>\n<hr>\n<p>上述伪类选择器皆兼容IE9+</p>"},{"title":"CSS 水平垂直居中的几种实现方式","date":"2017-07-25T16:00:00.000Z","_content":"前端开发中，总会遇到各种需要将元素水平垂直居中的场景。  \n这里简单介绍一下几种 CSS 水平垂直居中的方法及其适用性和兼容性。<!--more-->\n\n## 单行文字的水平垂直居中\n单行文字的垂直居中是最常见的，也是最容易实现的。  \n只要将文字的行高（line-height）和要垂直居中的元素高度（height）设置为一样即可。\n水平居中就设置一下 `text-align: center` 就可以了。\n例如：\n```html\n<div class=\"outer\">\n  <div class=\"inner\">这里是需要垂直居中的文字</div>\n</div>\n```\n\n```css\n.outer {\n  height: 40px;\n  line-height: 40px;\n  text-align: center;\n}\n```\n\n## 多行文字及元素的水平垂直居中\n### 一、display: inline-block + vertical-align: middle\n`vertical-align` 这个属性依赖于 inline/inline-block/table-cell ，如果元素不属于这几类，这个属性则无法生效。\n\n要用这两个属性实现垂直居中，需要用到伪类 `:before` 或者添加一个空元素 。\n\n假设我们有如下的一段 HTML 代码：\n```html\n<!-- 伪类写法 -->\n<div class=\"outer\">\n  <div class=\"inner\">这里是需要水平垂直居中的文字</div>\n</div>\n<!-- 空元素写法 -->\n<div class=\"outer\">\n  <div class=\"center\"></div>\n  <div class=\"inner\">这里是需要水平垂直居中的文字</div>\n</div>\n```\n那么我们的 CSS 应该这么写：\n```css\n.outer {\n  width: 200px;\n  height: 100px;\n  text-align: center;\n}\n\n.inner {\n  display: inline-block;\n  vertical-align: middle;\n}\n\n/* 伪类写法 */\n.outer:before {\n  content: '';\n  width: 0;\n  height: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n\n/* 空元素写法 */\n.center {\n  width: 0;\n  height: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n```\n两种写法的原理是一样的。  \n因为 vertical-align 需要有一个能和它对齐的元素，所以添加一个宽度为 0 的元素，可以实现不占用页面大小，却能影响页面布局的作用。  \n高度设置为 100%，那么无论父元素（在上面的代码里是 `outer`）高度设置为多少，都能在父元素内部垂直居中。  \n\n这种写法的优点就是兼容性好，IE 8 及其以上版本的浏览器，都支持这种写法。缺点是必须额外添加一个元素。  \n这种方式一般用于不确定是单行或者多行文字的垂直居中。\n\n### 二、使用绝对定位与 translate 实现水平垂直居中\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    position: relative;\n}\n\n.inner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n```\n注意：这里不要使用 translate3d，会导致显示模糊。  \n这种方式默认情况下，子元素的宽度为父元素的一半，因为 left 设置为 50%，所以文字是从 50% 的位置开始，在 100% （也就是最后面）的位置换行。\n\n### 三、使用绝对定位与负 margin 实现水平垂直居中\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    position: relative;\n}\n\n.inner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;\n    height: 100px;\n    margin-left: -100px; /* 宽度的一半 */\n    margin-top: -50px; /* 高度的一半 */\n}\n```\n这种方式的实现原理和 translate 的类似。  \n都是通过反向位移元素宽高的一半，来实现居中对齐。  \n但是负 margin 这种方式需要知道子元素的宽高才能实现。如果使用百分比，获取到的大小是父元素的，而不是子元素的，无法实现对齐效果。\n\n### 四、display: table-cell + vertical-align 实现垂直居中\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    display: table;\n}\n\n.inner {\n    display: table-cell;\n    vertical-align: middle;\n    text-align: center;\n}\n```\n这种方式实现的方式类似于 `display: inline-block`，区别在于 `inline-block` 需要额外的元素来实现对齐。而 `table-cell` 不需要。  \n这种方式的兼容性也很好，IE 8 及其以上版本的浏览器都支持。\n\n### 五、display: flex 实现居中对齐\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    display: flex;\n    justify-content: center; /* 水平居中 */\n    align-items: center; /* 垂直居中 */\n}\n```\n使用 flex 的优点是，子元素不进行任何设置就能完美实现居中对齐。  \n缺点是只有较新的浏览器支持该特性。  \nPC 端的，IE 10 及其以上版本才能兼容。  \n不过移动端 iOS 7.0 以上， Android 4.4 以上版本已经完全兼容。\n通过新旧语法混用（可用 autoprefixer 生成），可以兼容 Android 4.0 以上及 iOS 6.0 以上版本。  \n现在 Android 4.0 和 iOS 6.0 以下版本的用户已经很少了。随着时间的推移，会越来越少。  \n如果现在移动端的项目不用考虑 Android 4.0 以下版本的浏览器，那么 flex 完全可用了。\n\n## 总结\n上面几种对齐方式，一和四一般用于多行文字的居中对齐。二和三多用于弹窗的居中对齐。  \n而 flex 这种方式，各种情况的居中对齐都可以用。  \n\n如果不用考虑兼容性的话，可以优先选择 flex。  \n移动端的项目基本可用了。  \nPC 端的话，考虑到兼容性，最好就先不用，等 IE 10 以下版本的用户量减少到可以不用考虑的时候，再使用。","source":"_posts/css-horizontal-vertical-center.md","raw":"---\ntitle: CSS 水平垂直居中的几种实现方式\ndate: 2017-07-26\ntag: \n- css\n---\n前端开发中，总会遇到各种需要将元素水平垂直居中的场景。  \n这里简单介绍一下几种 CSS 水平垂直居中的方法及其适用性和兼容性。<!--more-->\n\n## 单行文字的水平垂直居中\n单行文字的垂直居中是最常见的，也是最容易实现的。  \n只要将文字的行高（line-height）和要垂直居中的元素高度（height）设置为一样即可。\n水平居中就设置一下 `text-align: center` 就可以了。\n例如：\n```html\n<div class=\"outer\">\n  <div class=\"inner\">这里是需要垂直居中的文字</div>\n</div>\n```\n\n```css\n.outer {\n  height: 40px;\n  line-height: 40px;\n  text-align: center;\n}\n```\n\n## 多行文字及元素的水平垂直居中\n### 一、display: inline-block + vertical-align: middle\n`vertical-align` 这个属性依赖于 inline/inline-block/table-cell ，如果元素不属于这几类，这个属性则无法生效。\n\n要用这两个属性实现垂直居中，需要用到伪类 `:before` 或者添加一个空元素 。\n\n假设我们有如下的一段 HTML 代码：\n```html\n<!-- 伪类写法 -->\n<div class=\"outer\">\n  <div class=\"inner\">这里是需要水平垂直居中的文字</div>\n</div>\n<!-- 空元素写法 -->\n<div class=\"outer\">\n  <div class=\"center\"></div>\n  <div class=\"inner\">这里是需要水平垂直居中的文字</div>\n</div>\n```\n那么我们的 CSS 应该这么写：\n```css\n.outer {\n  width: 200px;\n  height: 100px;\n  text-align: center;\n}\n\n.inner {\n  display: inline-block;\n  vertical-align: middle;\n}\n\n/* 伪类写法 */\n.outer:before {\n  content: '';\n  width: 0;\n  height: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n\n/* 空元素写法 */\n.center {\n  width: 0;\n  height: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n```\n两种写法的原理是一样的。  \n因为 vertical-align 需要有一个能和它对齐的元素，所以添加一个宽度为 0 的元素，可以实现不占用页面大小，却能影响页面布局的作用。  \n高度设置为 100%，那么无论父元素（在上面的代码里是 `outer`）高度设置为多少，都能在父元素内部垂直居中。  \n\n这种写法的优点就是兼容性好，IE 8 及其以上版本的浏览器，都支持这种写法。缺点是必须额外添加一个元素。  \n这种方式一般用于不确定是单行或者多行文字的垂直居中。\n\n### 二、使用绝对定位与 translate 实现水平垂直居中\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    position: relative;\n}\n\n.inner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n```\n注意：这里不要使用 translate3d，会导致显示模糊。  \n这种方式默认情况下，子元素的宽度为父元素的一半，因为 left 设置为 50%，所以文字是从 50% 的位置开始，在 100% （也就是最后面）的位置换行。\n\n### 三、使用绝对定位与负 margin 实现水平垂直居中\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    position: relative;\n}\n\n.inner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 200px;\n    height: 100px;\n    margin-left: -100px; /* 宽度的一半 */\n    margin-top: -50px; /* 高度的一半 */\n}\n```\n这种方式的实现原理和 translate 的类似。  \n都是通过反向位移元素宽高的一半，来实现居中对齐。  \n但是负 margin 这种方式需要知道子元素的宽高才能实现。如果使用百分比，获取到的大小是父元素的，而不是子元素的，无法实现对齐效果。\n\n### 四、display: table-cell + vertical-align 实现垂直居中\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    display: table;\n}\n\n.inner {\n    display: table-cell;\n    vertical-align: middle;\n    text-align: center;\n}\n```\n这种方式实现的方式类似于 `display: inline-block`，区别在于 `inline-block` 需要额外的元素来实现对齐。而 `table-cell` 不需要。  \n这种方式的兼容性也很好，IE 8 及其以上版本的浏览器都支持。\n\n### 五、display: flex 实现居中对齐\n\n```html\n<div class=\"outer\">\n    <div class=\"inner\">水平垂直居中</div>\n</div>\n```\n\n```css\n.outer {\n    display: flex;\n    justify-content: center; /* 水平居中 */\n    align-items: center; /* 垂直居中 */\n}\n```\n使用 flex 的优点是，子元素不进行任何设置就能完美实现居中对齐。  \n缺点是只有较新的浏览器支持该特性。  \nPC 端的，IE 10 及其以上版本才能兼容。  \n不过移动端 iOS 7.0 以上， Android 4.4 以上版本已经完全兼容。\n通过新旧语法混用（可用 autoprefixer 生成），可以兼容 Android 4.0 以上及 iOS 6.0 以上版本。  \n现在 Android 4.0 和 iOS 6.0 以下版本的用户已经很少了。随着时间的推移，会越来越少。  \n如果现在移动端的项目不用考虑 Android 4.0 以下版本的浏览器，那么 flex 完全可用了。\n\n## 总结\n上面几种对齐方式，一和四一般用于多行文字的居中对齐。二和三多用于弹窗的居中对齐。  \n而 flex 这种方式，各种情况的居中对齐都可以用。  \n\n如果不用考虑兼容性的话，可以优先选择 flex。  \n移动端的项目基本可用了。  \nPC 端的话，考虑到兼容性，最好就先不用，等 IE 10 以下版本的用户量减少到可以不用考虑的时候，再使用。","slug":"css-horizontal-vertical-center","published":1,"updated":"2017-08-08T07:22:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84obh000fuo2ed75s5v66","content":"<p>前端开发中，总会遇到各种需要将元素水平垂直居中的场景。<br>这里简单介绍一下几种 CSS 水平垂直居中的方法及其适用性和兼容性。<a id=\"more\"></a></p>\n<h2 id=\"单行文字的水平垂直居中\"><a href=\"#单行文字的水平垂直居中\" class=\"headerlink\" title=\"单行文字的水平垂直居中\"></a>单行文字的水平垂直居中</h2><p>单行文字的垂直居中是最常见的，也是最容易实现的。<br>只要将文字的行高（line-height）和要垂直居中的元素高度（height）设置为一样即可。<br>水平居中就设置一下 <code>text-align: center</code> 就可以了。<br>例如：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>这里是需要垂直居中的文字<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">40px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">40px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"多行文字及元素的水平垂直居中\"><a href=\"#多行文字及元素的水平垂直居中\" class=\"headerlink\" title=\"多行文字及元素的水平垂直居中\"></a>多行文字及元素的水平垂直居中</h2><h3 id=\"一、display-inline-block-vertical-align-middle\"><a href=\"#一、display-inline-block-vertical-align-middle\" class=\"headerlink\" title=\"一、display: inline-block + vertical-align: middle\"></a>一、display: inline-block + vertical-align: middle</h3><p><code>vertical-align</code> 这个属性依赖于 inline/inline-block/table-cell ，如果元素不属于这几类，这个属性则无法生效。</p>\n<p>要用这两个属性实现垂直居中，需要用到伪类 <code>:before</code> 或者添加一个空元素 。</p>\n<p>假设我们有如下的一段 HTML 代码：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 伪类写法 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>这里是需要水平垂直居中的文字<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 空元素写法 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"center\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>这里是需要水平垂直居中的文字<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>那么我们的 CSS 应该这么写：<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 伪类写法 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.outer</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">''</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 空元素写法 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.center</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>两种写法的原理是一样的。<br>因为 vertical-align 需要有一个能和它对齐的元素，所以添加一个宽度为 0 的元素，可以实现不占用页面大小，却能影响页面布局的作用。<br>高度设置为 100%，那么无论父元素（在上面的代码里是 <code>outer</code>）高度设置为多少，都能在父元素内部垂直居中。  </p>\n<p>这种写法的优点就是兼容性好，IE 8 及其以上版本的浏览器，都支持这种写法。缺点是必须额外添加一个元素。<br>这种方式一般用于不确定是单行或者多行文字的垂直居中。</p>\n<h3 id=\"二、使用绝对定位与-translate-实现水平垂直居中\"><a href=\"#二、使用绝对定位与-translate-实现水平垂直居中\" class=\"headerlink\" title=\"二、使用绝对定位与 translate 实现水平垂直居中\"></a>二、使用绝对定位与 translate 实现水平垂直居中</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%, -50%);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意：这里不要使用 translate3d，会导致显示模糊。<br>这种方式默认情况下，子元素的宽度为父元素的一半，因为 left 设置为 50%，所以文字是从 50% 的位置开始，在 100% （也就是最后面）的位置换行。</p>\n<h3 id=\"三、使用绝对定位与负-margin-实现水平垂直居中\"><a href=\"#三、使用绝对定位与负-margin-实现水平垂直居中\" class=\"headerlink\" title=\"三、使用绝对定位与负 margin 实现水平垂直居中\"></a>三、使用绝对定位与负 margin 实现水平垂直居中</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">100px</span>; <span class=\"comment\">/* 宽度的一半 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">50px</span>; <span class=\"comment\">/* 高度的一半 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种方式的实现原理和 translate 的类似。<br>都是通过反向位移元素宽高的一半，来实现居中对齐。<br>但是负 margin 这种方式需要知道子元素的宽高才能实现。如果使用百分比，获取到的大小是父元素的，而不是子元素的，无法实现对齐效果。</p>\n<h3 id=\"四、display-table-cell-vertical-align-实现垂直居中\"><a href=\"#四、display-table-cell-vertical-align-实现垂直居中\" class=\"headerlink\" title=\"四、display: table-cell + vertical-align 实现垂直居中\"></a>四、display: table-cell + vertical-align 实现垂直居中</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种方式实现的方式类似于 <code>display: inline-block</code>，区别在于 <code>inline-block</code> 需要额外的元素来实现对齐。而 <code>table-cell</code> 不需要。<br>这种方式的兼容性也很好，IE 8 及其以上版本的浏览器都支持。</p>\n<h3 id=\"五、display-flex-实现居中对齐\"><a href=\"#五、display-flex-实现居中对齐\" class=\"headerlink\" title=\"五、display: flex 实现居中对齐\"></a>五、display: flex 实现居中对齐</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center; <span class=\"comment\">/* 水平居中 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center; <span class=\"comment\">/* 垂直居中 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 flex 的优点是，子元素不进行任何设置就能完美实现居中对齐。<br>缺点是只有较新的浏览器支持该特性。<br>PC 端的，IE 10 及其以上版本才能兼容。<br>不过移动端 iOS 7.0 以上， Android 4.4 以上版本已经完全兼容。<br>通过新旧语法混用（可用 autoprefixer 生成），可以兼容 Android 4.0 以上及 iOS 6.0 以上版本。<br>现在 Android 4.0 和 iOS 6.0 以下版本的用户已经很少了。随着时间的推移，会越来越少。<br>如果现在移动端的项目不用考虑 Android 4.0 以下版本的浏览器，那么 flex 完全可用了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>上面几种对齐方式，一和四一般用于多行文字的居中对齐。二和三多用于弹窗的居中对齐。<br>而 flex 这种方式，各种情况的居中对齐都可以用。  </p>\n<p>如果不用考虑兼容性的话，可以优先选择 flex。<br>移动端的项目基本可用了。<br>PC 端的话，考虑到兼容性，最好就先不用，等 IE 10 以下版本的用户量减少到可以不用考虑的时候，再使用。</p>\n","site":{"data":{}},"excerpt":"<p>前端开发中，总会遇到各种需要将元素水平垂直居中的场景。<br>这里简单介绍一下几种 CSS 水平垂直居中的方法及其适用性和兼容性。","more":"</p>\n<h2 id=\"单行文字的水平垂直居中\"><a href=\"#单行文字的水平垂直居中\" class=\"headerlink\" title=\"单行文字的水平垂直居中\"></a>单行文字的水平垂直居中</h2><p>单行文字的垂直居中是最常见的，也是最容易实现的。<br>只要将文字的行高（line-height）和要垂直居中的元素高度（height）设置为一样即可。<br>水平居中就设置一下 <code>text-align: center</code> 就可以了。<br>例如：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>这里是需要垂直居中的文字<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">40px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">line-height</span>: <span class=\"number\">40px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"多行文字及元素的水平垂直居中\"><a href=\"#多行文字及元素的水平垂直居中\" class=\"headerlink\" title=\"多行文字及元素的水平垂直居中\"></a>多行文字及元素的水平垂直居中</h2><h3 id=\"一、display-inline-block-vertical-align-middle\"><a href=\"#一、display-inline-block-vertical-align-middle\" class=\"headerlink\" title=\"一、display: inline-block + vertical-align: middle\"></a>一、display: inline-block + vertical-align: middle</h3><p><code>vertical-align</code> 这个属性依赖于 inline/inline-block/table-cell ，如果元素不属于这几类，这个属性则无法生效。</p>\n<p>要用这两个属性实现垂直居中，需要用到伪类 <code>:before</code> 或者添加一个空元素 。</p>\n<p>假设我们有如下的一段 HTML 代码：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 伪类写法 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>这里是需要水平垂直居中的文字<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 空元素写法 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"center\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>这里是需要水平垂直居中的文字<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>那么我们的 CSS 应该这么写：<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 伪类写法 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.outer</span><span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">content</span>: <span class=\"string\">''</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 空元素写法 */</span></span><br><span class=\"line\"><span class=\"selector-class\">.center</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">  <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>两种写法的原理是一样的。<br>因为 vertical-align 需要有一个能和它对齐的元素，所以添加一个宽度为 0 的元素，可以实现不占用页面大小，却能影响页面布局的作用。<br>高度设置为 100%，那么无论父元素（在上面的代码里是 <code>outer</code>）高度设置为多少，都能在父元素内部垂直居中。  </p>\n<p>这种写法的优点就是兼容性好，IE 8 及其以上版本的浏览器，都支持这种写法。缺点是必须额外添加一个元素。<br>这种方式一般用于不确定是单行或者多行文字的垂直居中。</p>\n<h3 id=\"二、使用绝对定位与-translate-实现水平垂直居中\"><a href=\"#二、使用绝对定位与-translate-实现水平垂直居中\" class=\"headerlink\" title=\"二、使用绝对定位与 translate 实现水平垂直居中\"></a>二、使用绝对定位与 translate 实现水平垂直居中</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-50%, -50%);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意：这里不要使用 translate3d，会导致显示模糊。<br>这种方式默认情况下，子元素的宽度为父元素的一半，因为 left 设置为 50%，所以文字是从 50% 的位置开始，在 100% （也就是最后面）的位置换行。</p>\n<h3 id=\"三、使用绝对定位与负-margin-实现水平垂直居中\"><a href=\"#三、使用绝对定位与负-margin-实现水平垂直居中\" class=\"headerlink\" title=\"三、使用绝对定位与负 margin 实现水平垂直居中\"></a>三、使用绝对定位与负 margin 实现水平垂直居中</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">margin-left</span>: -<span class=\"number\">100px</span>; <span class=\"comment\">/* 宽度的一半 */</span></span><br><span class=\"line\">    <span class=\"attribute\">margin-top</span>: -<span class=\"number\">50px</span>; <span class=\"comment\">/* 高度的一半 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种方式的实现原理和 translate 的类似。<br>都是通过反向位移元素宽高的一半，来实现居中对齐。<br>但是负 margin 这种方式需要知道子元素的宽高才能实现。如果使用百分比，获取到的大小是父元素的，而不是子元素的，无法实现对齐效果。</p>\n<h3 id=\"四、display-table-cell-vertical-align-实现垂直居中\"><a href=\"#四、display-table-cell-vertical-align-实现垂直居中\" class=\"headerlink\" title=\"四、display: table-cell + vertical-align 实现垂直居中\"></a>四、display: table-cell + vertical-align 实现垂直居中</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.inner</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这种方式实现的方式类似于 <code>display: inline-block</code>，区别在于 <code>inline-block</code> 需要额外的元素来实现对齐。而 <code>table-cell</code> 不需要。<br>这种方式的兼容性也很好，IE 8 及其以上版本的浏览器都支持。</p>\n<h3 id=\"五、display-flex-实现居中对齐\"><a href=\"#五、display-flex-实现居中对齐\" class=\"headerlink\" title=\"五、display: flex 实现居中对齐\"></a>五、display: flex 实现居中对齐</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span>水平垂直居中<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.outer</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center; <span class=\"comment\">/* 水平居中 */</span></span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center; <span class=\"comment\">/* 垂直居中 */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 flex 的优点是，子元素不进行任何设置就能完美实现居中对齐。<br>缺点是只有较新的浏览器支持该特性。<br>PC 端的，IE 10 及其以上版本才能兼容。<br>不过移动端 iOS 7.0 以上， Android 4.4 以上版本已经完全兼容。<br>通过新旧语法混用（可用 autoprefixer 生成），可以兼容 Android 4.0 以上及 iOS 6.0 以上版本。<br>现在 Android 4.0 和 iOS 6.0 以下版本的用户已经很少了。随着时间的推移，会越来越少。<br>如果现在移动端的项目不用考虑 Android 4.0 以下版本的浏览器，那么 flex 完全可用了。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>上面几种对齐方式，一和四一般用于多行文字的居中对齐。二和三多用于弹窗的居中对齐。<br>而 flex 这种方式，各种情况的居中对齐都可以用。  </p>\n<p>如果不用考虑兼容性的话，可以优先选择 flex。<br>移动端的项目基本可用了。<br>PC 端的话，考虑到兼容性，最好就先不用，等 IE 10 以下版本的用户量减少到可以不用考虑的时候，再使用。</p>"},{"title":"css 关于清除浮动的几种方法","date":"2017-08-04T05:59:46.000Z","_content":"#####  什么是CSS清除浮动？\n`\n在非IE浏览器（如Firefox）下，当容器的高度为auto，且容器的内容中有浮动（float为left或right）的元素，在这种情况下，容器的高度不能自动伸长以适应内容的高度，使得内容溢出到容器外面而影响（甚至破坏）布局的现象。这个现象叫浮动溢出，为了防止这个现象的出现而进行的CSS处理，就叫CSS清除浮动。引用W3C的例子，容器没有包围浮动的元素。\n`\n<!--more-->\n##### 一、给父元素定高\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid black;\n            width: 300px;\n            height: 50px;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #ff4400;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #005FC3;\n            width: 200px;\n            height: 100px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n- 优点：简单，代码少，容易掌握\n- 缺点：只适合高度固定的布局，要给出精确的高度，如果高度和父级div不一样时，会产生问题\n\n##### 二、使用带clear属性的空元素\n`\n在浮动元素后使用一个空元素如<div class=\"clear\"></div>，并在CSS中赋予.clear{clear:both;}属性即可清理浮动。\n`\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .top{\n            border: 1px solid #000;\n            width:300px;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #F0FFF0;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #FFB5C5;\n            width: 200px;\n            height: 100px;\n        }\n        .clearfix{\n            clear: both;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"top\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"clearfix\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n-  优点：简单，代码少，浏览器兼容性好。\n-  缺点：需要添加大量无语义的html元素，后期不容易维护。\n\n##### 三、使用邻接元素处理\n`\n什么都不做，给浮动元素后面的元素添加clear属性。\n`\n##### 四、使用CSS的overflow属性\n`\n给浮动元素的容器添加overflow:hidden;或overflow:auto;可以清除浮动，另外在 IE6 中还需要触发 hasLayout ，例如为父元素设置容器宽高或设置 zoom:1。\n在添加overflow属性后，浮动元素又回到了容器层，把容器高度撑起，达到了清理浮动的效果。`\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid black;\n            width: 300px;\n            overflow: hidden;\n            zoom: 1;/*兼容 IE*/\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #ff4400;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #005FC3;\n            width: 200px;\n            height: 100px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n##### 五、给浮动的元素的容器添加浮动\n\n`给浮动元素的容器也添加上浮动属性即可清除内部浮动，但是这样会使其整体浮动，影响布局，不推荐使用。`\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid black;\n            width: 300px;\n            float: left;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #ff4400;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #005FC3;\n            width: 200px;\n            height: 100px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n\n\n##### 六、使用CSS的:after伪元素\n\n`\n结合 :after 伪元素（注意这不是伪类，而是伪元素，代表一个元素之后最近的元素）和 IEhack ，可以完美兼容当前主流的各大浏览器，这里的 IEhack 指的是触发 hasLayout。\n给浮动元素的容器添加一个clearfix的class，然后给这个class添加一个:after伪元素实现元素末尾添加一个看不见的块元素（Block element）清理浮动。\n`\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid #000;\n            width: 300px;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #F0FFF0;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #FFB5C5;\n            width: 200px;\n            height: 100px;\n        }\n        .clearfix:after{  /*最简方式*/\n            content: '';\n            display: block;\n            clear: both;\n        }\n        /* 新浪使用方式\n        .clearfix:after{ \n            content: '';\n            display: block;\n            clear: both;\n            height: 0;\n            visibility: hidden;\n        }\n        */\n        .clearfix{ /*兼容 IE*/\n            zoom: 1;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer clearfix\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n\n##### 总结\n\n\n`通过上面的例子，我们不难发现清除浮动的方法可以分成两类：`\n\n  `1.是利用 clear 属性，包括在浮动元素末尾添加一个带有 clear: both 属性的空 div 来闭合元素，其实利用 :after 伪元素的方法也是在元素末尾添加一个内容为一个点并带有 clear: both 属性的元素实现的。`\n  \n  `2.是触发浮动元素父元素的 BFC (Block Formatting Contexts, 块级格式化上下文)，使到该父元素可以包含浮动元素，关于这一点。`\n\n##### 推荐\n\n`在网页主要布局时使用:after伪元素方法并作为主要清理浮动方式；在小模块如ul里使用overflow:hidden;（留意可能产生的隐藏溢出元素问题）；如果本身就是浮动元素则可自动清除内部浮动，无需格外处理；正文中使用邻接元素清理之前的浮动。\n最后可以使用相对完美的:after伪元素方法清理浮动，文档结构更加清晰。\n`\n\n\n\n","source":"_posts/css-clearfix-md.md","raw":"---\ntitle: css 关于清除浮动的几种方法\ndate: 2017-08-04 13:59:46\ntags:\n - css\n---\n#####  什么是CSS清除浮动？\n`\n在非IE浏览器（如Firefox）下，当容器的高度为auto，且容器的内容中有浮动（float为left或right）的元素，在这种情况下，容器的高度不能自动伸长以适应内容的高度，使得内容溢出到容器外面而影响（甚至破坏）布局的现象。这个现象叫浮动溢出，为了防止这个现象的出现而进行的CSS处理，就叫CSS清除浮动。引用W3C的例子，容器没有包围浮动的元素。\n`\n<!--more-->\n##### 一、给父元素定高\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid black;\n            width: 300px;\n            height: 50px;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #ff4400;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #005FC3;\n            width: 200px;\n            height: 100px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n- 优点：简单，代码少，容易掌握\n- 缺点：只适合高度固定的布局，要给出精确的高度，如果高度和父级div不一样时，会产生问题\n\n##### 二、使用带clear属性的空元素\n`\n在浮动元素后使用一个空元素如<div class=\"clear\"></div>，并在CSS中赋予.clear{clear:both;}属性即可清理浮动。\n`\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .top{\n            border: 1px solid #000;\n            width:300px;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #F0FFF0;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #FFB5C5;\n            width: 200px;\n            height: 100px;\n        }\n        .clearfix{\n            clear: both;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"top\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"clearfix\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n-  优点：简单，代码少，浏览器兼容性好。\n-  缺点：需要添加大量无语义的html元素，后期不容易维护。\n\n##### 三、使用邻接元素处理\n`\n什么都不做，给浮动元素后面的元素添加clear属性。\n`\n##### 四、使用CSS的overflow属性\n`\n给浮动元素的容器添加overflow:hidden;或overflow:auto;可以清除浮动，另外在 IE6 中还需要触发 hasLayout ，例如为父元素设置容器宽高或设置 zoom:1。\n在添加overflow属性后，浮动元素又回到了容器层，把容器高度撑起，达到了清理浮动的效果。`\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid black;\n            width: 300px;\n            overflow: hidden;\n            zoom: 1;/*兼容 IE*/\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #ff4400;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #005FC3;\n            width: 200px;\n            height: 100px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n##### 五、给浮动的元素的容器添加浮动\n\n`给浮动元素的容器也添加上浮动属性即可清除内部浮动，但是这样会使其整体浮动，影响布局，不推荐使用。`\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid black;\n            width: 300px;\n            float: left;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #ff4400;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #005FC3;\n            width: 200px;\n            height: 100px;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n\n\n##### 六、使用CSS的:after伪元素\n\n`\n结合 :after 伪元素（注意这不是伪类，而是伪元素，代表一个元素之后最近的元素）和 IEhack ，可以完美兼容当前主流的各大浏览器，这里的 IEhack 指的是触发 hasLayout。\n给浮动元素的容器添加一个clearfix的class，然后给这个class添加一个:after伪元素实现元素末尾添加一个看不见的块元素（Block element）清理浮动。\n`\n\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title></title>\n    <style>\n        .outer{\n            border: 1px solid #000;\n            width: 300px;\n        }\n        .inner{\n            width: 50px;\n            height: 50px;\n            background-color: #F0FFF0;\n            margin-right: 20px;\n            float: left;\n        }\n        .footer{\n            background-color: #FFB5C5;\n            width: 200px;\n            height: 100px;\n        }\n        .clearfix:after{  /*最简方式*/\n            content: '';\n            display: block;\n            clear: both;\n        }\n        /* 新浪使用方式\n        .clearfix:after{ \n            content: '';\n            display: block;\n            clear: both;\n            height: 0;\n            visibility: hidden;\n        }\n        */\n        .clearfix{ /*兼容 IE*/\n            zoom: 1;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"outer clearfix\">\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n        <div class=\"inner\"></div>\n    </div>\n    <div class=\"footer\"></div>\n</body>\n</html>\n```\n\n##### 总结\n\n\n`通过上面的例子，我们不难发现清除浮动的方法可以分成两类：`\n\n  `1.是利用 clear 属性，包括在浮动元素末尾添加一个带有 clear: both 属性的空 div 来闭合元素，其实利用 :after 伪元素的方法也是在元素末尾添加一个内容为一个点并带有 clear: both 属性的元素实现的。`\n  \n  `2.是触发浮动元素父元素的 BFC (Block Formatting Contexts, 块级格式化上下文)，使到该父元素可以包含浮动元素，关于这一点。`\n\n##### 推荐\n\n`在网页主要布局时使用:after伪元素方法并作为主要清理浮动方式；在小模块如ul里使用overflow:hidden;（留意可能产生的隐藏溢出元素问题）；如果本身就是浮动元素则可自动清除内部浮动，无需格外处理；正文中使用邻接元素清理之前的浮动。\n最后可以使用相对完美的:after伪元素方法清理浮动，文档结构更加清晰。\n`\n\n\n\n","slug":"css-clearfix-md","published":1,"updated":"2017-09-08T06:54:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84obl000juo2em3z8y83c","content":"<h5 id=\"什么是CSS清除浮动？\"><a href=\"#什么是CSS清除浮动？\" class=\"headerlink\" title=\"什么是CSS清除浮动？\"></a>什么是CSS清除浮动？</h5><p><code>在非IE浏览器（如Firefox）下，当容器的高度为auto，且容器的内容中有浮动（float为left或right）的元素，在这种情况下，容器的高度不能自动伸长以适应内容的高度，使得内容溢出到容器外面而影响（甚至破坏）布局的现象。这个现象叫浮动溢出，为了防止这个现象的出现而进行的CSS处理，就叫CSS清除浮动。引用W3C的例子，容器没有包围浮动的元素。</code><br><a id=\"more\"></a></p>\n<h5 id=\"一、给父元素定高\"><a href=\"#一、给父元素定高\" class=\"headerlink\" title=\"一、给父元素定高\"></a>一、给父元素定高</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            border: 1px solid black;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#ff4400</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#005FC3</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：简单，代码少，容易掌握</li>\n<li>缺点：只适合高度固定的布局，要给出精确的高度，如果高度和父级div不一样时，会产生问题</li>\n</ul>\n<h5 id=\"二、使用带clear属性的空元素\"><a href=\"#二、使用带clear属性的空元素\" class=\"headerlink\" title=\"二、使用带clear属性的空元素\"></a>二、使用带clear属性的空元素</h5><p><code>在浮动元素后使用一个空元素如&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;，并在CSS中赋予.clear{clear:both;}属性即可清理浮动。</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.top</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">border</span>: 1<span class=\"selector-tag\">px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-id\">#000</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">width</span><span class=\"selector-pseudo\">:300px</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#F0FFF0</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#FFB5C5</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            clear: both;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"top\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"clearfix\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>优点：简单，代码少，浏览器兼容性好。</li>\n<li>缺点：需要添加大量无语义的html元素，后期不容易维护。</li>\n</ul>\n<h5 id=\"三、使用邻接元素处理\"><a href=\"#三、使用邻接元素处理\" class=\"headerlink\" title=\"三、使用邻接元素处理\"></a>三、使用邻接元素处理</h5><p><code>什么都不做，给浮动元素后面的元素添加clear属性。</code></p>\n<h5 id=\"四、使用CSS的overflow属性\"><a href=\"#四、使用CSS的overflow属性\" class=\"headerlink\" title=\"四、使用CSS的overflow属性\"></a>四、使用CSS的overflow属性</h5><p><code>给浮动元素的容器添加overflow:hidden;或overflow:auto;可以清除浮动，另外在 IE6 中还需要触发 hasLayout ，例如为父元素设置容器宽高或设置 zoom:1。\n在添加overflow属性后，浮动元素又回到了容器层，把容器高度撑起，达到了清理浮动的效果。</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            border: 1px solid black;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">            overflow: hidden;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">zoom</span>: 1;<span class=\"comment\">/*兼容 IE*/</span></span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#ff4400</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#005FC3</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h5 id=\"五、给浮动的元素的容器添加浮动\"><a href=\"#五、给浮动的元素的容器添加浮动\" class=\"headerlink\" title=\"五、给浮动的元素的容器添加浮动\"></a>五、给浮动的元素的容器添加浮动</h5><p><code>给浮动元素的容器也添加上浮动属性即可清除内部浮动，但是这样会使其整体浮动，影响布局，不推荐使用。</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            border: 1px solid black;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#ff4400</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#005FC3</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"六、使用CSS的-after伪元素\"><a href=\"#六、使用CSS的-after伪元素\" class=\"headerlink\" title=\"六、使用CSS的:after伪元素\"></a>六、使用CSS的:after伪元素</h5><p><code>结合 :after 伪元素（注意这不是伪类，而是伪元素，代表一个元素之后最近的元素）和 IEhack ，可以完美兼容当前主流的各大浏览器，这里的 IEhack 指的是触发 hasLayout。\n给浮动元素的容器添加一个clearfix的class，然后给这个class添加一个:after伪元素实现元素末尾添加一个看不见的块元素（Block element）清理浮动。</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">border</span>: 1<span class=\"selector-tag\">px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-id\">#000</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#F0FFF0</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#FFB5C5</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span><span class=\"selector-pseudo\">:after</span>&#123;  <span class=\"comment\">/*最简方式*/</span></span></span><br><span class=\"line\"><span class=\"undefined\">            content: '';</span></span><br><span class=\"line\"><span class=\"undefined\">            display: block;</span></span><br><span class=\"line\"><span class=\"undefined\">            clear: both;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        /* 新浪使用方式</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span><span class=\"selector-pseudo\">:after</span>&#123; </span></span><br><span class=\"line\"><span class=\"undefined\">            content: '';</span></span><br><span class=\"line\"><span class=\"undefined\">            display: block;</span></span><br><span class=\"line\"><span class=\"undefined\">            clear: both;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">            visibility: hidden;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        */</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span>&#123; <span class=\"comment\">/*兼容 IE*/</span></span></span><br><span class=\"line\"><span class=\"undefined\">            zoom: 1;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer clearfix\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h5><p><code>通过上面的例子，我们不难发现清除浮动的方法可以分成两类：</code></p>\n<p>  <code>1.是利用 clear 属性，包括在浮动元素末尾添加一个带有 clear: both 属性的空 div 来闭合元素，其实利用 :after 伪元素的方法也是在元素末尾添加一个内容为一个点并带有 clear: both 属性的元素实现的。</code></p>\n<p>  <code>2.是触发浮动元素父元素的 BFC (Block Formatting Contexts, 块级格式化上下文)，使到该父元素可以包含浮动元素，关于这一点。</code></p>\n<h5 id=\"推荐\"><a href=\"#推荐\" class=\"headerlink\" title=\"推荐\"></a>推荐</h5><p><code>在网页主要布局时使用:after伪元素方法并作为主要清理浮动方式；在小模块如ul里使用overflow:hidden;（留意可能产生的隐藏溢出元素问题）；如果本身就是浮动元素则可自动清除内部浮动，无需格外处理；正文中使用邻接元素清理之前的浮动。\n最后可以使用相对完美的:after伪元素方法清理浮动，文档结构更加清晰。</code></p>\n","site":{"data":{}},"excerpt":"<h5 id=\"什么是CSS清除浮动？\"><a href=\"#什么是CSS清除浮动？\" class=\"headerlink\" title=\"什么是CSS清除浮动？\"></a>什么是CSS清除浮动？</h5><p><code>在非IE浏览器（如Firefox）下，当容器的高度为auto，且容器的内容中有浮动（float为left或right）的元素，在这种情况下，容器的高度不能自动伸长以适应内容的高度，使得内容溢出到容器外面而影响（甚至破坏）布局的现象。这个现象叫浮动溢出，为了防止这个现象的出现而进行的CSS处理，就叫CSS清除浮动。引用W3C的例子，容器没有包围浮动的元素。</code><br>","more":"</p>\n<h5 id=\"一、给父元素定高\"><a href=\"#一、给父元素定高\" class=\"headerlink\" title=\"一、给父元素定高\"></a>一、给父元素定高</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            border: 1px solid black;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#ff4400</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#005FC3</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：简单，代码少，容易掌握</li>\n<li>缺点：只适合高度固定的布局，要给出精确的高度，如果高度和父级div不一样时，会产生问题</li>\n</ul>\n<h5 id=\"二、使用带clear属性的空元素\"><a href=\"#二、使用带clear属性的空元素\" class=\"headerlink\" title=\"二、使用带clear属性的空元素\"></a>二、使用带clear属性的空元素</h5><p><code>在浮动元素后使用一个空元素如&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;，并在CSS中赋予.clear{clear:both;}属性即可清理浮动。</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.top</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">border</span>: 1<span class=\"selector-tag\">px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-id\">#000</span>;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">width</span><span class=\"selector-pseudo\">:300px</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#F0FFF0</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#FFB5C5</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            clear: both;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"top\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"clearfix\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>优点：简单，代码少，浏览器兼容性好。</li>\n<li>缺点：需要添加大量无语义的html元素，后期不容易维护。</li>\n</ul>\n<h5 id=\"三、使用邻接元素处理\"><a href=\"#三、使用邻接元素处理\" class=\"headerlink\" title=\"三、使用邻接元素处理\"></a>三、使用邻接元素处理</h5><p><code>什么都不做，给浮动元素后面的元素添加clear属性。</code></p>\n<h5 id=\"四、使用CSS的overflow属性\"><a href=\"#四、使用CSS的overflow属性\" class=\"headerlink\" title=\"四、使用CSS的overflow属性\"></a>四、使用CSS的overflow属性</h5><p><code>给浮动元素的容器添加overflow:hidden;或overflow:auto;可以清除浮动，另外在 IE6 中还需要触发 hasLayout ，例如为父元素设置容器宽高或设置 zoom:1。\n在添加overflow属性后，浮动元素又回到了容器层，把容器高度撑起，达到了清理浮动的效果。</code><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            border: 1px solid black;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">            overflow: hidden;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">zoom</span>: 1;<span class=\"comment\">/*兼容 IE*/</span></span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#ff4400</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#005FC3</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h5 id=\"五、给浮动的元素的容器添加浮动\"><a href=\"#五、给浮动的元素的容器添加浮动\" class=\"headerlink\" title=\"五、给浮动的元素的容器添加浮动\"></a>五、给浮动的元素的容器添加浮动</h5><p><code>给浮动元素的容器也添加上浮动属性即可清除内部浮动，但是这样会使其整体浮动，影响布局，不推荐使用。</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            border: 1px solid black;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#ff4400</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#005FC3</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"六、使用CSS的-after伪元素\"><a href=\"#六、使用CSS的-after伪元素\" class=\"headerlink\" title=\"六、使用CSS的:after伪元素\"></a>六、使用CSS的:after伪元素</h5><p><code>结合 :after 伪元素（注意这不是伪类，而是伪元素，代表一个元素之后最近的元素）和 IEhack ，可以完美兼容当前主流的各大浏览器，这里的 IEhack 指的是触发 hasLayout。\n给浮动元素的容器添加一个clearfix的class，然后给这个class添加一个:after伪元素实现元素末尾添加一个看不见的块元素（Block element）清理浮动。</code></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.outer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">border</span>: 1<span class=\"selector-tag\">px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-id\">#000</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 300px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.inner</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 50px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 50px;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#F0FFF0</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin-right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">            float: left;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.footer</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">            <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#FFB5C5</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 200px;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100px;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span><span class=\"selector-pseudo\">:after</span>&#123;  <span class=\"comment\">/*最简方式*/</span></span></span><br><span class=\"line\"><span class=\"undefined\">            content: '';</span></span><br><span class=\"line\"><span class=\"undefined\">            display: block;</span></span><br><span class=\"line\"><span class=\"undefined\">            clear: both;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        /* 新浪使用方式</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span><span class=\"selector-pseudo\">:after</span>&#123; </span></span><br><span class=\"line\"><span class=\"undefined\">            content: '';</span></span><br><span class=\"line\"><span class=\"undefined\">            display: block;</span></span><br><span class=\"line\"><span class=\"undefined\">            clear: both;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">            visibility: hidden;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        */</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-class\">.clearfix</span>&#123; <span class=\"comment\">/*兼容 IE*/</span></span></span><br><span class=\"line\"><span class=\"undefined\">            zoom: 1;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"outer clearfix\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h5><p><code>通过上面的例子，我们不难发现清除浮动的方法可以分成两类：</code></p>\n<p>  <code>1.是利用 clear 属性，包括在浮动元素末尾添加一个带有 clear: both 属性的空 div 来闭合元素，其实利用 :after 伪元素的方法也是在元素末尾添加一个内容为一个点并带有 clear: both 属性的元素实现的。</code></p>\n<p>  <code>2.是触发浮动元素父元素的 BFC (Block Formatting Contexts, 块级格式化上下文)，使到该父元素可以包含浮动元素，关于这一点。</code></p>\n<h5 id=\"推荐\"><a href=\"#推荐\" class=\"headerlink\" title=\"推荐\"></a>推荐</h5><p><code>在网页主要布局时使用:after伪元素方法并作为主要清理浮动方式；在小模块如ul里使用overflow:hidden;（留意可能产生的隐藏溢出元素问题）；如果本身就是浮动元素则可自动清除内部浮动，无需格外处理；正文中使用邻接元素清理之前的浮动。\n最后可以使用相对完美的:after伪元素方法清理浮动，文档结构更加清晰。</code></p>"},{"title":"设计模式之单例模式","date":"2017-12-07T16:00:00.000Z","_content":"\n单例模式：保证一个类仅有一个实例，并提供一个访问它的全局访问点.\n全局缓存、浏 览器中的 window 对象、登录弹窗\n<!--more-->\n\n\n## 单例模式\n\n### 直接返回对象\n\n唯一变量：重写构造函数，形成闭包变量\n\n```js\nvar singleTon = function () {\n  var instance = {\n    name: 'Jack',\n    getName: function () {\n      console.log(instance.name);\n    }\n  };\n  singleTon = function () {\n    return instance;\n  }\n  return instance;\n}\nvar singleton = singleTon();\nvar singleton2 = singleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n\n### 隐式返回this\n\n唯一变量：写入函数属性\n\n```js\nvar SingleTon = function () {\n  if (SingleTon.instance) {\n    return SingleTon.instance;\n  }\n  this.name = 'Jack';\n  this.getName = function () {\n    console.log(this.name);\n  }\n  SingleTon.instance = this;\n}\nvar singleton = new SingleTon();\nvar singleton2 = new SingleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n\n### 重写构造函数\n\n唯一变量：重写构造函数，形成闭包变量\n\n```js\nvar SingleTon = function () {\n  var instance = this;\n  SingleTon = function () {\n    return instance;\n  }\n  this.name = 'Jack';\n  this.getName = function () {\n    console.log(this.name);\n  }\n}\nvar singleton = new SingleTon();\nvar singleton2 = new SingleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n\n### 闭包形式\n\n唯一变量：匿名函数，形成闭包变量\n\n```js\nvar SingleTon;\n(function () {\n  var instance;\n  SingleTon = function () {\n    if (instance) return instance;\n    instance = this;\n    this.name = 'Jack';\n    this.getName = function () {\n      console.log(this.name);\n    }\n  }\n})();\nvar singleton = new SingleTon();\nvar singleton2 = new SingleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n## 原理\n\n形成唯一变量，实例最后都指向同一变量\n\n## 方式\n\n+ 使用匿名函数，形成闭包变量\n+ 重写构造函数，形成闭包变量\n+ 写入构造函数属性，形成函数属性变量\n\n## 代理形式实现单例\n\nQ：以上代码不能一目了然，可读性差，可维护性差，可扩展性差\nA：分割业务代码和单例代码\n\n+ 单例核心代码\n\n```js\nvar obj;\nif (obj) return obj\nobj = xxx;\n```\n\n+ 业务代码\n\n```js\nvar LoginBox = function () {\n  this.init();\n}\nLoginBox.prototype = {\n  init: function () {\n    this.$box = document.getElementById('LoginBox');\n  },\n  show: function () {\n    this.$box.style.display = 'block';\n  }\n}\n```\n\n+ 单例代码\n\n```js\nvar proxyLoginBox = (function () {\n  var instance;\n  return function () {\n    if (instance) return instance;\n    instance = new LoginBox();\n  }\n})();\n```\n\n+ 调用代码\n\n```js\nvar loginbox = new proxyLoginBox();\nvar loginbox2 = new proxyLoginBox();\n```\n\n## 参考\n\n[JavaScript设计模式与开发实践](https://book.douban.com/subject/26382780/)","source":"_posts/design-pattern-singleton-pattern.md","raw":"---\ntitle: 设计模式之单例模式\ndate: 2017-12-08\ntags:\n---\n\n单例模式：保证一个类仅有一个实例，并提供一个访问它的全局访问点.\n全局缓存、浏 览器中的 window 对象、登录弹窗\n<!--more-->\n\n\n## 单例模式\n\n### 直接返回对象\n\n唯一变量：重写构造函数，形成闭包变量\n\n```js\nvar singleTon = function () {\n  var instance = {\n    name: 'Jack',\n    getName: function () {\n      console.log(instance.name);\n    }\n  };\n  singleTon = function () {\n    return instance;\n  }\n  return instance;\n}\nvar singleton = singleTon();\nvar singleton2 = singleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n\n### 隐式返回this\n\n唯一变量：写入函数属性\n\n```js\nvar SingleTon = function () {\n  if (SingleTon.instance) {\n    return SingleTon.instance;\n  }\n  this.name = 'Jack';\n  this.getName = function () {\n    console.log(this.name);\n  }\n  SingleTon.instance = this;\n}\nvar singleton = new SingleTon();\nvar singleton2 = new SingleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n\n### 重写构造函数\n\n唯一变量：重写构造函数，形成闭包变量\n\n```js\nvar SingleTon = function () {\n  var instance = this;\n  SingleTon = function () {\n    return instance;\n  }\n  this.name = 'Jack';\n  this.getName = function () {\n    console.log(this.name);\n  }\n}\nvar singleton = new SingleTon();\nvar singleton2 = new SingleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n\n### 闭包形式\n\n唯一变量：匿名函数，形成闭包变量\n\n```js\nvar SingleTon;\n(function () {\n  var instance;\n  SingleTon = function () {\n    if (instance) return instance;\n    instance = this;\n    this.name = 'Jack';\n    this.getName = function () {\n      console.log(this.name);\n    }\n  }\n})();\nvar singleton = new SingleTon();\nvar singleton2 = new SingleTon();\nsingleton.name = 'new Jack';\nsingleton2.getName(); // new Jack\nconsole.log(singleton === singleton2); // true\n```\n\n## 原理\n\n形成唯一变量，实例最后都指向同一变量\n\n## 方式\n\n+ 使用匿名函数，形成闭包变量\n+ 重写构造函数，形成闭包变量\n+ 写入构造函数属性，形成函数属性变量\n\n## 代理形式实现单例\n\nQ：以上代码不能一目了然，可读性差，可维护性差，可扩展性差\nA：分割业务代码和单例代码\n\n+ 单例核心代码\n\n```js\nvar obj;\nif (obj) return obj\nobj = xxx;\n```\n\n+ 业务代码\n\n```js\nvar LoginBox = function () {\n  this.init();\n}\nLoginBox.prototype = {\n  init: function () {\n    this.$box = document.getElementById('LoginBox');\n  },\n  show: function () {\n    this.$box.style.display = 'block';\n  }\n}\n```\n\n+ 单例代码\n\n```js\nvar proxyLoginBox = (function () {\n  var instance;\n  return function () {\n    if (instance) return instance;\n    instance = new LoginBox();\n  }\n})();\n```\n\n+ 调用代码\n\n```js\nvar loginbox = new proxyLoginBox();\nvar loginbox2 = new proxyLoginBox();\n```\n\n## 参考\n\n[JavaScript设计模式与开发实践](https://book.douban.com/subject/26382780/)","slug":"design-pattern-singleton-pattern","published":1,"updated":"2017-12-15T06:28:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84obo000luo2e9koi3lcm","content":"<p>单例模式：保证一个类仅有一个实例，并提供一个访问它的全局访问点.<br>全局缓存、浏 览器中的 window 对象、登录弹窗<br><a id=\"more\"></a></p>\n<h2 id=\"单例模式\"><a href=\"#单例模式\" class=\"headerlink\" title=\"单例模式\"></a>单例模式</h2><h3 id=\"直接返回对象\"><a href=\"#直接返回对象\" class=\"headerlink\" title=\"直接返回对象\"></a>直接返回对象</h3><p>唯一变量：重写构造函数，形成闭包变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> singleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'Jack'</span>,</span><br><span class=\"line\">    getName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(instance.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  singleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = singleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = singleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"隐式返回this\"><a href=\"#隐式返回this\" class=\"headerlink\" title=\"隐式返回this\"></a>隐式返回this</h3><p>唯一变量：写入函数属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (SingleTon.instance) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> SingleTon.instance;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'Jack'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  SingleTon.instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"重写构造函数\"><a href=\"#重写构造函数\" class=\"headerlink\" title=\"重写构造函数\"></a>重写构造函数</h3><p>唯一变量：重写构造函数，形成闭包变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'Jack'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"闭包形式\"><a href=\"#闭包形式\" class=\"headerlink\" title=\"闭包形式\"></a>闭包形式</h3><p>唯一变量：匿名函数，形成闭包变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SingleTon;</span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance;</span><br><span class=\"line\">  SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (instance) <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'Jack'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><p>形成唯一变量，实例最后都指向同一变量</p>\n<h2 id=\"方式\"><a href=\"#方式\" class=\"headerlink\" title=\"方式\"></a>方式</h2><ul>\n<li>使用匿名函数，形成闭包变量</li>\n<li>重写构造函数，形成闭包变量</li>\n<li>写入构造函数属性，形成函数属性变量</li>\n</ul>\n<h2 id=\"代理形式实现单例\"><a href=\"#代理形式实现单例\" class=\"headerlink\" title=\"代理形式实现单例\"></a>代理形式实现单例</h2><p>Q：以上代码不能一目了然，可读性差，可维护性差，可扩展性差<br>A：分割业务代码和单例代码</p>\n<ul>\n<li>单例核心代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (obj) <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">obj = xxx;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>业务代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> LoginBox = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">LoginBox.prototype = &#123;</span><br><span class=\"line\">  init: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.$box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'LoginBox'</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  show: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.$box.style.display = <span class=\"string\">'block'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>单例代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> proxyLoginBox = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (instance) <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    instance = <span class=\"keyword\">new</span> LoginBox();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<ul>\n<li>调用代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> loginbox = <span class=\"keyword\">new</span> proxyLoginBox();</span><br><span class=\"line\"><span class=\"keyword\">var</span> loginbox2 = <span class=\"keyword\">new</span> proxyLoginBox();</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://book.douban.com/subject/26382780/\" target=\"_blank\" rel=\"noopener\">JavaScript设计模式与开发实践</a></p>\n","site":{"data":{}},"excerpt":"<p>单例模式：保证一个类仅有一个实例，并提供一个访问它的全局访问点.<br>全局缓存、浏 览器中的 window 对象、登录弹窗<br>","more":"</p>\n<h2 id=\"单例模式\"><a href=\"#单例模式\" class=\"headerlink\" title=\"单例模式\"></a>单例模式</h2><h3 id=\"直接返回对象\"><a href=\"#直接返回对象\" class=\"headerlink\" title=\"直接返回对象\"></a>直接返回对象</h3><p>唯一变量：重写构造函数，形成闭包变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> singleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'Jack'</span>,</span><br><span class=\"line\">    getName: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(instance.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  singleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = singleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = singleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"隐式返回this\"><a href=\"#隐式返回this\" class=\"headerlink\" title=\"隐式返回this\"></a>隐式返回this</h3><p>唯一变量：写入函数属性</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (SingleTon.instance) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> SingleTon.instance;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'Jack'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  SingleTon.instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"重写构造函数\"><a href=\"#重写构造函数\" class=\"headerlink\" title=\"重写构造函数\"></a>重写构造函数</h3><p>唯一变量：重写构造函数，形成闭包变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = <span class=\"string\">'Jack'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"闭包形式\"><a href=\"#闭包形式\" class=\"headerlink\" title=\"闭包形式\"></a>闭包形式</h3><p>唯一变量：匿名函数，形成闭包变量</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> SingleTon;</span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance;</span><br><span class=\"line\">  SingleTon = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (instance) <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    instance = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name = <span class=\"string\">'Jack'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.getName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\"><span class=\"keyword\">var</span> singleton2 = <span class=\"keyword\">new</span> SingleTon();</span><br><span class=\"line\">singleton.name = <span class=\"string\">'new Jack'</span>;</span><br><span class=\"line\">singleton2.getName(); <span class=\"comment\">// new Jack</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(singleton === singleton2); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><p>形成唯一变量，实例最后都指向同一变量</p>\n<h2 id=\"方式\"><a href=\"#方式\" class=\"headerlink\" title=\"方式\"></a>方式</h2><ul>\n<li>使用匿名函数，形成闭包变量</li>\n<li>重写构造函数，形成闭包变量</li>\n<li>写入构造函数属性，形成函数属性变量</li>\n</ul>\n<h2 id=\"代理形式实现单例\"><a href=\"#代理形式实现单例\" class=\"headerlink\" title=\"代理形式实现单例\"></a>代理形式实现单例</h2><p>Q：以上代码不能一目了然，可读性差，可维护性差，可扩展性差<br>A：分割业务代码和单例代码</p>\n<ul>\n<li>单例核心代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> obj;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (obj) <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">obj = xxx;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>业务代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> LoginBox = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">LoginBox.prototype = &#123;</span><br><span class=\"line\">  init: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.$box = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'LoginBox'</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  show: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.$box.style.display = <span class=\"string\">'block'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>单例代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> proxyLoginBox = (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> instance;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (instance) <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    instance = <span class=\"keyword\">new</span> LoginBox();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<ul>\n<li>调用代码</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> loginbox = <span class=\"keyword\">new</span> proxyLoginBox();</span><br><span class=\"line\"><span class=\"keyword\">var</span> loginbox2 = <span class=\"keyword\">new</span> proxyLoginBox();</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://book.douban.com/subject/26382780/\" target=\"_blank\" rel=\"noopener\">JavaScript设计模式与开发实践</a></p>"},{"title":"介绍","date":"2017-07-25T08:06:32.000Z","_content":"本站基于Hexo，写文章前需要先安装Hexo。（文档格式是Markdown）\n<!--more-->\n\n## Hexo使用\n\n### 全局安装\n\n``` bash\n$ npm install hexo-cli -g\n```\n详情：[Hexo](https://hexo.io/)\n\n\n### 本地预览\n\n``` bash\n$ hexo server\n```\n详情：[Hexo Server](https://hexo.io/docs/server.html)\n\n\n### 创建文章\n\n``` bash\n$ hexo new \"your note name\"\n```\n新建的文章位于 `/source/_post` 下面\n详情：[Hexo Writing](https://hexo.io/docs/writing.html)\n\n\n### 编译静态文件\n\n``` bash\n$ hexo generate\n```\n此操作是在服务器操作，本地无需提交 `public` 静态文件。\n详情：[Hexo Generate](https://hexo.io/docs/generating.html)\n\n\n### 发布文章\n\n把自己的 `markdown` 文件 `push` 上版本库即可，其他交由服务器去拉取并编译静态文件..\n\n","source":"_posts/fe-intro.md","raw":"---\ntitle: 介绍\ndate: 2017-07-25 16:06:32\ntags:\n - tutotial\n---\n本站基于Hexo，写文章前需要先安装Hexo。（文档格式是Markdown）\n<!--more-->\n\n## Hexo使用\n\n### 全局安装\n\n``` bash\n$ npm install hexo-cli -g\n```\n详情：[Hexo](https://hexo.io/)\n\n\n### 本地预览\n\n``` bash\n$ hexo server\n```\n详情：[Hexo Server](https://hexo.io/docs/server.html)\n\n\n### 创建文章\n\n``` bash\n$ hexo new \"your note name\"\n```\n新建的文章位于 `/source/_post` 下面\n详情：[Hexo Writing](https://hexo.io/docs/writing.html)\n\n\n### 编译静态文件\n\n``` bash\n$ hexo generate\n```\n此操作是在服务器操作，本地无需提交 `public` 静态文件。\n详情：[Hexo Generate](https://hexo.io/docs/generating.html)\n\n\n### 发布文章\n\n把自己的 `markdown` 文件 `push` 上版本库即可，其他交由服务器去拉取并编译静态文件..\n\n","slug":"fe-intro","published":1,"updated":"2017-12-01T07:50:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84obt000ouo2e4yvyq05g","content":"<p>本站基于Hexo，写文章前需要先安装Hexo。（文档格式是Markdown）<br><a id=\"more\"></a></p>\n<h2 id=\"Hexo使用\"><a href=\"#Hexo使用\" class=\"headerlink\" title=\"Hexo使用\"></a>Hexo使用</h2><h3 id=\"全局安装\"><a href=\"#全局安装\" class=\"headerlink\" title=\"全局安装\"></a>全局安装</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-cli -g</span><br></pre></td></tr></table></figure>\n<p>详情：<a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a></p>\n<h3 id=\"本地预览\"><a href=\"#本地预览\" class=\"headerlink\" title=\"本地预览\"></a>本地预览</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>详情：<a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Hexo Server</a></p>\n<h3 id=\"创建文章\"><a href=\"#创建文章\" class=\"headerlink\" title=\"创建文章\"></a>创建文章</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"your note name\"</span></span><br></pre></td></tr></table></figure>\n<p>新建的文章位于 <code>/source/_post</code> 下面<br>详情：<a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Hexo Writing</a></p>\n<h3 id=\"编译静态文件\"><a href=\"#编译静态文件\" class=\"headerlink\" title=\"编译静态文件\"></a>编译静态文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>此操作是在服务器操作，本地无需提交 <code>public</code> 静态文件。<br>详情：<a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Hexo Generate</a></p>\n<h3 id=\"发布文章\"><a href=\"#发布文章\" class=\"headerlink\" title=\"发布文章\"></a>发布文章</h3><p>把自己的 <code>markdown</code> 文件 <code>push</code> 上版本库即可，其他交由服务器去拉取并编译静态文件..</p>\n","site":{"data":{}},"excerpt":"<p>本站基于Hexo，写文章前需要先安装Hexo。（文档格式是Markdown）<br>","more":"</p>\n<h2 id=\"Hexo使用\"><a href=\"#Hexo使用\" class=\"headerlink\" title=\"Hexo使用\"></a>Hexo使用</h2><h3 id=\"全局安装\"><a href=\"#全局安装\" class=\"headerlink\" title=\"全局安装\"></a>全局安装</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install hexo-cli -g</span><br></pre></td></tr></table></figure>\n<p>详情：<a href=\"https://hexo.io/\" target=\"_blank\" rel=\"noopener\">Hexo</a></p>\n<h3 id=\"本地预览\"><a href=\"#本地预览\" class=\"headerlink\" title=\"本地预览\"></a>本地预览</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>详情：<a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Hexo Server</a></p>\n<h3 id=\"创建文章\"><a href=\"#创建文章\" class=\"headerlink\" title=\"创建文章\"></a>创建文章</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"your note name\"</span></span><br></pre></td></tr></table></figure>\n<p>新建的文章位于 <code>/source/_post</code> 下面<br>详情：<a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Hexo Writing</a></p>\n<h3 id=\"编译静态文件\"><a href=\"#编译静态文件\" class=\"headerlink\" title=\"编译静态文件\"></a>编译静态文件</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>此操作是在服务器操作，本地无需提交 <code>public</code> 静态文件。<br>详情：<a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Hexo Generate</a></p>\n<h3 id=\"发布文章\"><a href=\"#发布文章\" class=\"headerlink\" title=\"发布文章\"></a>发布文章</h3><p>把自己的 <code>markdown</code> 文件 <code>push</code> 上版本库即可，其他交由服务器去拉取并编译静态文件..</p>"},{"title":"git基础","date":"2017-11-17T04:17:08.000Z","_content":"#### 初次运行 Git 前的配置\nGit 提供了一个叫做 git config 的工具，专门用来配置或读取相应的工作环境变量。而正是由这些环境变量，决定了 Git 在各个环节的具体工作方式和行为。这些变量可以存放在以下三个不同的地方：\n- /etc/gitconfig 文件：系统中对所有用户都普遍适用的配置。若使用 git config 时用 --system 选项，读写的就是这个文件。\n- ~/.gitconfig 文件：用户目录下的配置文件只适用于该用户。若使用 git config 时用 --global 选项，读写的就是这个文件。\n- 当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）：这里的配置仅仅针对当前项目有效。每一个级别的配置都会覆盖上层的相同配置，所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。\n<!--more-->\n\n在 Windows 系统上，Git 会找寻用户主目录下的 .gitconfig 文件。主目录即 $HOME 变量指定的目录，一般都是C:\\Documents and Settings\\$USER 。此外，Git 还会尝试找寻 /etc/gitconfig 文件，只不过看当初 Git 装在什么目录，就以此作为根目录来定位。\n\n#### 初始化新仓库\n要对现有的某个项目开始用 Git 管理，只需到此项目所在的目录，执行：\n```bash\n$ git init\n```\n#### 克隆现有的仓库\n\n为了得一个项目的拷贝(copy),我们需要知道这个项目仓库的地址(Git URL). Git能在许多协议下使用，所以Git URL可能以ssh://, http(s)://, git://,或是只是以一个用户名（git 会认为这是一个ssh 地址）为前辍. 有些仓库可以通过不只一种协议来访问，例如，Git本身的源代码你既可以用 git:// 协议来访问：\n```bash\n$ git clone git@github.com:BozhongFE/blog.git\n```\n也可以通过https协议来访问:\n```bash\n$ git clone https://github.com/BozhongFE/blog.git\n```\n#### 检查当前文件状态\n要查看哪些文件处于什么状态，可以用 git status 命令。 如果在克隆仓库后立即使用此命令，会看到类似这样的输出：\n```bash\n$  git status\nOn branch master\nYour branch is up-to-date with 'origin/master'.\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n        source/_posts/git.md\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n\n```\n#### 跟踪新文件\n```bash\n$ git add source/_posts/git.md\n```\n再运行 git status 命令，会看到 git.md 文件已被跟踪，并处于暂存状态：\n```bash\n$ git status\nOn branch master\nYour branch is up-to-date with 'origin/master'.\nChanges to be committed:\n  (use \"git reset HEAD <file>...\" to unstage)\n\n        new file:   source/_posts/git.md\n\n```\n#### 暂存已修改文件\n运行了 git add 之后又作了修订的文件，需要重新运行 git add 把最新版本重新暂存起来\n#### 状态简览\ngit status 命令的输出十分详细，但其用语有些繁琐。 如果你使用 git status -s 命令或 git status --short 命令，你将得到一种更为紧凑的格式输出。 运行 git status -s ，状态报告输出如下：\n```bash\n$ git status -s\n?? source/_posts/git.md\n\n```\n#### 忽略文件\n一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。 通常都是些自动生成的文件，比如日志文件，或者编译过程中创建的临时文件等。 在这种情况下，我们可以创建一个名为 .gitignore 的文件，列出要忽略的文件模式。 来看一个实际的例子：\n```bash\n.DS_Store\ndb.json\n*.log\nnode_modules/\npublic/\n.deploy*/\nyarn.lock\n```\n#### 未暂存的修改\n要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 git diff：\n```bash\n$ git diff\n```\n#### 提交更新\n```bash\n$ git commit\n```\n#### 移动文件\n```bash\n$ git mv file_from file_to\n```\n#### 查看commit历史\n```bash\n$ git log\n```\n#### 显示分支\n```bash\n$ git branch\n```\n#### 切换分支\n新建一个a分支，并且自动切换到a分支。\n```bash\n$ git checkout -b a\n$ git branch\n* a\n  master\n\n```\n#### 合并分支\n```bash\n$ git checkout master\nSwitched to branch 'master'\nYour branch is up-to-date with 'origin/master'.\n$ git merge a \n```\n#### 删除分支\n\n有新建分支，那肯定有删除分支，假如这个分支新建错了，或者a分支的代码已经顺利合并到 master 分支来了，那么a分支没用了，需要删除，这个时候执行 git branch -d a 就可以把a分支删除了。\n```bash\ngit branch -d a\n```\n\n有些时候可能会删除失败，比如如果a分支的代码还没有合并到master，你执行 git branch -d a 是删除不了的，它会智能的提示你a分支还有未合并的代码，但是如果你非要删除，那就执行 git branch -D a 就可以强制删除a分支。\n\n```bash\n$ git branch -D a \n```\n#### 设置别名\n```bash\n$ git config --global alias.psm 'push origin master'\n$ git config --global alias.plm 'pull origin master'\n$ git psm\n$ git plm\n```\n#### 获取分支走向和详细日志\n```bash\n$ git log --graph --pretty=format:'%Cred%h%Creset\n-%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' \n--abbrev-commit --date=relative\n$ git config --global alias.lg \"log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative\"\n$ git lg\n```\n#### 查看配置信息\n要检查已有的配置信息，包括之前设置的别名，可以使用 git config --list 命令：\n```bash\n$ git config --list\ncore.symlinks=false\ncore.autocrlf=true\ncore.fscache=true\ncolor.diff=auto\ncolor.status=auto\ncolor.branch=auto\ncolor.interactive=true\nhelp.format=html\nhttp.sslcainfo=C:/Program Files/Git/mingw64/ssl/certs/ca-bundle.crt\ndiff.astextplain.textconv=astextplain\nrebase.autosquash=true\nuser.name=xxxxx\nuser.email=xxxx@xxx.com\nuser.username=airyland\nfilter.lfs.clean=git-lfs clean -- %f\nfilter.lfs.smudge=git-lfs smudge -- %f\nfilter.lfs.required=true\nfilter.lfs.process=git-lfs filter-process\npush.default=current\nalias.lg=log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative\nalias.psm=push origin master\nalias.br=branch\nalias.plm=pull origin master\n```\n有时候会看到重复的变量名，那就说明它们来自不同的配置文件（比如 /etc/gitconfig 和 ~/.gitconfig），不过最终 Git实际采用的是最后一个。\n\n---\n相关链接：\n\nPro Git：https://git-scm.com/book/zh/v2","source":"_posts/git.md","raw":"---\ntitle: git基础\ndate: 2017-11-17 12:17:08\ntags:\n- tool\n---\n#### 初次运行 Git 前的配置\nGit 提供了一个叫做 git config 的工具，专门用来配置或读取相应的工作环境变量。而正是由这些环境变量，决定了 Git 在各个环节的具体工作方式和行为。这些变量可以存放在以下三个不同的地方：\n- /etc/gitconfig 文件：系统中对所有用户都普遍适用的配置。若使用 git config 时用 --system 选项，读写的就是这个文件。\n- ~/.gitconfig 文件：用户目录下的配置文件只适用于该用户。若使用 git config 时用 --global 选项，读写的就是这个文件。\n- 当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）：这里的配置仅仅针对当前项目有效。每一个级别的配置都会覆盖上层的相同配置，所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。\n<!--more-->\n\n在 Windows 系统上，Git 会找寻用户主目录下的 .gitconfig 文件。主目录即 $HOME 变量指定的目录，一般都是C:\\Documents and Settings\\$USER 。此外，Git 还会尝试找寻 /etc/gitconfig 文件，只不过看当初 Git 装在什么目录，就以此作为根目录来定位。\n\n#### 初始化新仓库\n要对现有的某个项目开始用 Git 管理，只需到此项目所在的目录，执行：\n```bash\n$ git init\n```\n#### 克隆现有的仓库\n\n为了得一个项目的拷贝(copy),我们需要知道这个项目仓库的地址(Git URL). Git能在许多协议下使用，所以Git URL可能以ssh://, http(s)://, git://,或是只是以一个用户名（git 会认为这是一个ssh 地址）为前辍. 有些仓库可以通过不只一种协议来访问，例如，Git本身的源代码你既可以用 git:// 协议来访问：\n```bash\n$ git clone git@github.com:BozhongFE/blog.git\n```\n也可以通过https协议来访问:\n```bash\n$ git clone https://github.com/BozhongFE/blog.git\n```\n#### 检查当前文件状态\n要查看哪些文件处于什么状态，可以用 git status 命令。 如果在克隆仓库后立即使用此命令，会看到类似这样的输出：\n```bash\n$  git status\nOn branch master\nYour branch is up-to-date with 'origin/master'.\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n        source/_posts/git.md\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n\n```\n#### 跟踪新文件\n```bash\n$ git add source/_posts/git.md\n```\n再运行 git status 命令，会看到 git.md 文件已被跟踪，并处于暂存状态：\n```bash\n$ git status\nOn branch master\nYour branch is up-to-date with 'origin/master'.\nChanges to be committed:\n  (use \"git reset HEAD <file>...\" to unstage)\n\n        new file:   source/_posts/git.md\n\n```\n#### 暂存已修改文件\n运行了 git add 之后又作了修订的文件，需要重新运行 git add 把最新版本重新暂存起来\n#### 状态简览\ngit status 命令的输出十分详细，但其用语有些繁琐。 如果你使用 git status -s 命令或 git status --short 命令，你将得到一种更为紧凑的格式输出。 运行 git status -s ，状态报告输出如下：\n```bash\n$ git status -s\n?? source/_posts/git.md\n\n```\n#### 忽略文件\n一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。 通常都是些自动生成的文件，比如日志文件，或者编译过程中创建的临时文件等。 在这种情况下，我们可以创建一个名为 .gitignore 的文件，列出要忽略的文件模式。 来看一个实际的例子：\n```bash\n.DS_Store\ndb.json\n*.log\nnode_modules/\npublic/\n.deploy*/\nyarn.lock\n```\n#### 未暂存的修改\n要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 git diff：\n```bash\n$ git diff\n```\n#### 提交更新\n```bash\n$ git commit\n```\n#### 移动文件\n```bash\n$ git mv file_from file_to\n```\n#### 查看commit历史\n```bash\n$ git log\n```\n#### 显示分支\n```bash\n$ git branch\n```\n#### 切换分支\n新建一个a分支，并且自动切换到a分支。\n```bash\n$ git checkout -b a\n$ git branch\n* a\n  master\n\n```\n#### 合并分支\n```bash\n$ git checkout master\nSwitched to branch 'master'\nYour branch is up-to-date with 'origin/master'.\n$ git merge a \n```\n#### 删除分支\n\n有新建分支，那肯定有删除分支，假如这个分支新建错了，或者a分支的代码已经顺利合并到 master 分支来了，那么a分支没用了，需要删除，这个时候执行 git branch -d a 就可以把a分支删除了。\n```bash\ngit branch -d a\n```\n\n有些时候可能会删除失败，比如如果a分支的代码还没有合并到master，你执行 git branch -d a 是删除不了的，它会智能的提示你a分支还有未合并的代码，但是如果你非要删除，那就执行 git branch -D a 就可以强制删除a分支。\n\n```bash\n$ git branch -D a \n```\n#### 设置别名\n```bash\n$ git config --global alias.psm 'push origin master'\n$ git config --global alias.plm 'pull origin master'\n$ git psm\n$ git plm\n```\n#### 获取分支走向和详细日志\n```bash\n$ git log --graph --pretty=format:'%Cred%h%Creset\n-%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' \n--abbrev-commit --date=relative\n$ git config --global alias.lg \"log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative\"\n$ git lg\n```\n#### 查看配置信息\n要检查已有的配置信息，包括之前设置的别名，可以使用 git config --list 命令：\n```bash\n$ git config --list\ncore.symlinks=false\ncore.autocrlf=true\ncore.fscache=true\ncolor.diff=auto\ncolor.status=auto\ncolor.branch=auto\ncolor.interactive=true\nhelp.format=html\nhttp.sslcainfo=C:/Program Files/Git/mingw64/ssl/certs/ca-bundle.crt\ndiff.astextplain.textconv=astextplain\nrebase.autosquash=true\nuser.name=xxxxx\nuser.email=xxxx@xxx.com\nuser.username=airyland\nfilter.lfs.clean=git-lfs clean -- %f\nfilter.lfs.smudge=git-lfs smudge -- %f\nfilter.lfs.required=true\nfilter.lfs.process=git-lfs filter-process\npush.default=current\nalias.lg=log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative\nalias.psm=push origin master\nalias.br=branch\nalias.plm=pull origin master\n```\n有时候会看到重复的变量名，那就说明它们来自不同的配置文件（比如 /etc/gitconfig 和 ~/.gitconfig），不过最终 Git实际采用的是最后一个。\n\n---\n相关链接：\n\nPro Git：https://git-scm.com/book/zh/v2","slug":"git","published":1,"updated":"2017-12-01T07:50:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84obv000quo2efhtudcws","content":"<h4 id=\"初次运行-Git-前的配置\"><a href=\"#初次运行-Git-前的配置\" class=\"headerlink\" title=\"初次运行 Git 前的配置\"></a>初次运行 Git 前的配置</h4><p>Git 提供了一个叫做 git config 的工具，专门用来配置或读取相应的工作环境变量。而正是由这些环境变量，决定了 Git 在各个环节的具体工作方式和行为。这些变量可以存放在以下三个不同的地方：</p>\n<ul>\n<li>/etc/gitconfig 文件：系统中对所有用户都普遍适用的配置。若使用 git config 时用 –system 选项，读写的就是这个文件。</li>\n<li>~/.gitconfig 文件：用户目录下的配置文件只适用于该用户。若使用 git config 时用 –global 选项，读写的就是这个文件。</li>\n<li>当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）：这里的配置仅仅针对当前项目有效。每一个级别的配置都会覆盖上层的相同配置，所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。<a id=\"more\"></a>\n</li>\n</ul>\n<p>在 Windows 系统上，Git 会找寻用户主目录下的 .gitconfig 文件。主目录即 $HOME 变量指定的目录，一般都是C:\\Documents and Settings\\$USER 。此外，Git 还会尝试找寻 /etc/gitconfig 文件，只不过看当初 Git 装在什么目录，就以此作为根目录来定位。</p>\n<h4 id=\"初始化新仓库\"><a href=\"#初始化新仓库\" class=\"headerlink\" title=\"初始化新仓库\"></a>初始化新仓库</h4><p>要对现有的某个项目开始用 Git 管理，只需到此项目所在的目录，执行：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git init</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"克隆现有的仓库\"><a href=\"#克隆现有的仓库\" class=\"headerlink\" title=\"克隆现有的仓库\"></a>克隆现有的仓库</h4><p>为了得一个项目的拷贝(copy),我们需要知道这个项目仓库的地址(Git URL). Git能在许多协议下使用，所以Git URL可能以ssh://, http(s)://, git://,或是只是以一个用户名（git 会认为这是一个ssh 地址）为前辍. 有些仓库可以通过不只一种协议来访问，例如，Git本身的源代码你既可以用 git:// 协议来访问：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> git@github.com:BozhongFE/blog.git</span><br></pre></td></tr></table></figure></p>\n<p>也可以通过https协议来访问:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/BozhongFE/blog.git</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"检查当前文件状态\"><a href=\"#检查当前文件状态\" class=\"headerlink\" title=\"检查当前文件状态\"></a>检查当前文件状态</h4><p>要查看哪些文件处于什么状态，可以用 git status 命令。 如果在克隆仓库后立即使用此命令，会看到类似这样的输出：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">'origin/master'</span>.</span><br><span class=\"line\">Untracked files:</span><br><span class=\"line\">  (use <span class=\"string\">\"git add &lt;file&gt;...\"</span> to include <span class=\"keyword\">in</span> what will be committed)</span><br><span class=\"line\">        <span class=\"built_in\">source</span>/_posts/git.md</span><br><span class=\"line\"></span><br><span class=\"line\">nothing added to commit but untracked files present (use <span class=\"string\">\"git add\"</span> to track)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"跟踪新文件\"><a href=\"#跟踪新文件\" class=\"headerlink\" title=\"跟踪新文件\"></a>跟踪新文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add <span class=\"built_in\">source</span>/_posts/git.md</span><br></pre></td></tr></table></figure>\n<p>再运行 git status 命令，会看到 git.md 文件已被跟踪，并处于暂存状态：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">'origin/master'</span>.</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use <span class=\"string\">\"git reset HEAD &lt;file&gt;...\"</span> to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">        new file:   <span class=\"built_in\">source</span>/_posts/git.md</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"暂存已修改文件\"><a href=\"#暂存已修改文件\" class=\"headerlink\" title=\"暂存已修改文件\"></a>暂存已修改文件</h4><p>运行了 git add 之后又作了修订的文件，需要重新运行 git add 把最新版本重新暂存起来</p>\n<h4 id=\"状态简览\"><a href=\"#状态简览\" class=\"headerlink\" title=\"状态简览\"></a>状态简览</h4><p>git status 命令的输出十分详细，但其用语有些繁琐。 如果你使用 git status -s 命令或 git status –short 命令，你将得到一种更为紧凑的格式输出。 运行 git status -s ，状态报告输出如下：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status -s</span><br><span class=\"line\">?? <span class=\"built_in\">source</span>/_posts/git.md</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"忽略文件\"><a href=\"#忽略文件\" class=\"headerlink\" title=\"忽略文件\"></a>忽略文件</h4><p>一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。 通常都是些自动生成的文件，比如日志文件，或者编译过程中创建的临时文件等。 在这种情况下，我们可以创建一个名为 .gitignore 的文件，列出要忽略的文件模式。 来看一个实际的例子：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.DS_Store</span><br><span class=\"line\">db.json</span><br><span class=\"line\">*.<span class=\"built_in\">log</span></span><br><span class=\"line\">node_modules/</span><br><span class=\"line\">public/</span><br><span class=\"line\">.deploy*/</span><br><span class=\"line\">yarn.lock</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"未暂存的修改\"><a href=\"#未暂存的修改\" class=\"headerlink\" title=\"未暂存的修改\"></a>未暂存的修改</h4><p>要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 git diff：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"提交更新\"><a href=\"#提交更新\" class=\"headerlink\" title=\"提交更新\"></a>提交更新</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git commit</span><br></pre></td></tr></table></figure>\n<h4 id=\"移动文件\"><a href=\"#移动文件\" class=\"headerlink\" title=\"移动文件\"></a>移动文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git mv file_from file_to</span><br></pre></td></tr></table></figure>\n<h4 id=\"查看commit历史\"><a href=\"#查看commit历史\" class=\"headerlink\" title=\"查看commit历史\"></a>查看commit历史</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">log</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"显示分支\"><a href=\"#显示分支\" class=\"headerlink\" title=\"显示分支\"></a>显示分支</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch</span><br></pre></td></tr></table></figure>\n<h4 id=\"切换分支\"><a href=\"#切换分支\" class=\"headerlink\" title=\"切换分支\"></a>切换分支</h4><p>新建一个a分支，并且自动切换到a分支。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout -b a</span><br><span class=\"line\">$ git branch</span><br><span class=\"line\">* a</span><br><span class=\"line\">  master</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"合并分支\"><a href=\"#合并分支\" class=\"headerlink\" title=\"合并分支\"></a>合并分支</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout master</span><br><span class=\"line\">Switched to branch <span class=\"string\">'master'</span></span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">'origin/master'</span>.</span><br><span class=\"line\">$ git merge a</span><br></pre></td></tr></table></figure>\n<h4 id=\"删除分支\"><a href=\"#删除分支\" class=\"headerlink\" title=\"删除分支\"></a>删除分支</h4><p>有新建分支，那肯定有删除分支，假如这个分支新建错了，或者a分支的代码已经顺利合并到 master 分支来了，那么a分支没用了，需要删除，这个时候执行 git branch -d a 就可以把a分支删除了。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d a</span><br></pre></td></tr></table></figure></p>\n<p>有些时候可能会删除失败，比如如果a分支的代码还没有合并到master，你执行 git branch -d a 是删除不了的，它会智能的提示你a分支还有未合并的代码，但是如果你非要删除，那就执行 git branch -D a 就可以强制删除a分支。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch -D a</span><br></pre></td></tr></table></figure>\n<h4 id=\"设置别名\"><a href=\"#设置别名\" class=\"headerlink\" title=\"设置别名\"></a>设置别名</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global alias.psm <span class=\"string\">'push origin master'</span></span><br><span class=\"line\">$ git config --global alias.plm <span class=\"string\">'pull origin master'</span></span><br><span class=\"line\">$ git psm</span><br><span class=\"line\">$ git plm</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取分支走向和详细日志\"><a href=\"#获取分支走向和详细日志\" class=\"headerlink\" title=\"获取分支走向和详细日志\"></a>获取分支走向和详细日志</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">log</span> --graph --pretty=format:<span class=\"string\">'%Cred%h%Creset</span></span><br><span class=\"line\"><span class=\"string\">-%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> </span><br><span class=\"line\">--abbrev-commit --date=relative</span><br><span class=\"line\">$ git config --global alias.lg <span class=\"string\">\"log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative\"</span></span><br><span class=\"line\">$ git lg</span><br></pre></td></tr></table></figure>\n<h4 id=\"查看配置信息\"><a href=\"#查看配置信息\" class=\"headerlink\" title=\"查看配置信息\"></a>查看配置信息</h4><p>要检查已有的配置信息，包括之前设置的别名，可以使用 git config –list 命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --list</span><br><span class=\"line\">core.symlinks=<span class=\"literal\">false</span></span><br><span class=\"line\">core.autocrlf=<span class=\"literal\">true</span></span><br><span class=\"line\">core.fscache=<span class=\"literal\">true</span></span><br><span class=\"line\">color.diff=auto</span><br><span class=\"line\">color.status=auto</span><br><span class=\"line\">color.branch=auto</span><br><span class=\"line\">color.interactive=<span class=\"literal\">true</span></span><br><span class=\"line\">help.format=html</span><br><span class=\"line\">http.sslcainfo=C:/Program Files/Git/mingw64/ssl/certs/ca-bundle.crt</span><br><span class=\"line\">diff.astextplain.textconv=astextplain</span><br><span class=\"line\">rebase.autosquash=<span class=\"literal\">true</span></span><br><span class=\"line\">user.name=xxxxx</span><br><span class=\"line\">user.email=xxxx@xxx.com</span><br><span class=\"line\">user.username=airyland</span><br><span class=\"line\">filter.lfs.clean=git-lfs clean -- %f</span><br><span class=\"line\">filter.lfs.smudge=git-lfs smudge -- %f</span><br><span class=\"line\">filter.lfs.required=<span class=\"literal\">true</span></span><br><span class=\"line\">filter.lfs.process=git-lfs filter-process</span><br><span class=\"line\">push.default=current</span><br><span class=\"line\">alias.lg=<span class=\"built_in\">log</span> --graph --pretty=format:<span class=\"string\">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> --abbrev-commit --date=relative</span><br><span class=\"line\">alias.psm=push origin master</span><br><span class=\"line\">alias.br=branch</span><br><span class=\"line\">alias.plm=pull origin master</span><br></pre></td></tr></table></figure></p>\n<p>有时候会看到重复的变量名，那就说明它们来自不同的配置文件（比如 /etc/gitconfig 和 ~/.gitconfig），不过最终 Git实际采用的是最后一个。</p>\n<hr>\n<p>相关链接：</p>\n<p>Pro Git：<a href=\"https://git-scm.com/book/zh/v2\" target=\"_blank\" rel=\"noopener\">https://git-scm.com/book/zh/v2</a></p>\n","site":{"data":{}},"excerpt":"<h4 id=\"初次运行-Git-前的配置\"><a href=\"#初次运行-Git-前的配置\" class=\"headerlink\" title=\"初次运行 Git 前的配置\"></a>初次运行 Git 前的配置</h4><p>Git 提供了一个叫做 git config 的工具，专门用来配置或读取相应的工作环境变量。而正是由这些环境变量，决定了 Git 在各个环节的具体工作方式和行为。这些变量可以存放在以下三个不同的地方：</p>\n<ul>\n<li>/etc/gitconfig 文件：系统中对所有用户都普遍适用的配置。若使用 git config 时用 –system 选项，读写的就是这个文件。</li>\n<li>~/.gitconfig 文件：用户目录下的配置文件只适用于该用户。若使用 git config 时用 –global 选项，读写的就是这个文件。</li>\n<li>当前项目的 git 目录中的配置文件（也就是工作目录中的 .git/config 文件）：这里的配置仅仅针对当前项目有效。每一个级别的配置都会覆盖上层的相同配置，所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。","more":"</li>\n</ul>\n<p>在 Windows 系统上，Git 会找寻用户主目录下的 .gitconfig 文件。主目录即 $HOME 变量指定的目录，一般都是C:\\Documents and Settings\\$USER 。此外，Git 还会尝试找寻 /etc/gitconfig 文件，只不过看当初 Git 装在什么目录，就以此作为根目录来定位。</p>\n<h4 id=\"初始化新仓库\"><a href=\"#初始化新仓库\" class=\"headerlink\" title=\"初始化新仓库\"></a>初始化新仓库</h4><p>要对现有的某个项目开始用 Git 管理，只需到此项目所在的目录，执行：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git init</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"克隆现有的仓库\"><a href=\"#克隆现有的仓库\" class=\"headerlink\" title=\"克隆现有的仓库\"></a>克隆现有的仓库</h4><p>为了得一个项目的拷贝(copy),我们需要知道这个项目仓库的地址(Git URL). Git能在许多协议下使用，所以Git URL可能以ssh://, http(s)://, git://,或是只是以一个用户名（git 会认为这是一个ssh 地址）为前辍. 有些仓库可以通过不只一种协议来访问，例如，Git本身的源代码你既可以用 git:// 协议来访问：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> git@github.com:BozhongFE/blog.git</span><br></pre></td></tr></table></figure></p>\n<p>也可以通过https协议来访问:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/BozhongFE/blog.git</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"检查当前文件状态\"><a href=\"#检查当前文件状态\" class=\"headerlink\" title=\"检查当前文件状态\"></a>检查当前文件状态</h4><p>要查看哪些文件处于什么状态，可以用 git status 命令。 如果在克隆仓库后立即使用此命令，会看到类似这样的输出：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">'origin/master'</span>.</span><br><span class=\"line\">Untracked files:</span><br><span class=\"line\">  (use <span class=\"string\">\"git add &lt;file&gt;...\"</span> to include <span class=\"keyword\">in</span> what will be committed)</span><br><span class=\"line\">        <span class=\"built_in\">source</span>/_posts/git.md</span><br><span class=\"line\"></span><br><span class=\"line\">nothing added to commit but untracked files present (use <span class=\"string\">\"git add\"</span> to track)</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"跟踪新文件\"><a href=\"#跟踪新文件\" class=\"headerlink\" title=\"跟踪新文件\"></a>跟踪新文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git add <span class=\"built_in\">source</span>/_posts/git.md</span><br></pre></td></tr></table></figure>\n<p>再运行 git status 命令，会看到 git.md 文件已被跟踪，并处于暂存状态：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">'origin/master'</span>.</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use <span class=\"string\">\"git reset HEAD &lt;file&gt;...\"</span> to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">        new file:   <span class=\"built_in\">source</span>/_posts/git.md</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"暂存已修改文件\"><a href=\"#暂存已修改文件\" class=\"headerlink\" title=\"暂存已修改文件\"></a>暂存已修改文件</h4><p>运行了 git add 之后又作了修订的文件，需要重新运行 git add 把最新版本重新暂存起来</p>\n<h4 id=\"状态简览\"><a href=\"#状态简览\" class=\"headerlink\" title=\"状态简览\"></a>状态简览</h4><p>git status 命令的输出十分详细，但其用语有些繁琐。 如果你使用 git status -s 命令或 git status –short 命令，你将得到一种更为紧凑的格式输出。 运行 git status -s ，状态报告输出如下：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git status -s</span><br><span class=\"line\">?? <span class=\"built_in\">source</span>/_posts/git.md</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"忽略文件\"><a href=\"#忽略文件\" class=\"headerlink\" title=\"忽略文件\"></a>忽略文件</h4><p>一般我们总会有些文件无需纳入 Git 的管理，也不希望它们总出现在未跟踪文件列表。 通常都是些自动生成的文件，比如日志文件，或者编译过程中创建的临时文件等。 在这种情况下，我们可以创建一个名为 .gitignore 的文件，列出要忽略的文件模式。 来看一个实际的例子：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.DS_Store</span><br><span class=\"line\">db.json</span><br><span class=\"line\">*.<span class=\"built_in\">log</span></span><br><span class=\"line\">node_modules/</span><br><span class=\"line\">public/</span><br><span class=\"line\">.deploy*/</span><br><span class=\"line\">yarn.lock</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"未暂存的修改\"><a href=\"#未暂存的修改\" class=\"headerlink\" title=\"未暂存的修改\"></a>未暂存的修改</h4><p>要查看尚未暂存的文件更新了哪些部分，不加参数直接输入 git diff：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git diff</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"提交更新\"><a href=\"#提交更新\" class=\"headerlink\" title=\"提交更新\"></a>提交更新</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git commit</span><br></pre></td></tr></table></figure>\n<h4 id=\"移动文件\"><a href=\"#移动文件\" class=\"headerlink\" title=\"移动文件\"></a>移动文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git mv file_from file_to</span><br></pre></td></tr></table></figure>\n<h4 id=\"查看commit历史\"><a href=\"#查看commit历史\" class=\"headerlink\" title=\"查看commit历史\"></a>查看commit历史</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">log</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"显示分支\"><a href=\"#显示分支\" class=\"headerlink\" title=\"显示分支\"></a>显示分支</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch</span><br></pre></td></tr></table></figure>\n<h4 id=\"切换分支\"><a href=\"#切换分支\" class=\"headerlink\" title=\"切换分支\"></a>切换分支</h4><p>新建一个a分支，并且自动切换到a分支。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout -b a</span><br><span class=\"line\">$ git branch</span><br><span class=\"line\">* a</span><br><span class=\"line\">  master</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"合并分支\"><a href=\"#合并分支\" class=\"headerlink\" title=\"合并分支\"></a>合并分支</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout master</span><br><span class=\"line\">Switched to branch <span class=\"string\">'master'</span></span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">'origin/master'</span>.</span><br><span class=\"line\">$ git merge a</span><br></pre></td></tr></table></figure>\n<h4 id=\"删除分支\"><a href=\"#删除分支\" class=\"headerlink\" title=\"删除分支\"></a>删除分支</h4><p>有新建分支，那肯定有删除分支，假如这个分支新建错了，或者a分支的代码已经顺利合并到 master 分支来了，那么a分支没用了，需要删除，这个时候执行 git branch -d a 就可以把a分支删除了。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d a</span><br></pre></td></tr></table></figure></p>\n<p>有些时候可能会删除失败，比如如果a分支的代码还没有合并到master，你执行 git branch -d a 是删除不了的，它会智能的提示你a分支还有未合并的代码，但是如果你非要删除，那就执行 git branch -D a 就可以强制删除a分支。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch -D a</span><br></pre></td></tr></table></figure>\n<h4 id=\"设置别名\"><a href=\"#设置别名\" class=\"headerlink\" title=\"设置别名\"></a>设置别名</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global alias.psm <span class=\"string\">'push origin master'</span></span><br><span class=\"line\">$ git config --global alias.plm <span class=\"string\">'pull origin master'</span></span><br><span class=\"line\">$ git psm</span><br><span class=\"line\">$ git plm</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取分支走向和详细日志\"><a href=\"#获取分支走向和详细日志\" class=\"headerlink\" title=\"获取分支走向和详细日志\"></a>获取分支走向和详细日志</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">log</span> --graph --pretty=format:<span class=\"string\">'%Cred%h%Creset</span></span><br><span class=\"line\"><span class=\"string\">-%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> </span><br><span class=\"line\">--abbrev-commit --date=relative</span><br><span class=\"line\">$ git config --global alias.lg <span class=\"string\">\"log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative\"</span></span><br><span class=\"line\">$ git lg</span><br></pre></td></tr></table></figure>\n<h4 id=\"查看配置信息\"><a href=\"#查看配置信息\" class=\"headerlink\" title=\"查看配置信息\"></a>查看配置信息</h4><p>要检查已有的配置信息，包括之前设置的别名，可以使用 git config –list 命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --list</span><br><span class=\"line\">core.symlinks=<span class=\"literal\">false</span></span><br><span class=\"line\">core.autocrlf=<span class=\"literal\">true</span></span><br><span class=\"line\">core.fscache=<span class=\"literal\">true</span></span><br><span class=\"line\">color.diff=auto</span><br><span class=\"line\">color.status=auto</span><br><span class=\"line\">color.branch=auto</span><br><span class=\"line\">color.interactive=<span class=\"literal\">true</span></span><br><span class=\"line\">help.format=html</span><br><span class=\"line\">http.sslcainfo=C:/Program Files/Git/mingw64/ssl/certs/ca-bundle.crt</span><br><span class=\"line\">diff.astextplain.textconv=astextplain</span><br><span class=\"line\">rebase.autosquash=<span class=\"literal\">true</span></span><br><span class=\"line\">user.name=xxxxx</span><br><span class=\"line\">user.email=xxxx@xxx.com</span><br><span class=\"line\">user.username=airyland</span><br><span class=\"line\">filter.lfs.clean=git-lfs clean -- %f</span><br><span class=\"line\">filter.lfs.smudge=git-lfs smudge -- %f</span><br><span class=\"line\">filter.lfs.required=<span class=\"literal\">true</span></span><br><span class=\"line\">filter.lfs.process=git-lfs filter-process</span><br><span class=\"line\">push.default=current</span><br><span class=\"line\">alias.lg=<span class=\"built_in\">log</span> --graph --pretty=format:<span class=\"string\">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> --abbrev-commit --date=relative</span><br><span class=\"line\">alias.psm=push origin master</span><br><span class=\"line\">alias.br=branch</span><br><span class=\"line\">alias.plm=pull origin master</span><br></pre></td></tr></table></figure></p>\n<p>有时候会看到重复的变量名，那就说明它们来自不同的配置文件（比如 /etc/gitconfig 和 ~/.gitconfig），不过最终 Git实际采用的是最后一个。</p>\n<hr>\n<p>相关链接：</p>\n<p>Pro Git：<a href=\"https://git-scm.com/book/zh/v2\" target=\"_blank\" rel=\"noopener\">https://git-scm.com/book/zh/v2</a></p>"},{"title":"css 强制换行/强制不换行","date":"2017-08-08T09:17:45.000Z","_content":"日常开发中经常会遇到文字不可以换行，或者自动换行的需求。\n这里简单介绍下常用的文本标签的处理方法。[附上demo](/demo/css-word-break.html)\n\n<!--more-->\n\n- - -\n\n### 关键属性\n* word-break: 指定了怎样在单词内断行。[详细：MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-break \"word-break | MDN\")\n* overflow-wrap(word-wrap): 是否允许单词内换行。css3中将word-wrap改名为overflow-wrap，考虑兼容问题使用word-wrap。[详细：MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-wrap \"overflow-wrap | MDN\")\n* white-space: 设置如何处理元素中的空白。[详细：MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/white-space \"white-space | MDN\")\n\n### 强制不换行\n\n* `white-space: nowrap` 强制在同一行内显示所有文本，直到文本结束或者 `<br />`。\n* `white-space: pre` 换行和其他空白字符(换行符/空格/制表符/文字转行)都将受到保护,等同 `<pre>`。\n\n* `word-break: keep-all` 不允许CJK（中/日/韩）文本断行，移动端基本不支持。\n\n### 强制换行\n\n* 常用块状文本标签，如 `<p>`\n\n  不需要添加任何样式，但过长的英文/数字会另起一行，特殊情况下会溢出空间。\n\n* `<pre>` 标签\n\n  `<pre>` 默认换行规则等同下面样式\n\n  ```css\n  p {\n    display: block; /* 块状元素不需要这行*/\n    white-space: pre;\n  }\n  ```\n  `white-space: pre-wrap` 过长的英文/数字会另起一行，特殊情况下会溢出空间，但不同浏览器对空白换行的处理有差异。\n\n  ```css\n  pre {\n    white-space: pre-wrap;\n  }\n  ```\n\n  也可以用`white-space: pre-line`，但会合并空格和制表符。\n\n|white-space:|换行符|空格和制表符|文字转行|\n|-|-|-|\n|normal|合并|合并|转行|\n|nowrap|合并|合并|不转行|\n|pre|保留|保留|不转行|\n|pre-wrap|保留|保留|转行|\n|pre-line|保留|合并|转行|\n\n* 英文/数字内换行\n\n  针对过长的英文/数字的解决方法 `word-wrap: break-word` 或 `word-break: break-all`。\n\n* word-wrap/word-break区别\n\n  `word-wrap: break-word` 会先尝试将单词挪到下一行，下一行宽度不够才会进行单词内断句。\n  `word-break: break-all` 直接进行单词内断句。\n\n  PC端两者都不适合搭配 `white-space:pre` `<pre>` 使用。\n\n* display: block/inline-block/inline\n\n  `display: block` 文字溢出不会撑起容器。\n  `display: inline-block` 容器不定宽度，文字溢出会撑起容器，只有 `word-break:break-all` 有效， `word-wrap: break-word` 需配合宽度使用。\n  `display: inline` border会受文字影响，能用于特殊需求。部分浏览器word-wrap/word-break换行无效，如FF。\n\n### 兼容问题\n\n* `word-break:keep-all` 移动端基本不支持。\n* 不同浏览器的属性间搭配会有显示差异。\n","source":"_posts/css-word-break.md","raw":"---\ntitle: css 强制换行/强制不换行\ndate: 2017-08-08 17:17:45\ntags:\n- css\n---\n日常开发中经常会遇到文字不可以换行，或者自动换行的需求。\n这里简单介绍下常用的文本标签的处理方法。[附上demo](/demo/css-word-break.html)\n\n<!--more-->\n\n- - -\n\n### 关键属性\n* word-break: 指定了怎样在单词内断行。[详细：MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-break \"word-break | MDN\")\n* overflow-wrap(word-wrap): 是否允许单词内换行。css3中将word-wrap改名为overflow-wrap，考虑兼容问题使用word-wrap。[详细：MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-wrap \"overflow-wrap | MDN\")\n* white-space: 设置如何处理元素中的空白。[详细：MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/white-space \"white-space | MDN\")\n\n### 强制不换行\n\n* `white-space: nowrap` 强制在同一行内显示所有文本，直到文本结束或者 `<br />`。\n* `white-space: pre` 换行和其他空白字符(换行符/空格/制表符/文字转行)都将受到保护,等同 `<pre>`。\n\n* `word-break: keep-all` 不允许CJK（中/日/韩）文本断行，移动端基本不支持。\n\n### 强制换行\n\n* 常用块状文本标签，如 `<p>`\n\n  不需要添加任何样式，但过长的英文/数字会另起一行，特殊情况下会溢出空间。\n\n* `<pre>` 标签\n\n  `<pre>` 默认换行规则等同下面样式\n\n  ```css\n  p {\n    display: block; /* 块状元素不需要这行*/\n    white-space: pre;\n  }\n  ```\n  `white-space: pre-wrap` 过长的英文/数字会另起一行，特殊情况下会溢出空间，但不同浏览器对空白换行的处理有差异。\n\n  ```css\n  pre {\n    white-space: pre-wrap;\n  }\n  ```\n\n  也可以用`white-space: pre-line`，但会合并空格和制表符。\n\n|white-space:|换行符|空格和制表符|文字转行|\n|-|-|-|\n|normal|合并|合并|转行|\n|nowrap|合并|合并|不转行|\n|pre|保留|保留|不转行|\n|pre-wrap|保留|保留|转行|\n|pre-line|保留|合并|转行|\n\n* 英文/数字内换行\n\n  针对过长的英文/数字的解决方法 `word-wrap: break-word` 或 `word-break: break-all`。\n\n* word-wrap/word-break区别\n\n  `word-wrap: break-word` 会先尝试将单词挪到下一行，下一行宽度不够才会进行单词内断句。\n  `word-break: break-all` 直接进行单词内断句。\n\n  PC端两者都不适合搭配 `white-space:pre` `<pre>` 使用。\n\n* display: block/inline-block/inline\n\n  `display: block` 文字溢出不会撑起容器。\n  `display: inline-block` 容器不定宽度，文字溢出会撑起容器，只有 `word-break:break-all` 有效， `word-wrap: break-word` 需配合宽度使用。\n  `display: inline` border会受文字影响，能用于特殊需求。部分浏览器word-wrap/word-break换行无效，如FF。\n\n### 兼容问题\n\n* `word-break:keep-all` 移动端基本不支持。\n* 不同浏览器的属性间搭配会有显示差异。\n","slug":"css-word-break","published":1,"updated":"2017-08-18T03:49:42.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oby000tuo2e305j2iqu","content":"<p>日常开发中经常会遇到文字不可以换行，或者自动换行的需求。<br>这里简单介绍下常用的文本标签的处理方法。<a href=\"/demo/css-word-break.html\">附上demo</a></p>\n<a id=\"more\"></a>\n<hr>\n<h3 id=\"关键属性\"><a href=\"#关键属性\" class=\"headerlink\" title=\"关键属性\"></a>关键属性</h3><ul>\n<li>word-break: 指定了怎样在单词内断行。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-break\" title=\"word-break | MDN\" target=\"_blank\" rel=\"noopener\">详细：MDN</a></li>\n<li>overflow-wrap(word-wrap): 是否允许单词内换行。css3中将word-wrap改名为overflow-wrap，考虑兼容问题使用word-wrap。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-wrap\" title=\"overflow-wrap | MDN\" target=\"_blank\" rel=\"noopener\">详细：MDN</a></li>\n<li>white-space: 设置如何处理元素中的空白。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/white-space\" title=\"white-space | MDN\" target=\"_blank\" rel=\"noopener\">详细：MDN</a></li>\n</ul>\n<h3 id=\"强制不换行\"><a href=\"#强制不换行\" class=\"headerlink\" title=\"强制不换行\"></a>强制不换行</h3><ul>\n<li><code>white-space: nowrap</code> 强制在同一行内显示所有文本，直到文本结束或者 <code>&lt;br /&gt;</code>。</li>\n<li><p><code>white-space: pre</code> 换行和其他空白字符(换行符/空格/制表符/文字转行)都将受到保护,等同 <code>&lt;pre&gt;</code>。</p>\n</li>\n<li><p><code>word-break: keep-all</code> 不允许CJK（中/日/韩）文本断行，移动端基本不支持。</p>\n</li>\n</ul>\n<h3 id=\"强制换行\"><a href=\"#强制换行\" class=\"headerlink\" title=\"强制换行\"></a>强制换行</h3><ul>\n<li><p>常用块状文本标签，如 <code>&lt;p&gt;</code></p>\n<p>不需要添加任何样式，但过长的英文/数字会另起一行，特殊情况下会溢出空间。</p>\n</li>\n<li><p><code>&lt;pre&gt;</code> 标签</p>\n<p><code>&lt;pre&gt;</code> 默认换行规则等同下面样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block; <span class=\"comment\">/* 块状元素不需要这行*/</span></span><br><span class=\"line\">  <span class=\"attribute\">white-space</span>: pre;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>white-space: pre-wrap</code> 过长的英文/数字会另起一行，特殊情况下会溢出空间，但不同浏览器对空白换行的处理有差异。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">pre</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">white-space</span>: pre-wrap;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>也可以用<code>white-space: pre-line</code>，但会合并空格和制表符。</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>white-space:</th>\n<th>换行符</th>\n<th>空格和制表符</th>\n<th>文字转行</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>normal</td>\n<td>合并</td>\n<td>合并</td>\n<td>转行</td>\n</tr>\n<tr>\n<td>nowrap</td>\n<td>合并</td>\n<td>合并</td>\n<td>不转行</td>\n</tr>\n<tr>\n<td>pre</td>\n<td>保留</td>\n<td>保留</td>\n<td>不转行</td>\n</tr>\n<tr>\n<td>pre-wrap</td>\n<td>保留</td>\n<td>保留</td>\n<td>转行</td>\n</tr>\n<tr>\n<td>pre-line</td>\n<td>保留</td>\n<td>合并</td>\n<td>转行</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><p>英文/数字内换行</p>\n<p>针对过长的英文/数字的解决方法 <code>word-wrap: break-word</code> 或 <code>word-break: break-all</code>。</p>\n</li>\n<li><p>word-wrap/word-break区别</p>\n<p><code>word-wrap: break-word</code> 会先尝试将单词挪到下一行，下一行宽度不够才会进行单词内断句。<br><code>word-break: break-all</code> 直接进行单词内断句。</p>\n<p>PC端两者都不适合搭配 <code>white-space:pre</code> <code>&lt;pre&gt;</code> 使用。</p>\n</li>\n<li><p>display: block/inline-block/inline</p>\n<p><code>display: block</code> 文字溢出不会撑起容器。<br><code>display: inline-block</code> 容器不定宽度，文字溢出会撑起容器，只有 <code>word-break:break-all</code> 有效， <code>word-wrap: break-word</code> 需配合宽度使用。<br><code>display: inline</code> border会受文字影响，能用于特殊需求。部分浏览器word-wrap/word-break换行无效，如FF。</p>\n</li>\n</ul>\n<h3 id=\"兼容问题\"><a href=\"#兼容问题\" class=\"headerlink\" title=\"兼容问题\"></a>兼容问题</h3><ul>\n<li><code>word-break:keep-all</code> 移动端基本不支持。</li>\n<li>不同浏览器的属性间搭配会有显示差异。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>日常开发中经常会遇到文字不可以换行，或者自动换行的需求。<br>这里简单介绍下常用的文本标签的处理方法。<a href=\"/demo/css-word-break.html\">附上demo</a></p>","more":"<hr>\n<h3 id=\"关键属性\"><a href=\"#关键属性\" class=\"headerlink\" title=\"关键属性\"></a>关键属性</h3><ul>\n<li>word-break: 指定了怎样在单词内断行。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-break\" title=\"word-break | MDN\" target=\"_blank\" rel=\"noopener\">详细：MDN</a></li>\n<li>overflow-wrap(word-wrap): 是否允许单词内换行。css3中将word-wrap改名为overflow-wrap，考虑兼容问题使用word-wrap。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/word-wrap\" title=\"overflow-wrap | MDN\" target=\"_blank\" rel=\"noopener\">详细：MDN</a></li>\n<li>white-space: 设置如何处理元素中的空白。<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/white-space\" title=\"white-space | MDN\" target=\"_blank\" rel=\"noopener\">详细：MDN</a></li>\n</ul>\n<h3 id=\"强制不换行\"><a href=\"#强制不换行\" class=\"headerlink\" title=\"强制不换行\"></a>强制不换行</h3><ul>\n<li><code>white-space: nowrap</code> 强制在同一行内显示所有文本，直到文本结束或者 <code>&lt;br /&gt;</code>。</li>\n<li><p><code>white-space: pre</code> 换行和其他空白字符(换行符/空格/制表符/文字转行)都将受到保护,等同 <code>&lt;pre&gt;</code>。</p>\n</li>\n<li><p><code>word-break: keep-all</code> 不允许CJK（中/日/韩）文本断行，移动端基本不支持。</p>\n</li>\n</ul>\n<h3 id=\"强制换行\"><a href=\"#强制换行\" class=\"headerlink\" title=\"强制换行\"></a>强制换行</h3><ul>\n<li><p>常用块状文本标签，如 <code>&lt;p&gt;</code></p>\n<p>不需要添加任何样式，但过长的英文/数字会另起一行，特殊情况下会溢出空间。</p>\n</li>\n<li><p><code>&lt;pre&gt;</code> 标签</p>\n<p><code>&lt;pre&gt;</code> 默认换行规则等同下面样式</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">p</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block; <span class=\"comment\">/* 块状元素不需要这行*/</span></span><br><span class=\"line\">  <span class=\"attribute\">white-space</span>: pre;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>white-space: pre-wrap</code> 过长的英文/数字会另起一行，特殊情况下会溢出空间，但不同浏览器对空白换行的处理有差异。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">pre</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">white-space</span>: pre-wrap;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>也可以用<code>white-space: pre-line</code>，但会合并空格和制表符。</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>white-space:</th>\n<th>换行符</th>\n<th>空格和制表符</th>\n<th>文字转行</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>normal</td>\n<td>合并</td>\n<td>合并</td>\n<td>转行</td>\n</tr>\n<tr>\n<td>nowrap</td>\n<td>合并</td>\n<td>合并</td>\n<td>不转行</td>\n</tr>\n<tr>\n<td>pre</td>\n<td>保留</td>\n<td>保留</td>\n<td>不转行</td>\n</tr>\n<tr>\n<td>pre-wrap</td>\n<td>保留</td>\n<td>保留</td>\n<td>转行</td>\n</tr>\n<tr>\n<td>pre-line</td>\n<td>保留</td>\n<td>合并</td>\n<td>转行</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><p>英文/数字内换行</p>\n<p>针对过长的英文/数字的解决方法 <code>word-wrap: break-word</code> 或 <code>word-break: break-all</code>。</p>\n</li>\n<li><p>word-wrap/word-break区别</p>\n<p><code>word-wrap: break-word</code> 会先尝试将单词挪到下一行，下一行宽度不够才会进行单词内断句。<br><code>word-break: break-all</code> 直接进行单词内断句。</p>\n<p>PC端两者都不适合搭配 <code>white-space:pre</code> <code>&lt;pre&gt;</code> 使用。</p>\n</li>\n<li><p>display: block/inline-block/inline</p>\n<p><code>display: block</code> 文字溢出不会撑起容器。<br><code>display: inline-block</code> 容器不定宽度，文字溢出会撑起容器，只有 <code>word-break:break-all</code> 有效， <code>word-wrap: break-word</code> 需配合宽度使用。<br><code>display: inline</code> border会受文字影响，能用于特殊需求。部分浏览器word-wrap/word-break换行无效，如FF。</p>\n</li>\n</ul>\n<h3 id=\"兼容问题\"><a href=\"#兼容问题\" class=\"headerlink\" title=\"兼容问题\"></a>兼容问题</h3><ul>\n<li><code>word-break:keep-all</code> 移动端基本不支持。</li>\n<li>不同浏览器的属性间搭配会有显示差异。</li>\n</ul>"},{"title":"如何写一个简单的 nodejs 爬虫","date":"2017-11-07T16:00:00.000Z","_content":"  \n这篇文章主要是通过写一个爬取豆瓣电影 Top250 数据的爬虫。  \n讲解一下写 nodejs 爬虫的基本思路。\n\n<!-- more -->\n\n## 先初始化一个项目\n\n新建一个项目文件夹，执行 `npm init` 生成 package.json，然后进入项目目录。  \n接下来可以开始进行模块安装。\n\n## 安装依赖模块\n\n这里我们需要用到两个模块，分别是：\n\n- [request](https://github.com/request/request) - 负责数据的下载\n- [cheerio](https://github.com/cheeriojs/cheerio) - 负责数据的解析\n\n执行以下命令安装：\n\n```bash\n# npm 5 以上版本 --save 是默认行为，如果你的 npm 版本是 5.0 以上，可以省略 --save 参数\nnpm install request cheerio --save\n```\n\n## 实现步骤\n\n### 1. 分析页面数据和结构\n\n首先，假设我们这里需要拿到电影的名字、年份、排名、评分、制片地区、电影封面。\n\n先用浏览器打开[豆瓣电影Top250](https://movie.douban.com/top250)。  \n然后通过查看 HTML 源代码，电影数据放在 `class=\"grid_view\"` 的 ol 列表里面。  \n列表内每个 `class=\"item\"` 的 div 为一部电影的数据。  \n如图：  \n![例子](//ww4.sinaimg.cn/large/a15b4afegy1flbythsps0j20oo0fpq4a)\n\n分析可得，  \n电影封面为 `class=\"pic\"` 的 div 内的唯一一个 img 标签；  \n排名为 `class=\"pic\"` 的 div 内的 em 标签；  \n评分为 `class=\"rating_num\"` 的 span 标签；\n名字为 `class=\"title\"` 的 span 标签内容（有两个，别名不计）；  \n年份和制片地区为 `class=\"bd\"` 的第一个 p 标签内，br 标签后面那部分。\n\n因为我们要爬取多个页面，所以要看下页面链接的规则。  \n首页的链接是 https://movie.douban.com/top250  \n第二个页面的链接是 https://movie.douban.com/top250?start=25&filter=  \n结合页面和链接，我们可以发现这里的 `start` 是表示从第几部电影开始显示，而每页显示的电影数量是 25 部。  \n`filter` 参数我们这里用不到，所以忽略掉。\n\n### 2. 引入依赖\n\n创建一个文件，这里文件名假设为 `fetchData.js`\n\n```javascript\nconst cheerio = require('cheerio');\nconst request = require('request');\nconst fs = require('fs'); // node.js 自带模块，用于读写操作\n```\n\n### 3. 请求数据\n\n```javascript\nconst fileName = 'data.txt';\nconst homeUrl = 'https://movie.douban.com/top250';\n\nconst getData = () => {\n  const dataUrl = homeUrl;\n  request.get(dataUrl, (err, rep, body) => {\n    if (!err) {\n      const dataFile = fs.createWriteStream(fileName); // 创建文件写入流\n      dataFile.write(body); // 将获取到的数据写入文件\n      dataFile.end(); // 关闭数据流\n      console.log('done');\n    } else {\n      console.log('error', err);\n    }\n  });\n};\n// 执行函数\ngetData();\n```\n\n写到这里，可以执行一下 `node fetchData.js`，看是否能正常获取到页面数据。正常的话，再继续往下看。\n\n### 4. 解析数据并格式化\n\n```javascript\n// 去除前后空格和换行\nconst trim = (str) => {\n  if (typeof str === 'string') {\n    return str.replace(/[\\r\\n]/g, '').replace(/^\\s*|\\s*$/g, '');\n  }\n  return '';\n};\n\n// 解析并格式化数据\nconst formatData = (html) => {\n  const $ = cheerio.load(html);\n  const $item = $('.grid_view .item');\n  const allData = [];\n\n  $item.each((index, element) => {\n    const $thisItem = $(element);\n    const rank = $thisItem.find('.pic em').text(); // 排名\n    const ratingNum = $thisItem.find('.rating_num').text(); // 评分\n    const picUrl = $thisItem.find('.pic img').attr('src'); // 封面\n    const titleArray = $thisItem.find('.info .hd .title'); \n    const title = titleArray.eq(0).text() + titleArray.eq(1).text(); // 标题\n    const info = $thisItem.find('.info .bd p').eq(0).text().split('\\n')[2];\n    const infoArray = info.split('/');\n    const releaseDate = infoArray[0]; // 上映日期\n    const country = infoArray[1]; // 国家或地区\n    const data = {\n      rank: trim(rank),\n      ratingNum: trim(ratingNum),\n      name: trim(title),\n      pic: trim(picUrl),\n      releaseDate: trim(releaseDate),\n      country: trim(country),\n    };\n    allData.push(data);\n  });\n\n  const dataFile = fs.createWriteStream(fileName);\n  dataFile.write(JSON.stringify(allData));\n  dataFile.end();\n  console.log('done');\n};\n```\n\n这部分写好之后，把上一步 `request.get` 里面的代码修改如下：\n\n```javascript\nrequest.get(dataUrl, (err, rep, body) => {\n  if (!err) {\n    formatData(body);\n  } else {\n    console.log('error', err);\n  }\n});\n```\n\n保存之后执行 `node fetchData.js`。  \n在控制台显示 `done` 之后，打开 `data.txt`，应该就可以看到对应的数据了。  \n接下来，我们写分页抓取的逻辑。\n\n### 5. 抓取多个页面\n\n这里需要修改 `getData` 函数部分的代码，并新增一些代码。\n\n```javascript\n// homeUrl 后面加上这些\nconst pageSize = 25; // 每 25 部电影一页\nconst pageCount = 5; // 需要抓取的页面数量\nconst intervalTime = 1000; // 间隔时间，毫秒\nlet startNumber = 0; // 从排名第几部开始显示\nlet timeoutId = 0;\n\nconst getData = () => {\n  const dataUrl = homeUrl + '?start=' + startNumber; // 这里加上查询参数\n  // ...其他的不需要修改\n};\n\nconst saveData = (fileName, data) => {\n  fs.appendFile(fileName, data, (err) => {\n    if (!err) {\n      console.log(`已爬取完第${(startNumber / pageSize) + 1}页数据`);\n      timeoutId = setTimeout(() => {\n        if (startNumber < (pageCount - 1) * pageSize) {\n          startNumber += pageSize;\n          getData();\n        } else {\n          clearTimeout(timeoutId);\n          console.log(`已爬取完所有数据，总共${pageCount}页，${pageCount * pageSize}条`);\n        }\n      }, intervalTime);\n    } else {\n      console.log('error:', err);\n    }\n  });\n};\n\nconst formatData = (html) => {\n  // ...这里省略上面部分\n  // 下面这四行删除掉\n  // const dataFile = fs.createWriteStream(fileName);\n  // dataFile.write(JSON.stringify(allData));\n  // dataFile.end();\n  // console.log('done');\n\n  saveData(fileName, JSON.stringify(allData) + '\\n');\n};\n```\n\n最后可以拿到 5 组数据，如下：  \n![数据](//ww4.sinaimg.cn/large/a15b4afegy1flbytwmmr5j20jq02ewem)","source":"_posts/how-to-create-a-nodejs-spider.md","raw":"---\ntitle: 如何写一个简单的 nodejs 爬虫\ndate: 2017-11-08\ntags: \n  - javascript\n---\n  \n这篇文章主要是通过写一个爬取豆瓣电影 Top250 数据的爬虫。  \n讲解一下写 nodejs 爬虫的基本思路。\n\n<!-- more -->\n\n## 先初始化一个项目\n\n新建一个项目文件夹，执行 `npm init` 生成 package.json，然后进入项目目录。  \n接下来可以开始进行模块安装。\n\n## 安装依赖模块\n\n这里我们需要用到两个模块，分别是：\n\n- [request](https://github.com/request/request) - 负责数据的下载\n- [cheerio](https://github.com/cheeriojs/cheerio) - 负责数据的解析\n\n执行以下命令安装：\n\n```bash\n# npm 5 以上版本 --save 是默认行为，如果你的 npm 版本是 5.0 以上，可以省略 --save 参数\nnpm install request cheerio --save\n```\n\n## 实现步骤\n\n### 1. 分析页面数据和结构\n\n首先，假设我们这里需要拿到电影的名字、年份、排名、评分、制片地区、电影封面。\n\n先用浏览器打开[豆瓣电影Top250](https://movie.douban.com/top250)。  \n然后通过查看 HTML 源代码，电影数据放在 `class=\"grid_view\"` 的 ol 列表里面。  \n列表内每个 `class=\"item\"` 的 div 为一部电影的数据。  \n如图：  \n![例子](//ww4.sinaimg.cn/large/a15b4afegy1flbythsps0j20oo0fpq4a)\n\n分析可得，  \n电影封面为 `class=\"pic\"` 的 div 内的唯一一个 img 标签；  \n排名为 `class=\"pic\"` 的 div 内的 em 标签；  \n评分为 `class=\"rating_num\"` 的 span 标签；\n名字为 `class=\"title\"` 的 span 标签内容（有两个，别名不计）；  \n年份和制片地区为 `class=\"bd\"` 的第一个 p 标签内，br 标签后面那部分。\n\n因为我们要爬取多个页面，所以要看下页面链接的规则。  \n首页的链接是 https://movie.douban.com/top250  \n第二个页面的链接是 https://movie.douban.com/top250?start=25&filter=  \n结合页面和链接，我们可以发现这里的 `start` 是表示从第几部电影开始显示，而每页显示的电影数量是 25 部。  \n`filter` 参数我们这里用不到，所以忽略掉。\n\n### 2. 引入依赖\n\n创建一个文件，这里文件名假设为 `fetchData.js`\n\n```javascript\nconst cheerio = require('cheerio');\nconst request = require('request');\nconst fs = require('fs'); // node.js 自带模块，用于读写操作\n```\n\n### 3. 请求数据\n\n```javascript\nconst fileName = 'data.txt';\nconst homeUrl = 'https://movie.douban.com/top250';\n\nconst getData = () => {\n  const dataUrl = homeUrl;\n  request.get(dataUrl, (err, rep, body) => {\n    if (!err) {\n      const dataFile = fs.createWriteStream(fileName); // 创建文件写入流\n      dataFile.write(body); // 将获取到的数据写入文件\n      dataFile.end(); // 关闭数据流\n      console.log('done');\n    } else {\n      console.log('error', err);\n    }\n  });\n};\n// 执行函数\ngetData();\n```\n\n写到这里，可以执行一下 `node fetchData.js`，看是否能正常获取到页面数据。正常的话，再继续往下看。\n\n### 4. 解析数据并格式化\n\n```javascript\n// 去除前后空格和换行\nconst trim = (str) => {\n  if (typeof str === 'string') {\n    return str.replace(/[\\r\\n]/g, '').replace(/^\\s*|\\s*$/g, '');\n  }\n  return '';\n};\n\n// 解析并格式化数据\nconst formatData = (html) => {\n  const $ = cheerio.load(html);\n  const $item = $('.grid_view .item');\n  const allData = [];\n\n  $item.each((index, element) => {\n    const $thisItem = $(element);\n    const rank = $thisItem.find('.pic em').text(); // 排名\n    const ratingNum = $thisItem.find('.rating_num').text(); // 评分\n    const picUrl = $thisItem.find('.pic img').attr('src'); // 封面\n    const titleArray = $thisItem.find('.info .hd .title'); \n    const title = titleArray.eq(0).text() + titleArray.eq(1).text(); // 标题\n    const info = $thisItem.find('.info .bd p').eq(0).text().split('\\n')[2];\n    const infoArray = info.split('/');\n    const releaseDate = infoArray[0]; // 上映日期\n    const country = infoArray[1]; // 国家或地区\n    const data = {\n      rank: trim(rank),\n      ratingNum: trim(ratingNum),\n      name: trim(title),\n      pic: trim(picUrl),\n      releaseDate: trim(releaseDate),\n      country: trim(country),\n    };\n    allData.push(data);\n  });\n\n  const dataFile = fs.createWriteStream(fileName);\n  dataFile.write(JSON.stringify(allData));\n  dataFile.end();\n  console.log('done');\n};\n```\n\n这部分写好之后，把上一步 `request.get` 里面的代码修改如下：\n\n```javascript\nrequest.get(dataUrl, (err, rep, body) => {\n  if (!err) {\n    formatData(body);\n  } else {\n    console.log('error', err);\n  }\n});\n```\n\n保存之后执行 `node fetchData.js`。  \n在控制台显示 `done` 之后，打开 `data.txt`，应该就可以看到对应的数据了。  \n接下来，我们写分页抓取的逻辑。\n\n### 5. 抓取多个页面\n\n这里需要修改 `getData` 函数部分的代码，并新增一些代码。\n\n```javascript\n// homeUrl 后面加上这些\nconst pageSize = 25; // 每 25 部电影一页\nconst pageCount = 5; // 需要抓取的页面数量\nconst intervalTime = 1000; // 间隔时间，毫秒\nlet startNumber = 0; // 从排名第几部开始显示\nlet timeoutId = 0;\n\nconst getData = () => {\n  const dataUrl = homeUrl + '?start=' + startNumber; // 这里加上查询参数\n  // ...其他的不需要修改\n};\n\nconst saveData = (fileName, data) => {\n  fs.appendFile(fileName, data, (err) => {\n    if (!err) {\n      console.log(`已爬取完第${(startNumber / pageSize) + 1}页数据`);\n      timeoutId = setTimeout(() => {\n        if (startNumber < (pageCount - 1) * pageSize) {\n          startNumber += pageSize;\n          getData();\n        } else {\n          clearTimeout(timeoutId);\n          console.log(`已爬取完所有数据，总共${pageCount}页，${pageCount * pageSize}条`);\n        }\n      }, intervalTime);\n    } else {\n      console.log('error:', err);\n    }\n  });\n};\n\nconst formatData = (html) => {\n  // ...这里省略上面部分\n  // 下面这四行删除掉\n  // const dataFile = fs.createWriteStream(fileName);\n  // dataFile.write(JSON.stringify(allData));\n  // dataFile.end();\n  // console.log('done');\n\n  saveData(fileName, JSON.stringify(allData) + '\\n');\n};\n```\n\n最后可以拿到 5 组数据，如下：  \n![数据](//ww4.sinaimg.cn/large/a15b4afegy1flbytwmmr5j20jq02ewem)","slug":"how-to-create-a-nodejs-spider","published":1,"updated":"2017-12-15T06:28:26.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oc1000wuo2eczku5sr9","content":"<p>这篇文章主要是通过写一个爬取豆瓣电影 Top250 数据的爬虫。<br>讲解一下写 nodejs 爬虫的基本思路。</p>\n<a id=\"more\"></a>\n<h2 id=\"先初始化一个项目\"><a href=\"#先初始化一个项目\" class=\"headerlink\" title=\"先初始化一个项目\"></a>先初始化一个项目</h2><p>新建一个项目文件夹，执行 <code>npm init</code> 生成 package.json，然后进入项目目录。<br>接下来可以开始进行模块安装。</p>\n<h2 id=\"安装依赖模块\"><a href=\"#安装依赖模块\" class=\"headerlink\" title=\"安装依赖模块\"></a>安装依赖模块</h2><p>这里我们需要用到两个模块，分别是：</p>\n<ul>\n<li><a href=\"https://github.com/request/request\" target=\"_blank\" rel=\"noopener\">request</a> - 负责数据的下载</li>\n<li><a href=\"https://github.com/cheeriojs/cheerio\" target=\"_blank\" rel=\"noopener\">cheerio</a> - 负责数据的解析</li>\n</ul>\n<p>执行以下命令安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># npm 5 以上版本 --save 是默认行为，如果你的 npm 版本是 5.0 以上，可以省略 --save 参数</span></span><br><span class=\"line\">npm install request cheerio --save</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><h3 id=\"1-分析页面数据和结构\"><a href=\"#1-分析页面数据和结构\" class=\"headerlink\" title=\"1. 分析页面数据和结构\"></a>1. 分析页面数据和结构</h3><p>首先，假设我们这里需要拿到电影的名字、年份、排名、评分、制片地区、电影封面。</p>\n<p>先用浏览器打开<a href=\"https://movie.douban.com/top250\" target=\"_blank\" rel=\"noopener\">豆瓣电影Top250</a>。<br>然后通过查看 HTML 源代码，电影数据放在 <code>class=&quot;grid_view&quot;</code> 的 ol 列表里面。<br>列表内每个 <code>class=&quot;item&quot;</code> 的 div 为一部电影的数据。<br>如图：<br><img src=\"//ww4.sinaimg.cn/large/a15b4afegy1flbythsps0j20oo0fpq4a\" alt=\"例子\"></p>\n<p>分析可得，<br>电影封面为 <code>class=&quot;pic&quot;</code> 的 div 内的唯一一个 img 标签；<br>排名为 <code>class=&quot;pic&quot;</code> 的 div 内的 em 标签；<br>评分为 <code>class=&quot;rating_num&quot;</code> 的 span 标签；<br>名字为 <code>class=&quot;title&quot;</code> 的 span 标签内容（有两个，别名不计）；<br>年份和制片地区为 <code>class=&quot;bd&quot;</code> 的第一个 p 标签内，br 标签后面那部分。</p>\n<p>因为我们要爬取多个页面，所以要看下页面链接的规则。<br>首页的链接是 <a href=\"https://movie.douban.com/top250\" target=\"_blank\" rel=\"noopener\">https://movie.douban.com/top250</a><br>第二个页面的链接是 <a href=\"https://movie.douban.com/top250?start=25&amp;filter=\" target=\"_blank\" rel=\"noopener\">https://movie.douban.com/top250?start=25&amp;filter=</a><br>结合页面和链接，我们可以发现这里的 <code>start</code> 是表示从第几部电影开始显示，而每页显示的电影数量是 25 部。<br><code>filter</code> 参数我们这里用不到，所以忽略掉。</p>\n<h3 id=\"2-引入依赖\"><a href=\"#2-引入依赖\" class=\"headerlink\" title=\"2. 引入依赖\"></a>2. 引入依赖</h3><p>创建一个文件，这里文件名假设为 <code>fetchData.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">'cheerio'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">'request'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>); <span class=\"comment\">// node.js 自带模块，用于读写操作</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-请求数据\"><a href=\"#3-请求数据\" class=\"headerlink\" title=\"3. 请求数据\"></a>3. 请求数据</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fileName = <span class=\"string\">'data.txt'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> homeUrl = <span class=\"string\">'https://movie.douban.com/top250'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> getData = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataUrl = homeUrl;</span><br><span class=\"line\">  request.get(dataUrl, (err, rep, body) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> dataFile = fs.createWriteStream(fileName); <span class=\"comment\">// 创建文件写入流</span></span><br><span class=\"line\">      dataFile.write(body); <span class=\"comment\">// 将获取到的数据写入文件</span></span><br><span class=\"line\">      dataFile.end(); <span class=\"comment\">// 关闭数据流</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'done'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'error'</span>, err);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 执行函数</span></span><br><span class=\"line\">getData();</span><br></pre></td></tr></table></figure>\n<p>写到这里，可以执行一下 <code>node fetchData.js</code>，看是否能正常获取到页面数据。正常的话，再继续往下看。</p>\n<h3 id=\"4-解析数据并格式化\"><a href=\"#4-解析数据并格式化\" class=\"headerlink\" title=\"4. 解析数据并格式化\"></a>4. 解析数据并格式化</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 去除前后空格和换行</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> trim = <span class=\"function\">(<span class=\"params\">str</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> str === <span class=\"string\">'string'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str.replace(<span class=\"regexp\">/[\\r\\n]/g</span>, <span class=\"string\">''</span>).replace(<span class=\"regexp\">/^\\s*|\\s*$/g</span>, <span class=\"string\">''</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解析并格式化数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> formatData = <span class=\"function\">(<span class=\"params\">html</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> $ = cheerio.load(html);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> $item = $(<span class=\"string\">'.grid_view .item'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> allData = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  $item.each(<span class=\"function\">(<span class=\"params\">index, element</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> $thisItem = $(element);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> rank = $thisItem.find(<span class=\"string\">'.pic em'</span>).text(); <span class=\"comment\">// 排名</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ratingNum = $thisItem.find(<span class=\"string\">'.rating_num'</span>).text(); <span class=\"comment\">// 评分</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> picUrl = $thisItem.find(<span class=\"string\">'.pic img'</span>).attr(<span class=\"string\">'src'</span>); <span class=\"comment\">// 封面</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> titleArray = $thisItem.find(<span class=\"string\">'.info .hd .title'</span>); </span><br><span class=\"line\">    <span class=\"keyword\">const</span> title = titleArray.eq(<span class=\"number\">0</span>).text() + titleArray.eq(<span class=\"number\">1</span>).text(); <span class=\"comment\">// 标题</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> info = $thisItem.find(<span class=\"string\">'.info .bd p'</span>).eq(<span class=\"number\">0</span>).text().split(<span class=\"string\">'\\n'</span>)[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">const</span> infoArray = info.split(<span class=\"string\">'/'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> releaseDate = infoArray[<span class=\"number\">0</span>]; <span class=\"comment\">// 上映日期</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> country = infoArray[<span class=\"number\">1</span>]; <span class=\"comment\">// 国家或地区</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = &#123;</span><br><span class=\"line\">      rank: trim(rank),</span><br><span class=\"line\">      ratingNum: trim(ratingNum),</span><br><span class=\"line\">      name: trim(title),</span><br><span class=\"line\">      pic: trim(picUrl),</span><br><span class=\"line\">      releaseDate: trim(releaseDate),</span><br><span class=\"line\">      country: trim(country),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    allData.push(data);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataFile = fs.createWriteStream(fileName);</span><br><span class=\"line\">  dataFile.write(<span class=\"built_in\">JSON</span>.stringify(allData));</span><br><span class=\"line\">  dataFile.end();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'done'</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这部分写好之后，把上一步 <code>request.get</code> 里面的代码修改如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request.get(dataUrl, (err, rep, body) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">    formatData(body);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'error'</span>, err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>保存之后执行 <code>node fetchData.js</code>。<br>在控制台显示 <code>done</code> 之后，打开 <code>data.txt</code>，应该就可以看到对应的数据了。<br>接下来，我们写分页抓取的逻辑。</p>\n<h3 id=\"5-抓取多个页面\"><a href=\"#5-抓取多个页面\" class=\"headerlink\" title=\"5. 抓取多个页面\"></a>5. 抓取多个页面</h3><p>这里需要修改 <code>getData</code> 函数部分的代码，并新增一些代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// homeUrl 后面加上这些</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> pageSize = <span class=\"number\">25</span>; <span class=\"comment\">// 每 25 部电影一页</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> pageCount = <span class=\"number\">5</span>; <span class=\"comment\">// 需要抓取的页面数量</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> intervalTime = <span class=\"number\">1000</span>; <span class=\"comment\">// 间隔时间，毫秒</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> startNumber = <span class=\"number\">0</span>; <span class=\"comment\">// 从排名第几部开始显示</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> timeoutId = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> getData = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataUrl = homeUrl + <span class=\"string\">'?start='</span> + startNumber; <span class=\"comment\">// 这里加上查询参数</span></span><br><span class=\"line\">  <span class=\"comment\">// ...其他的不需要修改</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> saveData = <span class=\"function\">(<span class=\"params\">fileName, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  fs.appendFile(fileName, data, (err) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">`已爬取完第<span class=\"subst\">$&#123;(startNumber <span class=\"regexp\">/ pageSize) + 1&#125;页数据`);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">      timeoutId = setTimeout(() =&gt; &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">        if (startNumber &lt; (pageCount - 1) * pageSize) &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          startNumber += pageSize;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          getData();</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">        &#125; else &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          clearTimeout(timeoutId);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          console.log(`已爬取完所有数据，总共$&#123;pageCount&#125;页，$&#123;pageCount * pageSize&#125;条`);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">        &#125;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">      &#125;, intervalTime);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">    &#125; else &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">      console.log('error:', err);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">    &#125;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  &#125;);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">&#125;;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\"></span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">const formatData = (html) =&gt; &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ ...这里省略上面部分</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ 下面这四行删除掉</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ const dataFile = fs.createWriteStream(fileName);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ dataFile.write(JSON.stringify(allData));</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ dataFile.end();</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ console.log('done');</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\"></span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  saveData(fileName, JSON.stringify(allData) + '\\n');</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">&#125;;</span></span></span></span><br></pre></td></tr></table></figure>\n<p>最后可以拿到 5 组数据，如下：<br><img src=\"//ww4.sinaimg.cn/large/a15b4afegy1flbytwmmr5j20jq02ewem\" alt=\"数据\"></p>\n","site":{"data":{}},"excerpt":"<p>这篇文章主要是通过写一个爬取豆瓣电影 Top250 数据的爬虫。<br>讲解一下写 nodejs 爬虫的基本思路。</p>","more":"<h2 id=\"先初始化一个项目\"><a href=\"#先初始化一个项目\" class=\"headerlink\" title=\"先初始化一个项目\"></a>先初始化一个项目</h2><p>新建一个项目文件夹，执行 <code>npm init</code> 生成 package.json，然后进入项目目录。<br>接下来可以开始进行模块安装。</p>\n<h2 id=\"安装依赖模块\"><a href=\"#安装依赖模块\" class=\"headerlink\" title=\"安装依赖模块\"></a>安装依赖模块</h2><p>这里我们需要用到两个模块，分别是：</p>\n<ul>\n<li><a href=\"https://github.com/request/request\" target=\"_blank\" rel=\"noopener\">request</a> - 负责数据的下载</li>\n<li><a href=\"https://github.com/cheeriojs/cheerio\" target=\"_blank\" rel=\"noopener\">cheerio</a> - 负责数据的解析</li>\n</ul>\n<p>执行以下命令安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># npm 5 以上版本 --save 是默认行为，如果你的 npm 版本是 5.0 以上，可以省略 --save 参数</span></span><br><span class=\"line\">npm install request cheerio --save</span><br></pre></td></tr></table></figure>\n<h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><h3 id=\"1-分析页面数据和结构\"><a href=\"#1-分析页面数据和结构\" class=\"headerlink\" title=\"1. 分析页面数据和结构\"></a>1. 分析页面数据和结构</h3><p>首先，假设我们这里需要拿到电影的名字、年份、排名、评分、制片地区、电影封面。</p>\n<p>先用浏览器打开<a href=\"https://movie.douban.com/top250\" target=\"_blank\" rel=\"noopener\">豆瓣电影Top250</a>。<br>然后通过查看 HTML 源代码，电影数据放在 <code>class=&quot;grid_view&quot;</code> 的 ol 列表里面。<br>列表内每个 <code>class=&quot;item&quot;</code> 的 div 为一部电影的数据。<br>如图：<br><img src=\"//ww4.sinaimg.cn/large/a15b4afegy1flbythsps0j20oo0fpq4a\" alt=\"例子\"></p>\n<p>分析可得，<br>电影封面为 <code>class=&quot;pic&quot;</code> 的 div 内的唯一一个 img 标签；<br>排名为 <code>class=&quot;pic&quot;</code> 的 div 内的 em 标签；<br>评分为 <code>class=&quot;rating_num&quot;</code> 的 span 标签；<br>名字为 <code>class=&quot;title&quot;</code> 的 span 标签内容（有两个，别名不计）；<br>年份和制片地区为 <code>class=&quot;bd&quot;</code> 的第一个 p 标签内，br 标签后面那部分。</p>\n<p>因为我们要爬取多个页面，所以要看下页面链接的规则。<br>首页的链接是 <a href=\"https://movie.douban.com/top250\" target=\"_blank\" rel=\"noopener\">https://movie.douban.com/top250</a><br>第二个页面的链接是 <a href=\"https://movie.douban.com/top250?start=25&amp;filter=\" target=\"_blank\" rel=\"noopener\">https://movie.douban.com/top250?start=25&amp;filter=</a><br>结合页面和链接，我们可以发现这里的 <code>start</code> 是表示从第几部电影开始显示，而每页显示的电影数量是 25 部。<br><code>filter</code> 参数我们这里用不到，所以忽略掉。</p>\n<h3 id=\"2-引入依赖\"><a href=\"#2-引入依赖\" class=\"headerlink\" title=\"2. 引入依赖\"></a>2. 引入依赖</h3><p>创建一个文件，这里文件名假设为 <code>fetchData.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">'cheerio'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> request = <span class=\"built_in\">require</span>(<span class=\"string\">'request'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>); <span class=\"comment\">// node.js 自带模块，用于读写操作</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-请求数据\"><a href=\"#3-请求数据\" class=\"headerlink\" title=\"3. 请求数据\"></a>3. 请求数据</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fileName = <span class=\"string\">'data.txt'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> homeUrl = <span class=\"string\">'https://movie.douban.com/top250'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> getData = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataUrl = homeUrl;</span><br><span class=\"line\">  request.get(dataUrl, (err, rep, body) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> dataFile = fs.createWriteStream(fileName); <span class=\"comment\">// 创建文件写入流</span></span><br><span class=\"line\">      dataFile.write(body); <span class=\"comment\">// 将获取到的数据写入文件</span></span><br><span class=\"line\">      dataFile.end(); <span class=\"comment\">// 关闭数据流</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'done'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'error'</span>, err);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// 执行函数</span></span><br><span class=\"line\">getData();</span><br></pre></td></tr></table></figure>\n<p>写到这里，可以执行一下 <code>node fetchData.js</code>，看是否能正常获取到页面数据。正常的话，再继续往下看。</p>\n<h3 id=\"4-解析数据并格式化\"><a href=\"#4-解析数据并格式化\" class=\"headerlink\" title=\"4. 解析数据并格式化\"></a>4. 解析数据并格式化</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 去除前后空格和换行</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> trim = <span class=\"function\">(<span class=\"params\">str</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> str === <span class=\"string\">'string'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str.replace(<span class=\"regexp\">/[\\r\\n]/g</span>, <span class=\"string\">''</span>).replace(<span class=\"regexp\">/^\\s*|\\s*$/g</span>, <span class=\"string\">''</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">''</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 解析并格式化数据</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> formatData = <span class=\"function\">(<span class=\"params\">html</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> $ = cheerio.load(html);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> $item = $(<span class=\"string\">'.grid_view .item'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> allData = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  $item.each(<span class=\"function\">(<span class=\"params\">index, element</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> $thisItem = $(element);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> rank = $thisItem.find(<span class=\"string\">'.pic em'</span>).text(); <span class=\"comment\">// 排名</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ratingNum = $thisItem.find(<span class=\"string\">'.rating_num'</span>).text(); <span class=\"comment\">// 评分</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> picUrl = $thisItem.find(<span class=\"string\">'.pic img'</span>).attr(<span class=\"string\">'src'</span>); <span class=\"comment\">// 封面</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> titleArray = $thisItem.find(<span class=\"string\">'.info .hd .title'</span>); </span><br><span class=\"line\">    <span class=\"keyword\">const</span> title = titleArray.eq(<span class=\"number\">0</span>).text() + titleArray.eq(<span class=\"number\">1</span>).text(); <span class=\"comment\">// 标题</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> info = $thisItem.find(<span class=\"string\">'.info .bd p'</span>).eq(<span class=\"number\">0</span>).text().split(<span class=\"string\">'\\n'</span>)[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">const</span> infoArray = info.split(<span class=\"string\">'/'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> releaseDate = infoArray[<span class=\"number\">0</span>]; <span class=\"comment\">// 上映日期</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> country = infoArray[<span class=\"number\">1</span>]; <span class=\"comment\">// 国家或地区</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> data = &#123;</span><br><span class=\"line\">      rank: trim(rank),</span><br><span class=\"line\">      ratingNum: trim(ratingNum),</span><br><span class=\"line\">      name: trim(title),</span><br><span class=\"line\">      pic: trim(picUrl),</span><br><span class=\"line\">      releaseDate: trim(releaseDate),</span><br><span class=\"line\">      country: trim(country),</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    allData.push(data);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataFile = fs.createWriteStream(fileName);</span><br><span class=\"line\">  dataFile.write(<span class=\"built_in\">JSON</span>.stringify(allData));</span><br><span class=\"line\">  dataFile.end();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'done'</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这部分写好之后，把上一步 <code>request.get</code> 里面的代码修改如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">request.get(dataUrl, (err, rep, body) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">    formatData(body);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'error'</span>, err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>保存之后执行 <code>node fetchData.js</code>。<br>在控制台显示 <code>done</code> 之后，打开 <code>data.txt</code>，应该就可以看到对应的数据了。<br>接下来，我们写分页抓取的逻辑。</p>\n<h3 id=\"5-抓取多个页面\"><a href=\"#5-抓取多个页面\" class=\"headerlink\" title=\"5. 抓取多个页面\"></a>5. 抓取多个页面</h3><p>这里需要修改 <code>getData</code> 函数部分的代码，并新增一些代码。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// homeUrl 后面加上这些</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> pageSize = <span class=\"number\">25</span>; <span class=\"comment\">// 每 25 部电影一页</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> pageCount = <span class=\"number\">5</span>; <span class=\"comment\">// 需要抓取的页面数量</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> intervalTime = <span class=\"number\">1000</span>; <span class=\"comment\">// 间隔时间，毫秒</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> startNumber = <span class=\"number\">0</span>; <span class=\"comment\">// 从排名第几部开始显示</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> timeoutId = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> getData = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataUrl = homeUrl + <span class=\"string\">'?start='</span> + startNumber; <span class=\"comment\">// 这里加上查询参数</span></span><br><span class=\"line\">  <span class=\"comment\">// ...其他的不需要修改</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> saveData = <span class=\"function\">(<span class=\"params\">fileName, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  fs.appendFile(fileName, data, (err) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!err) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">`已爬取完第<span class=\"subst\">$&#123;(startNumber <span class=\"regexp\">/ pageSize) + 1&#125;页数据`);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">      timeoutId = setTimeout(() =&gt; &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">        if (startNumber &lt; (pageCount - 1) * pageSize) &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          startNumber += pageSize;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          getData();</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">        &#125; else &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          clearTimeout(timeoutId);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">          console.log(`已爬取完所有数据，总共$&#123;pageCount&#125;页，$&#123;pageCount * pageSize&#125;条`);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">        &#125;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">      &#125;, intervalTime);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">    &#125; else &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">      console.log('error:', err);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">    &#125;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  &#125;);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">&#125;;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\"></span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">const formatData = (html) =&gt; &#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ ...这里省略上面部分</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ 下面这四行删除掉</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ const dataFile = fs.createWriteStream(fileName);</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ dataFile.write(JSON.stringify(allData));</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ dataFile.end();</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ console.log('done');</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\"></span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">  saveData(fileName, JSON.stringify(allData) + '\\n');</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"regexp\">&#125;;</span></span></span></span><br></pre></td></tr></table></figure>\n<p>最后可以拿到 5 组数据，如下：<br><img src=\"//ww4.sinaimg.cn/large/a15b4afegy1flbytwmmr5j20jq02ewem\" alt=\"数据\"></p>"},{"title":"js中常见的数组操作","date":"2017-12-15T05:06:31.000Z","_content":"## 数组元素的添加\n### push()和unshift()\n```\n1. push() //在数组的最末尾添加元素;\n2. unshift() //在数组的最前面添加一个元素;\n```\n<!--more-->\n例：\n```javascript\nvar arr = [1,2,3];\nvar aaa = arr.push(\"a\");//在数组的最末尾添加一个元素;\nconsole.log(arr);//元素被修改了\nconsole.log(aaa);//返回值是数组的长度;\n\n\nvar _aaa = arr.unshift(\"b\");//在数组的最前面添加一个元素;\nconsole.log(arr);//元素被修改了\nconsole.log(_aaa);//返回值是数组的长度;\n```\n## 数组元素的删除\n### pop()和shift()\n```\n1. pop()  //不需要参数;在数组的最末尾删除一项;\n1. shift() //不需要参数;在数组的最前面删除一项;\n```\n例：\n```javascript\nvar arr = [1,2,3,4];\nvar aaa = arr.pop();//不需要参数;在数组的最末尾删除一项;\nconsole.log(arr);//元素被修改了 [1,2,3]\nconsole.log(aaa);//被删除的那一项 4\n\nvar _aaa = arr.shift();//不需要参数;在数组的最前面删除一项;\nconsole.log(arr);//元素被修改了 [2,3]\nconsole.log(_aaa);//被删除的那一项 1\n```\n## 数组元素排序\n### sort( )\nsort(),数组中元素排序;(默认：从小到大)\n,默认按照首个字符的Unicode编码排序;如果第一个相同那么就比较第二个...\n例：\n\n```javascript        \nvar arr = [4,7,1,3,2,8,6,9,5];\nvar aaa =arr.sort();\nconsole.log(aaa);          // [1, 2, 3, 4, 5, 6, 7, 8, 9]\nconsole.log(aaa === arr);// true 原数组被排序了(冒泡排序)\n```\n \nsort(),数值大小排序方法,需要借助回调函数;\n例：\n\n```javascript\nvar arr = [4,5,1,13,2,7,6];//回调函数里面返回值如果是：参数1-参数2;升幂；参数2-参数1;降幂；\narr.sort(function (a,b) {\n  return a-b; //升序\n  //return b-a; //降序\n  //return b.value-a.value; //按照元素value属性的大小排序;\n});\nconsole.log(arr); // [1, 2, 4, 5, 6, 7, 13]\n```\n## 数组的翻转\n### reverse()\n例:\n```javascript\nvar arr1 = [1,2,3,4,5];\nvar aaa = arr1.reverse(); // [5,4,3,2,1]\n```\n\n## 数组元素的连接 \n### concat()\n数组1.concat(数组2); // 链接两个数组;\n例 ：\n\n```javascript\nvar arr1 = [1,2,3];\nvar arr2 = [\"a\",\"b\",\"c\"];\nvar arr3 = arr1.concat(arr2);\nconsole.log(arr3)//[1, 2, 3, \"a\", \"b\", \"c\"]\n```\n\n## 数组元素的截取 \n### slice()\n数组.slice(开始索引值，结束索引值);     //数组截取;\n例 ：\n\n```javascript\nvar arr = [1, 2, 3, \"a\", \"b\", \"c\"];\nconsole.log(arr.slice(3)); //从索引值为3截取到最后;[\"a\", \"b\", \"c\"]\nconsole.log(arr.slice(0,3));//包左不包右;[1, 2, 3]\nconsole.log(arr.slice(-2));//负数是后几个;[\"b\", \"c\"]\nconsole.log(arr.slice(3,0));//如果前面的比后面的大，那么就是[];[]\nconsole.log(arr);//原数组不被修改;[1, 2, 3, \"a\", \"b\", \"c\"]\n```\n## splice()\n\nsplice(开始索引值，删除几个，替换内容1，替换内容2，...); // 替换和删除; \n改变原数组;返回值是被删除/替换的内容                                                   \n例:\n\n```javascript\nvar arr = [1,2,3,4,5,6,\"a\", \"b\", \"c\"]\narr.splice(5); //从索引值为5截取到最后;(删除)\nconsole.log(arr); // [1, 2, 3, 4, 5]\narr.splice(1,2);//(删除指定个数)从索引为1的开始删除2个\nconsole.log(arr);//[1, 4, 5]\n//替换\nvar arr = [1,2,3,4,5,6,\"a\", \"b\", \"c\"];\nconsole.log(arr.splice(3,3,\"aaa\",\"bbb\",\"ccc\"));//(删除指定数并替换)[4, 5, 6]\nconsole.log(arr);// [1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]\n// 添加\narr.splice(3,0,\"aaa\",\"bbb\",\"ccc\");//(删除指定个数)\nconsole.log(arr);//截取或者替换之后的;[1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]\n```\n## 数组的索引\n### indexOf / lastIndexOf\n数组.indexOf(元素);      // 给元素，查索引(从前往后)\n数组.lastIndexOf(元素);  // 给元素，查索引(从后往前)\n例：\n```javascript\nvar arr = [\"a\",\"b\",\"c\",\"d\",\"c\",\"b\",\"b\"];\nconsole.log(arr.indexOf(\"b\"));        // 1 查到以后立刻返回\nconsole.log(arr.lastIndexOf(\"b\"));    // 6 找到以后立刻返回\nconsole.log(arr.indexOf(\"xxx\"));    // -1;  查不到就返回-1；\n```\n\n## 数组遍历\n### filter()\n对数组中每一项运行回调函数，该函数返回结果是true的项组成的新数组\n新数组是有老数组中的元素组成的，return为ture的项;\n例：\n```javascript\nvar arr = [100,222,333,444,555];\nvar newArr = arr.filter(function (element, index, array) {\n  //只要是偶数，就组成数组;(数组中辨别元素)\n  if(element%2 === 0){\n      return true;\n  }else{\n      return false;\n  }\n})\nconsole.log(newArr); // [100，222, 444]\n```\n   \n### every()\nevery() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。\nevery() 方法使用指定函数检测数组中的所有元素：\n如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。\n如果所有元素都满足条件，则返回 true。\n 例：\n```javascript\nvar arr = [120, 220, 320, 420, 520]\nvar bool = arr.every(function (element, index, array) {\n  //判断：我们定义所有元素都大于200;\n  //if(element > 100){\n  if(element > 200){\n      return true;\n  }else{\n      return false;\n  }\n})\nalert(bool); //false\n```\n\n### forEach()\n和for循环一样；没有返回值;\n例：\n\n```javascript\nvar arr = [111,222,333,444,555];\nvar sum = 0;\nvar aaa = arr.forEach(function (element,index,array) {\n  console.log(element); // 输出数组中的每一个元素\n  console.log(index); // 数组元素对应的索引值\n  console.log(array); // 数组本身 [111, 222, 333, 444, 555]\n  sum += element; //数组中元素求和;\n});\nconsole.log(sum); // 数组元素加起来的和\nconsole.log(aaa);//undefined；没有返回值 所以返回undefined\n```\n### map()\n\n对数组中每一项运行回调函数，返回该函数的结果组成的新数组。 return什么新数组中就有什么，不return返回undefined，对数组二次加工。\n例：\n```javascript\nvar arr = [111,222,333,444,555];\nvar newArr = arr.map(function (element, index, array) {\n    if(index == 3){\n        return element; // 这里return了 所以下面返回的值是444\n    }\n    return element*100; // 返回的元素值都乘上100后的值\n})\nconsole.log(newArr); // [11100, 22200, 33300, 444, 55500]\n```","source":"_posts/js-array.md","raw":"---\ntitle: js中常见的数组操作\ndate: 2017-12-15 13:06:31\ntags:\n- javascript\n---\n## 数组元素的添加\n### push()和unshift()\n```\n1. push() //在数组的最末尾添加元素;\n2. unshift() //在数组的最前面添加一个元素;\n```\n<!--more-->\n例：\n```javascript\nvar arr = [1,2,3];\nvar aaa = arr.push(\"a\");//在数组的最末尾添加一个元素;\nconsole.log(arr);//元素被修改了\nconsole.log(aaa);//返回值是数组的长度;\n\n\nvar _aaa = arr.unshift(\"b\");//在数组的最前面添加一个元素;\nconsole.log(arr);//元素被修改了\nconsole.log(_aaa);//返回值是数组的长度;\n```\n## 数组元素的删除\n### pop()和shift()\n```\n1. pop()  //不需要参数;在数组的最末尾删除一项;\n1. shift() //不需要参数;在数组的最前面删除一项;\n```\n例：\n```javascript\nvar arr = [1,2,3,4];\nvar aaa = arr.pop();//不需要参数;在数组的最末尾删除一项;\nconsole.log(arr);//元素被修改了 [1,2,3]\nconsole.log(aaa);//被删除的那一项 4\n\nvar _aaa = arr.shift();//不需要参数;在数组的最前面删除一项;\nconsole.log(arr);//元素被修改了 [2,3]\nconsole.log(_aaa);//被删除的那一项 1\n```\n## 数组元素排序\n### sort( )\nsort(),数组中元素排序;(默认：从小到大)\n,默认按照首个字符的Unicode编码排序;如果第一个相同那么就比较第二个...\n例：\n\n```javascript        \nvar arr = [4,7,1,3,2,8,6,9,5];\nvar aaa =arr.sort();\nconsole.log(aaa);          // [1, 2, 3, 4, 5, 6, 7, 8, 9]\nconsole.log(aaa === arr);// true 原数组被排序了(冒泡排序)\n```\n \nsort(),数值大小排序方法,需要借助回调函数;\n例：\n\n```javascript\nvar arr = [4,5,1,13,2,7,6];//回调函数里面返回值如果是：参数1-参数2;升幂；参数2-参数1;降幂；\narr.sort(function (a,b) {\n  return a-b; //升序\n  //return b-a; //降序\n  //return b.value-a.value; //按照元素value属性的大小排序;\n});\nconsole.log(arr); // [1, 2, 4, 5, 6, 7, 13]\n```\n## 数组的翻转\n### reverse()\n例:\n```javascript\nvar arr1 = [1,2,3,4,5];\nvar aaa = arr1.reverse(); // [5,4,3,2,1]\n```\n\n## 数组元素的连接 \n### concat()\n数组1.concat(数组2); // 链接两个数组;\n例 ：\n\n```javascript\nvar arr1 = [1,2,3];\nvar arr2 = [\"a\",\"b\",\"c\"];\nvar arr3 = arr1.concat(arr2);\nconsole.log(arr3)//[1, 2, 3, \"a\", \"b\", \"c\"]\n```\n\n## 数组元素的截取 \n### slice()\n数组.slice(开始索引值，结束索引值);     //数组截取;\n例 ：\n\n```javascript\nvar arr = [1, 2, 3, \"a\", \"b\", \"c\"];\nconsole.log(arr.slice(3)); //从索引值为3截取到最后;[\"a\", \"b\", \"c\"]\nconsole.log(arr.slice(0,3));//包左不包右;[1, 2, 3]\nconsole.log(arr.slice(-2));//负数是后几个;[\"b\", \"c\"]\nconsole.log(arr.slice(3,0));//如果前面的比后面的大，那么就是[];[]\nconsole.log(arr);//原数组不被修改;[1, 2, 3, \"a\", \"b\", \"c\"]\n```\n## splice()\n\nsplice(开始索引值，删除几个，替换内容1，替换内容2，...); // 替换和删除; \n改变原数组;返回值是被删除/替换的内容                                                   \n例:\n\n```javascript\nvar arr = [1,2,3,4,5,6,\"a\", \"b\", \"c\"]\narr.splice(5); //从索引值为5截取到最后;(删除)\nconsole.log(arr); // [1, 2, 3, 4, 5]\narr.splice(1,2);//(删除指定个数)从索引为1的开始删除2个\nconsole.log(arr);//[1, 4, 5]\n//替换\nvar arr = [1,2,3,4,5,6,\"a\", \"b\", \"c\"];\nconsole.log(arr.splice(3,3,\"aaa\",\"bbb\",\"ccc\"));//(删除指定数并替换)[4, 5, 6]\nconsole.log(arr);// [1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]\n// 添加\narr.splice(3,0,\"aaa\",\"bbb\",\"ccc\");//(删除指定个数)\nconsole.log(arr);//截取或者替换之后的;[1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]\n```\n## 数组的索引\n### indexOf / lastIndexOf\n数组.indexOf(元素);      // 给元素，查索引(从前往后)\n数组.lastIndexOf(元素);  // 给元素，查索引(从后往前)\n例：\n```javascript\nvar arr = [\"a\",\"b\",\"c\",\"d\",\"c\",\"b\",\"b\"];\nconsole.log(arr.indexOf(\"b\"));        // 1 查到以后立刻返回\nconsole.log(arr.lastIndexOf(\"b\"));    // 6 找到以后立刻返回\nconsole.log(arr.indexOf(\"xxx\"));    // -1;  查不到就返回-1；\n```\n\n## 数组遍历\n### filter()\n对数组中每一项运行回调函数，该函数返回结果是true的项组成的新数组\n新数组是有老数组中的元素组成的，return为ture的项;\n例：\n```javascript\nvar arr = [100,222,333,444,555];\nvar newArr = arr.filter(function (element, index, array) {\n  //只要是偶数，就组成数组;(数组中辨别元素)\n  if(element%2 === 0){\n      return true;\n  }else{\n      return false;\n  }\n})\nconsole.log(newArr); // [100，222, 444]\n```\n   \n### every()\nevery() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。\nevery() 方法使用指定函数检测数组中的所有元素：\n如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。\n如果所有元素都满足条件，则返回 true。\n 例：\n```javascript\nvar arr = [120, 220, 320, 420, 520]\nvar bool = arr.every(function (element, index, array) {\n  //判断：我们定义所有元素都大于200;\n  //if(element > 100){\n  if(element > 200){\n      return true;\n  }else{\n      return false;\n  }\n})\nalert(bool); //false\n```\n\n### forEach()\n和for循环一样；没有返回值;\n例：\n\n```javascript\nvar arr = [111,222,333,444,555];\nvar sum = 0;\nvar aaa = arr.forEach(function (element,index,array) {\n  console.log(element); // 输出数组中的每一个元素\n  console.log(index); // 数组元素对应的索引值\n  console.log(array); // 数组本身 [111, 222, 333, 444, 555]\n  sum += element; //数组中元素求和;\n});\nconsole.log(sum); // 数组元素加起来的和\nconsole.log(aaa);//undefined；没有返回值 所以返回undefined\n```\n### map()\n\n对数组中每一项运行回调函数，返回该函数的结果组成的新数组。 return什么新数组中就有什么，不return返回undefined，对数组二次加工。\n例：\n```javascript\nvar arr = [111,222,333,444,555];\nvar newArr = arr.map(function (element, index, array) {\n    if(index == 3){\n        return element; // 这里return了 所以下面返回的值是444\n    }\n    return element*100; // 返回的元素值都乘上100后的值\n})\nconsole.log(newArr); // [11100, 22200, 33300, 444, 55500]\n```","slug":"js-array","published":1,"updated":"2017-12-22T05:49:43.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oc60010uo2es68fkclb","content":"<h2 id=\"数组元素的添加\"><a href=\"#数组元素的添加\" class=\"headerlink\" title=\"数组元素的添加\"></a>数组元素的添加</h2><h3 id=\"push-和unshift\"><a href=\"#push-和unshift\" class=\"headerlink\" title=\"push()和unshift()\"></a>push()和unshift()</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. push() //在数组的最末尾添加元素;</span><br><span class=\"line\">2. unshift() //在数组的最前面添加一个元素;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr.push(<span class=\"string\">\"a\"</span>);<span class=\"comment\">//在数组的最末尾添加一个元素;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);<span class=\"comment\">//返回值是数组的长度;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> _aaa = arr.unshift(<span class=\"string\">\"b\"</span>);<span class=\"comment\">//在数组的最前面添加一个元素;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(_aaa);<span class=\"comment\">//返回值是数组的长度;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组元素的删除\"><a href=\"#数组元素的删除\" class=\"headerlink\" title=\"数组元素的删除\"></a>数组元素的删除</h2><h3 id=\"pop-和shift\"><a href=\"#pop-和shift\" class=\"headerlink\" title=\"pop()和shift()\"></a>pop()和shift()</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. pop()  //不需要参数;在数组的最末尾删除一项;</span><br><span class=\"line\">1. shift() //不需要参数;在数组的最前面删除一项;</span><br></pre></td></tr></table></figure>\n<p>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr.pop();<span class=\"comment\">//不需要参数;在数组的最末尾删除一项;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了 [1,2,3]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);<span class=\"comment\">//被删除的那一项 4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> _aaa = arr.shift();<span class=\"comment\">//不需要参数;在数组的最前面删除一项;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了 [2,3]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(_aaa);<span class=\"comment\">//被删除的那一项 1</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组元素排序\"><a href=\"#数组元素排序\" class=\"headerlink\" title=\"数组元素排序\"></a>数组元素排序</h2><h3 id=\"sort\"><a href=\"#sort\" class=\"headerlink\" title=\"sort( )\"></a>sort( )</h3><p>sort(),数组中元素排序;(默认：从小到大)<br>,默认按照首个字符的Unicode编码排序;如果第一个相同那么就比较第二个…<br>例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">4</span>,<span class=\"number\">7</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">8</span>,<span class=\"number\">6</span>,<span class=\"number\">9</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa =arr.sort();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);          <span class=\"comment\">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa === arr);<span class=\"comment\">// true 原数组被排序了(冒泡排序)</span></span><br></pre></td></tr></table></figure>\n<p>sort(),数值大小排序方法,需要借助回调函数;<br>例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">1</span>,<span class=\"number\">13</span>,<span class=\"number\">2</span>,<span class=\"number\">7</span>,<span class=\"number\">6</span>];<span class=\"comment\">//回调函数里面返回值如果是：参数1-参数2;升幂；参数2-参数1;降幂；</span></span><br><span class=\"line\">arr.sort(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a,b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a-b; <span class=\"comment\">//升序</span></span><br><span class=\"line\">  <span class=\"comment\">//return b-a; //降序</span></span><br><span class=\"line\">  <span class=\"comment\">//return b.value-a.value; //按照元素value属性的大小排序;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 2, 4, 5, 6, 7, 13]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"数组的翻转\"><a href=\"#数组的翻转\" class=\"headerlink\" title=\"数组的翻转\"></a>数组的翻转</h2><h3 id=\"reverse\"><a href=\"#reverse\" class=\"headerlink\" title=\"reverse()\"></a>reverse()</h3><p>例:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr1.reverse(); <span class=\"comment\">// [5,4,3,2,1]</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组元素的连接\"><a href=\"#数组元素的连接\" class=\"headerlink\" title=\"数组元素的连接\"></a>数组元素的连接</h2><h3 id=\"concat\"><a href=\"#concat\" class=\"headerlink\" title=\"concat()\"></a>concat()</h3><p>数组1.concat(数组2); // 链接两个数组;<br>例 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = arr1.concat(arr2);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr3)<span class=\"comment\">//[1, 2, 3, \"a\", \"b\", \"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"数组元素的截取\"><a href=\"#数组元素的截取\" class=\"headerlink\" title=\"数组元素的截取\"></a>数组元素的截取</h2><h3 id=\"slice\"><a href=\"#slice\" class=\"headerlink\" title=\"slice()\"></a>slice()</h3><p>数组.slice(开始索引值，结束索引值);     //数组截取;<br>例 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">3</span>)); <span class=\"comment\">//从索引值为3截取到最后;[\"a\", \"b\", \"c\"]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>));<span class=\"comment\">//包左不包右;[1, 2, 3]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">-2</span>));<span class=\"comment\">//负数是后几个;[\"b\", \"c\"]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">3</span>,<span class=\"number\">0</span>));<span class=\"comment\">//如果前面的比后面的大，那么就是[];[]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//原数组不被修改;[1, 2, 3, \"a\", \"b\", \"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"splice\"><a href=\"#splice\" class=\"headerlink\" title=\"splice()\"></a>splice()</h2><p>splice(开始索引值，删除几个，替换内容1，替换内容2，…); // 替换和删除;<br>改变原数组;返回值是被删除/替换的内容<br>例:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>]</span><br><span class=\"line\">arr.splice(<span class=\"number\">5</span>); <span class=\"comment\">//从索引值为5截取到最后;(删除)</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 2, 3, 4, 5]</span></span><br><span class=\"line\">arr.splice(<span class=\"number\">1</span>,<span class=\"number\">2</span>);<span class=\"comment\">//(删除指定个数)从索引为1的开始删除2个</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//[1, 4, 5]</span></span><br><span class=\"line\"><span class=\"comment\">//替换</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.splice(<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"string\">\"aaa\"</span>,<span class=\"string\">\"bbb\"</span>,<span class=\"string\">\"ccc\"</span>));<span class=\"comment\">//(删除指定数并替换)[4, 5, 6]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">// [1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]</span></span><br><span class=\"line\"><span class=\"comment\">// 添加</span></span><br><span class=\"line\">arr.splice(<span class=\"number\">3</span>,<span class=\"number\">0</span>,<span class=\"string\">\"aaa\"</span>,<span class=\"string\">\"bbb\"</span>,<span class=\"string\">\"ccc\"</span>);<span class=\"comment\">//(删除指定个数)</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//截取或者替换之后的;[1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"数组的索引\"><a href=\"#数组的索引\" class=\"headerlink\" title=\"数组的索引\"></a>数组的索引</h2><h3 id=\"indexOf-lastIndexOf\"><a href=\"#indexOf-lastIndexOf\" class=\"headerlink\" title=\"indexOf / lastIndexOf\"></a>indexOf / lastIndexOf</h3><p>数组.indexOf(元素);      // 给元素，查索引(从前往后)<br>数组.lastIndexOf(元素);  // 给元素，查索引(从后往前)<br>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"b\"</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"string\">\"b\"</span>));        <span class=\"comment\">// 1 查到以后立刻返回</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.lastIndexOf(<span class=\"string\">\"b\"</span>));    <span class=\"comment\">// 6 找到以后立刻返回</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"string\">\"xxx\"</span>));    <span class=\"comment\">// -1;  查不到就返回-1；</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组遍历\"><a href=\"#数组遍历\" class=\"headerlink\" title=\"数组遍历\"></a>数组遍历</h2><h3 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter()\"></a>filter()</h3><p>对数组中每一项运行回调函数，该函数返回结果是true的项组成的新数组<br>新数组是有老数组中的元素组成的，return为ture的项;<br>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">100</span>,<span class=\"number\">222</span>,<span class=\"number\">333</span>,<span class=\"number\">444</span>,<span class=\"number\">555</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArr = arr.filter(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, index, array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//只要是偶数，就组成数组;(数组中辨别元素)</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(element%<span class=\"number\">2</span> === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newArr); <span class=\"comment\">// [100，222, 444]</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"every\"><a href=\"#every\" class=\"headerlink\" title=\"every()\"></a>every()</h3><p>every() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。<br>every() 方法使用指定函数检测数组中的所有元素：<br>如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。<br>如果所有元素都满足条件，则返回 true。<br> 例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">120</span>, <span class=\"number\">220</span>, <span class=\"number\">320</span>, <span class=\"number\">420</span>, <span class=\"number\">520</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> bool = arr.every(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, index, array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//判断：我们定义所有元素都大于200;</span></span><br><span class=\"line\">  <span class=\"comment\">//if(element &gt; 100)&#123;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(element &gt; <span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">alert(bool); <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"forEach\"><a href=\"#forEach\" class=\"headerlink\" title=\"forEach()\"></a>forEach()</h3><p>和for循环一样；没有返回值;<br>例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">111</span>,<span class=\"number\">222</span>,<span class=\"number\">333</span>,<span class=\"number\">444</span>,<span class=\"number\">555</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element,index,array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(element); <span class=\"comment\">// 输出数组中的每一个元素</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(index); <span class=\"comment\">// 数组元素对应的索引值</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(array); <span class=\"comment\">// 数组本身 [111, 222, 333, 444, 555]</span></span><br><span class=\"line\">  sum += element; <span class=\"comment\">//数组中元素求和;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(sum); <span class=\"comment\">// 数组元素加起来的和</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);<span class=\"comment\">//undefined；没有返回值 所以返回undefined</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map()\"></a>map()</h3><p>对数组中每一项运行回调函数，返回该函数的结果组成的新数组。 return什么新数组中就有什么，不return返回undefined，对数组二次加工。<br>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">111</span>,<span class=\"number\">222</span>,<span class=\"number\">333</span>,<span class=\"number\">444</span>,<span class=\"number\">555</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArr = arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, index, array</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(index == <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> element; <span class=\"comment\">// 这里return了 所以下面返回的值是444</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> element*<span class=\"number\">100</span>; <span class=\"comment\">// 返回的元素值都乘上100后的值</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newArr); <span class=\"comment\">// [11100, 22200, 33300, 444, 55500]</span></span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"数组元素的添加\"><a href=\"#数组元素的添加\" class=\"headerlink\" title=\"数组元素的添加\"></a>数组元素的添加</h2><h3 id=\"push-和unshift\"><a href=\"#push-和unshift\" class=\"headerlink\" title=\"push()和unshift()\"></a>push()和unshift()</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. push() //在数组的最末尾添加元素;</span><br><span class=\"line\">2. unshift() //在数组的最前面添加一个元素;</span><br></pre></td></tr></table></figure>","more":"<p>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr.push(<span class=\"string\">\"a\"</span>);<span class=\"comment\">//在数组的最末尾添加一个元素;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);<span class=\"comment\">//返回值是数组的长度;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> _aaa = arr.unshift(<span class=\"string\">\"b\"</span>);<span class=\"comment\">//在数组的最前面添加一个元素;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(_aaa);<span class=\"comment\">//返回值是数组的长度;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组元素的删除\"><a href=\"#数组元素的删除\" class=\"headerlink\" title=\"数组元素的删除\"></a>数组元素的删除</h2><h3 id=\"pop-和shift\"><a href=\"#pop-和shift\" class=\"headerlink\" title=\"pop()和shift()\"></a>pop()和shift()</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. pop()  //不需要参数;在数组的最末尾删除一项;</span><br><span class=\"line\">1. shift() //不需要参数;在数组的最前面删除一项;</span><br></pre></td></tr></table></figure>\n<p>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr.pop();<span class=\"comment\">//不需要参数;在数组的最末尾删除一项;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了 [1,2,3]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);<span class=\"comment\">//被删除的那一项 4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> _aaa = arr.shift();<span class=\"comment\">//不需要参数;在数组的最前面删除一项;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//元素被修改了 [2,3]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(_aaa);<span class=\"comment\">//被删除的那一项 1</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组元素排序\"><a href=\"#数组元素排序\" class=\"headerlink\" title=\"数组元素排序\"></a>数组元素排序</h2><h3 id=\"sort\"><a href=\"#sort\" class=\"headerlink\" title=\"sort( )\"></a>sort( )</h3><p>sort(),数组中元素排序;(默认：从小到大)<br>,默认按照首个字符的Unicode编码排序;如果第一个相同那么就比较第二个…<br>例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">4</span>,<span class=\"number\">7</span>,<span class=\"number\">1</span>,<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">8</span>,<span class=\"number\">6</span>,<span class=\"number\">9</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa =arr.sort();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);          <span class=\"comment\">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa === arr);<span class=\"comment\">// true 原数组被排序了(冒泡排序)</span></span><br></pre></td></tr></table></figure>\n<p>sort(),数值大小排序方法,需要借助回调函数;<br>例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">1</span>,<span class=\"number\">13</span>,<span class=\"number\">2</span>,<span class=\"number\">7</span>,<span class=\"number\">6</span>];<span class=\"comment\">//回调函数里面返回值如果是：参数1-参数2;升幂；参数2-参数1;降幂；</span></span><br><span class=\"line\">arr.sort(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a,b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a-b; <span class=\"comment\">//升序</span></span><br><span class=\"line\">  <span class=\"comment\">//return b-a; //降序</span></span><br><span class=\"line\">  <span class=\"comment\">//return b.value-a.value; //按照元素value属性的大小排序;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 2, 4, 5, 6, 7, 13]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"数组的翻转\"><a href=\"#数组的翻转\" class=\"headerlink\" title=\"数组的翻转\"></a>数组的翻转</h2><h3 id=\"reverse\"><a href=\"#reverse\" class=\"headerlink\" title=\"reverse()\"></a>reverse()</h3><p>例:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr1.reverse(); <span class=\"comment\">// [5,4,3,2,1]</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组元素的连接\"><a href=\"#数组元素的连接\" class=\"headerlink\" title=\"数组元素的连接\"></a>数组元素的连接</h2><h3 id=\"concat\"><a href=\"#concat\" class=\"headerlink\" title=\"concat()\"></a>concat()</h3><p>数组1.concat(数组2); // 链接两个数组;<br>例 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr1 = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr2 = [<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> arr3 = arr1.concat(arr2);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr3)<span class=\"comment\">//[1, 2, 3, \"a\", \"b\", \"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"数组元素的截取\"><a href=\"#数组元素的截取\" class=\"headerlink\" title=\"数组元素的截取\"></a>数组元素的截取</h2><h3 id=\"slice\"><a href=\"#slice\" class=\"headerlink\" title=\"slice()\"></a>slice()</h3><p>数组.slice(开始索引值，结束索引值);     //数组截取;<br>例 ：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">3</span>)); <span class=\"comment\">//从索引值为3截取到最后;[\"a\", \"b\", \"c\"]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>));<span class=\"comment\">//包左不包右;[1, 2, 3]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">-2</span>));<span class=\"comment\">//负数是后几个;[\"b\", \"c\"]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.slice(<span class=\"number\">3</span>,<span class=\"number\">0</span>));<span class=\"comment\">//如果前面的比后面的大，那么就是[];[]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//原数组不被修改;[1, 2, 3, \"a\", \"b\", \"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"splice\"><a href=\"#splice\" class=\"headerlink\" title=\"splice()\"></a>splice()</h2><p>splice(开始索引值，删除几个，替换内容1，替换内容2，…); // 替换和删除;<br>改变原数组;返回值是被删除/替换的内容<br>例:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>]</span><br><span class=\"line\">arr.splice(<span class=\"number\">5</span>); <span class=\"comment\">//从索引值为5截取到最后;(删除)</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr); <span class=\"comment\">// [1, 2, 3, 4, 5]</span></span><br><span class=\"line\">arr.splice(<span class=\"number\">1</span>,<span class=\"number\">2</span>);<span class=\"comment\">//(删除指定个数)从索引为1的开始删除2个</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//[1, 4, 5]</span></span><br><span class=\"line\"><span class=\"comment\">//替换</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.splice(<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"string\">\"aaa\"</span>,<span class=\"string\">\"bbb\"</span>,<span class=\"string\">\"ccc\"</span>));<span class=\"comment\">//(删除指定数并替换)[4, 5, 6]</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">// [1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]</span></span><br><span class=\"line\"><span class=\"comment\">// 添加</span></span><br><span class=\"line\">arr.splice(<span class=\"number\">3</span>,<span class=\"number\">0</span>,<span class=\"string\">\"aaa\"</span>,<span class=\"string\">\"bbb\"</span>,<span class=\"string\">\"ccc\"</span>);<span class=\"comment\">//(删除指定个数)</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr);<span class=\"comment\">//截取或者替换之后的;[1, 2, 3, \"aaa\", \"bbb\", \"ccc\", \"aaa\", \"bbb\", \"ccc\", \"a\", \"b\", \"c\"]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"数组的索引\"><a href=\"#数组的索引\" class=\"headerlink\" title=\"数组的索引\"></a>数组的索引</h2><h3 id=\"indexOf-lastIndexOf\"><a href=\"#indexOf-lastIndexOf\" class=\"headerlink\" title=\"indexOf / lastIndexOf\"></a>indexOf / lastIndexOf</h3><p>数组.indexOf(元素);      // 给元素，查索引(从前往后)<br>数组.lastIndexOf(元素);  // 给元素，查索引(从后往前)<br>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"b\"</span>];</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"string\">\"b\"</span>));        <span class=\"comment\">// 1 查到以后立刻返回</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.lastIndexOf(<span class=\"string\">\"b\"</span>));    <span class=\"comment\">// 6 找到以后立刻返回</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(arr.indexOf(<span class=\"string\">\"xxx\"</span>));    <span class=\"comment\">// -1;  查不到就返回-1；</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数组遍历\"><a href=\"#数组遍历\" class=\"headerlink\" title=\"数组遍历\"></a>数组遍历</h2><h3 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter()\"></a>filter()</h3><p>对数组中每一项运行回调函数，该函数返回结果是true的项组成的新数组<br>新数组是有老数组中的元素组成的，return为ture的项;<br>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">100</span>,<span class=\"number\">222</span>,<span class=\"number\">333</span>,<span class=\"number\">444</span>,<span class=\"number\">555</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArr = arr.filter(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, index, array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//只要是偶数，就组成数组;(数组中辨别元素)</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(element%<span class=\"number\">2</span> === <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newArr); <span class=\"comment\">// [100，222, 444]</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"every\"><a href=\"#every\" class=\"headerlink\" title=\"every()\"></a>every()</h3><p>every() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。<br>every() 方法使用指定函数检测数组中的所有元素：<br>如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。<br>如果所有元素都满足条件，则返回 true。<br> 例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">120</span>, <span class=\"number\">220</span>, <span class=\"number\">320</span>, <span class=\"number\">420</span>, <span class=\"number\">520</span>]</span><br><span class=\"line\"><span class=\"keyword\">var</span> bool = arr.every(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, index, array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//判断：我们定义所有元素都大于200;</span></span><br><span class=\"line\">  <span class=\"comment\">//if(element &gt; 100)&#123;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(element &gt; <span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">alert(bool); <span class=\"comment\">//false</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"forEach\"><a href=\"#forEach\" class=\"headerlink\" title=\"forEach()\"></a>forEach()</h3><p>和for循环一样；没有返回值;<br>例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">111</span>,<span class=\"number\">222</span>,<span class=\"number\">333</span>,<span class=\"number\">444</span>,<span class=\"number\">555</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> aaa = arr.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element,index,array</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(element); <span class=\"comment\">// 输出数组中的每一个元素</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(index); <span class=\"comment\">// 数组元素对应的索引值</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(array); <span class=\"comment\">// 数组本身 [111, 222, 333, 444, 555]</span></span><br><span class=\"line\">  sum += element; <span class=\"comment\">//数组中元素求和;</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(sum); <span class=\"comment\">// 数组元素加起来的和</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(aaa);<span class=\"comment\">//undefined；没有返回值 所以返回undefined</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map()\"></a>map()</h3><p>对数组中每一项运行回调函数，返回该函数的结果组成的新数组。 return什么新数组中就有什么，不return返回undefined，对数组二次加工。<br>例：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">111</span>,<span class=\"number\">222</span>,<span class=\"number\">333</span>,<span class=\"number\">444</span>,<span class=\"number\">555</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArr = arr.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">element, index, array</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(index == <span class=\"number\">3</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> element; <span class=\"comment\">// 这里return了 所以下面返回的值是444</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> element*<span class=\"number\">100</span>; <span class=\"comment\">// 返回的元素值都乘上100后的值</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newArr); <span class=\"comment\">// [11100, 22200, 33300, 444, 55500]</span></span><br></pre></td></tr></table></figure></p>"},{"title":"相等运算符 == 和 ===  / 隐式类型转换","date":"2017-10-26T09:51:00.000Z","_content":"Q: 写一个对象来满足 `a == '1'`; `==` 和 `===` 的区别在哪。（取自百度面试题）\n\n<!--more-->\n\n---\n\n## == 和 === 的区别\n\n\n> `==` 允许在等价性比较中进行强制转换，而 `===` 不允许强制转换。\n\n**严格相等运算符 `===` **\n* 不同类型值相比较  `false`\n* 同一类的原始类型值（数值、字符串、布尔值）比较，值相等  `true` / 值不相等  `false`\n* 同一类的复合类型值（对象、数组、函数）比较，不比较它们的值，而是比较它们是否指向同一个对象\n  ```js\n  var a = { m: 1 };\n  var b = { m: 1 };\n  a === b; // false\n\n  var a = { m: 1};\n  var b = a;\n  a === b; // true\n  ```\n* `undefined` 和 `null` 与自身相等\n  ```js\n  null === null // true\n  undefined === undefined // true\n  ```\n* `NaN` 永远不等于它自己，`+0 / -0 / 0` 互相相等\n\n\n**抽象相等运算符 `==` **\n\n> 比较同类型数据时同 `===`；不同类型，先将数据进行类型转换，然后再用 `===` 比较。\n\n* 不同原始类型值（数值、字符串、布尔值）转换成数值类型再比较，字符串和布尔值都会转换成数值。\n```js\n  '1' == true  // true 同 1 == true\n  '2' == true  // false 同 2 == true\n  'a' == true  // false 同 a == true\n\n  '0' == false // true 同 0 == false\n  '2' == false // false 同 2 == false\n  'a' == false // false 同 a == false\n```\n* `undefined` 和 `null`\n```js\n  null == undefined // true\n```\n* 对象与原始类型值比较\n\n  > 先将对象转换成原始类型值（隐式类型转换），再用 `===` 比较。调用了下面两个方法：\n  定义在 `object.prototype` 上的：\n  `valueOf` 方法：用来把对象转换成原始类型的值\n  `toString` 方法：将对象表示成文本值或者期望的字符串\n\n  ```js\n    // 写一个对象来满足a == '1'\n    const a = { toString: () => '1'};\n    console.log(typeof a); // -->object\n    console.log(a == '1'); // -->true\n\n    // 或者\n    const c = new String('1');\n    console.log(typeof c); // -->object\n    console.log(c == '1'); // -->true\n  ```\n\n## JavaScript 中应该用 `==` 还是 `===`？\n\n> 摘自《你不懂JS》系列：\n许多开发者认为 === 的行为更加容易预测，所以他们总是主张使用 === 而劝人们远离 ==，我认为这种看法是非常短视的。如果你花点时间来搞清楚它是如何工作的话，== 绝对是一个能够帮助你程序的强大工具。\n\n> 来源知乎：\n 绝大多数场合应该使用 === ，只有检测 null/undefined 的时候可以使用 x == null ，因为通常我们不区分 null 和 undefined ，即将 x == null 作为 x === null || x === undefined 的缩写。\n\n**用 `==` 副作用**\n\n* 覆写某个对象的 valueOf/toString\n  > == 的隐式类型转换调用了这两个方法，如果在覆盖的方法里写了带有副作用的代码，会带来副作用。\n\n  ```js\n    // 出现异常\n    var x = 1;\n    var obj = {\n      valueOf: function() {\n        return {};\n      },\n      toString: function() {\n        return {};\n      },\n    }\n    console.log( obj == 0 );\n    // Error: Cannot convert object to primitive value (不能将对象转换为原始值)\n\n\n\n    // 刁钻的例子\n    var i = 2;\n    Number.prototype.valueOf = function() {\n      return i++;\n    };\n    var a = new Number(42 );\n    if (a == 2 && a == 3) {\n      console.log( \"Yep, this happened.\" );\n    }\n    // Yep, this happend.\n  ```\n\n* 没有类型限制，类型转换的后果将是不可预料的\n\n  > 如果比较的任意一边可能出现 true 或者 false 值，那么就永远，永远不要使用 ==。\n  如果比较的任意一边可能出现 []，\"\"，或 0 这些值，那么认真地考虑不使用 ==。\n\n  ```js\n    \"\" == 0; // true\n    123 == \"123\"; // true\n    false == \" \\t \"; // true\n    0 == []; // true\n    \"\" == []; // true\n    [] == ![]; // true\n  ```\n* 是否对后续代码造成意外的影响\n  > 维护他人/自己的代码。当看到 == 时，需要去判断代码意图是需要这么写/随手写的/不应该转型写错了，而且逻辑/语义不清晰，也容易隐藏错误。\n\n  > 例子：if (x == 10) x += 5\n  如果传入的x是字符串'10'，x的结果会变成'105'。在后续运算中字符串'105'又可能被转型，从而引入隐蔽的错误。\n\n** 适合使用的情况 **\n\n* 判断一个字符串看起来是不是空白的（由空白字符组成）\n```js\n  var str = \"  \";\n  if (typeof str === \"string\" && str == false) {\n    console.log(\"由空白字符组成\");\n  }\n  // 由空白字符组成\n```\n\n* 检测 `null/undefined`\n```js\n  a == null;\n  //等同于\n  a === null || a === undefined;\n```\n\n## 隐式类型转换\n\n> 隐式类型转换（自动类型转换）：不需要书写代码，由系统自动完成的类型转换。\n\n** 运算中存在的隐式类型转换 **\n\n* `+` 运算符\n  > 当运算符 `+` 两边一个是数字类型，一个是字符串类型时，js引擎规定进行字符串连接运算而非算术加运算。\n\n  ```js\n    var a = 11;\n    a = a + '';\n    console.log(typeof a)  // --> string\n  ```\n\n* `-` 运算符: 取负 / 减法运算\n  > 与 `+` 相反，会把字符串隐式的转换成数字再进行算术减法运算。\n\n  ```js\n    var a = 11; b = '5';\n    var c = a - b;\n    console.log(typeof c); // -->number\n\n    var a = '11';\n    a = a - '';\n    console.log(typeof a); // -->number\n  ```\n\n** 语句中存在的隐式类型转换 **\n\n* `if/while`\n\n  > 括号内的判断条件转换成 `Boolean` 类型;\n\n  ```js\n    if (a) {\n      // do something\n    }\n    while (a) {\n      // do something\n    }\n  ```\n\n* `for in`\n\n  > 属性名/键值/索引转换成 `String` 类型。\n\n  ```js\n    var a = { 1: 222, 'a': 333};\n    for (var k in a) {\n      console.log( k, ':', typeof k)\n    }\n    /*\n    * 1: string\n    * a: string\n    */\n\n    // 数组的索引也是字符串类型。\n\n    var arr = [1, 3, 5, 7];\n    for (var i in arr) {\n      console.log( i, ':', typeof i);\n    }\n    /*\n    * 0: string\n    * 1: string\n    * 2: string\n    * 3: string\n    */\n  ```\n\n* `alert`\n\n  > 给String原型上添加了个 `fn` 方法，该方法返回 `this` ，即当前类的实例对象。\n    既然是对象那么 `typeof a.fn()` 自然返回是object了。\n    关键是最后的 `alert(a.fn())`，`a.fn()`返回的是对象，但 `alert` 却隐式转换成了字符串 `hello` 显示。同样的情况发生在数字类型上。\n\n  ```js\n    String.prototype.fn = function() {\n      return this;\n    };\n\n    var a = 'hello';\n\n    alert(typeof a.fn()); // --> object\n    alert(a.fn()); // -->hello\n    console.log(a.fn()); // --> String {0: \"h\", 1: \"e\", 2: \"l\", 3: \"l\", 4: \"o\", length: 5, [[PrimitiveValue]]: \"hello\"}\n  ```\n\n\n## 参考文档\n\n[Javascript 中 == 和 === 区别是什么？](https://www.zhihu.com/question/31442029 \"Javascript 中 == 和 === 区别是什么？\")\n[js隐式转换](http://www.jianshu.com/p/0f1e3ff14537 \"js隐式转换\")\n[《你不懂JS：类型与文法》-- 第四章：强制转换](https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/types%20%26%20grammar/ch4.md\"《你不懂JS：类型与文法》-- 第四章：强制转换\")","source":"_posts/js-equal-and-implicitcoercion.md","raw":"---\ntitle: 相等运算符 == 和 ===  / 隐式类型转换\ndate: 2017-10-26 17:51:00\ntags:\n - javascript\n---\nQ: 写一个对象来满足 `a == '1'`; `==` 和 `===` 的区别在哪。（取自百度面试题）\n\n<!--more-->\n\n---\n\n## == 和 === 的区别\n\n\n> `==` 允许在等价性比较中进行强制转换，而 `===` 不允许强制转换。\n\n**严格相等运算符 `===` **\n* 不同类型值相比较  `false`\n* 同一类的原始类型值（数值、字符串、布尔值）比较，值相等  `true` / 值不相等  `false`\n* 同一类的复合类型值（对象、数组、函数）比较，不比较它们的值，而是比较它们是否指向同一个对象\n  ```js\n  var a = { m: 1 };\n  var b = { m: 1 };\n  a === b; // false\n\n  var a = { m: 1};\n  var b = a;\n  a === b; // true\n  ```\n* `undefined` 和 `null` 与自身相等\n  ```js\n  null === null // true\n  undefined === undefined // true\n  ```\n* `NaN` 永远不等于它自己，`+0 / -0 / 0` 互相相等\n\n\n**抽象相等运算符 `==` **\n\n> 比较同类型数据时同 `===`；不同类型，先将数据进行类型转换，然后再用 `===` 比较。\n\n* 不同原始类型值（数值、字符串、布尔值）转换成数值类型再比较，字符串和布尔值都会转换成数值。\n```js\n  '1' == true  // true 同 1 == true\n  '2' == true  // false 同 2 == true\n  'a' == true  // false 同 a == true\n\n  '0' == false // true 同 0 == false\n  '2' == false // false 同 2 == false\n  'a' == false // false 同 a == false\n```\n* `undefined` 和 `null`\n```js\n  null == undefined // true\n```\n* 对象与原始类型值比较\n\n  > 先将对象转换成原始类型值（隐式类型转换），再用 `===` 比较。调用了下面两个方法：\n  定义在 `object.prototype` 上的：\n  `valueOf` 方法：用来把对象转换成原始类型的值\n  `toString` 方法：将对象表示成文本值或者期望的字符串\n\n  ```js\n    // 写一个对象来满足a == '1'\n    const a = { toString: () => '1'};\n    console.log(typeof a); // -->object\n    console.log(a == '1'); // -->true\n\n    // 或者\n    const c = new String('1');\n    console.log(typeof c); // -->object\n    console.log(c == '1'); // -->true\n  ```\n\n## JavaScript 中应该用 `==` 还是 `===`？\n\n> 摘自《你不懂JS》系列：\n许多开发者认为 === 的行为更加容易预测，所以他们总是主张使用 === 而劝人们远离 ==，我认为这种看法是非常短视的。如果你花点时间来搞清楚它是如何工作的话，== 绝对是一个能够帮助你程序的强大工具。\n\n> 来源知乎：\n 绝大多数场合应该使用 === ，只有检测 null/undefined 的时候可以使用 x == null ，因为通常我们不区分 null 和 undefined ，即将 x == null 作为 x === null || x === undefined 的缩写。\n\n**用 `==` 副作用**\n\n* 覆写某个对象的 valueOf/toString\n  > == 的隐式类型转换调用了这两个方法，如果在覆盖的方法里写了带有副作用的代码，会带来副作用。\n\n  ```js\n    // 出现异常\n    var x = 1;\n    var obj = {\n      valueOf: function() {\n        return {};\n      },\n      toString: function() {\n        return {};\n      },\n    }\n    console.log( obj == 0 );\n    // Error: Cannot convert object to primitive value (不能将对象转换为原始值)\n\n\n\n    // 刁钻的例子\n    var i = 2;\n    Number.prototype.valueOf = function() {\n      return i++;\n    };\n    var a = new Number(42 );\n    if (a == 2 && a == 3) {\n      console.log( \"Yep, this happened.\" );\n    }\n    // Yep, this happend.\n  ```\n\n* 没有类型限制，类型转换的后果将是不可预料的\n\n  > 如果比较的任意一边可能出现 true 或者 false 值，那么就永远，永远不要使用 ==。\n  如果比较的任意一边可能出现 []，\"\"，或 0 这些值，那么认真地考虑不使用 ==。\n\n  ```js\n    \"\" == 0; // true\n    123 == \"123\"; // true\n    false == \" \\t \"; // true\n    0 == []; // true\n    \"\" == []; // true\n    [] == ![]; // true\n  ```\n* 是否对后续代码造成意外的影响\n  > 维护他人/自己的代码。当看到 == 时，需要去判断代码意图是需要这么写/随手写的/不应该转型写错了，而且逻辑/语义不清晰，也容易隐藏错误。\n\n  > 例子：if (x == 10) x += 5\n  如果传入的x是字符串'10'，x的结果会变成'105'。在后续运算中字符串'105'又可能被转型，从而引入隐蔽的错误。\n\n** 适合使用的情况 **\n\n* 判断一个字符串看起来是不是空白的（由空白字符组成）\n```js\n  var str = \"  \";\n  if (typeof str === \"string\" && str == false) {\n    console.log(\"由空白字符组成\");\n  }\n  // 由空白字符组成\n```\n\n* 检测 `null/undefined`\n```js\n  a == null;\n  //等同于\n  a === null || a === undefined;\n```\n\n## 隐式类型转换\n\n> 隐式类型转换（自动类型转换）：不需要书写代码，由系统自动完成的类型转换。\n\n** 运算中存在的隐式类型转换 **\n\n* `+` 运算符\n  > 当运算符 `+` 两边一个是数字类型，一个是字符串类型时，js引擎规定进行字符串连接运算而非算术加运算。\n\n  ```js\n    var a = 11;\n    a = a + '';\n    console.log(typeof a)  // --> string\n  ```\n\n* `-` 运算符: 取负 / 减法运算\n  > 与 `+` 相反，会把字符串隐式的转换成数字再进行算术减法运算。\n\n  ```js\n    var a = 11; b = '5';\n    var c = a - b;\n    console.log(typeof c); // -->number\n\n    var a = '11';\n    a = a - '';\n    console.log(typeof a); // -->number\n  ```\n\n** 语句中存在的隐式类型转换 **\n\n* `if/while`\n\n  > 括号内的判断条件转换成 `Boolean` 类型;\n\n  ```js\n    if (a) {\n      // do something\n    }\n    while (a) {\n      // do something\n    }\n  ```\n\n* `for in`\n\n  > 属性名/键值/索引转换成 `String` 类型。\n\n  ```js\n    var a = { 1: 222, 'a': 333};\n    for (var k in a) {\n      console.log( k, ':', typeof k)\n    }\n    /*\n    * 1: string\n    * a: string\n    */\n\n    // 数组的索引也是字符串类型。\n\n    var arr = [1, 3, 5, 7];\n    for (var i in arr) {\n      console.log( i, ':', typeof i);\n    }\n    /*\n    * 0: string\n    * 1: string\n    * 2: string\n    * 3: string\n    */\n  ```\n\n* `alert`\n\n  > 给String原型上添加了个 `fn` 方法，该方法返回 `this` ，即当前类的实例对象。\n    既然是对象那么 `typeof a.fn()` 自然返回是object了。\n    关键是最后的 `alert(a.fn())`，`a.fn()`返回的是对象，但 `alert` 却隐式转换成了字符串 `hello` 显示。同样的情况发生在数字类型上。\n\n  ```js\n    String.prototype.fn = function() {\n      return this;\n    };\n\n    var a = 'hello';\n\n    alert(typeof a.fn()); // --> object\n    alert(a.fn()); // -->hello\n    console.log(a.fn()); // --> String {0: \"h\", 1: \"e\", 2: \"l\", 3: \"l\", 4: \"o\", length: 5, [[PrimitiveValue]]: \"hello\"}\n  ```\n\n\n## 参考文档\n\n[Javascript 中 == 和 === 区别是什么？](https://www.zhihu.com/question/31442029 \"Javascript 中 == 和 === 区别是什么？\")\n[js隐式转换](http://www.jianshu.com/p/0f1e3ff14537 \"js隐式转换\")\n[《你不懂JS：类型与文法》-- 第四章：强制转换](https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/types%20%26%20grammar/ch4.md\"《你不懂JS：类型与文法》-- 第四章：强制转换\")","slug":"js-equal-and-implicitcoercion","published":1,"updated":"2017-10-27T10:42:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oc90012uo2eu72jvd6f","content":"<p>Q: 写一个对象来满足 <code>a == &#39;1&#39;</code>; <code>==</code> 和 <code>===</code> 的区别在哪。（取自百度面试题）</p>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"和-的区别\"><a href=\"#和-的区别\" class=\"headerlink\" title=\"== 和 === 的区别\"></a>== 和 === 的区别</h2><blockquote>\n<p><code>==</code> 允许在等价性比较中进行强制转换，而 <code>===</code> 不允许强制转换。</p>\n</blockquote>\n<p><strong>严格相等运算符 <code>===</code> </strong></p>\n<ul>\n<li>不同类型值相比较  <code>false</code></li>\n<li>同一类的原始类型值（数值、字符串、布尔值）比较，值相等  <code>true</code> / 值不相等  <code>false</code></li>\n<li><p>同一类的复合类型值（对象、数组、函数）比较，不比较它们的值，而是比较它们是否指向同一个对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">m</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123; <span class=\"attr\">m</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\">a === b; <span class=\"comment\">// false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">m</span>: <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a;</span><br><span class=\"line\">a === b; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>undefined</code> 和 <code>null</code> 与自身相等</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">null</span> === <span class=\"literal\">null</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"literal\">undefined</span> === <span class=\"literal\">undefined</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>NaN</code> 永远不等于它自己，<code>+0 / -0 / 0</code> 互相相等</p>\n</li>\n</ul>\n<p><strong>抽象相等运算符 <code>==</code> </strong></p>\n<blockquote>\n<p>比较同类型数据时同 <code>===</code>；不同类型，先将数据进行类型转换，然后再用 <code>===</code> 比较。</p>\n</blockquote>\n<ul>\n<li><p>不同原始类型值（数值、字符串、布尔值）转换成数值类型再比较，字符串和布尔值都会转换成数值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'1'</span> == <span class=\"literal\">true</span>  <span class=\"comment\">// true 同 1 == true</span></span><br><span class=\"line\"><span class=\"string\">'2'</span> == <span class=\"literal\">true</span>  <span class=\"comment\">// false 同 2 == true</span></span><br><span class=\"line\"><span class=\"string\">'a'</span> == <span class=\"literal\">true</span>  <span class=\"comment\">// false 同 a == true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'0'</span> == <span class=\"literal\">false</span> <span class=\"comment\">// true 同 0 == false</span></span><br><span class=\"line\"><span class=\"string\">'2'</span> == <span class=\"literal\">false</span> <span class=\"comment\">// false 同 2 == false</span></span><br><span class=\"line\"><span class=\"string\">'a'</span> == <span class=\"literal\">false</span> <span class=\"comment\">// false 同 a == false</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>undefined</code> 和 <code>null</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">null</span> == <span class=\"literal\">undefined</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>对象与原始类型值比较</p>\n<blockquote>\n<p>先将对象转换成原始类型值（隐式类型转换），再用 <code>===</code> 比较。调用了下面两个方法：<br>定义在 <code>object.prototype</code> 上的：<br><code>valueOf</code> 方法：用来把对象转换成原始类型的值<br><code>toString</code> 方法：将对象表示成文本值或者期望的字符串</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 写一个对象来满足a == '1'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> a = &#123; <span class=\"attr\">toString</span>: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"string\">'1'</span>&#125;;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> a); <span class=\"comment\">// --&gt;object</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a == <span class=\"string\">'1'</span>); <span class=\"comment\">// --&gt;true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> c = <span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">'1'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> c); <span class=\"comment\">// --&gt;object</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c == <span class=\"string\">'1'</span>); <span class=\"comment\">// --&gt;true</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"JavaScript-中应该用-还是-？\"><a href=\"#JavaScript-中应该用-还是-？\" class=\"headerlink\" title=\"JavaScript 中应该用 == 还是 ===？\"></a>JavaScript 中应该用 <code>==</code> 还是 <code>===</code>？</h2><blockquote>\n<p>摘自《你不懂JS》系列：<br>许多开发者认为 === 的行为更加容易预测，所以他们总是主张使用 === 而劝人们远离 ==，我认为这种看法是非常短视的。如果你花点时间来搞清楚它是如何工作的话，== 绝对是一个能够帮助你程序的强大工具。</p>\n</blockquote>\n<blockquote>\n<p>来源知乎：<br> 绝大多数场合应该使用 === ，只有检测 null/undefined 的时候可以使用 x == null ，因为通常我们不区分 null 和 undefined ，即将 x == null 作为 x === null || x === undefined 的缩写。</p>\n</blockquote>\n<p><strong>用 <code>==</code> 副作用</strong></p>\n<ul>\n<li><p>覆写某个对象的 valueOf/toString</p>\n<blockquote>\n<p>== 的隐式类型转换调用了这两个方法，如果在覆盖的方法里写了带有副作用的代码，会带来副作用。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 出现异常</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  valueOf: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  toString: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj == <span class=\"number\">0</span> );</span><br><span class=\"line\"><span class=\"comment\">// Error: Cannot convert object to primitive value (不能将对象转换为原始值)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 刁钻的例子</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">Number</span>.prototype.valueOf = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> i++;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> <span class=\"built_in\">Number</span>(<span class=\"number\">42</span> );</span><br><span class=\"line\"><span class=\"keyword\">if</span> (a == <span class=\"number\">2</span> &amp;&amp; a == <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( <span class=\"string\">\"Yep, this happened.\"</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Yep, this happend.</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>没有类型限制，类型转换的后果将是不可预料的</p>\n<blockquote>\n<p>如果比较的任意一边可能出现 true 或者 false 值，那么就永远，永远不要使用 ==。<br>如果比较的任意一边可能出现 []，””，或 0 这些值，那么认真地考虑不使用 ==。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"\"</span> == <span class=\"number\">0</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">123</span> == <span class=\"string\">\"123\"</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"literal\">false</span> == <span class=\"string\">\" \\t \"</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">0</span> == []; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">\"\"</span> == []; <span class=\"comment\">// true</span></span><br><span class=\"line\">[] == ![]; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>是否对后续代码造成意外的影响</p>\n<blockquote>\n<p>维护他人/自己的代码。当看到 == 时，需要去判断代码意图是需要这么写/随手写的/不应该转型写错了，而且逻辑/语义不清晰，也容易隐藏错误。</p>\n</blockquote>\n<blockquote>\n<p>例子：if (x == 10) x += 5<br>如果传入的x是字符串’10’，x的结果会变成’105’。在后续运算中字符串’105’又可能被转型，从而引入隐蔽的错误。</p>\n</blockquote>\n</li>\n</ul>\n<p><strong> 适合使用的情况 </strong></p>\n<ul>\n<li><p>判断一个字符串看起来是不是空白的（由空白字符组成）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">\"  \"</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> str === <span class=\"string\">\"string\"</span> &amp;&amp; str == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"由空白字符组成\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 由空白字符组成</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>检测 <code>null/undefined</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a == <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">//等同于</span></span><br><span class=\"line\">a === <span class=\"literal\">null</span> || a === <span class=\"literal\">undefined</span>;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"隐式类型转换\"><a href=\"#隐式类型转换\" class=\"headerlink\" title=\"隐式类型转换\"></a>隐式类型转换</h2><blockquote>\n<p>隐式类型转换（自动类型转换）：不需要书写代码，由系统自动完成的类型转换。</p>\n</blockquote>\n<p><strong> 运算中存在的隐式类型转换 </strong></p>\n<ul>\n<li><p><code>+</code> 运算符</p>\n<blockquote>\n<p>当运算符 <code>+</code> 两边一个是数字类型，一个是字符串类型时，js引擎规定进行字符串连接运算而非算术加运算。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">11</span>;</span><br><span class=\"line\">a = a + <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> a)  <span class=\"comment\">// --&gt; string</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>-</code> 运算符: 取负 / 减法运算</p>\n<blockquote>\n<p>与 <code>+</code> 相反，会把字符串隐式的转换成数字再进行算术减法运算。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">11</span>; b = <span class=\"string\">'5'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = a - b;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> c); <span class=\"comment\">// --&gt;number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'11'</span>;</span><br><span class=\"line\">a = a - <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> a); <span class=\"comment\">// --&gt;number</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong> 语句中存在的隐式类型转换 </strong></p>\n<ul>\n<li><p><code>if/while</code></p>\n<blockquote>\n<p>括号内的判断条件转换成 <code>Boolean</code> 类型;</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (a) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (a) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>for in</code></p>\n<blockquote>\n<p>属性名/键值/索引转换成 <code>String</code> 类型。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"number\">1</span>: <span class=\"number\">222</span>, <span class=\"string\">'a'</span>: <span class=\"number\">333</span>&#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> k <span class=\"keyword\">in</span> a) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( k, <span class=\"string\">':'</span>, <span class=\"keyword\">typeof</span> k)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* 1: string</span></span><br><span class=\"line\"><span class=\"comment\">* a: string</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数组的索引也是字符串类型。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> arr) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( i, <span class=\"string\">':'</span>, <span class=\"keyword\">typeof</span> i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* 0: string</span></span><br><span class=\"line\"><span class=\"comment\">* 1: string</span></span><br><span class=\"line\"><span class=\"comment\">* 2: string</span></span><br><span class=\"line\"><span class=\"comment\">* 3: string</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>alert</code></p>\n<blockquote>\n<p>给String原型上添加了个 <code>fn</code> 方法，该方法返回 <code>this</code> ，即当前类的实例对象。<br>  既然是对象那么 <code>typeof a.fn()</code> 自然返回是object了。<br>  关键是最后的 <code>alert(a.fn())</code>，<code>a.fn()</code>返回的是对象，但 <code>alert</code> 却隐式转换成了字符串 <code>hello</code> 显示。同样的情况发生在数字类型上。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">String</span>.prototype.fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'hello'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">alert(<span class=\"keyword\">typeof</span> a.fn()); <span class=\"comment\">// --&gt; object</span></span><br><span class=\"line\">alert(a.fn()); <span class=\"comment\">// --&gt;hello</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.fn()); <span class=\"comment\">// --&gt; String &#123;0: \"h\", 1: \"e\", 2: \"l\", 3: \"l\", 4: \"o\", length: 5, [[PrimitiveValue]]: \"hello\"&#125;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><p><a href=\"https://www.zhihu.com/question/31442029\" title=\"Javascript 中 == 和 === 区别是什么？\" target=\"_blank\" rel=\"noopener\">Javascript 中 == 和 === 区别是什么？</a><br><a href=\"http://www.jianshu.com/p/0f1e3ff14537\" title=\"js隐式转换\" target=\"_blank\" rel=\"noopener\">js隐式转换</a><br><a href=\"https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/types%20%26%20grammar/ch4.md&quot;《你不懂JS：类型与文法》-- 第四章：强制转换&quot;\" target=\"_blank\" rel=\"noopener\">《你不懂JS：类型与文法》– 第四章：强制转换</a></p>\n","site":{"data":{}},"excerpt":"<p>Q: 写一个对象来满足 <code>a == &#39;1&#39;</code>; <code>==</code> 和 <code>===</code> 的区别在哪。（取自百度面试题）</p>","more":"<hr>\n<h2 id=\"和-的区别\"><a href=\"#和-的区别\" class=\"headerlink\" title=\"== 和 === 的区别\"></a>== 和 === 的区别</h2><blockquote>\n<p><code>==</code> 允许在等价性比较中进行强制转换，而 <code>===</code> 不允许强制转换。</p>\n</blockquote>\n<p><strong>严格相等运算符 <code>===</code> </strong></p>\n<ul>\n<li>不同类型值相比较  <code>false</code></li>\n<li>同一类的原始类型值（数值、字符串、布尔值）比较，值相等  <code>true</code> / 值不相等  <code>false</code></li>\n<li><p>同一类的复合类型值（对象、数组、函数）比较，不比较它们的值，而是比较它们是否指向同一个对象</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">m</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123; <span class=\"attr\">m</span>: <span class=\"number\">1</span> &#125;;</span><br><span class=\"line\">a === b; <span class=\"comment\">// false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"attr\">m</span>: <span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = a;</span><br><span class=\"line\">a === b; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>undefined</code> 和 <code>null</code> 与自身相等</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">null</span> === <span class=\"literal\">null</span> <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"literal\">undefined</span> === <span class=\"literal\">undefined</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>NaN</code> 永远不等于它自己，<code>+0 / -0 / 0</code> 互相相等</p>\n</li>\n</ul>\n<p><strong>抽象相等运算符 <code>==</code> </strong></p>\n<blockquote>\n<p>比较同类型数据时同 <code>===</code>；不同类型，先将数据进行类型转换，然后再用 <code>===</code> 比较。</p>\n</blockquote>\n<ul>\n<li><p>不同原始类型值（数值、字符串、布尔值）转换成数值类型再比较，字符串和布尔值都会转换成数值。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'1'</span> == <span class=\"literal\">true</span>  <span class=\"comment\">// true 同 1 == true</span></span><br><span class=\"line\"><span class=\"string\">'2'</span> == <span class=\"literal\">true</span>  <span class=\"comment\">// false 同 2 == true</span></span><br><span class=\"line\"><span class=\"string\">'a'</span> == <span class=\"literal\">true</span>  <span class=\"comment\">// false 同 a == true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'0'</span> == <span class=\"literal\">false</span> <span class=\"comment\">// true 同 0 == false</span></span><br><span class=\"line\"><span class=\"string\">'2'</span> == <span class=\"literal\">false</span> <span class=\"comment\">// false 同 2 == false</span></span><br><span class=\"line\"><span class=\"string\">'a'</span> == <span class=\"literal\">false</span> <span class=\"comment\">// false 同 a == false</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>undefined</code> 和 <code>null</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"literal\">null</span> == <span class=\"literal\">undefined</span> <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>对象与原始类型值比较</p>\n<blockquote>\n<p>先将对象转换成原始类型值（隐式类型转换），再用 <code>===</code> 比较。调用了下面两个方法：<br>定义在 <code>object.prototype</code> 上的：<br><code>valueOf</code> 方法：用来把对象转换成原始类型的值<br><code>toString</code> 方法：将对象表示成文本值或者期望的字符串</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 写一个对象来满足a == '1'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> a = &#123; <span class=\"attr\">toString</span>: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"string\">'1'</span>&#125;;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> a); <span class=\"comment\">// --&gt;object</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a == <span class=\"string\">'1'</span>); <span class=\"comment\">// --&gt;true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> c = <span class=\"keyword\">new</span> <span class=\"built_in\">String</span>(<span class=\"string\">'1'</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> c); <span class=\"comment\">// --&gt;object</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(c == <span class=\"string\">'1'</span>); <span class=\"comment\">// --&gt;true</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"JavaScript-中应该用-还是-？\"><a href=\"#JavaScript-中应该用-还是-？\" class=\"headerlink\" title=\"JavaScript 中应该用 == 还是 ===？\"></a>JavaScript 中应该用 <code>==</code> 还是 <code>===</code>？</h2><blockquote>\n<p>摘自《你不懂JS》系列：<br>许多开发者认为 === 的行为更加容易预测，所以他们总是主张使用 === 而劝人们远离 ==，我认为这种看法是非常短视的。如果你花点时间来搞清楚它是如何工作的话，== 绝对是一个能够帮助你程序的强大工具。</p>\n</blockquote>\n<blockquote>\n<p>来源知乎：<br> 绝大多数场合应该使用 === ，只有检测 null/undefined 的时候可以使用 x == null ，因为通常我们不区分 null 和 undefined ，即将 x == null 作为 x === null || x === undefined 的缩写。</p>\n</blockquote>\n<p><strong>用 <code>==</code> 副作用</strong></p>\n<ul>\n<li><p>覆写某个对象的 valueOf/toString</p>\n<blockquote>\n<p>== 的隐式类型转换调用了这两个方法，如果在覆盖的方法里写了带有副作用的代码，会带来副作用。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 出现异常</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  valueOf: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  toString: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;&#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj == <span class=\"number\">0</span> );</span><br><span class=\"line\"><span class=\"comment\">// Error: Cannot convert object to primitive value (不能将对象转换为原始值)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 刁钻的例子</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"built_in\">Number</span>.prototype.valueOf = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> i++;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> <span class=\"built_in\">Number</span>(<span class=\"number\">42</span> );</span><br><span class=\"line\"><span class=\"keyword\">if</span> (a == <span class=\"number\">2</span> &amp;&amp; a == <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( <span class=\"string\">\"Yep, this happened.\"</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Yep, this happend.</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>没有类型限制，类型转换的后果将是不可预料的</p>\n<blockquote>\n<p>如果比较的任意一边可能出现 true 或者 false 值，那么就永远，永远不要使用 ==。<br>如果比较的任意一边可能出现 []，””，或 0 这些值，那么认真地考虑不使用 ==。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"\"</span> == <span class=\"number\">0</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">123</span> == <span class=\"string\">\"123\"</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"literal\">false</span> == <span class=\"string\">\" \\t \"</span>; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"number\">0</span> == []; <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"string\">\"\"</span> == []; <span class=\"comment\">// true</span></span><br><span class=\"line\">[] == ![]; <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>是否对后续代码造成意外的影响</p>\n<blockquote>\n<p>维护他人/自己的代码。当看到 == 时，需要去判断代码意图是需要这么写/随手写的/不应该转型写错了，而且逻辑/语义不清晰，也容易隐藏错误。</p>\n</blockquote>\n<blockquote>\n<p>例子：if (x == 10) x += 5<br>如果传入的x是字符串’10’，x的结果会变成’105’。在后续运算中字符串’105’又可能被转型，从而引入隐蔽的错误。</p>\n</blockquote>\n</li>\n</ul>\n<p><strong> 适合使用的情况 </strong></p>\n<ul>\n<li><p>判断一个字符串看起来是不是空白的（由空白字符组成）</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> str = <span class=\"string\">\"  \"</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> str === <span class=\"string\">\"string\"</span> &amp;&amp; str == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"由空白字符组成\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 由空白字符组成</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>检测 <code>null/undefined</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a == <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"comment\">//等同于</span></span><br><span class=\"line\">a === <span class=\"literal\">null</span> || a === <span class=\"literal\">undefined</span>;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"隐式类型转换\"><a href=\"#隐式类型转换\" class=\"headerlink\" title=\"隐式类型转换\"></a>隐式类型转换</h2><blockquote>\n<p>隐式类型转换（自动类型转换）：不需要书写代码，由系统自动完成的类型转换。</p>\n</blockquote>\n<p><strong> 运算中存在的隐式类型转换 </strong></p>\n<ul>\n<li><p><code>+</code> 运算符</p>\n<blockquote>\n<p>当运算符 <code>+</code> 两边一个是数字类型，一个是字符串类型时，js引擎规定进行字符串连接运算而非算术加运算。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">11</span>;</span><br><span class=\"line\">a = a + <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> a)  <span class=\"comment\">// --&gt; string</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>-</code> 运算符: 取负 / 减法运算</p>\n<blockquote>\n<p>与 <code>+</code> 相反，会把字符串隐式的转换成数字再进行算术减法运算。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">11</span>; b = <span class=\"string\">'5'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = a - b;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> c); <span class=\"comment\">// --&gt;number</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'11'</span>;</span><br><span class=\"line\">a = a - <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">typeof</span> a); <span class=\"comment\">// --&gt;number</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong> 语句中存在的隐式类型转换 </strong></p>\n<ul>\n<li><p><code>if/while</code></p>\n<blockquote>\n<p>括号内的判断条件转换成 <code>Boolean</code> 类型;</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (a) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (a) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>for in</code></p>\n<blockquote>\n<p>属性名/键值/索引转换成 <code>String</code> 类型。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; <span class=\"number\">1</span>: <span class=\"number\">222</span>, <span class=\"string\">'a'</span>: <span class=\"number\">333</span>&#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> k <span class=\"keyword\">in</span> a) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( k, <span class=\"string\">':'</span>, <span class=\"keyword\">typeof</span> k)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* 1: string</span></span><br><span class=\"line\"><span class=\"comment\">* a: string</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 数组的索引也是字符串类型。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> arr) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log( i, <span class=\"string\">':'</span>, <span class=\"keyword\">typeof</span> i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* 0: string</span></span><br><span class=\"line\"><span class=\"comment\">* 1: string</span></span><br><span class=\"line\"><span class=\"comment\">* 2: string</span></span><br><span class=\"line\"><span class=\"comment\">* 3: string</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>alert</code></p>\n<blockquote>\n<p>给String原型上添加了个 <code>fn</code> 方法，该方法返回 <code>this</code> ，即当前类的实例对象。<br>  既然是对象那么 <code>typeof a.fn()</code> 自然返回是object了。<br>  关键是最后的 <code>alert(a.fn())</code>，<code>a.fn()</code>返回的是对象，但 <code>alert</code> 却隐式转换成了字符串 <code>hello</code> 显示。同样的情况发生在数字类型上。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">String</span>.prototype.fn = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'hello'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">alert(<span class=\"keyword\">typeof</span> a.fn()); <span class=\"comment\">// --&gt; object</span></span><br><span class=\"line\">alert(a.fn()); <span class=\"comment\">// --&gt;hello</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.fn()); <span class=\"comment\">// --&gt; String &#123;0: \"h\", 1: \"e\", 2: \"l\", 3: \"l\", 4: \"o\", length: 5, [[PrimitiveValue]]: \"hello\"&#125;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><p><a href=\"https://www.zhihu.com/question/31442029\" title=\"Javascript 中 == 和 === 区别是什么？\" target=\"_blank\" rel=\"noopener\">Javascript 中 == 和 === 区别是什么？</a><br><a href=\"http://www.jianshu.com/p/0f1e3ff14537\" title=\"js隐式转换\" target=\"_blank\" rel=\"noopener\">js隐式转换</a><br><a href=\"https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/types%20%26%20grammar/ch4.md&quot;《你不懂JS：类型与文法》-- 第四章：强制转换&quot;\" target=\"_blank\" rel=\"noopener\">《你不懂JS：类型与文法》– 第四章：强制转换</a></p>"},{"title":"Error type","date":"2017-11-30T16:00:00.000Z","_content":"\n在我们实际开发过程中避免不了会遇到JS的错误，为此今天分享一下在我们开发出错时JS会抛出哪些错误信息让我们可以快速定位错误\n\n<!-- more -->\n\n开发中执行代码期间可能会发生的错误有多种类型.每种错误都有对应的错误类型，当代码解析或运行时发生错误，javascript引擎就会自动产生并抛出一个error对象的实例，然后整个程序就中断在发生错误的地方.\n\n\n### Error 语法\n\n```js\n  new Error([meSSage[, fileName[,lineNumber]]])\n```\n\n### Error 参数\n\n- message 可阅读的错误描述信息\n- filename 创建Error对象的fileName属性的值.默认是包含异常代码的文件名\n- lineNumbe r创建Error对象的lineNumber属性的值.默认是构造Error对象的行数\n\n相关Error方法及属性可在下面的参考资料中查询\n\n### Error 错误类型\nError对象是原始错误类型，在它的基础上，派生了以下6种标准错误\n\n## SyntaxError  语法错误\n\n当Javascript语言解析代码时,Javascript引擎发现了不符合语法规范的tokens或token顺序时抛出SyntaxError.可能是丢失运算符或者转义字符等\n\n例如:\n\n```js\n  var a = [;] //Unexpected end of input\n  var a = 1 + //Unexpected token;\n  var a = 213132；//Uncaught SyntaxError: Invalid or unexpected token\n  console.log(\"PI: \" Math.PI); //Uncaught SyntaxError: missing ) after argument list\n  var a='sd; //Uncaught SyntaxError: Invalid or unexpected token\n```\nUncaught SyntaxError: missing ) after argument list\n没有使用 ”+“ 操作符来连接字符串，JavaScript 认为 log 函数的参数的值只是 “PI: ”，在这种情况下，它应该用一个右括号作为结束.\n\nUnexpected token;\n意外符号\n\nUnexpected end of input\n意外的终止输入, 解析代码时，碰到不可预知的错误\n\nUncaught SyntaxError: Invalid or unexpected token\n无效的意外符号\n\nUncaught SyntaxError: Invalid or unexpected token \n一个字符串字面量少了结尾的引号 \n\n## ReferenceError 引用错误\n\n当你尝试引用一个未被定义的变量时，将会抛出一个 ReferenceError引用错误 .\n\n例如:\n\n```js\n  function doSomething(){};\n  if(doSomething() = 'somevalue'){}; //Uncaught ReferenceError: Invalid left-hand side in assignment\n\n  console.log(a);  //Uncaught ReferenceError: a is not defined\n```\nUncaught ReferenceError: Invalid left-hand side in assignment\n左手边包含不能赋值的东西 \n\nUncaught ReferenceError: a is not defined\na 未定义\n\n## TypeError 类型错误\n\n对象用来表示值的类型非预期类型时发生的错误，即执行特定于类型的操作时，变量的类型并不符合所预期的类型\n\n例如:\n\n```js\n  var foo = undefined;\n  foo();  //Uncaught TypeError: foo is not a function\n  var x = document.getElementByID('foo'); //Uncaught TypeError: document.getElementByID is not a function\n\n  var a = { };\n  var b = { a: a };\n  a.b = b;\n  JSON.stringify(a); //Uncaught TypeError: Converting circular structure to JSON\n```\nUncaught TypeError: foo is not a function\n当尝试调用一个像方法的值，这个值并不是一个方法\n\nUncaught TypeError: Converting circular structure to JSON\n把循环引用的对象，传给 JSON.stringify 会引起错误.\n\n\n## RangeError 范围错误\n\n当传递一个不合法的length值作为Array 构造器的参数创建数组，或者传递错误值到数值计算方法（Number.toExponential()，Number.toFixed() ，Number.toPrecision()），会出现RangeError.\n\n例如:\n\n```js\n  var items1 = new Array(-20); //Uncaught RangeError: Invalid array length\n\n  (function a(){a();})() \n  //Uncaught RangeError: Maximum call stack size exceeded\n  //InternalError: too much recursion\n```\nUncaught RangeError: Invalid array length\n当传递一个不合法的length值作为Array 构造器的参数创建数组 ，则会抛出错误 无效的数组长度\n\nUncaught RangeError: Maximum call stack size exceeded\n函数的无限递归调用引起 ，则会抛出错误 超过最大调用堆栈大小\n\nInternalError: too much recursion\n内部错误：递归过深\n\n*InternalError 对象表示出现在JavaScript引擎内部的错误,该特性是非标准的\n\n\n## URIError 统一资源标识符函数错误\n\nURIError是URI相关函数的参数不正确时抛出的错误，主要涉及encodeURI()、decodeURI()、encodeURIComponent()、decodeURIComponent()、escape()和unescape()这六个函数.\n\n例如:\n\n```js\n  decodeURI('%')//URI格式不正确 //Uncaught URIError: URI malformed\n```\nUncaught URIError: URI malformed\nURI格式不正确\n\n##  EvalError eval错误\n使用 eval() 函数而发生异常时被抛出 ，该错误类型已经在ES5中不使用了，只是为了保证与以前代码兼容，才继续保留\n\n\n## 如何捕捉错误的类型\n使用try-catch语句来捕获错误\n\n```js\ntry{\n  t;\n}catch(ex){\n  console.log(ex.message);//t is not defined \n  console.log(ex.name);//ReferenceError\n}\n```\n## 如何创建自定义错误\n\nthrow 语句允许我们创建自定义错误\n\n```html \n  <h1>My First JavaScript</h1>\n  <p>Please input a number between 5 and 10:</p>\n  <input id=\"demo\" type=\"text\">\n  <button type=\"button\" onclick=\"myFunction()\">Test Input</button>\n  <p id=\"mess\"></p>\n```\n\n```js\n  function myFunction(){\n    try{\n      var x=document.getElementById(\"demo\").value;\n      if(x==\"\")    throw \"empty\";\n      if(isNaN(x)) throw \"not a number\";\n      if(x>10)     throw \"too high\";\n      if(x<5)      throw \"too low\";\n    }catch(err){\n      var y=document.getElementById(\"mess\");\n      y.innerHTML=\"Error: \" + err + \".\";\n    }\n  }\n```\n\n## 参考资料及拓展阅读\n\n[Error 对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)\n[JS常见异常类型以及捕获异常](http://blog.csdn.net/alex8046/article/details/46707833)\n","source":"_posts/js-error-type.md","raw":"---\ntitle: Error type\ndate: 2017-12-01\ntags:\n - javascript\n---\n\n在我们实际开发过程中避免不了会遇到JS的错误，为此今天分享一下在我们开发出错时JS会抛出哪些错误信息让我们可以快速定位错误\n\n<!-- more -->\n\n开发中执行代码期间可能会发生的错误有多种类型.每种错误都有对应的错误类型，当代码解析或运行时发生错误，javascript引擎就会自动产生并抛出一个error对象的实例，然后整个程序就中断在发生错误的地方.\n\n\n### Error 语法\n\n```js\n  new Error([meSSage[, fileName[,lineNumber]]])\n```\n\n### Error 参数\n\n- message 可阅读的错误描述信息\n- filename 创建Error对象的fileName属性的值.默认是包含异常代码的文件名\n- lineNumbe r创建Error对象的lineNumber属性的值.默认是构造Error对象的行数\n\n相关Error方法及属性可在下面的参考资料中查询\n\n### Error 错误类型\nError对象是原始错误类型，在它的基础上，派生了以下6种标准错误\n\n## SyntaxError  语法错误\n\n当Javascript语言解析代码时,Javascript引擎发现了不符合语法规范的tokens或token顺序时抛出SyntaxError.可能是丢失运算符或者转义字符等\n\n例如:\n\n```js\n  var a = [;] //Unexpected end of input\n  var a = 1 + //Unexpected token;\n  var a = 213132；//Uncaught SyntaxError: Invalid or unexpected token\n  console.log(\"PI: \" Math.PI); //Uncaught SyntaxError: missing ) after argument list\n  var a='sd; //Uncaught SyntaxError: Invalid or unexpected token\n```\nUncaught SyntaxError: missing ) after argument list\n没有使用 ”+“ 操作符来连接字符串，JavaScript 认为 log 函数的参数的值只是 “PI: ”，在这种情况下，它应该用一个右括号作为结束.\n\nUnexpected token;\n意外符号\n\nUnexpected end of input\n意外的终止输入, 解析代码时，碰到不可预知的错误\n\nUncaught SyntaxError: Invalid or unexpected token\n无效的意外符号\n\nUncaught SyntaxError: Invalid or unexpected token \n一个字符串字面量少了结尾的引号 \n\n## ReferenceError 引用错误\n\n当你尝试引用一个未被定义的变量时，将会抛出一个 ReferenceError引用错误 .\n\n例如:\n\n```js\n  function doSomething(){};\n  if(doSomething() = 'somevalue'){}; //Uncaught ReferenceError: Invalid left-hand side in assignment\n\n  console.log(a);  //Uncaught ReferenceError: a is not defined\n```\nUncaught ReferenceError: Invalid left-hand side in assignment\n左手边包含不能赋值的东西 \n\nUncaught ReferenceError: a is not defined\na 未定义\n\n## TypeError 类型错误\n\n对象用来表示值的类型非预期类型时发生的错误，即执行特定于类型的操作时，变量的类型并不符合所预期的类型\n\n例如:\n\n```js\n  var foo = undefined;\n  foo();  //Uncaught TypeError: foo is not a function\n  var x = document.getElementByID('foo'); //Uncaught TypeError: document.getElementByID is not a function\n\n  var a = { };\n  var b = { a: a };\n  a.b = b;\n  JSON.stringify(a); //Uncaught TypeError: Converting circular structure to JSON\n```\nUncaught TypeError: foo is not a function\n当尝试调用一个像方法的值，这个值并不是一个方法\n\nUncaught TypeError: Converting circular structure to JSON\n把循环引用的对象，传给 JSON.stringify 会引起错误.\n\n\n## RangeError 范围错误\n\n当传递一个不合法的length值作为Array 构造器的参数创建数组，或者传递错误值到数值计算方法（Number.toExponential()，Number.toFixed() ，Number.toPrecision()），会出现RangeError.\n\n例如:\n\n```js\n  var items1 = new Array(-20); //Uncaught RangeError: Invalid array length\n\n  (function a(){a();})() \n  //Uncaught RangeError: Maximum call stack size exceeded\n  //InternalError: too much recursion\n```\nUncaught RangeError: Invalid array length\n当传递一个不合法的length值作为Array 构造器的参数创建数组 ，则会抛出错误 无效的数组长度\n\nUncaught RangeError: Maximum call stack size exceeded\n函数的无限递归调用引起 ，则会抛出错误 超过最大调用堆栈大小\n\nInternalError: too much recursion\n内部错误：递归过深\n\n*InternalError 对象表示出现在JavaScript引擎内部的错误,该特性是非标准的\n\n\n## URIError 统一资源标识符函数错误\n\nURIError是URI相关函数的参数不正确时抛出的错误，主要涉及encodeURI()、decodeURI()、encodeURIComponent()、decodeURIComponent()、escape()和unescape()这六个函数.\n\n例如:\n\n```js\n  decodeURI('%')//URI格式不正确 //Uncaught URIError: URI malformed\n```\nUncaught URIError: URI malformed\nURI格式不正确\n\n##  EvalError eval错误\n使用 eval() 函数而发生异常时被抛出 ，该错误类型已经在ES5中不使用了，只是为了保证与以前代码兼容，才继续保留\n\n\n## 如何捕捉错误的类型\n使用try-catch语句来捕获错误\n\n```js\ntry{\n  t;\n}catch(ex){\n  console.log(ex.message);//t is not defined \n  console.log(ex.name);//ReferenceError\n}\n```\n## 如何创建自定义错误\n\nthrow 语句允许我们创建自定义错误\n\n```html \n  <h1>My First JavaScript</h1>\n  <p>Please input a number between 5 and 10:</p>\n  <input id=\"demo\" type=\"text\">\n  <button type=\"button\" onclick=\"myFunction()\">Test Input</button>\n  <p id=\"mess\"></p>\n```\n\n```js\n  function myFunction(){\n    try{\n      var x=document.getElementById(\"demo\").value;\n      if(x==\"\")    throw \"empty\";\n      if(isNaN(x)) throw \"not a number\";\n      if(x>10)     throw \"too high\";\n      if(x<5)      throw \"too low\";\n    }catch(err){\n      var y=document.getElementById(\"mess\");\n      y.innerHTML=\"Error: \" + err + \".\";\n    }\n  }\n```\n\n## 参考资料及拓展阅读\n\n[Error 对象](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error)\n[JS常见异常类型以及捕获异常](http://blog.csdn.net/alex8046/article/details/46707833)\n","slug":"js-error-type","published":1,"updated":"2017-12-01T07:50:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ock0015uo2edjvdpww0","content":"<p>在我们实际开发过程中避免不了会遇到JS的错误，为此今天分享一下在我们开发出错时JS会抛出哪些错误信息让我们可以快速定位错误</p>\n<a id=\"more\"></a>\n<p>开发中执行代码期间可能会发生的错误有多种类型.每种错误都有对应的错误类型，当代码解析或运行时发生错误，javascript引擎就会自动产生并抛出一个error对象的实例，然后整个程序就中断在发生错误的地方.</p>\n<h3 id=\"Error-语法\"><a href=\"#Error-语法\" class=\"headerlink\" title=\"Error 语法\"></a>Error 语法</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>([meSSage[, fileName[,lineNumber]]])</span><br></pre></td></tr></table></figure>\n<h3 id=\"Error-参数\"><a href=\"#Error-参数\" class=\"headerlink\" title=\"Error 参数\"></a>Error 参数</h3><ul>\n<li>message 可阅读的错误描述信息</li>\n<li>filename 创建Error对象的fileName属性的值.默认是包含异常代码的文件名</li>\n<li>lineNumbe r创建Error对象的lineNumber属性的值.默认是构造Error对象的行数</li>\n</ul>\n<p>相关Error方法及属性可在下面的参考资料中查询</p>\n<h3 id=\"Error-错误类型\"><a href=\"#Error-错误类型\" class=\"headerlink\" title=\"Error 错误类型\"></a>Error 错误类型</h3><p>Error对象是原始错误类型，在它的基础上，派生了以下6种标准错误</p>\n<h2 id=\"SyntaxError-语法错误\"><a href=\"#SyntaxError-语法错误\" class=\"headerlink\" title=\"SyntaxError  语法错误\"></a>SyntaxError  语法错误</h2><p>当Javascript语言解析代码时,Javascript引擎发现了不符合语法规范的tokens或token顺序时抛出SyntaxError.可能是丢失运算符或者转义字符等</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [;] <span class=\"comment\">//Unexpected end of input</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span> + <span class=\"comment\">//Unexpected token;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">213132</span>；<span class=\"comment\">//Uncaught SyntaxError: Invalid or unexpected token</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"PI: \"</span> <span class=\"built_in\">Math</span>.PI); <span class=\"comment\">//Uncaught SyntaxError: missing ) after argument list</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a=<span class=\"string\">'sd; //Uncaught SyntaxError: Invalid or unexpected token</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught SyntaxError: missing ) after argument list<br>没有使用 ”+“ 操作符来连接字符串，JavaScript 认为 log 函数的参数的值只是 “PI: ”，在这种情况下，它应该用一个右括号作为结束.</p>\n<p>Unexpected token;<br>意外符号</p>\n<p>Unexpected end of input<br>意外的终止输入, 解析代码时，碰到不可预知的错误</p>\n<p>Uncaught SyntaxError: Invalid or unexpected token<br>无效的意外符号</p>\n<p>Uncaught SyntaxError: Invalid or unexpected token<br>一个字符串字面量少了结尾的引号 </p>\n<h2 id=\"ReferenceError-引用错误\"><a href=\"#ReferenceError-引用错误\" class=\"headerlink\" title=\"ReferenceError 引用错误\"></a>ReferenceError 引用错误</h2><p>当你尝试引用一个未被定义的变量时，将会抛出一个 ReferenceError引用错误 .</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(doSomething() = <span class=\"string\">'somevalue'</span>)&#123;&#125;; <span class=\"comment\">//Uncaught ReferenceError: Invalid left-hand side in assignment</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);  <span class=\"comment\">//Uncaught ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught ReferenceError: Invalid left-hand side in assignment<br>左手边包含不能赋值的东西 </p>\n<p>Uncaught ReferenceError: a is not defined<br>a 未定义</p>\n<h2 id=\"TypeError-类型错误\"><a href=\"#TypeError-类型错误\" class=\"headerlink\" title=\"TypeError 类型错误\"></a>TypeError 类型错误</h2><p>对象用来表示值的类型非预期类型时发生的错误，即执行特定于类型的操作时，变量的类型并不符合所预期的类型</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">foo();  <span class=\"comment\">//Uncaught TypeError: foo is not a function</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"built_in\">document</span>.getElementByID(<span class=\"string\">'foo'</span>); <span class=\"comment\">//Uncaught TypeError: document.getElementByID is not a function</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123; <span class=\"attr\">a</span>: a &#125;;</span><br><span class=\"line\">a.b = b;</span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(a); <span class=\"comment\">//Uncaught TypeError: Converting circular structure to JSON</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught TypeError: foo is not a function<br>当尝试调用一个像方法的值，这个值并不是一个方法</p>\n<p>Uncaught TypeError: Converting circular structure to JSON<br>把循环引用的对象，传给 JSON.stringify 会引起错误.</p>\n<h2 id=\"RangeError-范围错误\"><a href=\"#RangeError-范围错误\" class=\"headerlink\" title=\"RangeError 范围错误\"></a>RangeError 范围错误</h2><p>当传递一个不合法的length值作为Array 构造器的参数创建数组，或者传递错误值到数值计算方法（Number.toExponential()，Number.toFixed() ，Number.toPrecision()），会出现RangeError.</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> items1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">-20</span>); <span class=\"comment\">//Uncaught RangeError: Invalid array length</span></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>)</span>&#123;a();&#125;)() </span><br><span class=\"line\"><span class=\"comment\">//Uncaught RangeError: Maximum call stack size exceeded</span></span><br><span class=\"line\"><span class=\"comment\">//InternalError: too much recursion</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught RangeError: Invalid array length<br>当传递一个不合法的length值作为Array 构造器的参数创建数组 ，则会抛出错误 无效的数组长度</p>\n<p>Uncaught RangeError: Maximum call stack size exceeded<br>函数的无限递归调用引起 ，则会抛出错误 超过最大调用堆栈大小</p>\n<p>InternalError: too much recursion<br>内部错误：递归过深</p>\n<p>*InternalError 对象表示出现在JavaScript引擎内部的错误,该特性是非标准的</p>\n<h2 id=\"URIError-统一资源标识符函数错误\"><a href=\"#URIError-统一资源标识符函数错误\" class=\"headerlink\" title=\"URIError 统一资源标识符函数错误\"></a>URIError 统一资源标识符函数错误</h2><p>URIError是URI相关函数的参数不正确时抛出的错误，主要涉及encodeURI()、decodeURI()、encodeURIComponent()、decodeURIComponent()、escape()和unescape()这六个函数.</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">decodeURI</span>(<span class=\"string\">'%'</span>)<span class=\"comment\">//URI格式不正确 //Uncaught URIError: URI malformed</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught URIError: URI malformed<br>URI格式不正确</p>\n<h2 id=\"EvalError-eval错误\"><a href=\"#EvalError-eval错误\" class=\"headerlink\" title=\"EvalError eval错误\"></a>EvalError eval错误</h2><p>使用 eval() 函数而发生异常时被抛出 ，该错误类型已经在ES5中不使用了，只是为了保证与以前代码兼容，才继续保留</p>\n<h2 id=\"如何捕捉错误的类型\"><a href=\"#如何捕捉错误的类型\" class=\"headerlink\" title=\"如何捕捉错误的类型\"></a>如何捕捉错误的类型</h2><p>使用try-catch语句来捕获错误</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">  t;</span><br><span class=\"line\">&#125;<span class=\"keyword\">catch</span>(ex)&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(ex.message);<span class=\"comment\">//t is not defined </span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(ex.name);<span class=\"comment\">//ReferenceError</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"如何创建自定义错误\"><a href=\"#如何创建自定义错误\" class=\"headerlink\" title=\"如何创建自定义错误\"></a>如何创建自定义错误</h2><p>throw 语句允许我们创建自定义错误</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>My First JavaScript<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Please input a number between 5 and 10:<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"demo\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"myFunction()\"</span>&gt;</span>Test Input<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mess\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> x=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"demo\"</span>).value;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x==<span class=\"string\">\"\"</span>)    <span class=\"keyword\">throw</span> <span class=\"string\">\"empty\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">isNaN</span>(x)) <span class=\"keyword\">throw</span> <span class=\"string\">\"not a number\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&gt;<span class=\"number\">10</span>)     <span class=\"keyword\">throw</span> <span class=\"string\">\"too high\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&lt;<span class=\"number\">5</span>)      <span class=\"keyword\">throw</span> <span class=\"string\">\"too low\"</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">catch</span>(err)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"mess\"</span>);</span><br><span class=\"line\">    y.innerHTML=<span class=\"string\">\"Error: \"</span> + err + <span class=\"string\">\".\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考资料及拓展阅读\"><a href=\"#参考资料及拓展阅读\" class=\"headerlink\" title=\"参考资料及拓展阅读\"></a>参考资料及拓展阅读</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error\" target=\"_blank\" rel=\"noopener\">Error 对象</a><br><a href=\"http://blog.csdn.net/alex8046/article/details/46707833\" target=\"_blank\" rel=\"noopener\">JS常见异常类型以及捕获异常</a></p>\n","site":{"data":{}},"excerpt":"<p>在我们实际开发过程中避免不了会遇到JS的错误，为此今天分享一下在我们开发出错时JS会抛出哪些错误信息让我们可以快速定位错误</p>","more":"<p>开发中执行代码期间可能会发生的错误有多种类型.每种错误都有对应的错误类型，当代码解析或运行时发生错误，javascript引擎就会自动产生并抛出一个error对象的实例，然后整个程序就中断在发生错误的地方.</p>\n<h3 id=\"Error-语法\"><a href=\"#Error-语法\" class=\"headerlink\" title=\"Error 语法\"></a>Error 语法</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>([meSSage[, fileName[,lineNumber]]])</span><br></pre></td></tr></table></figure>\n<h3 id=\"Error-参数\"><a href=\"#Error-参数\" class=\"headerlink\" title=\"Error 参数\"></a>Error 参数</h3><ul>\n<li>message 可阅读的错误描述信息</li>\n<li>filename 创建Error对象的fileName属性的值.默认是包含异常代码的文件名</li>\n<li>lineNumbe r创建Error对象的lineNumber属性的值.默认是构造Error对象的行数</li>\n</ul>\n<p>相关Error方法及属性可在下面的参考资料中查询</p>\n<h3 id=\"Error-错误类型\"><a href=\"#Error-错误类型\" class=\"headerlink\" title=\"Error 错误类型\"></a>Error 错误类型</h3><p>Error对象是原始错误类型，在它的基础上，派生了以下6种标准错误</p>\n<h2 id=\"SyntaxError-语法错误\"><a href=\"#SyntaxError-语法错误\" class=\"headerlink\" title=\"SyntaxError  语法错误\"></a>SyntaxError  语法错误</h2><p>当Javascript语言解析代码时,Javascript引擎发现了不符合语法规范的tokens或token顺序时抛出SyntaxError.可能是丢失运算符或者转义字符等</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [;] <span class=\"comment\">//Unexpected end of input</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span> + <span class=\"comment\">//Unexpected token;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">213132</span>；<span class=\"comment\">//Uncaught SyntaxError: Invalid or unexpected token</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"PI: \"</span> <span class=\"built_in\">Math</span>.PI); <span class=\"comment\">//Uncaught SyntaxError: missing ) after argument list</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a=<span class=\"string\">'sd; //Uncaught SyntaxError: Invalid or unexpected token</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught SyntaxError: missing ) after argument list<br>没有使用 ”+“ 操作符来连接字符串，JavaScript 认为 log 函数的参数的值只是 “PI: ”，在这种情况下，它应该用一个右括号作为结束.</p>\n<p>Unexpected token;<br>意外符号</p>\n<p>Unexpected end of input<br>意外的终止输入, 解析代码时，碰到不可预知的错误</p>\n<p>Uncaught SyntaxError: Invalid or unexpected token<br>无效的意外符号</p>\n<p>Uncaught SyntaxError: Invalid or unexpected token<br>一个字符串字面量少了结尾的引号 </p>\n<h2 id=\"ReferenceError-引用错误\"><a href=\"#ReferenceError-引用错误\" class=\"headerlink\" title=\"ReferenceError 引用错误\"></a>ReferenceError 引用错误</h2><p>当你尝试引用一个未被定义的变量时，将会抛出一个 ReferenceError引用错误 .</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSomething</span>(<span class=\"params\"></span>)</span>&#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(doSomething() = <span class=\"string\">'somevalue'</span>)&#123;&#125;; <span class=\"comment\">//Uncaught ReferenceError: Invalid left-hand side in assignment</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);  <span class=\"comment\">//Uncaught ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught ReferenceError: Invalid left-hand side in assignment<br>左手边包含不能赋值的东西 </p>\n<p>Uncaught ReferenceError: a is not defined<br>a 未定义</p>\n<h2 id=\"TypeError-类型错误\"><a href=\"#TypeError-类型错误\" class=\"headerlink\" title=\"TypeError 类型错误\"></a>TypeError 类型错误</h2><p>对象用来表示值的类型非预期类型时发生的错误，即执行特定于类型的操作时，变量的类型并不符合所预期的类型</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> foo = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">foo();  <span class=\"comment\">//Uncaught TypeError: foo is not a function</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> x = <span class=\"built_in\">document</span>.getElementByID(<span class=\"string\">'foo'</span>); <span class=\"comment\">//Uncaught TypeError: document.getElementByID is not a function</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123; &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123; <span class=\"attr\">a</span>: a &#125;;</span><br><span class=\"line\">a.b = b;</span><br><span class=\"line\"><span class=\"built_in\">JSON</span>.stringify(a); <span class=\"comment\">//Uncaught TypeError: Converting circular structure to JSON</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught TypeError: foo is not a function<br>当尝试调用一个像方法的值，这个值并不是一个方法</p>\n<p>Uncaught TypeError: Converting circular structure to JSON<br>把循环引用的对象，传给 JSON.stringify 会引起错误.</p>\n<h2 id=\"RangeError-范围错误\"><a href=\"#RangeError-范围错误\" class=\"headerlink\" title=\"RangeError 范围错误\"></a>RangeError 范围错误</h2><p>当传递一个不合法的length值作为Array 构造器的参数创建数组，或者传递错误值到数值计算方法（Number.toExponential()，Number.toFixed() ，Number.toPrecision()），会出现RangeError.</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> items1 = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">-20</span>); <span class=\"comment\">//Uncaught RangeError: Invalid array length</span></span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>)</span>&#123;a();&#125;)() </span><br><span class=\"line\"><span class=\"comment\">//Uncaught RangeError: Maximum call stack size exceeded</span></span><br><span class=\"line\"><span class=\"comment\">//InternalError: too much recursion</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught RangeError: Invalid array length<br>当传递一个不合法的length值作为Array 构造器的参数创建数组 ，则会抛出错误 无效的数组长度</p>\n<p>Uncaught RangeError: Maximum call stack size exceeded<br>函数的无限递归调用引起 ，则会抛出错误 超过最大调用堆栈大小</p>\n<p>InternalError: too much recursion<br>内部错误：递归过深</p>\n<p>*InternalError 对象表示出现在JavaScript引擎内部的错误,该特性是非标准的</p>\n<h2 id=\"URIError-统一资源标识符函数错误\"><a href=\"#URIError-统一资源标识符函数错误\" class=\"headerlink\" title=\"URIError 统一资源标识符函数错误\"></a>URIError 统一资源标识符函数错误</h2><p>URIError是URI相关函数的参数不正确时抛出的错误，主要涉及encodeURI()、decodeURI()、encodeURIComponent()、decodeURIComponent()、escape()和unescape()这六个函数.</p>\n<p>例如:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">decodeURI</span>(<span class=\"string\">'%'</span>)<span class=\"comment\">//URI格式不正确 //Uncaught URIError: URI malformed</span></span><br></pre></td></tr></table></figure>\n<p>Uncaught URIError: URI malformed<br>URI格式不正确</p>\n<h2 id=\"EvalError-eval错误\"><a href=\"#EvalError-eval错误\" class=\"headerlink\" title=\"EvalError eval错误\"></a>EvalError eval错误</h2><p>使用 eval() 函数而发生异常时被抛出 ，该错误类型已经在ES5中不使用了，只是为了保证与以前代码兼容，才继续保留</p>\n<h2 id=\"如何捕捉错误的类型\"><a href=\"#如何捕捉错误的类型\" class=\"headerlink\" title=\"如何捕捉错误的类型\"></a>如何捕捉错误的类型</h2><p>使用try-catch语句来捕获错误</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">  t;</span><br><span class=\"line\">&#125;<span class=\"keyword\">catch</span>(ex)&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(ex.message);<span class=\"comment\">//t is not defined </span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(ex.name);<span class=\"comment\">//ReferenceError</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"如何创建自定义错误\"><a href=\"#如何创建自定义错误\" class=\"headerlink\" title=\"如何创建自定义错误\"></a>如何创建自定义错误</h2><p>throw 语句允许我们创建自定义错误</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>My First JavaScript<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Please input a number between 5 and 10:<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"demo\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"myFunction()\"</span>&gt;</span>Test Input<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mess\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> x=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"demo\"</span>).value;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x==<span class=\"string\">\"\"</span>)    <span class=\"keyword\">throw</span> <span class=\"string\">\"empty\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">isNaN</span>(x)) <span class=\"keyword\">throw</span> <span class=\"string\">\"not a number\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&gt;<span class=\"number\">10</span>)     <span class=\"keyword\">throw</span> <span class=\"string\">\"too high\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(x&lt;<span class=\"number\">5</span>)      <span class=\"keyword\">throw</span> <span class=\"string\">\"too low\"</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">catch</span>(err)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> y=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"mess\"</span>);</span><br><span class=\"line\">    y.innerHTML=<span class=\"string\">\"Error: \"</span> + err + <span class=\"string\">\".\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考资料及拓展阅读\"><a href=\"#参考资料及拓展阅读\" class=\"headerlink\" title=\"参考资料及拓展阅读\"></a>参考资料及拓展阅读</h2><p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error\" target=\"_blank\" rel=\"noopener\">Error 对象</a><br><a href=\"http://blog.csdn.net/alex8046/article/details/46707833\" target=\"_blank\" rel=\"noopener\">JS常见异常类型以及捕获异常</a></p>"},{"title":"模块 与 requirejs","date":"2017-09-14T09:43:17.000Z","_content":"\n### 模块\n\n  模块是一种将系统分离成独立功能部分的方法，严格定义模块接口、模块间具有透明性,对外导出一些公用API，比如函数，类，属性，方法\n\n<!--more-->\n\n  ![module-and-requirejs](/img/module-and-requirejs/img.jpg)\n\n\n## 模块的特性\n\n  * 可维护性 灵活架构，焦点分离 方便模块间组合、分解 ，单个模块功能调试、升级 ，多人协作互不干扰 \n  * 命名空间 通过命名空间，能极大缓解命名冲突，避免命名空间污染\n  * 可复用性 更高效的满足更多的个性化需求\n\n## 模块的模式\n\n  模块模式一般用来模拟类的概念,把公有和私有方法还有变量存储在一个对象中,在公开调用API的同时，仍然在一个闭包范围内封装私有变量和方法。\n\n  模块模式常见形式如下\n    1. 匿名闭包函数\n    2. 全局引入\n    3. 模块出口\n    4. 高级模式\n    5. 扩充\n    6. 松耦合扩充\n    7. 紧耦合扩充\n    8. 克隆和继承\n    9. 跨文件私有状态\n  现在，通行的Javascript模块规范主要有两种：CommonJS和AMD。\n\n  * commonjs  是服务器端模块的规范，同步加载，因为在服务器读取模块都是在本地磁盘，加载速度很快，如果是在客户端（浏览器），同步加载模块的时候有可能会出现“假死”状况，NodeJS应用了这个规范\n\n  * AMD 即 (Asynchronous Module Definition)，它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行，requireJs应用了这个规范.\n\n  ![module-and-requirejs](/img/module-and-requirejs/AMD.png)\n\n ### requireJs\n\n  RequireJS是一个工具库，主要用于客户端的模块管理。它可以让客户端的代码分成一个个模块，实现异步或动态加载，按需、并行、延时载入js库，避免网页失去响应，从而提高代码的性能和可维护性。\n\n ## requireJs 配置\n    * config\n      常见配置\n      -baseUrl 所有模块的查找根路径\n      -paths 指定各个模块的加载路径\n      -shim 为那些没有使用define()来声明依赖关系、设置模块的\"浏览器全局变量注入\"型脚本做依赖和导出配置。 兼容不符合AMD规范的模块加载  \n\n      [查看更多配置项](https://segmentfault.com/a/1190000002403806);\n   \n ## requireJs 引用\n\n  data-main 属性是requireJS的入口文件路径\n\n  ``` html\n  <script data-main=\"js/main\" src=\"./js/require.js\" type=\"text/javascript\"></script> \n  ```\n ## define 定义模块\n  1.独立模块\n    ``` javascript\n      define(function () {\n          return {\n              method1: function() {},\n              method2: function() {},\n          };\n      });\n    ```\n  2.非独立模块\n    ``` javascript\n      define(['module1', 'module2'], function(m1, m2) {\n          return {\n              method: function() {\n                  m1.methodA();\n                  m2.methodB();\n              }\n          };\n      });\n\n    ```\n  ## require 模块加载及使用\n\n    * 模块加载的相对路径的规则:\n      1.没有指定data-main属性时，以该JS文件所在路径为根路径\n      2.有指定 data-main 属性时，则以data-main属性引入的所在路径为根路径\n      3.如有配置config中的baseUrl属性，则以baseUrl为根路径\n\n    * 使用\n    ``` javascript\n      requirejs(['a','b'], function(a,b) {\n       var module = {\n         module1 : function(){\n\n         },\n         module2 : {\n\n         }\n       }\n        return module;\n      });\n\n    ```\n     ![module-and-requirejs](/img/module-and-requirejs/load.png)\n**********************************************************\n**** END ****\n\n\n**********************************************************\n\n### 参考文档\n\n[模块模式](https://www.oschina.net/translate/javascript-module-pattern-in-depth);\n[requirejs](http://requirejs.org/docs/api.html);\n","source":"_posts/module-and-requirejs.md","raw":"---\ntitle: 模块 与 requirejs\ndate: 2017-09-14 17:43:17\ntags:\n - javascript\n---\n\n### 模块\n\n  模块是一种将系统分离成独立功能部分的方法，严格定义模块接口、模块间具有透明性,对外导出一些公用API，比如函数，类，属性，方法\n\n<!--more-->\n\n  ![module-and-requirejs](/img/module-and-requirejs/img.jpg)\n\n\n## 模块的特性\n\n  * 可维护性 灵活架构，焦点分离 方便模块间组合、分解 ，单个模块功能调试、升级 ，多人协作互不干扰 \n  * 命名空间 通过命名空间，能极大缓解命名冲突，避免命名空间污染\n  * 可复用性 更高效的满足更多的个性化需求\n\n## 模块的模式\n\n  模块模式一般用来模拟类的概念,把公有和私有方法还有变量存储在一个对象中,在公开调用API的同时，仍然在一个闭包范围内封装私有变量和方法。\n\n  模块模式常见形式如下\n    1. 匿名闭包函数\n    2. 全局引入\n    3. 模块出口\n    4. 高级模式\n    5. 扩充\n    6. 松耦合扩充\n    7. 紧耦合扩充\n    8. 克隆和继承\n    9. 跨文件私有状态\n  现在，通行的Javascript模块规范主要有两种：CommonJS和AMD。\n\n  * commonjs  是服务器端模块的规范，同步加载，因为在服务器读取模块都是在本地磁盘，加载速度很快，如果是在客户端（浏览器），同步加载模块的时候有可能会出现“假死”状况，NodeJS应用了这个规范\n\n  * AMD 即 (Asynchronous Module Definition)，它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行，requireJs应用了这个规范.\n\n  ![module-and-requirejs](/img/module-and-requirejs/AMD.png)\n\n ### requireJs\n\n  RequireJS是一个工具库，主要用于客户端的模块管理。它可以让客户端的代码分成一个个模块，实现异步或动态加载，按需、并行、延时载入js库，避免网页失去响应，从而提高代码的性能和可维护性。\n\n ## requireJs 配置\n    * config\n      常见配置\n      -baseUrl 所有模块的查找根路径\n      -paths 指定各个模块的加载路径\n      -shim 为那些没有使用define()来声明依赖关系、设置模块的\"浏览器全局变量注入\"型脚本做依赖和导出配置。 兼容不符合AMD规范的模块加载  \n\n      [查看更多配置项](https://segmentfault.com/a/1190000002403806);\n   \n ## requireJs 引用\n\n  data-main 属性是requireJS的入口文件路径\n\n  ``` html\n  <script data-main=\"js/main\" src=\"./js/require.js\" type=\"text/javascript\"></script> \n  ```\n ## define 定义模块\n  1.独立模块\n    ``` javascript\n      define(function () {\n          return {\n              method1: function() {},\n              method2: function() {},\n          };\n      });\n    ```\n  2.非独立模块\n    ``` javascript\n      define(['module1', 'module2'], function(m1, m2) {\n          return {\n              method: function() {\n                  m1.methodA();\n                  m2.methodB();\n              }\n          };\n      });\n\n    ```\n  ## require 模块加载及使用\n\n    * 模块加载的相对路径的规则:\n      1.没有指定data-main属性时，以该JS文件所在路径为根路径\n      2.有指定 data-main 属性时，则以data-main属性引入的所在路径为根路径\n      3.如有配置config中的baseUrl属性，则以baseUrl为根路径\n\n    * 使用\n    ``` javascript\n      requirejs(['a','b'], function(a,b) {\n       var module = {\n         module1 : function(){\n\n         },\n         module2 : {\n\n         }\n       }\n        return module;\n      });\n\n    ```\n     ![module-and-requirejs](/img/module-and-requirejs/load.png)\n**********************************************************\n**** END ****\n\n\n**********************************************************\n\n### 参考文档\n\n[模块模式](https://www.oschina.net/translate/javascript-module-pattern-in-depth);\n[requirejs](http://requirejs.org/docs/api.html);\n","slug":"module-and-requirejs","published":1,"updated":"2017-09-19T09:54:07.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ocq0017uo2ecfe22ls9","content":"<h3 id=\"模块\"><a href=\"#模块\" class=\"headerlink\" title=\"模块\"></a>模块</h3><p>  模块是一种将系统分离成独立功能部分的方法，严格定义模块接口、模块间具有透明性,对外导出一些公用API，比如函数，类，属性，方法</p>\n<a id=\"more\"></a>\n<p>  <img src=\"/img/module-and-requirejs/img.jpg\" alt=\"module-and-requirejs\"></p>\n<h2 id=\"模块的特性\"><a href=\"#模块的特性\" class=\"headerlink\" title=\"模块的特性\"></a>模块的特性</h2><ul>\n<li>可维护性 灵活架构，焦点分离 方便模块间组合、分解 ，单个模块功能调试、升级 ，多人协作互不干扰 </li>\n<li>命名空间 通过命名空间，能极大缓解命名冲突，避免命名空间污染</li>\n<li>可复用性 更高效的满足更多的个性化需求</li>\n</ul>\n<h2 id=\"模块的模式\"><a href=\"#模块的模式\" class=\"headerlink\" title=\"模块的模式\"></a>模块的模式</h2><p>  模块模式一般用来模拟类的概念,把公有和私有方法还有变量存储在一个对象中,在公开调用API的同时，仍然在一个闭包范围内封装私有变量和方法。</p>\n<p>  模块模式常见形式如下</p>\n<pre><code>1. 匿名闭包函数\n2. 全局引入\n3. 模块出口\n4. 高级模式\n5. 扩充\n6. 松耦合扩充\n7. 紧耦合扩充\n8. 克隆和继承\n9. 跨文件私有状态\n</code></pre><p>  现在，通行的Javascript模块规范主要有两种：CommonJS和AMD。</p>\n<ul>\n<li><p>commonjs  是服务器端模块的规范，同步加载，因为在服务器读取模块都是在本地磁盘，加载速度很快，如果是在客户端（浏览器），同步加载模块的时候有可能会出现“假死”状况，NodeJS应用了这个规范</p>\n</li>\n<li><p>AMD 即 (Asynchronous Module Definition)，它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行，requireJs应用了这个规范.</p>\n<p><img src=\"/img/module-and-requirejs/AMD.png\" alt=\"module-and-requirejs\"></p>\n<h3 id=\"requireJs\"><a href=\"#requireJs\" class=\"headerlink\" title=\"requireJs\"></a>requireJs</h3><p>RequireJS是一个工具库，主要用于客户端的模块管理。它可以让客户端的代码分成一个个模块，实现异步或动态加载，按需、并行、延时载入js库，避免网页失去响应，从而提高代码的性能和可维护性。</p>\n<h2 id=\"requireJs-配置\"><a href=\"#requireJs-配置\" class=\"headerlink\" title=\"requireJs 配置\"></a>requireJs 配置</h2><ul>\n<li><p>config<br>常见配置<br>-baseUrl 所有模块的查找根路径<br>-paths 指定各个模块的加载路径<br>-shim 为那些没有使用define()来声明依赖关系、设置模块的”浏览器全局变量注入”型脚本做依赖和导出配置。 兼容不符合AMD规范的模块加载  </p>\n<p><a href=\"https://segmentfault.com/a/1190000002403806\" target=\"_blank\" rel=\"noopener\">查看更多配置项</a>;</p>\n</li>\n</ul>\n<h2 id=\"requireJs-引用\"><a href=\"#requireJs-引用\" class=\"headerlink\" title=\"requireJs 引用\"></a>requireJs 引用</h2><p>data-main 属性是requireJS的入口文件路径</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">data-main</span>=<span class=\"string\">\"js/main\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./js/require.js\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"define-定义模块\"><a href=\"#define-定义模块\" class=\"headerlink\" title=\"define 定义模块\"></a>define 定义模块</h2><p>1.独立模块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        method1: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;,</span><br><span class=\"line\">        method2: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>2.非独立模块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define([<span class=\"string\">'module1'</span>, <span class=\"string\">'module2'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m1, m2</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        method: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            m1.methodA();</span><br><span class=\"line\">            m2.methodB();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"require-模块加载及使用\"><a href=\"#require-模块加载及使用\" class=\"headerlink\" title=\"require 模块加载及使用\"></a>require 模块加载及使用</h2><ul>\n<li><p>模块加载的相对路径的规则:<br>1.没有指定data-main属性时，以该JS文件所在路径为根路径<br>2.有指定 data-main 属性时，则以data-main属性引入的所在路径为根路径<br>3.如有配置config中的baseUrl属性，则以baseUrl为根路径</p>\n</li>\n<li><p>使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">requirejs([<span class=\"string\">'a'</span>,<span class=\"string\">'b'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a,b</span>) </span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = &#123;</span><br><span class=\"line\">   module1 : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   module2 : &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">module</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/module-and-requirejs/load.png\" alt=\"module-and-requirejs\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p><strong><strong> END </strong></strong></p>\n<hr>\n<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3><p><a href=\"https://www.oschina.net/translate/javascript-module-pattern-in-depth\" target=\"_blank\" rel=\"noopener\">模块模式</a>;<br><a href=\"http://requirejs.org/docs/api.html\" target=\"_blank\" rel=\"noopener\">requirejs</a>;</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"模块\"><a href=\"#模块\" class=\"headerlink\" title=\"模块\"></a>模块</h3><p>  模块是一种将系统分离成独立功能部分的方法，严格定义模块接口、模块间具有透明性,对外导出一些公用API，比如函数，类，属性，方法</p>","more":"<p>  <img src=\"/img/module-and-requirejs/img.jpg\" alt=\"module-and-requirejs\"></p>\n<h2 id=\"模块的特性\"><a href=\"#模块的特性\" class=\"headerlink\" title=\"模块的特性\"></a>模块的特性</h2><ul>\n<li>可维护性 灵活架构，焦点分离 方便模块间组合、分解 ，单个模块功能调试、升级 ，多人协作互不干扰 </li>\n<li>命名空间 通过命名空间，能极大缓解命名冲突，避免命名空间污染</li>\n<li>可复用性 更高效的满足更多的个性化需求</li>\n</ul>\n<h2 id=\"模块的模式\"><a href=\"#模块的模式\" class=\"headerlink\" title=\"模块的模式\"></a>模块的模式</h2><p>  模块模式一般用来模拟类的概念,把公有和私有方法还有变量存储在一个对象中,在公开调用API的同时，仍然在一个闭包范围内封装私有变量和方法。</p>\n<p>  模块模式常见形式如下</p>\n<pre><code>1. 匿名闭包函数\n2. 全局引入\n3. 模块出口\n4. 高级模式\n5. 扩充\n6. 松耦合扩充\n7. 紧耦合扩充\n8. 克隆和继承\n9. 跨文件私有状态\n</code></pre><p>  现在，通行的Javascript模块规范主要有两种：CommonJS和AMD。</p>\n<ul>\n<li><p>commonjs  是服务器端模块的规范，同步加载，因为在服务器读取模块都是在本地磁盘，加载速度很快，如果是在客户端（浏览器），同步加载模块的时候有可能会出现“假死”状况，NodeJS应用了这个规范</p>\n</li>\n<li><p>AMD 即 (Asynchronous Module Definition)，它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行，requireJs应用了这个规范.</p>\n<p><img src=\"/img/module-and-requirejs/AMD.png\" alt=\"module-and-requirejs\"></p>\n<h3 id=\"requireJs\"><a href=\"#requireJs\" class=\"headerlink\" title=\"requireJs\"></a>requireJs</h3><p>RequireJS是一个工具库，主要用于客户端的模块管理。它可以让客户端的代码分成一个个模块，实现异步或动态加载，按需、并行、延时载入js库，避免网页失去响应，从而提高代码的性能和可维护性。</p>\n<h2 id=\"requireJs-配置\"><a href=\"#requireJs-配置\" class=\"headerlink\" title=\"requireJs 配置\"></a>requireJs 配置</h2><ul>\n<li><p>config<br>常见配置<br>-baseUrl 所有模块的查找根路径<br>-paths 指定各个模块的加载路径<br>-shim 为那些没有使用define()来声明依赖关系、设置模块的”浏览器全局变量注入”型脚本做依赖和导出配置。 兼容不符合AMD规范的模块加载  </p>\n<p><a href=\"https://segmentfault.com/a/1190000002403806\" target=\"_blank\" rel=\"noopener\">查看更多配置项</a>;</p>\n</li>\n</ul>\n<h2 id=\"requireJs-引用\"><a href=\"#requireJs-引用\" class=\"headerlink\" title=\"requireJs 引用\"></a>requireJs 引用</h2><p>data-main 属性是requireJS的入口文件路径</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">data-main</span>=<span class=\"string\">\"js/main\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./js/require.js\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"define-定义模块\"><a href=\"#define-定义模块\" class=\"headerlink\" title=\"define 定义模块\"></a>define 定义模块</h2><p>1.独立模块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        method1: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;,</span><br><span class=\"line\">        method2: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>2.非独立模块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define([<span class=\"string\">'module1'</span>, <span class=\"string\">'module2'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">m1, m2</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        method: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            m1.methodA();</span><br><span class=\"line\">            m2.methodB();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"require-模块加载及使用\"><a href=\"#require-模块加载及使用\" class=\"headerlink\" title=\"require 模块加载及使用\"></a>require 模块加载及使用</h2><ul>\n<li><p>模块加载的相对路径的规则:<br>1.没有指定data-main属性时，以该JS文件所在路径为根路径<br>2.有指定 data-main 属性时，则以data-main属性引入的所在路径为根路径<br>3.如有配置config中的baseUrl属性，则以baseUrl为根路径</p>\n</li>\n<li><p>使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">requirejs([<span class=\"string\">'a'</span>,<span class=\"string\">'b'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a,b</span>) </span>&#123;</span><br><span class=\"line\"> <span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = &#123;</span><br><span class=\"line\">   module1 : <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   module2 : &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">module</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><img src=\"/img/module-and-requirejs/load.png\" alt=\"module-and-requirejs\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p><strong><strong> END </strong></strong></p>\n<hr>\n<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3><p><a href=\"https://www.oschina.net/translate/javascript-module-pattern-in-depth\" target=\"_blank\" rel=\"noopener\">模块模式</a>;<br><a href=\"http://requirejs.org/docs/api.html\" target=\"_blank\" rel=\"noopener\">requirejs</a>;</p>"},{"title":"nodejs学习之路","date":"2017-12-21T16:00:00.000Z","_content":"\nnodejs可以用来做什么\n<!--学习之前我们可以想一想nodejs可以用来做什么-->\n<!--more-->\n\n## 可以做什么\n<!-- 其实我也不知道能做什么，只能把平时用过的东西拿出来分类一下 -->\n+ 工具\n> gulp\n> webpack\n> hexo\n> docute\n\n+ 服务\n> 福利频道\n> 专家在线\n> OA系统 + 图书馆\n> 么么哒相册后台\n> 爬虫\n\n+ 组件&库&框架\n> bz-login\n> bz-share\n> vue\n> react\n> angular\n> weui\n> element ui\n\n## 如何入门nodejs\n\n<!--\n一开始在想怎么跟大家说下nodejs，于是想了这个题目，但是觉得按照常规来说，感觉太啰嗦也太慢了，所以需要通过娶她方法来学\n-->\n如何快速入门nodejs（目的）\n=> 如何快速使用nodejs做服务项目（方法）\n<!--\n然后又开始想其他，觉得你们跟你们讲nodejs你们可能没什么用，还不如直接跟你们说怎么做项目\n-->\n\n## 项目启动准备\n\n### 框架\n\n+ express（yield: co + thunkify）（入门建议）\n+ koa1（yield）\n+ koa2（async - await）\n+ thinkjs（async - await）（php：mvc）\n\n## 初始化\n\n```js\nconst express = require('express');\nconst app = express();\napp.use('/', function (req, res) {\n  // req = reuest 请求进来的对象\n  // res = response 响应请求的对象\n  res.send('hello world');\n});\napp.listen(80);\n```\n\n## restful api\n\n### GET\n\n> http://127.0.0.1?a=1&b=2 GET\n\n```js\napp.get('/', function (req, res) {\n  console.log(req.query); // { a: 1, b: 2}\n  res.send('hello world');\n});\n```\n\n### POST\n\n> http://127.0.0.1 POST c=3, d=4\n\n```js\napp.post('/', function (req, res) {\n  console.log(req.body); // { c: 3, d: 4}\n  res.send('hello world');\n});\n```\n\n## 中间件\n\n顾名思义，就是中间处理事务的事件\n也可以理解为预处理函数\nhttp://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in\n\n### 典型事例, 登录中间件\n\n```js\nurl\n ┣ home -> login ? homePage : loginPage\n ┗ list -> login ? listPage : loginPage\n```\n\n```js\nurl\n ┣ login ? next() : loginPage\n ┣ home -> homePage\n ┗ list -> listPage\n```\n\n```js\napp.use(function (req, res, next) {\n  if (req.seesion.user) {\n    return next();\n  }\n  return res.redirect('./login');\n});\napp.use('/home', function (req, res) {\n  res.send('hello home');\n});\napp.use('/list', function (req, res) {\n  res.send('hello list');\n});\napp.use('/login', function (req, res) {\n  res.send('hello login');\n});\n```\n\n\n### 静态资源中间件\n```js\napp.use(express.static(path.join(__dirname, 'public')));\napp.use('/home', function (req, res) {\n  res.send('hello home');\n});\n```\n\n### 错误处理中间件\n```js\napp.use((err, req, res, next) => {\n  const status = err.status || 500;\n  res.status(status);\n  if (status === 404 || status === 500) {\n    return res.render(`error/${status}`);\n  }\n  return res.render('error');\n});\n```\n\n\n### 常见第三方中间件\n\n+ body-parser\n\n```js\nconst bodyParser = require('body-parser');\n\n// parse application/json\napp.use(bodyParser.json({ limit: '2mb' }));\n\n// parse application/x-www-form-urlencoded\napp.use(bodyParser.urlencoded({ limit: '2mb', extended: true }));\n```\n\n+ cookie-parser\n\n```js\nconst cookieParser = require('cookie-parser');\napp.use(cookieParser());\n\napp.get('/', function () {\n  app.get('/', function (req, res) {\n    console.log('Cookies: ', req.cookies)\n  });\n});\n```\n\n+ serve-favicon\n\n```js\nconst favicon = require('serve-favicon');\napp.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\n```\n\n## 常用nodejs模块\n\n+ path\n\n```js\nconst path = require('path');\n\n// \\img\\test.gif\npath.join('/', 'img', 'test.gif');\n\n// E:\\img\\test.gif\npath.resolve('/', 'img', 'test.gif');\n```\n\n+ fs\n\n```js\nconst fs = require('fs');\nfs.readFile\nfs.readFileSync\n\nfs.writeFile\nfs.writeFileSync\n\nfs.exists\nfs.existsSync\n\nfs.stat\nfs.statSync\n```\n\n## 参考\n\n+ http://www.expressjs.com.cn/resources/middleware.html","source":"_posts/nodejs-start.md","raw":"---\ntitle: nodejs学习之路\ndate: 2017-12-22\ntags:\n - javascript\n - node\n - express\n---\n\nnodejs可以用来做什么\n<!--学习之前我们可以想一想nodejs可以用来做什么-->\n<!--more-->\n\n## 可以做什么\n<!-- 其实我也不知道能做什么，只能把平时用过的东西拿出来分类一下 -->\n+ 工具\n> gulp\n> webpack\n> hexo\n> docute\n\n+ 服务\n> 福利频道\n> 专家在线\n> OA系统 + 图书馆\n> 么么哒相册后台\n> 爬虫\n\n+ 组件&库&框架\n> bz-login\n> bz-share\n> vue\n> react\n> angular\n> weui\n> element ui\n\n## 如何入门nodejs\n\n<!--\n一开始在想怎么跟大家说下nodejs，于是想了这个题目，但是觉得按照常规来说，感觉太啰嗦也太慢了，所以需要通过娶她方法来学\n-->\n如何快速入门nodejs（目的）\n=> 如何快速使用nodejs做服务项目（方法）\n<!--\n然后又开始想其他，觉得你们跟你们讲nodejs你们可能没什么用，还不如直接跟你们说怎么做项目\n-->\n\n## 项目启动准备\n\n### 框架\n\n+ express（yield: co + thunkify）（入门建议）\n+ koa1（yield）\n+ koa2（async - await）\n+ thinkjs（async - await）（php：mvc）\n\n## 初始化\n\n```js\nconst express = require('express');\nconst app = express();\napp.use('/', function (req, res) {\n  // req = reuest 请求进来的对象\n  // res = response 响应请求的对象\n  res.send('hello world');\n});\napp.listen(80);\n```\n\n## restful api\n\n### GET\n\n> http://127.0.0.1?a=1&b=2 GET\n\n```js\napp.get('/', function (req, res) {\n  console.log(req.query); // { a: 1, b: 2}\n  res.send('hello world');\n});\n```\n\n### POST\n\n> http://127.0.0.1 POST c=3, d=4\n\n```js\napp.post('/', function (req, res) {\n  console.log(req.body); // { c: 3, d: 4}\n  res.send('hello world');\n});\n```\n\n## 中间件\n\n顾名思义，就是中间处理事务的事件\n也可以理解为预处理函数\nhttp://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in\n\n### 典型事例, 登录中间件\n\n```js\nurl\n ┣ home -> login ? homePage : loginPage\n ┗ list -> login ? listPage : loginPage\n```\n\n```js\nurl\n ┣ login ? next() : loginPage\n ┣ home -> homePage\n ┗ list -> listPage\n```\n\n```js\napp.use(function (req, res, next) {\n  if (req.seesion.user) {\n    return next();\n  }\n  return res.redirect('./login');\n});\napp.use('/home', function (req, res) {\n  res.send('hello home');\n});\napp.use('/list', function (req, res) {\n  res.send('hello list');\n});\napp.use('/login', function (req, res) {\n  res.send('hello login');\n});\n```\n\n\n### 静态资源中间件\n```js\napp.use(express.static(path.join(__dirname, 'public')));\napp.use('/home', function (req, res) {\n  res.send('hello home');\n});\n```\n\n### 错误处理中间件\n```js\napp.use((err, req, res, next) => {\n  const status = err.status || 500;\n  res.status(status);\n  if (status === 404 || status === 500) {\n    return res.render(`error/${status}`);\n  }\n  return res.render('error');\n});\n```\n\n\n### 常见第三方中间件\n\n+ body-parser\n\n```js\nconst bodyParser = require('body-parser');\n\n// parse application/json\napp.use(bodyParser.json({ limit: '2mb' }));\n\n// parse application/x-www-form-urlencoded\napp.use(bodyParser.urlencoded({ limit: '2mb', extended: true }));\n```\n\n+ cookie-parser\n\n```js\nconst cookieParser = require('cookie-parser');\napp.use(cookieParser());\n\napp.get('/', function () {\n  app.get('/', function (req, res) {\n    console.log('Cookies: ', req.cookies)\n  });\n});\n```\n\n+ serve-favicon\n\n```js\nconst favicon = require('serve-favicon');\napp.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\n```\n\n## 常用nodejs模块\n\n+ path\n\n```js\nconst path = require('path');\n\n// \\img\\test.gif\npath.join('/', 'img', 'test.gif');\n\n// E:\\img\\test.gif\npath.resolve('/', 'img', 'test.gif');\n```\n\n+ fs\n\n```js\nconst fs = require('fs');\nfs.readFile\nfs.readFileSync\n\nfs.writeFile\nfs.writeFileSync\n\nfs.exists\nfs.existsSync\n\nfs.stat\nfs.statSync\n```\n\n## 参考\n\n+ http://www.expressjs.com.cn/resources/middleware.html","slug":"nodejs-start","published":1,"updated":"2017-12-22T07:16:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ocx001auo2eas53ft7l","content":"<p>nodejs可以用来做什么<br><!--学习之前我们可以想一想nodejs可以用来做什么--><br><a id=\"more\"></a></p>\n<h2 id=\"可以做什么\"><a href=\"#可以做什么\" class=\"headerlink\" title=\"可以做什么\"></a>可以做什么</h2><!-- 其实我也不知道能做什么，只能把平时用过的东西拿出来分类一下 -->\n<ul>\n<li><p>工具</p>\n<blockquote>\n<p>gulp<br>webpack<br>hexo<br>docute</p>\n</blockquote>\n</li>\n<li><p>服务</p>\n<blockquote>\n<p>福利频道<br>专家在线<br>OA系统 + 图书馆<br>么么哒相册后台<br>爬虫</p>\n</blockquote>\n</li>\n<li><p>组件&amp;库&amp;框架</p>\n<blockquote>\n<p>bz-login<br>bz-share<br>vue<br>react<br>angular<br>weui<br>element ui</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"如何入门nodejs\"><a href=\"#如何入门nodejs\" class=\"headerlink\" title=\"如何入门nodejs\"></a>如何入门nodejs</h2><!--\n一开始在想怎么跟大家说下nodejs，于是想了这个题目，但是觉得按照常规来说，感觉太啰嗦也太慢了，所以需要通过娶她方法来学\n-->\n<p>如何快速入门nodejs（目的）<br>=&gt; 如何快速使用nodejs做服务项目（方法）<br><!--\n然后又开始想其他，觉得你们跟你们讲nodejs你们可能没什么用，还不如直接跟你们说怎么做项目\n--></p>\n<h2 id=\"项目启动准备\"><a href=\"#项目启动准备\" class=\"headerlink\" title=\"项目启动准备\"></a>项目启动准备</h2><h3 id=\"框架\"><a href=\"#框架\" class=\"headerlink\" title=\"框架\"></a>框架</h3><ul>\n<li>express（yield: co + thunkify）（入门建议）</li>\n<li>koa1（yield）</li>\n<li>koa2（async - await）</li>\n<li>thinkjs（async - await）（php：mvc）</li>\n</ul>\n<h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = express();</span><br><span class=\"line\">app.use(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// req = reuest 请求进来的对象</span></span><br><span class=\"line\">  <span class=\"comment\">// res = response 响应请求的对象</span></span><br><span class=\"line\">  res.send(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.listen(<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"restful-api\"><a href=\"#restful-api\" class=\"headerlink\" title=\"restful api\"></a>restful api</h2><h3 id=\"GET\"><a href=\"#GET\" class=\"headerlink\" title=\"GET\"></a>GET</h3><blockquote>\n<p><a href=\"http://127.0.0.1?a=1&amp;b=2\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1?a=1&amp;b=2</a> GET</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(req.query); <span class=\"comment\">// &#123; a: 1, b: 2&#125;</span></span><br><span class=\"line\">  res.send(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"POST\"><a href=\"#POST\" class=\"headerlink\" title=\"POST\"></a>POST</h3><blockquote>\n<p><a href=\"http://127.0.0.1\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1</a> POST c=3, d=4</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.post(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(req.body); <span class=\"comment\">// &#123; c: 3, d: 4&#125;</span></span><br><span class=\"line\">  res.send(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><p>顾名思义，就是中间处理事务的事件<br>也可以理解为预处理函数<br><a href=\"http://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in</a></p>\n<h3 id=\"典型事例-登录中间件\"><a href=\"#典型事例-登录中间件\" class=\"headerlink\" title=\"典型事例, 登录中间件\"></a>典型事例, 登录中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url</span><br><span class=\"line\"> ┣ home -&gt; login ? homePage : loginPage</span><br><span class=\"line\"> ┗ list -&gt; login ? listPage : loginPage</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url</span><br><span class=\"line\"> ┣ login ? next() : loginPage</span><br><span class=\"line\"> ┣ home -&gt; homePage</span><br><span class=\"line\"> ┗ list -&gt; listPage</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.seesion.user) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res.redirect(<span class=\"string\">'./login'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.use(<span class=\"string\">'/home'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello home'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.use(<span class=\"string\">'/list'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello list'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.use(<span class=\"string\">'/login'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello login'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"静态资源中间件\"><a href=\"#静态资源中间件\" class=\"headerlink\" title=\"静态资源中间件\"></a>静态资源中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(express.static(path.join(__dirname, <span class=\"string\">'public'</span>)));</span><br><span class=\"line\">app.use(<span class=\"string\">'/home'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello home'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误处理中间件\"><a href=\"#错误处理中间件\" class=\"headerlink\" title=\"错误处理中间件\"></a>错误处理中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> status = err.status || <span class=\"number\">500</span>;</span><br><span class=\"line\">  res.status(status);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status === <span class=\"number\">404</span> || status === <span class=\"number\">500</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.render(<span class=\"string\">`error/<span class=\"subst\">$&#123;status&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res.render(<span class=\"string\">'error'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"常见第三方中间件\"><a href=\"#常见第三方中间件\" class=\"headerlink\" title=\"常见第三方中间件\"></a>常见第三方中间件</h3><ul>\n<li>body-parser</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// parse application/json</span></span><br><span class=\"line\">app.use(bodyParser.json(&#123; <span class=\"attr\">limit</span>: <span class=\"string\">'2mb'</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// parse application/x-www-form-urlencoded</span></span><br><span class=\"line\">app.use(bodyParser.urlencoded(&#123; <span class=\"attr\">limit</span>: <span class=\"string\">'2mb'</span>, <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> &#125;));</span><br></pre></td></tr></table></figure>\n<ul>\n<li>cookie-parser</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">'cookie-parser'</span>);</span><br><span class=\"line\">app.use(cookieParser());</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Cookies: '</span>, req.cookies)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>serve-favicon</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> favicon = <span class=\"built_in\">require</span>(<span class=\"string\">'serve-favicon'</span>);</span><br><span class=\"line\">app.use(favicon(path.join(__dirname, <span class=\"string\">'public'</span>, <span class=\"string\">'favicon.ico'</span>)));</span><br></pre></td></tr></table></figure>\n<h2 id=\"常用nodejs模块\"><a href=\"#常用nodejs模块\" class=\"headerlink\" title=\"常用nodejs模块\"></a>常用nodejs模块</h2><ul>\n<li>path</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// \\img\\test.gif</span></span><br><span class=\"line\">path.join(<span class=\"string\">'/'</span>, <span class=\"string\">'img'</span>, <span class=\"string\">'test.gif'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// E:\\img\\test.gif</span></span><br><span class=\"line\">path.resolve(<span class=\"string\">'/'</span>, <span class=\"string\">'img'</span>, <span class=\"string\">'test.gif'</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>fs</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\">fs.readFile</span><br><span class=\"line\">fs.readFileSync</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFile</span><br><span class=\"line\">fs.writeFileSync</span><br><span class=\"line\"></span><br><span class=\"line\">fs.exists</span><br><span class=\"line\">fs.existsSync</span><br><span class=\"line\"></span><br><span class=\"line\">fs.stat</span><br><span class=\"line\">fs.statSync</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://www.expressjs.com.cn/resources/middleware.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/resources/middleware.html</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>nodejs可以用来做什么<br><!--学习之前我们可以想一想nodejs可以用来做什么--><br>","more":"</p>\n<h2 id=\"可以做什么\"><a href=\"#可以做什么\" class=\"headerlink\" title=\"可以做什么\"></a>可以做什么</h2><!-- 其实我也不知道能做什么，只能把平时用过的东西拿出来分类一下 -->\n<ul>\n<li><p>工具</p>\n<blockquote>\n<p>gulp<br>webpack<br>hexo<br>docute</p>\n</blockquote>\n</li>\n<li><p>服务</p>\n<blockquote>\n<p>福利频道<br>专家在线<br>OA系统 + 图书馆<br>么么哒相册后台<br>爬虫</p>\n</blockquote>\n</li>\n<li><p>组件&amp;库&amp;框架</p>\n<blockquote>\n<p>bz-login<br>bz-share<br>vue<br>react<br>angular<br>weui<br>element ui</p>\n</blockquote>\n</li>\n</ul>\n<h2 id=\"如何入门nodejs\"><a href=\"#如何入门nodejs\" class=\"headerlink\" title=\"如何入门nodejs\"></a>如何入门nodejs</h2><!--\n一开始在想怎么跟大家说下nodejs，于是想了这个题目，但是觉得按照常规来说，感觉太啰嗦也太慢了，所以需要通过娶她方法来学\n-->\n<p>如何快速入门nodejs（目的）<br>=&gt; 如何快速使用nodejs做服务项目（方法）<br><!--\n然后又开始想其他，觉得你们跟你们讲nodejs你们可能没什么用，还不如直接跟你们说怎么做项目\n--></p>\n<h2 id=\"项目启动准备\"><a href=\"#项目启动准备\" class=\"headerlink\" title=\"项目启动准备\"></a>项目启动准备</h2><h3 id=\"框架\"><a href=\"#框架\" class=\"headerlink\" title=\"框架\"></a>框架</h3><ul>\n<li>express（yield: co + thunkify）（入门建议）</li>\n<li>koa1（yield）</li>\n<li>koa2（async - await）</li>\n<li>thinkjs（async - await）（php：mvc）</li>\n</ul>\n<h2 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = express();</span><br><span class=\"line\">app.use(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// req = reuest 请求进来的对象</span></span><br><span class=\"line\">  <span class=\"comment\">// res = response 响应请求的对象</span></span><br><span class=\"line\">  res.send(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.listen(<span class=\"number\">80</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"restful-api\"><a href=\"#restful-api\" class=\"headerlink\" title=\"restful api\"></a>restful api</h2><h3 id=\"GET\"><a href=\"#GET\" class=\"headerlink\" title=\"GET\"></a>GET</h3><blockquote>\n<p><a href=\"http://127.0.0.1?a=1&amp;b=2\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1?a=1&amp;b=2</a> GET</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(req.query); <span class=\"comment\">// &#123; a: 1, b: 2&#125;</span></span><br><span class=\"line\">  res.send(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"POST\"><a href=\"#POST\" class=\"headerlink\" title=\"POST\"></a>POST</h3><blockquote>\n<p><a href=\"http://127.0.0.1\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1</a> POST c=3, d=4</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.post(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(req.body); <span class=\"comment\">// &#123; c: 3, d: 4&#125;</span></span><br><span class=\"line\">  res.send(<span class=\"string\">'hello world'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h2><p>顾名思义，就是中间处理事务的事件<br>也可以理解为预处理函数<br><a href=\"http://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in</a></p>\n<h3 id=\"典型事例-登录中间件\"><a href=\"#典型事例-登录中间件\" class=\"headerlink\" title=\"典型事例, 登录中间件\"></a>典型事例, 登录中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url</span><br><span class=\"line\"> ┣ home -&gt; login ? homePage : loginPage</span><br><span class=\"line\"> ┗ list -&gt; login ? listPage : loginPage</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url</span><br><span class=\"line\"> ┣ login ? next() : loginPage</span><br><span class=\"line\"> ┣ home -&gt; homePage</span><br><span class=\"line\"> ┗ list -&gt; listPage</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (req.seesion.user) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res.redirect(<span class=\"string\">'./login'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.use(<span class=\"string\">'/home'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello home'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.use(<span class=\"string\">'/list'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello list'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">app.use(<span class=\"string\">'/login'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello login'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"静态资源中间件\"><a href=\"#静态资源中间件\" class=\"headerlink\" title=\"静态资源中间件\"></a>静态资源中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(express.static(path.join(__dirname, <span class=\"string\">'public'</span>)));</span><br><span class=\"line\">app.use(<span class=\"string\">'/home'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.send(<span class=\"string\">'hello home'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误处理中间件\"><a href=\"#错误处理中间件\" class=\"headerlink\" title=\"错误处理中间件\"></a>错误处理中间件</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"function\">(<span class=\"params\">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> status = err.status || <span class=\"number\">500</span>;</span><br><span class=\"line\">  res.status(status);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status === <span class=\"number\">404</span> || status === <span class=\"number\">500</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.render(<span class=\"string\">`error/<span class=\"subst\">$&#123;status&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> res.render(<span class=\"string\">'error'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"常见第三方中间件\"><a href=\"#常见第三方中间件\" class=\"headerlink\" title=\"常见第三方中间件\"></a>常见第三方中间件</h3><ul>\n<li>body-parser</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bodyParser = <span class=\"built_in\">require</span>(<span class=\"string\">'body-parser'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// parse application/json</span></span><br><span class=\"line\">app.use(bodyParser.json(&#123; <span class=\"attr\">limit</span>: <span class=\"string\">'2mb'</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// parse application/x-www-form-urlencoded</span></span><br><span class=\"line\">app.use(bodyParser.urlencoded(&#123; <span class=\"attr\">limit</span>: <span class=\"string\">'2mb'</span>, <span class=\"attr\">extended</span>: <span class=\"literal\">true</span> &#125;));</span><br></pre></td></tr></table></figure>\n<ul>\n<li>cookie-parser</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cookieParser = <span class=\"built_in\">require</span>(<span class=\"string\">'cookie-parser'</span>);</span><br><span class=\"line\">app.use(cookieParser());</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  app.get(<span class=\"string\">'/'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Cookies: '</span>, req.cookies)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>serve-favicon</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> favicon = <span class=\"built_in\">require</span>(<span class=\"string\">'serve-favicon'</span>);</span><br><span class=\"line\">app.use(favicon(path.join(__dirname, <span class=\"string\">'public'</span>, <span class=\"string\">'favicon.ico'</span>)));</span><br></pre></td></tr></table></figure>\n<h2 id=\"常用nodejs模块\"><a href=\"#常用nodejs模块\" class=\"headerlink\" title=\"常用nodejs模块\"></a>常用nodejs模块</h2><ul>\n<li>path</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// \\img\\test.gif</span></span><br><span class=\"line\">path.join(<span class=\"string\">'/'</span>, <span class=\"string\">'img'</span>, <span class=\"string\">'test.gif'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// E:\\img\\test.gif</span></span><br><span class=\"line\">path.resolve(<span class=\"string\">'/'</span>, <span class=\"string\">'img'</span>, <span class=\"string\">'test.gif'</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>fs</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>);</span><br><span class=\"line\">fs.readFile</span><br><span class=\"line\">fs.readFileSync</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFile</span><br><span class=\"line\">fs.writeFileSync</span><br><span class=\"line\"></span><br><span class=\"line\">fs.exists</span><br><span class=\"line\">fs.existsSync</span><br><span class=\"line\"></span><br><span class=\"line\">fs.stat</span><br><span class=\"line\">fs.statSync</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://www.expressjs.com.cn/resources/middleware.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/resources/middleware.html</a></li>\n</ul>"},{"title":"前端监控--错误日志(一)","date":"2017-12-29T02:27:55.000Z","_content":"\n  > 我们无法保证项目面对成千上万的用户，在各类浏览器下/遇到未知数据时不出问题。对一个拥有大量用户的互联网产品而言，采集到这些数据对所负责的页面进一步的观察监控就非常有必要了。\n\n<!--more-->\n\n---\n## 页面常见异常\n\n* HTML标签异常\n* CSS展现异常\n* 文件请求异常(如样式表/图片/脚本)\n* 脚本异常\n* 网络环境引起的异常(如网速很慢/运营商强行注入标签脚本)\n* 数据请求异常\n* ...\n\n涉及用户自身网络环境的异常很难规避。展示上的异常不会影响用户使用。\n** 涉及到交互逻辑/数据提交等脚本错误，会立刻终止用户的下一步操作，监控主要抓取的是此类异常。**\n\n---\n## 信息采集\n\n设计原则：尽可能多提供错误信息及上下文/兼容多平台/多浏览器。\n\n### 脚本错误\n\n```js\nwindow.onerror = function (message, url, lineNo, columnNo, error) {};\n```\n\n* `message {String}` 错误信息，直观的错误描述信息。\n* `url {String}` 发生错误对应的脚本路径。\n* `lineNo {Number}` 错误发生的行号。\n* `columnNo {Number}` 错误发生的列号。\n* `error {Object}` 具体的 error 对象，继承自 `window.Error` 的某一类，部分属性和前面几项有重叠，但是包含更加详细的错误调用堆栈信息，这对于定位错误非常有帮助。\n\n* 注意事项\n压缩混淆过的脚本错误想深入了解错误信息需使用sourcemap（位置信息文件）。\n低版本浏览器只能提供部分信息。\n跨域的JS资源需要往资源请求加`Access-Control-Allow-Origin`及标签加`crossorigin`属性才能获取准确信息。\n\n### Ajax上下文\n\n接口请求错误，可采集`XMLHttpRequest`对象的数据，接口返回的数据\n\n### 操作上下文\n\n交互错误，采集如点击类/输入类的信息，如标签/标签内属性/输入值 (类似统计)\n\n### 浏览器数据\n\nuserAgent\n\n### 资源加载\n\n对img/link/script等资源的加载错误，给标签添加onerror回调函数，但因各类库有自己加载外部资源的方式，无法全局控制。\n\n### 其他数据(设备信息/环境数据/开发者所需数据/...)\n\n---\n## 初试\n\n> mongoose 数据库\n接口 (vue模拟)\nweb页面\n\n![flow-one](/img/monitor-errorlog/flow-one.png)\n\n### 接口dev-server.js\n\n* 连接数据库，写入数据模型\n\n```js\nconst mongoose = require('mongoose');\nconst Schema = mongoose.Schema;\n\nmongoose.connect('mongodb://192.168.80.40/test_fe');\n\n// 错误数据模型\nconst ErrorSchema = new Schema({\n  created_at: { type: Number, default: parseInt(new Date().getTime() * 0.001, 10) },\n  content: String, // 错误信息\n  headers: String, // 请求头部\n});\nmongoose.model('Error', ErrorSchema);\n```\n\n* 接口两个-获取/写入\n\n```js\napp.use(function (req, res, next) {\n  // 跨域处理\n  res.header('Access-Control-Allow-Origin', 'http://fe.office.bzdev.net');\n  res.header('Access-Control-Allow-Credentials', true);\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  // 是否为空\n  req.empty = (data, type) => {\n    if (type === 'date') {\n      return !new Date(data).getTime();\n    } else if (type === 'timestamp') {\n      return !new Date(data * 1000).getTime();\n    } else if (type === 'array') {\n      return Object.prototype.toString.call(data) !== '[object Array]' ? true :\n          data.length === 0 ? true : false;\n    } else if (type === 'object') {\n      if (Object.prototype.toString.call(data) !== '[object Object]') {\n        return true;\n      }\n      for(var key in data){\n        return false;\n      }\n      return true;\n    } else if (type === 'number') {\n      return !parseInt(data, 10) || Object.prototype.toString.call(parseInt(data, 10)) !== '[object Number]';\n    } else {\n      return !data;\n    }\n  };\n  next();\n});\n// 获取错误日志\napp.get('/geterror', function(req, res, next) {\n\n  const body = req.empty(req.body, 'object') ? req.query : req.body;\n  // 分页\n  const page = body.page ? Number(body.page) : 1;\n  const pageSize = body.limit ? Number(body.limit) : 100;\n  const start = (page - 1) * pageSize;\n\n  co(function *() {\n    const list = yield mongoose.model('Error')\n      .find()\n      .skip(start)\n      .limit(pageSize)\n      .sort({created_at: -1})\n      .exec();\n\n    res.json({\n      error_code: 0,\n      data: list,\n    })\n  }).catch(next)\n})\n// 写入错误日志\napp.get('/seterror', function(req, res, next) {\n  const body = req.empty(req.body, 'object') ? req.query : req.body;\n  const headers = req.headers;\n\n  const content = body;\n\n  if (JSON.stringify(content) === '{}') return false;\n\n  co(function *() {\n    const json = {\n      content: JSON.stringify(content),\n      headers: JSON.stringify(headers),\n      created_at: parseInt(new Date().getTime() * 0.001, 10),\n    }\n\n    yield mongoose.model('Error').create(json);\n\n    return res.json({\n      error_code: 0,\n      data: {}\n    })\n  }).catch(next);\n})\n\n```\n\n### web页面采集脚本\n\npost存在跨域问题，重复请求会被浏览器忽略，可使用图片方式上报信息\n\n```js\nnew Vue({\n  ...\n  methods: {\n    ...\n    postError: function(err) {\n     if (!err) return false;\n\n      var image = document.createElement('img');\n\n      var items = [];\n      for (var key in err) {\n        if (err[key]) items.push(key + '=' + encodeURIComponent(JSON.stringify(err[key])));\n      }\n\n      // http://192.168.80.106:8081/seterror 数据采集接口\n      image.src = 'http://192.168.80.106:8081/seterror?' + items.join('&');\n\n      // 释放资源\n      image.onload = image.onerror = function() {\n        image = image.onload = image.onerror =  null;\n      }\n    }\n    ...\n  },\n  ...\n});\n```\n\n### 坑\n* 数据量大增长快的情况下，不适合用数据库，应改用文本日志，并节流控制数据采样率\n* 需考虑url长度限制问题，对上报内容进行筛选处理\n\n### 待续..？\n---\n\n## 参考文档\n\n[【第790期】构建可靠的前端异常监控服务-采集篇](https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651224516&idx=1&sn=077ef057e4efe325dc426ad0d315b4a7&chksm=bd49a0408a3e295676cff88c0dc304d0d181c3cf910e071ecc9a1868d480a3c473ff21bf7567&scene=21#wechat_redirect \"【第790期】构建可靠的前端异常监控服务-采集篇\")\n[【第833期】如何设计一个前端监控系统](https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651225487&idx=1&sn=060f827234606cd3e9a3771d67af4d0f&chksm=bd49a40b8a3e2d1dc9ed064543e236312e99a63e50987ae143012967366a1f691eff67a8ae1b&scene=21#wechat_redirect \"【第833期】如何设计一个前端监控系统\")\n","source":"_posts/monitor-errorlog-partone.md","raw":"---\ntitle: 前端监控--错误日志(一)\ndate: 2017-12-29 10:27:55\ntags:\n -\n---\n\n  > 我们无法保证项目面对成千上万的用户，在各类浏览器下/遇到未知数据时不出问题。对一个拥有大量用户的互联网产品而言，采集到这些数据对所负责的页面进一步的观察监控就非常有必要了。\n\n<!--more-->\n\n---\n## 页面常见异常\n\n* HTML标签异常\n* CSS展现异常\n* 文件请求异常(如样式表/图片/脚本)\n* 脚本异常\n* 网络环境引起的异常(如网速很慢/运营商强行注入标签脚本)\n* 数据请求异常\n* ...\n\n涉及用户自身网络环境的异常很难规避。展示上的异常不会影响用户使用。\n** 涉及到交互逻辑/数据提交等脚本错误，会立刻终止用户的下一步操作，监控主要抓取的是此类异常。**\n\n---\n## 信息采集\n\n设计原则：尽可能多提供错误信息及上下文/兼容多平台/多浏览器。\n\n### 脚本错误\n\n```js\nwindow.onerror = function (message, url, lineNo, columnNo, error) {};\n```\n\n* `message {String}` 错误信息，直观的错误描述信息。\n* `url {String}` 发生错误对应的脚本路径。\n* `lineNo {Number}` 错误发生的行号。\n* `columnNo {Number}` 错误发生的列号。\n* `error {Object}` 具体的 error 对象，继承自 `window.Error` 的某一类，部分属性和前面几项有重叠，但是包含更加详细的错误调用堆栈信息，这对于定位错误非常有帮助。\n\n* 注意事项\n压缩混淆过的脚本错误想深入了解错误信息需使用sourcemap（位置信息文件）。\n低版本浏览器只能提供部分信息。\n跨域的JS资源需要往资源请求加`Access-Control-Allow-Origin`及标签加`crossorigin`属性才能获取准确信息。\n\n### Ajax上下文\n\n接口请求错误，可采集`XMLHttpRequest`对象的数据，接口返回的数据\n\n### 操作上下文\n\n交互错误，采集如点击类/输入类的信息，如标签/标签内属性/输入值 (类似统计)\n\n### 浏览器数据\n\nuserAgent\n\n### 资源加载\n\n对img/link/script等资源的加载错误，给标签添加onerror回调函数，但因各类库有自己加载外部资源的方式，无法全局控制。\n\n### 其他数据(设备信息/环境数据/开发者所需数据/...)\n\n---\n## 初试\n\n> mongoose 数据库\n接口 (vue模拟)\nweb页面\n\n![flow-one](/img/monitor-errorlog/flow-one.png)\n\n### 接口dev-server.js\n\n* 连接数据库，写入数据模型\n\n```js\nconst mongoose = require('mongoose');\nconst Schema = mongoose.Schema;\n\nmongoose.connect('mongodb://192.168.80.40/test_fe');\n\n// 错误数据模型\nconst ErrorSchema = new Schema({\n  created_at: { type: Number, default: parseInt(new Date().getTime() * 0.001, 10) },\n  content: String, // 错误信息\n  headers: String, // 请求头部\n});\nmongoose.model('Error', ErrorSchema);\n```\n\n* 接口两个-获取/写入\n\n```js\napp.use(function (req, res, next) {\n  // 跨域处理\n  res.header('Access-Control-Allow-Origin', 'http://fe.office.bzdev.net');\n  res.header('Access-Control-Allow-Credentials', true);\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  // 是否为空\n  req.empty = (data, type) => {\n    if (type === 'date') {\n      return !new Date(data).getTime();\n    } else if (type === 'timestamp') {\n      return !new Date(data * 1000).getTime();\n    } else if (type === 'array') {\n      return Object.prototype.toString.call(data) !== '[object Array]' ? true :\n          data.length === 0 ? true : false;\n    } else if (type === 'object') {\n      if (Object.prototype.toString.call(data) !== '[object Object]') {\n        return true;\n      }\n      for(var key in data){\n        return false;\n      }\n      return true;\n    } else if (type === 'number') {\n      return !parseInt(data, 10) || Object.prototype.toString.call(parseInt(data, 10)) !== '[object Number]';\n    } else {\n      return !data;\n    }\n  };\n  next();\n});\n// 获取错误日志\napp.get('/geterror', function(req, res, next) {\n\n  const body = req.empty(req.body, 'object') ? req.query : req.body;\n  // 分页\n  const page = body.page ? Number(body.page) : 1;\n  const pageSize = body.limit ? Number(body.limit) : 100;\n  const start = (page - 1) * pageSize;\n\n  co(function *() {\n    const list = yield mongoose.model('Error')\n      .find()\n      .skip(start)\n      .limit(pageSize)\n      .sort({created_at: -1})\n      .exec();\n\n    res.json({\n      error_code: 0,\n      data: list,\n    })\n  }).catch(next)\n})\n// 写入错误日志\napp.get('/seterror', function(req, res, next) {\n  const body = req.empty(req.body, 'object') ? req.query : req.body;\n  const headers = req.headers;\n\n  const content = body;\n\n  if (JSON.stringify(content) === '{}') return false;\n\n  co(function *() {\n    const json = {\n      content: JSON.stringify(content),\n      headers: JSON.stringify(headers),\n      created_at: parseInt(new Date().getTime() * 0.001, 10),\n    }\n\n    yield mongoose.model('Error').create(json);\n\n    return res.json({\n      error_code: 0,\n      data: {}\n    })\n  }).catch(next);\n})\n\n```\n\n### web页面采集脚本\n\npost存在跨域问题，重复请求会被浏览器忽略，可使用图片方式上报信息\n\n```js\nnew Vue({\n  ...\n  methods: {\n    ...\n    postError: function(err) {\n     if (!err) return false;\n\n      var image = document.createElement('img');\n\n      var items = [];\n      for (var key in err) {\n        if (err[key]) items.push(key + '=' + encodeURIComponent(JSON.stringify(err[key])));\n      }\n\n      // http://192.168.80.106:8081/seterror 数据采集接口\n      image.src = 'http://192.168.80.106:8081/seterror?' + items.join('&');\n\n      // 释放资源\n      image.onload = image.onerror = function() {\n        image = image.onload = image.onerror =  null;\n      }\n    }\n    ...\n  },\n  ...\n});\n```\n\n### 坑\n* 数据量大增长快的情况下，不适合用数据库，应改用文本日志，并节流控制数据采样率\n* 需考虑url长度限制问题，对上报内容进行筛选处理\n\n### 待续..？\n---\n\n## 参考文档\n\n[【第790期】构建可靠的前端异常监控服务-采集篇](https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651224516&idx=1&sn=077ef057e4efe325dc426ad0d315b4a7&chksm=bd49a0408a3e295676cff88c0dc304d0d181c3cf910e071ecc9a1868d480a3c473ff21bf7567&scene=21#wechat_redirect \"【第790期】构建可靠的前端异常监控服务-采集篇\")\n[【第833期】如何设计一个前端监控系统](https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651225487&idx=1&sn=060f827234606cd3e9a3771d67af4d0f&chksm=bd49a40b8a3e2d1dc9ed064543e236312e99a63e50987ae143012967366a1f691eff67a8ae1b&scene=21#wechat_redirect \"【第833期】如何设计一个前端监控系统\")\n","slug":"monitor-errorlog-partone","published":1,"updated":"2018-03-02T05:42:03.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84od0001cuo2ehm1ptd00","content":"<blockquote>\n<p>我们无法保证项目面对成千上万的用户，在各类浏览器下/遇到未知数据时不出问题。对一个拥有大量用户的互联网产品而言，采集到这些数据对所负责的页面进一步的观察监控就非常有必要了。</p>\n</blockquote>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"页面常见异常\"><a href=\"#页面常见异常\" class=\"headerlink\" title=\"页面常见异常\"></a>页面常见异常</h2><ul>\n<li>HTML标签异常</li>\n<li>CSS展现异常</li>\n<li>文件请求异常(如样式表/图片/脚本)</li>\n<li>脚本异常</li>\n<li>网络环境引起的异常(如网速很慢/运营商强行注入标签脚本)</li>\n<li>数据请求异常</li>\n<li>…</li>\n</ul>\n<p>涉及用户自身网络环境的异常很难规避。展示上的异常不会影响用户使用。<br><strong> 涉及到交互逻辑/数据提交等脚本错误，会立刻终止用户的下一步操作，监控主要抓取的是此类异常。</strong></p>\n<hr>\n<h2 id=\"信息采集\"><a href=\"#信息采集\" class=\"headerlink\" title=\"信息采集\"></a>信息采集</h2><p>设计原则：尽可能多提供错误信息及上下文/兼容多平台/多浏览器。</p>\n<h3 id=\"脚本错误\"><a href=\"#脚本错误\" class=\"headerlink\" title=\"脚本错误\"></a>脚本错误</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">message, url, lineNo, columnNo, error</span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>message {String}</code> 错误信息，直观的错误描述信息。</li>\n<li><code>url {String}</code> 发生错误对应的脚本路径。</li>\n<li><code>lineNo {Number}</code> 错误发生的行号。</li>\n<li><code>columnNo {Number}</code> 错误发生的列号。</li>\n<li><p><code>error {Object}</code> 具体的 error 对象，继承自 <code>window.Error</code> 的某一类，部分属性和前面几项有重叠，但是包含更加详细的错误调用堆栈信息，这对于定位错误非常有帮助。</p>\n</li>\n<li><p>注意事项<br>压缩混淆过的脚本错误想深入了解错误信息需使用sourcemap（位置信息文件）。<br>低版本浏览器只能提供部分信息。<br>跨域的JS资源需要往资源请求加<code>Access-Control-Allow-Origin</code>及标签加<code>crossorigin</code>属性才能获取准确信息。</p>\n</li>\n</ul>\n<h3 id=\"Ajax上下文\"><a href=\"#Ajax上下文\" class=\"headerlink\" title=\"Ajax上下文\"></a>Ajax上下文</h3><p>接口请求错误，可采集<code>XMLHttpRequest</code>对象的数据，接口返回的数据</p>\n<h3 id=\"操作上下文\"><a href=\"#操作上下文\" class=\"headerlink\" title=\"操作上下文\"></a>操作上下文</h3><p>交互错误，采集如点击类/输入类的信息，如标签/标签内属性/输入值 (类似统计)</p>\n<h3 id=\"浏览器数据\"><a href=\"#浏览器数据\" class=\"headerlink\" title=\"浏览器数据\"></a>浏览器数据</h3><p>userAgent</p>\n<h3 id=\"资源加载\"><a href=\"#资源加载\" class=\"headerlink\" title=\"资源加载\"></a>资源加载</h3><p>对img/link/script等资源的加载错误，给标签添加onerror回调函数，但因各类库有自己加载外部资源的方式，无法全局控制。</p>\n<h3 id=\"其他数据-设备信息-环境数据-开发者所需数据-…\"><a href=\"#其他数据-设备信息-环境数据-开发者所需数据-…\" class=\"headerlink\" title=\"其他数据(设备信息/环境数据/开发者所需数据/…)\"></a>其他数据(设备信息/环境数据/开发者所需数据/…)</h3><hr>\n<h2 id=\"初试\"><a href=\"#初试\" class=\"headerlink\" title=\"初试\"></a>初试</h2><blockquote>\n<p>mongoose 数据库<br>接口 (vue模拟)<br>web页面</p>\n</blockquote>\n<p><img src=\"/img/monitor-errorlog/flow-one.png\" alt=\"flow-one\"></p>\n<h3 id=\"接口dev-server-js\"><a href=\"#接口dev-server-js\" class=\"headerlink\" title=\"接口dev-server.js\"></a>接口dev-server.js</h3><ul>\n<li>连接数据库，写入数据模型</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">'mongoose'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> Schema = mongoose.Schema;</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.connect(<span class=\"string\">'mongodb://192.168.80.40/test_fe'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误数据模型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ErrorSchema = <span class=\"keyword\">new</span> Schema(&#123;</span><br><span class=\"line\">  created_at: &#123; <span class=\"attr\">type</span>: <span class=\"built_in\">Number</span>, <span class=\"attr\">default</span>: <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() * <span class=\"number\">0.001</span>, <span class=\"number\">10</span>) &#125;,</span><br><span class=\"line\">  content: <span class=\"built_in\">String</span>, <span class=\"comment\">// 错误信息</span></span><br><span class=\"line\">  headers: <span class=\"built_in\">String</span>, <span class=\"comment\">// 请求头部</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">mongoose.model(<span class=\"string\">'Error'</span>, ErrorSchema);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>接口两个-获取/写入</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'http://fe.office.bzdev.net'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Credentials'</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 是否为空</span></span><br><span class=\"line\">  req.empty = <span class=\"function\">(<span class=\"params\">data, type</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === <span class=\"string\">'date'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(data).getTime();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'timestamp'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(data * <span class=\"number\">1000</span>).getTime();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'array'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(data) !== <span class=\"string\">'[object Array]'</span> ? <span class=\"literal\">true</span> :</span><br><span class=\"line\">          data.length === <span class=\"number\">0</span> ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.prototype.toString.call(data) !== <span class=\"string\">'[object Object]'</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'number'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"built_in\">parseInt</span>(data, <span class=\"number\">10</span>) || <span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"built_in\">parseInt</span>(data, <span class=\"number\">10</span>)) !== <span class=\"string\">'[object Number]'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 获取错误日志</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/geterror'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> body = req.empty(req.body, <span class=\"string\">'object'</span>) ? req.query : req.body;</span><br><span class=\"line\">  <span class=\"comment\">// 分页</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = body.page ? <span class=\"built_in\">Number</span>(body.page) : <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> pageSize = body.limit ? <span class=\"built_in\">Number</span>(body.limit) : <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> start = (page - <span class=\"number\">1</span>) * pageSize;</span><br><span class=\"line\"></span><br><span class=\"line\">  co(<span class=\"function\"><span class=\"keyword\">function</span> *(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> list = <span class=\"keyword\">yield</span> mongoose.model(<span class=\"string\">'Error'</span>)</span><br><span class=\"line\">      .find()</span><br><span class=\"line\">      .skip(start)</span><br><span class=\"line\">      .limit(pageSize)</span><br><span class=\"line\">      .sort(&#123;<span class=\"attr\">created_at</span>: <span class=\"number\">-1</span>&#125;)</span><br><span class=\"line\">      .exec();</span><br><span class=\"line\"></span><br><span class=\"line\">    res.json(&#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: list,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;).catch(next)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 写入错误日志</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/seterror'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> body = req.empty(req.body, <span class=\"string\">'object'</span>) ? req.query : req.body;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> headers = req.headers;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> content = body;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">JSON</span>.stringify(content) === <span class=\"string\">'&#123;&#125;'</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  co(<span class=\"function\"><span class=\"keyword\">function</span> *(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> json = &#123;</span><br><span class=\"line\">      content: <span class=\"built_in\">JSON</span>.stringify(content),</span><br><span class=\"line\">      headers: <span class=\"built_in\">JSON</span>.stringify(headers),</span><br><span class=\"line\">      created_at: <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() * <span class=\"number\">0.001</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> mongoose.model(<span class=\"string\">'Error'</span>).create(json);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.json(&#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;).catch(next);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"web页面采集脚本\"><a href=\"#web页面采集脚本\" class=\"headerlink\" title=\"web页面采集脚本\"></a>web页面采集脚本</h3><p>post存在跨域问题，重复请求会被浏览器忽略，可使用图片方式上报信息</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    postError: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!err) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">var</span> image = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">var</span> items = [];</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> err) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err[key]) items.push(key + <span class=\"string\">'='</span> + <span class=\"built_in\">encodeURIComponent</span>(<span class=\"built_in\">JSON</span>.stringify(err[key])));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// http://192.168.80.106:8081/seterror 数据采集接口</span></span><br><span class=\"line\">      image.src = <span class=\"string\">'http://192.168.80.106:8081/seterror?'</span> + items.join(<span class=\"string\">'&amp;'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 释放资源</span></span><br><span class=\"line\">      image.onload = image.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        image = image.onload = image.onerror =  <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"坑\"><a href=\"#坑\" class=\"headerlink\" title=\"坑\"></a>坑</h3><ul>\n<li>数据量大增长快的情况下，不适合用数据库，应改用文本日志，并节流控制数据采样率</li>\n<li>需考虑url长度限制问题，对上报内容进行筛选处理</li>\n</ul>\n<h3 id=\"待续-？\"><a href=\"#待续-？\" class=\"headerlink\" title=\"待续..？\"></a>待续..？</h3><hr>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651224516&amp;idx=1&amp;sn=077ef057e4efe325dc426ad0d315b4a7&amp;chksm=bd49a0408a3e295676cff88c0dc304d0d181c3cf910e071ecc9a1868d480a3c473ff21bf7567&amp;scene=21#wechat_redirect\" title=\"【第790期】构建可靠的前端异常监控服务-采集篇\" target=\"_blank\" rel=\"noopener\">【第790期】构建可靠的前端异常监控服务-采集篇</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651225487&amp;idx=1&amp;sn=060f827234606cd3e9a3771d67af4d0f&amp;chksm=bd49a40b8a3e2d1dc9ed064543e236312e99a63e50987ae143012967366a1f691eff67a8ae1b&amp;scene=21#wechat_redirect\" title=\"【第833期】如何设计一个前端监控系统\" target=\"_blank\" rel=\"noopener\">【第833期】如何设计一个前端监控系统</a></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>我们无法保证项目面对成千上万的用户，在各类浏览器下/遇到未知数据时不出问题。对一个拥有大量用户的互联网产品而言，采集到这些数据对所负责的页面进一步的观察监控就非常有必要了。</p>\n</blockquote>","more":"<hr>\n<h2 id=\"页面常见异常\"><a href=\"#页面常见异常\" class=\"headerlink\" title=\"页面常见异常\"></a>页面常见异常</h2><ul>\n<li>HTML标签异常</li>\n<li>CSS展现异常</li>\n<li>文件请求异常(如样式表/图片/脚本)</li>\n<li>脚本异常</li>\n<li>网络环境引起的异常(如网速很慢/运营商强行注入标签脚本)</li>\n<li>数据请求异常</li>\n<li>…</li>\n</ul>\n<p>涉及用户自身网络环境的异常很难规避。展示上的异常不会影响用户使用。<br><strong> 涉及到交互逻辑/数据提交等脚本错误，会立刻终止用户的下一步操作，监控主要抓取的是此类异常。</strong></p>\n<hr>\n<h2 id=\"信息采集\"><a href=\"#信息采集\" class=\"headerlink\" title=\"信息采集\"></a>信息采集</h2><p>设计原则：尽可能多提供错误信息及上下文/兼容多平台/多浏览器。</p>\n<h3 id=\"脚本错误\"><a href=\"#脚本错误\" class=\"headerlink\" title=\"脚本错误\"></a>脚本错误</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">message, url, lineNo, columnNo, error</span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>message {String}</code> 错误信息，直观的错误描述信息。</li>\n<li><code>url {String}</code> 发生错误对应的脚本路径。</li>\n<li><code>lineNo {Number}</code> 错误发生的行号。</li>\n<li><code>columnNo {Number}</code> 错误发生的列号。</li>\n<li><p><code>error {Object}</code> 具体的 error 对象，继承自 <code>window.Error</code> 的某一类，部分属性和前面几项有重叠，但是包含更加详细的错误调用堆栈信息，这对于定位错误非常有帮助。</p>\n</li>\n<li><p>注意事项<br>压缩混淆过的脚本错误想深入了解错误信息需使用sourcemap（位置信息文件）。<br>低版本浏览器只能提供部分信息。<br>跨域的JS资源需要往资源请求加<code>Access-Control-Allow-Origin</code>及标签加<code>crossorigin</code>属性才能获取准确信息。</p>\n</li>\n</ul>\n<h3 id=\"Ajax上下文\"><a href=\"#Ajax上下文\" class=\"headerlink\" title=\"Ajax上下文\"></a>Ajax上下文</h3><p>接口请求错误，可采集<code>XMLHttpRequest</code>对象的数据，接口返回的数据</p>\n<h3 id=\"操作上下文\"><a href=\"#操作上下文\" class=\"headerlink\" title=\"操作上下文\"></a>操作上下文</h3><p>交互错误，采集如点击类/输入类的信息，如标签/标签内属性/输入值 (类似统计)</p>\n<h3 id=\"浏览器数据\"><a href=\"#浏览器数据\" class=\"headerlink\" title=\"浏览器数据\"></a>浏览器数据</h3><p>userAgent</p>\n<h3 id=\"资源加载\"><a href=\"#资源加载\" class=\"headerlink\" title=\"资源加载\"></a>资源加载</h3><p>对img/link/script等资源的加载错误，给标签添加onerror回调函数，但因各类库有自己加载外部资源的方式，无法全局控制。</p>\n<h3 id=\"其他数据-设备信息-环境数据-开发者所需数据-…\"><a href=\"#其他数据-设备信息-环境数据-开发者所需数据-…\" class=\"headerlink\" title=\"其他数据(设备信息/环境数据/开发者所需数据/…)\"></a>其他数据(设备信息/环境数据/开发者所需数据/…)</h3><hr>\n<h2 id=\"初试\"><a href=\"#初试\" class=\"headerlink\" title=\"初试\"></a>初试</h2><blockquote>\n<p>mongoose 数据库<br>接口 (vue模拟)<br>web页面</p>\n</blockquote>\n<p><img src=\"/img/monitor-errorlog/flow-one.png\" alt=\"flow-one\"></p>\n<h3 id=\"接口dev-server-js\"><a href=\"#接口dev-server-js\" class=\"headerlink\" title=\"接口dev-server.js\"></a>接口dev-server.js</h3><ul>\n<li>连接数据库，写入数据模型</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mongoose = <span class=\"built_in\">require</span>(<span class=\"string\">'mongoose'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> Schema = mongoose.Schema;</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.connect(<span class=\"string\">'mongodb://192.168.80.40/test_fe'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 错误数据模型</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> ErrorSchema = <span class=\"keyword\">new</span> Schema(&#123;</span><br><span class=\"line\">  created_at: &#123; <span class=\"attr\">type</span>: <span class=\"built_in\">Number</span>, <span class=\"attr\">default</span>: <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() * <span class=\"number\">0.001</span>, <span class=\"number\">10</span>) &#125;,</span><br><span class=\"line\">  content: <span class=\"built_in\">String</span>, <span class=\"comment\">// 错误信息</span></span><br><span class=\"line\">  headers: <span class=\"built_in\">String</span>, <span class=\"comment\">// 请求头部</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">mongoose.model(<span class=\"string\">'Error'</span>, ErrorSchema);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>接口两个-获取/写入</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'http://fe.office.bzdev.net'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Credentials'</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 是否为空</span></span><br><span class=\"line\">  req.empty = <span class=\"function\">(<span class=\"params\">data, type</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type === <span class=\"string\">'date'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(data).getTime();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'timestamp'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(data * <span class=\"number\">1000</span>).getTime();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'array'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.prototype.toString.call(data) !== <span class=\"string\">'[object Array]'</span> ? <span class=\"literal\">true</span> :</span><br><span class=\"line\">          data.length === <span class=\"number\">0</span> ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'object'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.prototype.toString.call(data) !== <span class=\"string\">'[object Object]'</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (type === <span class=\"string\">'number'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !<span class=\"built_in\">parseInt</span>(data, <span class=\"number\">10</span>) || <span class=\"built_in\">Object</span>.prototype.toString.call(<span class=\"built_in\">parseInt</span>(data, <span class=\"number\">10</span>)) !== <span class=\"string\">'[object Number]'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> !data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 获取错误日志</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/geterror'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> body = req.empty(req.body, <span class=\"string\">'object'</span>) ? req.query : req.body;</span><br><span class=\"line\">  <span class=\"comment\">// 分页</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = body.page ? <span class=\"built_in\">Number</span>(body.page) : <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> pageSize = body.limit ? <span class=\"built_in\">Number</span>(body.limit) : <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> start = (page - <span class=\"number\">1</span>) * pageSize;</span><br><span class=\"line\"></span><br><span class=\"line\">  co(<span class=\"function\"><span class=\"keyword\">function</span> *(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> list = <span class=\"keyword\">yield</span> mongoose.model(<span class=\"string\">'Error'</span>)</span><br><span class=\"line\">      .find()</span><br><span class=\"line\">      .skip(start)</span><br><span class=\"line\">      .limit(pageSize)</span><br><span class=\"line\">      .sort(&#123;<span class=\"attr\">created_at</span>: <span class=\"number\">-1</span>&#125;)</span><br><span class=\"line\">      .exec();</span><br><span class=\"line\"></span><br><span class=\"line\">    res.json(&#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: list,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;).catch(next)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 写入错误日志</span></span><br><span class=\"line\">app.get(<span class=\"string\">'/seterror'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> body = req.empty(req.body, <span class=\"string\">'object'</span>) ? req.query : req.body;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> headers = req.headers;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> content = body;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">JSON</span>.stringify(content) === <span class=\"string\">'&#123;&#125;'</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  co(<span class=\"function\"><span class=\"keyword\">function</span> *(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> json = &#123;</span><br><span class=\"line\">      content: <span class=\"built_in\">JSON</span>.stringify(content),</span><br><span class=\"line\">      headers: <span class=\"built_in\">JSON</span>.stringify(headers),</span><br><span class=\"line\">      created_at: <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() * <span class=\"number\">0.001</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> mongoose.model(<span class=\"string\">'Error'</span>).create(json);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.json(&#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;&#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;).catch(next);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"web页面采集脚本\"><a href=\"#web页面采集脚本\" class=\"headerlink\" title=\"web页面采集脚本\"></a>web页面采集脚本</h3><p>post存在跨域问题，重复请求会被浏览器忽略，可使用图片方式上报信息</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    postError: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!err) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">var</span> image = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'img'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">var</span> items = [];</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> err) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err[key]) items.push(key + <span class=\"string\">'='</span> + <span class=\"built_in\">encodeURIComponent</span>(<span class=\"built_in\">JSON</span>.stringify(err[key])));</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// http://192.168.80.106:8081/seterror 数据采集接口</span></span><br><span class=\"line\">      image.src = <span class=\"string\">'http://192.168.80.106:8081/seterror?'</span> + items.join(<span class=\"string\">'&amp;'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 释放资源</span></span><br><span class=\"line\">      image.onload = image.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        image = image.onload = image.onerror =  <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"坑\"><a href=\"#坑\" class=\"headerlink\" title=\"坑\"></a>坑</h3><ul>\n<li>数据量大增长快的情况下，不适合用数据库，应改用文本日志，并节流控制数据采样率</li>\n<li>需考虑url长度限制问题，对上报内容进行筛选处理</li>\n</ul>\n<h3 id=\"待续-？\"><a href=\"#待续-？\" class=\"headerlink\" title=\"待续..？\"></a>待续..？</h3><hr>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651224516&amp;idx=1&amp;sn=077ef057e4efe325dc426ad0d315b4a7&amp;chksm=bd49a0408a3e295676cff88c0dc304d0d181c3cf910e071ecc9a1868d480a3c473ff21bf7567&amp;scene=21#wechat_redirect\" title=\"【第790期】构建可靠的前端异常监控服务-采集篇\" target=\"_blank\" rel=\"noopener\">【第790期】构建可靠的前端异常监控服务-采集篇</a><br><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651225487&amp;idx=1&amp;sn=060f827234606cd3e9a3771d67af4d0f&amp;chksm=bd49a40b8a3e2d1dc9ed064543e236312e99a63e50987ae143012967366a1f691eff67a8ae1b&amp;scene=21#wechat_redirect\" title=\"【第833期】如何设计一个前端监控系统\" target=\"_blank\" rel=\"noopener\">【第833期】如何设计一个前端监控系统</a></p>"},{"title":"文章规范","date":"2017-08-07T16:00:00.000Z","_content":"\n## 文章标签\n\n所有标签必须采用小写形式，单一词组\n新增的标签必须自己手动在 `tags/index.md` 加入进去<!--more-->\n\n\n## 代码风格\n\n### html\n\n``` html\n<html>\n  <head>\n    <title>Hello World</title>\n  </head>\n  <body>\n    <div>Hello World</div>\n  </body>\n</html>\n```\n\n\n### css\n\n``` css\nhtml {\n  font-size: 14px;\n}\n.class {\n  color: red;\n}\n```\n\n\n### javascript\n\n``` javascript\nconst str = '';\nfor (let i = 0; i <= 10; i++) {\n  console.log(i);\n}\n```\n\n### 阅读全文\n首页不要全部显示，只显示部分，可以用下面代码分割\n\n```markdown\n<!--more-->\n```\n","source":"_posts/note-style.md","raw":"---\ntitle: 文章规范\ndate: 2017-08-08\ntags:\n - tutotial\n---\n\n## 文章标签\n\n所有标签必须采用小写形式，单一词组\n新增的标签必须自己手动在 `tags/index.md` 加入进去<!--more-->\n\n\n## 代码风格\n\n### html\n\n``` html\n<html>\n  <head>\n    <title>Hello World</title>\n  </head>\n  <body>\n    <div>Hello World</div>\n  </body>\n</html>\n```\n\n\n### css\n\n``` css\nhtml {\n  font-size: 14px;\n}\n.class {\n  color: red;\n}\n```\n\n\n### javascript\n\n``` javascript\nconst str = '';\nfor (let i = 0; i <= 10; i++) {\n  console.log(i);\n}\n```\n\n### 阅读全文\n首页不要全部显示，只显示部分，可以用下面代码分割\n\n```markdown\n<!--more-->\n```\n","slug":"note-style","published":1,"updated":"2017-09-08T07:00:51.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84od3001fuo2erry2nt96","content":"<h2 id=\"文章标签\"><a href=\"#文章标签\" class=\"headerlink\" title=\"文章标签\"></a>文章标签</h2><p>所有标签必须采用小写形式，单一词组<br>新增的标签必须自己手动在 <code>tags/index.md</code> 加入进去<a id=\"more\"></a></p>\n<h2 id=\"代码风格\"><a href=\"#代码风格\" class=\"headerlink\" title=\"代码风格\"></a>代码风格</h2><h3 id=\"html\"><a href=\"#html\" class=\"headerlink\" title=\"html\"></a>html</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Hello World<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello World<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"css\"><a href=\"#css\" class=\"headerlink\" title=\"css\"></a>css</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">14px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"javascript\"><a href=\"#javascript\" class=\"headerlink\" title=\"javascript\"></a>javascript</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"阅读全文\"><a href=\"#阅读全文\" class=\"headerlink\" title=\"阅读全文\"></a>阅读全文</h3><p>首页不要全部显示，只显示部分，可以用下面代码分割</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"comment\">&lt;!--more--&gt;</span></span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"文章标签\"><a href=\"#文章标签\" class=\"headerlink\" title=\"文章标签\"></a>文章标签</h2><p>所有标签必须采用小写形式，单一词组<br>新增的标签必须自己手动在 <code>tags/index.md</code> 加入进去","more":"</p>\n<h2 id=\"代码风格\"><a href=\"#代码风格\" class=\"headerlink\" title=\"代码风格\"></a>代码风格</h2><h3 id=\"html\"><a href=\"#html\" class=\"headerlink\" title=\"html\"></a>html</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Hello World<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello World<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"css\"><a href=\"#css\" class=\"headerlink\" title=\"css\"></a>css</h3><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">html</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-size</span>: <span class=\"number\">14px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.class</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"javascript\"><a href=\"#javascript\" class=\"headerlink\" title=\"javascript\"></a>javascript</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> str = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt;= <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"阅读全文\"><a href=\"#阅读全文\" class=\"headerlink\" title=\"阅读全文\"></a>阅读全文</h3><p>首页不要全部显示，只显示部分，可以用下面代码分割</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"comment\">&lt;!--more--&gt;</span></span></span><br></pre></td></tr></table></figure>"},{"title":"如何把你 Github 上的模块改为可用 npm 安装","date":"2018-01-18T16:00:00.000Z","_content":"\n由于我们现在 Webpack + Vue.js 使用的频率越来越高。  \n而原有的 Sea.js 模块和现在用的 Require.js 模块，在 Webpack 中使用是比较麻烦的。  \n所以，将模块修改成标准 Node.js 模块，可以方便我们在代码中引用，减少模块的维护工作量。\n\n<!-- more -->\n\n## 修改打包代码\n\n这里以 `bz-share` 模块为例。  \n在原有的 `/build/config.js` 文件中，加入以下配置：\n\n```javascript\n{\n  // 无第三方依赖的 UMD 包，这个和 npm 安装没什么关系。这个包的作用下面会讲到。\n  'prod-noDepend': {\n    input: 'src/index.js',\n    format: 'umd',\n    moduleName: name,\n    output: path.join(modulePath, name + '-nodep.js')\n  },\n  // UMD 模块，UMD 为 Universal Module Definition 的缩写\n  'dist-common': {\n    input: 'src/index.js',\n    format: 'umd',\n    moduleName: name,\n    output: path.join('dist/', name + '.umd.js')\n  },\n  // ES6 模块，ESM 为 ES Modules 的缩写\n  'dist-esm': {\n    input: 'src/index.js',\n    format: 'es',\n    moduleName: name,\n    output: path.join('dist/', name + '.esm.js')\n  }\n}\n```\n在 `bz-share v0.2.0` 版本的时候，引入了一个使用 npm 安装的 `object-assign` 模块;  \n而我们上面三个配置打包后的代码中，是没有带有第三方模块的，只是带有引用代码。  \n这是为了避免重复引用相同的模块。  \n\n当然，所有第三方依赖包，都应该存在于你的模块 `package.json` 文件中。  \n如果没有，那之后你使用 npm 安装你的模块时，会因为缺少依赖文件而无法正常使用。\n\n\n## 修改 package.json\n\n新增以下几行代码：\n\n```diff\n{\n   \"name\": \"bz-share\",\n+  \"main\": \"dist/bz-share.umd.js\",\n+  \"module\": \"dist/bz-share.esm.js\",\n+  \"repository\": {\n+    \"type\": \"git\",\n+    \"url\": \"https://github.com/BozhongFE/bz-share.git\"\n+  },\n# 以下部分是安装依赖时自动加的\n+  \"dependencies\": {\n+    \"object-assign\": \"^4.1.1\"\n+  }\n}\n```\n\n`main` 字段，在我们使用 `require('moduleName')` 的时候，就会加载这个文件。  \n所以，这个文件需要是支持 Common.js 模块加载的。\n\n`module` 字段，在 Webpack 2.0 以上版本，和 Rollup 中，如果你使用 ES Modules 引用这个模块，那么在打包的时候，将会加载这个字段的文件。\n所以，这个文件需要是一个 ES Modules。\n\n具体可以看 [pkg.module](https://github.com/rollup/rollup/wiki/pkg.module)\n\n`repository` 字段，这个对于没有发布到 npm 上的模块，可以不写。  \n\n`dependencies` 字段，依赖文件，第三方依赖必须存在这个字段内。\n\n## 提交你的代码到 Github 上，并打上标签\n\n提交时，记得 `dist` 文件夹要一起提交。  \n提交到 Github 后，打上版本标签。  \n比如 `bz-share` 模块更新到 `0.2.0` 版本。那么，这个时候我们应该打上一个 `v0.2.0` 的标签。命令如下：\n\n```bash\n# 添加一个标签，并写上标签说明\ngit tag -a v0.2.0 -m \"my version 0.2.0\"\n\n# 将当前标签提交到远程服务器\ngit push origin v0.2.0\n```\n\n这时候，就可以使用以下命令进行模块的安装了：\n\n```bash\n# 安装指定版本\nnpm install https://github.com/BozhongFE/bz-share#v0.2.0\n# or\nnpm install github:BozhongFE/bz-share#v0.2.0\n\n# 安装最新版本，需要注意的是，这里安装的是最新提交的代码，而不是最后一个 tag 的代码\n# 不推荐使用这种方式，因为这种方式安装的代码，无法锁定在某个版本。\n# 其他人 npm install 该模块后，可能不是同一个版本，会导致未知的错误\nnpm install https://github.com/BozhongFE/bz-share\n# or\nnpm install github:BozhongFE/bz-share\n```\n\n打上标签之后，对应标签的代码就停留在打标签的那个提交上。后续提交不会更新到那个标签上。  \n如果你打上标签之后，更改了代码，但是又不想新增一个标签。  \n你可以先删除原有标签，然后再添加一个同名标签。\n\n```bash\n# 删除本地标签\ngit tag -d v0.2.0\n\n# 删除远程标签\ngit push origin -d v0.2.0\n\n# 新增同名标签\ngit tag -a v0.2.0 -m \"new version 0.2.0\"\n\n# 推送到远程服务器\ngit push origin v0.2.0\n```\n\n更多关于 `git tag` 的资料，可以看下 [Git-基础-打标签](https://git-scm.com/book/zh/v2/Git-基础-打标签)。 \n\n## 关于上面的无依赖 UMD 包的作用\n\n这个包是在没有使用打包工具时使用。  \n比如我们使用的 `Require.js`。  \n可以这么用：\n\n```javascript\nrequirejs.config({\n  paths: {\n    'object-assign': './js/object-assign.js',\n  },\n});\n\nrequirejs([\n  'mod/bz-share/0.2.0/bz-share-nodep',\n  'mod/bz-login/0.2.0/bz-login-nodep',\n], function (bzShare, bzLogin) {\n  // ...\n});\n```\n\n这样就可以避免多次引用同一个第三方依赖，造成不必要的空间浪费。  \n当然，这个第三方依赖必须支持 AMD 模块加载方式。才能在 `Require.js` 中使用。\n\n## 参考资料\n\n1. [pkg.module · rollup/rollup Wiki](https://github.com/rollup/rollup/wiki/pkg.module)\n2. [install | npm Documentation](https://docs.npmjs.com/cli/install)\n3. [Git-基础-打标签](https://git-scm.com/book/zh/v2/Git-基础-打标签)\n4. [Git查看、删除、重命名远程分支和tag](https://blog.zengrong.net/post/1746.html)","source":"_posts/npm-install-module-from-github.md","raw":"---\ntitle: 如何把你 Github 上的模块改为可用 npm 安装\ndate: 2018-01-19\ntag: \n- npm\n- javascript\n- Github\n---\n\n由于我们现在 Webpack + Vue.js 使用的频率越来越高。  \n而原有的 Sea.js 模块和现在用的 Require.js 模块，在 Webpack 中使用是比较麻烦的。  \n所以，将模块修改成标准 Node.js 模块，可以方便我们在代码中引用，减少模块的维护工作量。\n\n<!-- more -->\n\n## 修改打包代码\n\n这里以 `bz-share` 模块为例。  \n在原有的 `/build/config.js` 文件中，加入以下配置：\n\n```javascript\n{\n  // 无第三方依赖的 UMD 包，这个和 npm 安装没什么关系。这个包的作用下面会讲到。\n  'prod-noDepend': {\n    input: 'src/index.js',\n    format: 'umd',\n    moduleName: name,\n    output: path.join(modulePath, name + '-nodep.js')\n  },\n  // UMD 模块，UMD 为 Universal Module Definition 的缩写\n  'dist-common': {\n    input: 'src/index.js',\n    format: 'umd',\n    moduleName: name,\n    output: path.join('dist/', name + '.umd.js')\n  },\n  // ES6 模块，ESM 为 ES Modules 的缩写\n  'dist-esm': {\n    input: 'src/index.js',\n    format: 'es',\n    moduleName: name,\n    output: path.join('dist/', name + '.esm.js')\n  }\n}\n```\n在 `bz-share v0.2.0` 版本的时候，引入了一个使用 npm 安装的 `object-assign` 模块;  \n而我们上面三个配置打包后的代码中，是没有带有第三方模块的，只是带有引用代码。  \n这是为了避免重复引用相同的模块。  \n\n当然，所有第三方依赖包，都应该存在于你的模块 `package.json` 文件中。  \n如果没有，那之后你使用 npm 安装你的模块时，会因为缺少依赖文件而无法正常使用。\n\n\n## 修改 package.json\n\n新增以下几行代码：\n\n```diff\n{\n   \"name\": \"bz-share\",\n+  \"main\": \"dist/bz-share.umd.js\",\n+  \"module\": \"dist/bz-share.esm.js\",\n+  \"repository\": {\n+    \"type\": \"git\",\n+    \"url\": \"https://github.com/BozhongFE/bz-share.git\"\n+  },\n# 以下部分是安装依赖时自动加的\n+  \"dependencies\": {\n+    \"object-assign\": \"^4.1.1\"\n+  }\n}\n```\n\n`main` 字段，在我们使用 `require('moduleName')` 的时候，就会加载这个文件。  \n所以，这个文件需要是支持 Common.js 模块加载的。\n\n`module` 字段，在 Webpack 2.0 以上版本，和 Rollup 中，如果你使用 ES Modules 引用这个模块，那么在打包的时候，将会加载这个字段的文件。\n所以，这个文件需要是一个 ES Modules。\n\n具体可以看 [pkg.module](https://github.com/rollup/rollup/wiki/pkg.module)\n\n`repository` 字段，这个对于没有发布到 npm 上的模块，可以不写。  \n\n`dependencies` 字段，依赖文件，第三方依赖必须存在这个字段内。\n\n## 提交你的代码到 Github 上，并打上标签\n\n提交时，记得 `dist` 文件夹要一起提交。  \n提交到 Github 后，打上版本标签。  \n比如 `bz-share` 模块更新到 `0.2.0` 版本。那么，这个时候我们应该打上一个 `v0.2.0` 的标签。命令如下：\n\n```bash\n# 添加一个标签，并写上标签说明\ngit tag -a v0.2.0 -m \"my version 0.2.0\"\n\n# 将当前标签提交到远程服务器\ngit push origin v0.2.0\n```\n\n这时候，就可以使用以下命令进行模块的安装了：\n\n```bash\n# 安装指定版本\nnpm install https://github.com/BozhongFE/bz-share#v0.2.0\n# or\nnpm install github:BozhongFE/bz-share#v0.2.0\n\n# 安装最新版本，需要注意的是，这里安装的是最新提交的代码，而不是最后一个 tag 的代码\n# 不推荐使用这种方式，因为这种方式安装的代码，无法锁定在某个版本。\n# 其他人 npm install 该模块后，可能不是同一个版本，会导致未知的错误\nnpm install https://github.com/BozhongFE/bz-share\n# or\nnpm install github:BozhongFE/bz-share\n```\n\n打上标签之后，对应标签的代码就停留在打标签的那个提交上。后续提交不会更新到那个标签上。  \n如果你打上标签之后，更改了代码，但是又不想新增一个标签。  \n你可以先删除原有标签，然后再添加一个同名标签。\n\n```bash\n# 删除本地标签\ngit tag -d v0.2.0\n\n# 删除远程标签\ngit push origin -d v0.2.0\n\n# 新增同名标签\ngit tag -a v0.2.0 -m \"new version 0.2.0\"\n\n# 推送到远程服务器\ngit push origin v0.2.0\n```\n\n更多关于 `git tag` 的资料，可以看下 [Git-基础-打标签](https://git-scm.com/book/zh/v2/Git-基础-打标签)。 \n\n## 关于上面的无依赖 UMD 包的作用\n\n这个包是在没有使用打包工具时使用。  \n比如我们使用的 `Require.js`。  \n可以这么用：\n\n```javascript\nrequirejs.config({\n  paths: {\n    'object-assign': './js/object-assign.js',\n  },\n});\n\nrequirejs([\n  'mod/bz-share/0.2.0/bz-share-nodep',\n  'mod/bz-login/0.2.0/bz-login-nodep',\n], function (bzShare, bzLogin) {\n  // ...\n});\n```\n\n这样就可以避免多次引用同一个第三方依赖，造成不必要的空间浪费。  \n当然，这个第三方依赖必须支持 AMD 模块加载方式。才能在 `Require.js` 中使用。\n\n## 参考资料\n\n1. [pkg.module · rollup/rollup Wiki](https://github.com/rollup/rollup/wiki/pkg.module)\n2. [install | npm Documentation](https://docs.npmjs.com/cli/install)\n3. [Git-基础-打标签](https://git-scm.com/book/zh/v2/Git-基础-打标签)\n4. [Git查看、删除、重命名远程分支和tag](https://blog.zengrong.net/post/1746.html)","slug":"npm-install-module-from-github","published":1,"updated":"2018-03-02T05:42:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84od6001huo2e6s2b5w02","content":"<p>由于我们现在 Webpack + Vue.js 使用的频率越来越高。<br>而原有的 Sea.js 模块和现在用的 Require.js 模块，在 Webpack 中使用是比较麻烦的。<br>所以，将模块修改成标准 Node.js 模块，可以方便我们在代码中引用，减少模块的维护工作量。</p>\n<a id=\"more\"></a>\n<h2 id=\"修改打包代码\"><a href=\"#修改打包代码\" class=\"headerlink\" title=\"修改打包代码\"></a>修改打包代码</h2><p>这里以 <code>bz-share</code> 模块为例。<br>在原有的 <code>/build/config.js</code> 文件中，加入以下配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 无第三方依赖的 UMD 包，这个和 npm 安装没什么关系。这个包的作用下面会讲到。</span></span><br><span class=\"line\">  <span class=\"string\">'prod-noDepend'</span>: &#123;</span><br><span class=\"line\">    input: <span class=\"string\">'src/index.js'</span>,</span><br><span class=\"line\">    format: <span class=\"string\">'umd'</span>,</span><br><span class=\"line\">    moduleName: name,</span><br><span class=\"line\">    output: path.join(modulePath, name + <span class=\"string\">'-nodep.js'</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// UMD 模块，UMD 为 Universal Module Definition 的缩写</span></span><br><span class=\"line\">  <span class=\"string\">'dist-common'</span>: &#123;</span><br><span class=\"line\">    input: <span class=\"string\">'src/index.js'</span>,</span><br><span class=\"line\">    format: <span class=\"string\">'umd'</span>,</span><br><span class=\"line\">    moduleName: name,</span><br><span class=\"line\">    output: path.join(<span class=\"string\">'dist/'</span>, name + <span class=\"string\">'.umd.js'</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// ES6 模块，ESM 为 ES Modules 的缩写</span></span><br><span class=\"line\">  <span class=\"string\">'dist-esm'</span>: &#123;</span><br><span class=\"line\">    input: <span class=\"string\">'src/index.js'</span>,</span><br><span class=\"line\">    format: <span class=\"string\">'es'</span>,</span><br><span class=\"line\">    moduleName: name,</span><br><span class=\"line\">    output: path.join(<span class=\"string\">'dist/'</span>, name + <span class=\"string\">'.esm.js'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 <code>bz-share v0.2.0</code> 版本的时候，引入了一个使用 npm 安装的 <code>object-assign</code> 模块;<br>而我们上面三个配置打包后的代码中，是没有带有第三方模块的，只是带有引用代码。<br>这是为了避免重复引用相同的模块。  </p>\n<p>当然，所有第三方依赖包，都应该存在于你的模块 <code>package.json</code> 文件中。<br>如果没有，那之后你使用 npm 安装你的模块时，会因为缺少依赖文件而无法正常使用。</p>\n<h2 id=\"修改-package-json\"><a href=\"#修改-package-json\" class=\"headerlink\" title=\"修改 package.json\"></a>修改 package.json</h2><p>新增以下几行代码：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   \"name\": \"bz-share\",</span><br><span class=\"line\"><span class=\"addition\">+  \"main\": \"dist/bz-share.umd.js\",</span></span><br><span class=\"line\"><span class=\"addition\">+  \"module\": \"dist/bz-share.esm.js\",</span></span><br><span class=\"line\"><span class=\"addition\">+  \"repository\": &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    \"type\": \"git\",</span></span><br><span class=\"line\"><span class=\"addition\">+    \"url\": \"https://github.com/BozhongFE/bz-share.git\"</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;,</span></span><br><span class=\"line\"># 以下部分是安装依赖时自动加的</span><br><span class=\"line\"><span class=\"addition\">+  \"dependencies\": &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    \"object-assign\": \"^4.1.1\"</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>main</code> 字段，在我们使用 <code>require(&#39;moduleName&#39;)</code> 的时候，就会加载这个文件。<br>所以，这个文件需要是支持 Common.js 模块加载的。</p>\n<p><code>module</code> 字段，在 Webpack 2.0 以上版本，和 Rollup 中，如果你使用 ES Modules 引用这个模块，那么在打包的时候，将会加载这个字段的文件。<br>所以，这个文件需要是一个 ES Modules。</p>\n<p>具体可以看 <a href=\"https://github.com/rollup/rollup/wiki/pkg.module\" target=\"_blank\" rel=\"noopener\">pkg.module</a></p>\n<p><code>repository</code> 字段，这个对于没有发布到 npm 上的模块，可以不写。  </p>\n<p><code>dependencies</code> 字段，依赖文件，第三方依赖必须存在这个字段内。</p>\n<h2 id=\"提交你的代码到-Github-上，并打上标签\"><a href=\"#提交你的代码到-Github-上，并打上标签\" class=\"headerlink\" title=\"提交你的代码到 Github 上，并打上标签\"></a>提交你的代码到 Github 上，并打上标签</h2><p>提交时，记得 <code>dist</code> 文件夹要一起提交。<br>提交到 Github 后，打上版本标签。<br>比如 <code>bz-share</code> 模块更新到 <code>0.2.0</code> 版本。那么，这个时候我们应该打上一个 <code>v0.2.0</code> 的标签。命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加一个标签，并写上标签说明</span></span><br><span class=\"line\">git tag -a v0.2.0 -m <span class=\"string\">\"my version 0.2.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将当前标签提交到远程服务器</span></span><br><span class=\"line\">git push origin v0.2.0</span><br></pre></td></tr></table></figure>\n<p>这时候，就可以使用以下命令进行模块的安装了：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装指定版本</span></span><br><span class=\"line\">npm install https://github.com/BozhongFE/bz-share<span class=\"comment\">#v0.2.0</span></span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\">npm install github:BozhongFE/bz-share<span class=\"comment\">#v0.2.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装最新版本，需要注意的是，这里安装的是最新提交的代码，而不是最后一个 tag 的代码</span></span><br><span class=\"line\"><span class=\"comment\"># 不推荐使用这种方式，因为这种方式安装的代码，无法锁定在某个版本。</span></span><br><span class=\"line\"><span class=\"comment\"># 其他人 npm install 该模块后，可能不是同一个版本，会导致未知的错误</span></span><br><span class=\"line\">npm install https://github.com/BozhongFE/bz-share</span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\">npm install github:BozhongFE/bz-share</span><br></pre></td></tr></table></figure>\n<p>打上标签之后，对应标签的代码就停留在打标签的那个提交上。后续提交不会更新到那个标签上。<br>如果你打上标签之后，更改了代码，但是又不想新增一个标签。<br>你可以先删除原有标签，然后再添加一个同名标签。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 删除本地标签</span></span><br><span class=\"line\">git tag -d v0.2.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程标签</span></span><br><span class=\"line\">git push origin -d v0.2.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新增同名标签</span></span><br><span class=\"line\">git tag -a v0.2.0 -m <span class=\"string\">\"new version 0.2.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送到远程服务器</span></span><br><span class=\"line\">git push origin v0.2.0</span><br></pre></td></tr></table></figure>\n<p>更多关于 <code>git tag</code> 的资料，可以看下 <a href=\"https://git-scm.com/book/zh/v2/Git-基础-打标签\" target=\"_blank\" rel=\"noopener\">Git-基础-打标签</a>。 </p>\n<h2 id=\"关于上面的无依赖-UMD-包的作用\"><a href=\"#关于上面的无依赖-UMD-包的作用\" class=\"headerlink\" title=\"关于上面的无依赖 UMD 包的作用\"></a>关于上面的无依赖 UMD 包的作用</h2><p>这个包是在没有使用打包工具时使用。<br>比如我们使用的 <code>Require.js</code>。<br>可以这么用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    <span class=\"string\">'object-assign'</span>: <span class=\"string\">'./js/object-assign.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">requirejs([</span><br><span class=\"line\">  <span class=\"string\">'mod/bz-share/0.2.0/bz-share-nodep'</span>,</span><br><span class=\"line\">  <span class=\"string\">'mod/bz-login/0.2.0/bz-login-nodep'</span>,</span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">bzShare, bzLogin</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这样就可以避免多次引用同一个第三方依赖，造成不必要的空间浪费。<br>当然，这个第三方依赖必须支持 AMD 模块加载方式。才能在 <code>Require.js</code> 中使用。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li><a href=\"https://github.com/rollup/rollup/wiki/pkg.module\" target=\"_blank\" rel=\"noopener\">pkg.module · rollup/rollup Wiki</a></li>\n<li><a href=\"https://docs.npmjs.com/cli/install\" target=\"_blank\" rel=\"noopener\">install | npm Documentation</a></li>\n<li><a href=\"https://git-scm.com/book/zh/v2/Git-基础-打标签\" target=\"_blank\" rel=\"noopener\">Git-基础-打标签</a></li>\n<li><a href=\"https://blog.zengrong.net/post/1746.html\" target=\"_blank\" rel=\"noopener\">Git查看、删除、重命名远程分支和tag</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>由于我们现在 Webpack + Vue.js 使用的频率越来越高。<br>而原有的 Sea.js 模块和现在用的 Require.js 模块，在 Webpack 中使用是比较麻烦的。<br>所以，将模块修改成标准 Node.js 模块，可以方便我们在代码中引用，减少模块的维护工作量。</p>","more":"<h2 id=\"修改打包代码\"><a href=\"#修改打包代码\" class=\"headerlink\" title=\"修改打包代码\"></a>修改打包代码</h2><p>这里以 <code>bz-share</code> 模块为例。<br>在原有的 <code>/build/config.js</code> 文件中，加入以下配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 无第三方依赖的 UMD 包，这个和 npm 安装没什么关系。这个包的作用下面会讲到。</span></span><br><span class=\"line\">  <span class=\"string\">'prod-noDepend'</span>: &#123;</span><br><span class=\"line\">    input: <span class=\"string\">'src/index.js'</span>,</span><br><span class=\"line\">    format: <span class=\"string\">'umd'</span>,</span><br><span class=\"line\">    moduleName: name,</span><br><span class=\"line\">    output: path.join(modulePath, name + <span class=\"string\">'-nodep.js'</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// UMD 模块，UMD 为 Universal Module Definition 的缩写</span></span><br><span class=\"line\">  <span class=\"string\">'dist-common'</span>: &#123;</span><br><span class=\"line\">    input: <span class=\"string\">'src/index.js'</span>,</span><br><span class=\"line\">    format: <span class=\"string\">'umd'</span>,</span><br><span class=\"line\">    moduleName: name,</span><br><span class=\"line\">    output: path.join(<span class=\"string\">'dist/'</span>, name + <span class=\"string\">'.umd.js'</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// ES6 模块，ESM 为 ES Modules 的缩写</span></span><br><span class=\"line\">  <span class=\"string\">'dist-esm'</span>: &#123;</span><br><span class=\"line\">    input: <span class=\"string\">'src/index.js'</span>,</span><br><span class=\"line\">    format: <span class=\"string\">'es'</span>,</span><br><span class=\"line\">    moduleName: name,</span><br><span class=\"line\">    output: path.join(<span class=\"string\">'dist/'</span>, name + <span class=\"string\">'.esm.js'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 <code>bz-share v0.2.0</code> 版本的时候，引入了一个使用 npm 安装的 <code>object-assign</code> 模块;<br>而我们上面三个配置打包后的代码中，是没有带有第三方模块的，只是带有引用代码。<br>这是为了避免重复引用相同的模块。  </p>\n<p>当然，所有第三方依赖包，都应该存在于你的模块 <code>package.json</code> 文件中。<br>如果没有，那之后你使用 npm 安装你的模块时，会因为缺少依赖文件而无法正常使用。</p>\n<h2 id=\"修改-package-json\"><a href=\"#修改-package-json\" class=\"headerlink\" title=\"修改 package.json\"></a>修改 package.json</h2><p>新增以下几行代码：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   \"name\": \"bz-share\",</span><br><span class=\"line\"><span class=\"addition\">+  \"main\": \"dist/bz-share.umd.js\",</span></span><br><span class=\"line\"><span class=\"addition\">+  \"module\": \"dist/bz-share.esm.js\",</span></span><br><span class=\"line\"><span class=\"addition\">+  \"repository\": &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    \"type\": \"git\",</span></span><br><span class=\"line\"><span class=\"addition\">+    \"url\": \"https://github.com/BozhongFE/bz-share.git\"</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;,</span></span><br><span class=\"line\"># 以下部分是安装依赖时自动加的</span><br><span class=\"line\"><span class=\"addition\">+  \"dependencies\": &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    \"object-assign\": \"^4.1.1\"</span></span><br><span class=\"line\"><span class=\"addition\">+  &#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>main</code> 字段，在我们使用 <code>require(&#39;moduleName&#39;)</code> 的时候，就会加载这个文件。<br>所以，这个文件需要是支持 Common.js 模块加载的。</p>\n<p><code>module</code> 字段，在 Webpack 2.0 以上版本，和 Rollup 中，如果你使用 ES Modules 引用这个模块，那么在打包的时候，将会加载这个字段的文件。<br>所以，这个文件需要是一个 ES Modules。</p>\n<p>具体可以看 <a href=\"https://github.com/rollup/rollup/wiki/pkg.module\" target=\"_blank\" rel=\"noopener\">pkg.module</a></p>\n<p><code>repository</code> 字段，这个对于没有发布到 npm 上的模块，可以不写。  </p>\n<p><code>dependencies</code> 字段，依赖文件，第三方依赖必须存在这个字段内。</p>\n<h2 id=\"提交你的代码到-Github-上，并打上标签\"><a href=\"#提交你的代码到-Github-上，并打上标签\" class=\"headerlink\" title=\"提交你的代码到 Github 上，并打上标签\"></a>提交你的代码到 Github 上，并打上标签</h2><p>提交时，记得 <code>dist</code> 文件夹要一起提交。<br>提交到 Github 后，打上版本标签。<br>比如 <code>bz-share</code> 模块更新到 <code>0.2.0</code> 版本。那么，这个时候我们应该打上一个 <code>v0.2.0</code> 的标签。命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加一个标签，并写上标签说明</span></span><br><span class=\"line\">git tag -a v0.2.0 -m <span class=\"string\">\"my version 0.2.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将当前标签提交到远程服务器</span></span><br><span class=\"line\">git push origin v0.2.0</span><br></pre></td></tr></table></figure>\n<p>这时候，就可以使用以下命令进行模块的安装了：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装指定版本</span></span><br><span class=\"line\">npm install https://github.com/BozhongFE/bz-share<span class=\"comment\">#v0.2.0</span></span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\">npm install github:BozhongFE/bz-share<span class=\"comment\">#v0.2.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装最新版本，需要注意的是，这里安装的是最新提交的代码，而不是最后一个 tag 的代码</span></span><br><span class=\"line\"><span class=\"comment\"># 不推荐使用这种方式，因为这种方式安装的代码，无法锁定在某个版本。</span></span><br><span class=\"line\"><span class=\"comment\"># 其他人 npm install 该模块后，可能不是同一个版本，会导致未知的错误</span></span><br><span class=\"line\">npm install https://github.com/BozhongFE/bz-share</span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\">npm install github:BozhongFE/bz-share</span><br></pre></td></tr></table></figure>\n<p>打上标签之后，对应标签的代码就停留在打标签的那个提交上。后续提交不会更新到那个标签上。<br>如果你打上标签之后，更改了代码，但是又不想新增一个标签。<br>你可以先删除原有标签，然后再添加一个同名标签。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 删除本地标签</span></span><br><span class=\"line\">git tag -d v0.2.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程标签</span></span><br><span class=\"line\">git push origin -d v0.2.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新增同名标签</span></span><br><span class=\"line\">git tag -a v0.2.0 -m <span class=\"string\">\"new version 0.2.0\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送到远程服务器</span></span><br><span class=\"line\">git push origin v0.2.0</span><br></pre></td></tr></table></figure>\n<p>更多关于 <code>git tag</code> 的资料，可以看下 <a href=\"https://git-scm.com/book/zh/v2/Git-基础-打标签\" target=\"_blank\" rel=\"noopener\">Git-基础-打标签</a>。 </p>\n<h2 id=\"关于上面的无依赖-UMD-包的作用\"><a href=\"#关于上面的无依赖-UMD-包的作用\" class=\"headerlink\" title=\"关于上面的无依赖 UMD 包的作用\"></a>关于上面的无依赖 UMD 包的作用</h2><p>这个包是在没有使用打包工具时使用。<br>比如我们使用的 <code>Require.js</code>。<br>可以这么用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    <span class=\"string\">'object-assign'</span>: <span class=\"string\">'./js/object-assign.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">requirejs([</span><br><span class=\"line\">  <span class=\"string\">'mod/bz-share/0.2.0/bz-share-nodep'</span>,</span><br><span class=\"line\">  <span class=\"string\">'mod/bz-login/0.2.0/bz-login-nodep'</span>,</span><br><span class=\"line\">], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">bzShare, bzLogin</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这样就可以避免多次引用同一个第三方依赖，造成不必要的空间浪费。<br>当然，这个第三方依赖必须支持 AMD 模块加载方式。才能在 <code>Require.js</code> 中使用。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li><a href=\"https://github.com/rollup/rollup/wiki/pkg.module\" target=\"_blank\" rel=\"noopener\">pkg.module · rollup/rollup Wiki</a></li>\n<li><a href=\"https://docs.npmjs.com/cli/install\" target=\"_blank\" rel=\"noopener\">install | npm Documentation</a></li>\n<li><a href=\"https://git-scm.com/book/zh/v2/Git-基础-打标签\" target=\"_blank\" rel=\"noopener\">Git-基础-打标签</a></li>\n<li><a href=\"https://blog.zengrong.net/post/1746.html\" target=\"_blank\" rel=\"noopener\">Git查看、删除、重命名远程分支和tag</a></li>\n</ol>"},{"title":"浏览器渲染及相应优化","date":"2017-09-08T04:43:29.000Z","_content":"为了保证页面的渲染效果，简单了解下浏览器是如何处理HTML/JavaScript/CSS的。\n<!--more-->\n\n---\n\n### 页面渲染过程（以Chrome为例）\n\n  一个页面更新时，渲染过程大致如下：\n\n  ![browser-render](/img/browser-render/Image1.png)\n\n* `JavaScript` 为了实现动画效果，用js对DOM元素操作等。\n* `Style` 计算样式，如果元素的样式有改变，在这一步重新计算样式，并匹配到对应的DOM上。\n* `Layout` 根据上一步的DOM样式规则，重新进行布局（重排）。\n* `Paint` 在多个渲染层上，对新的布局重新绘制（重绘）。\n* `Composite` 将绘制好的多个渲染层合并，显示到屏幕上。\n\n  网页生成时，至少会 `渲染 （Layout+Paint）`一次。用户访问过程中，会不断地`重排（reflow）`和`重绘（repaint）`，页面重绘的速度要比页面重排的速度快。\n\n* `重排（reflow）` 因为元素的规模尺寸，布局，隐藏等改变而需要浏览器重新计算页面元素位置和几何结构（geometries）的进程。\n* `重绘（repaint）` 一些元素需要更新属性，这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。\n\n  实际场景下，大概会有三种常见的渲染流程（也即是Layout和Paint步骤是可避免的）：\n\n  ![browser-render](/img/browser-render/Image2.png)\n\n### 核心问题\n\n* 大多数设备的刷新频率是`60次/秒`，也就说是浏览器对每一帧画面的渲染工作要在`16ms内`完成，超出这个时间，页面的渲染就会出现卡顿现象，影响用户体验。\n\n* 浏览器不会在js执行的时候更新DOM，而是会把这些DOM操作存放在一个队列中，在js执行完之后按顺序一次性执行完毕，因此在js执行过程中用户一直在被阻塞。若js中存在很多DOM操作，就会不断地重绘或重排，影响页面性能。\n\n\n\n### DOM操作对页面性能的影响\n\n  `重排（Reflow）`的性能消耗比`重绘（Repaint）`的高很多。一个节点的重排很有可能导致子节点，甚至父节点以及同级节点的重排。在一些高性能的电脑上也许还没什么，但是如果reflow发生在一些手机上，那么这个过程是非常痛苦和耗电的。\n\n**触发重排的原因简单有以下几个：**\n\n* DOM元素的几何属性变化,以及dom的显示和隐藏(单指display,不包括visibility)\n* DOM树的结构变化\n* **获取某些属性或调用某些方法**\n* window的resize或者scroll\n* font-size的改变\n\n  浏览器在底层会进行一些优化，具体是指它会将多个DOM操作合并在一起，批量更新，但是第三点提到的操作则会中断该过程，造成额外的重排，以下方法属性会间接引起重排:\n\n* `clientHeight` `clientLeft` `clientTop` `clientWidth` `focus()` `getBoundingClientRect()` `getClientRects()` `innerText` `offsetHeight` `offsetLeft` `offsetParent` `offsetTop` `offsetWidth` `outerText, scrollByLines()` `scrollByPages()` `scrollHeight` `scrollIntoView()` `scrollIntoViewIfNeeded()` `scrollLeft` `scrollTop` `scrollWidth`\n* `height` `width`\n* `getBoundingClientRect()` `getClientRects()`\n* `computeCTM()` `getBBox()`\n* `getCharNumAtPosition()` `getComputedTextLength()` `getEndPositionOfChar()` `getExtentOfChar()` `getNumberOfChars()` `getRotationOfChar()` `getStartPositionOfChar()` `getSubStringLength()` `selectSubString()`\n* `instanceRoot`\n* `getComputedStyle()` `scrollBy()` `scrollTo()` `scrollX` `scrollY`\n`webkitConvertPointFromNodeToPage()` `webkitConvertPointFromPageToNode()`\n\n\n\n**触发重绘的原因：**\n* 只改变了元素的样式，并未改变元素大小、位置。\n* 一个元素的重排一定会影响到渲染树的变化，因此也一定会涉及到页面的重绘。\n\n  重绘和重排也有类似规律，触发它不会触发重排，但还是会触发渲染层的合并，性能开销同样不低。若页面动效不可避免的话，依靠重排来实现也是一个较好的方法\n\n\n### 优化（针对浏览器渲染）\n\n* **优化JavaScript的执行效率**\n\n* **降低样式计算的范围和复杂度**\n  * 减少需要执行样式计算的元素个数\n  * 保持class的简短\n\n  ```css\n  .box:nth-last-child(-n+1) .title {\n  }\n\n  //改善后\n  .final-box-title {\n  }\n  ```\n\n  CSS选择器效率从高到低的排序：\n  * id选择器 `#myid`\n  * 类选择器 `.myclassname`\n  * 标签选择器 `div,h1,p`\n  * 相邻选择器 `h1+p`\n  * 子选择器 `ul < li`\n  * 后代选择器 `li a`\n  * 通配符选择器 `*`\n  * 属性选择器 `a[rel=\"external\"]`\n  * 伪类选择器 `a:hover,li:nth-child`\n\n\n* **避免大规模、复杂的布局**\n * 尽量控制DOM的显示或隐藏，而不是删除或添加。\n * 尽量使用flexbox，flexbox布局性能消耗会少于旧的布局模型（相对/绝对/浮动）。\n * 避免让浏览器陷入'读写读写'循环，在循环外部做变量储存，一次性操作DOM。\n * 使用class设计样式，不要使用style，每一次赋值都会重新渲染页面。\n\n\n* **简化绘制的复杂度、减少绘制区域**\n\n\n* **优先使用渲染层合并属性、控制层数量**\n  使用transform/opacity实现动画效果，会跳过渲染流程的布局和绘制环节，只做渲染层的合并。\n\n\n* **对用户输入事件/滚动事件等处理函数去抖动（移动设备）**\n  使用由浏览器专门为动画提供的API - requestAnimationFrame()\n\n### 参考文档\n\n[【渲染原理】浏览器渲染原理的个人整理](http://www.cnblogs.com/mfoonirlee/p/6903876.html \"【渲染原理】浏览器渲染原理的个人整理\")\n[深度剖析浏览器渲染性能原理，你到底知道多少？](http://www.jianshu.com/p/a32b890c29b1 \"深度剖析浏览器渲染性能原理，你到底知道多少？\")\n[高频 dom 操作和页面性能优化探索](http://web.jobbole.com/92320/ \"高频 dom 操作和页面性能优化探索\")\n\n\n","source":"_posts/optimize-browser-rendering.md","raw":"---\ntitle: 浏览器渲染及相应优化\ndate: 2017-09-08 12:43:29\ntags:\n - optimize\n---\n为了保证页面的渲染效果，简单了解下浏览器是如何处理HTML/JavaScript/CSS的。\n<!--more-->\n\n---\n\n### 页面渲染过程（以Chrome为例）\n\n  一个页面更新时，渲染过程大致如下：\n\n  ![browser-render](/img/browser-render/Image1.png)\n\n* `JavaScript` 为了实现动画效果，用js对DOM元素操作等。\n* `Style` 计算样式，如果元素的样式有改变，在这一步重新计算样式，并匹配到对应的DOM上。\n* `Layout` 根据上一步的DOM样式规则，重新进行布局（重排）。\n* `Paint` 在多个渲染层上，对新的布局重新绘制（重绘）。\n* `Composite` 将绘制好的多个渲染层合并，显示到屏幕上。\n\n  网页生成时，至少会 `渲染 （Layout+Paint）`一次。用户访问过程中，会不断地`重排（reflow）`和`重绘（repaint）`，页面重绘的速度要比页面重排的速度快。\n\n* `重排（reflow）` 因为元素的规模尺寸，布局，隐藏等改变而需要浏览器重新计算页面元素位置和几何结构（geometries）的进程。\n* `重绘（repaint）` 一些元素需要更新属性，这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。\n\n  实际场景下，大概会有三种常见的渲染流程（也即是Layout和Paint步骤是可避免的）：\n\n  ![browser-render](/img/browser-render/Image2.png)\n\n### 核心问题\n\n* 大多数设备的刷新频率是`60次/秒`，也就说是浏览器对每一帧画面的渲染工作要在`16ms内`完成，超出这个时间，页面的渲染就会出现卡顿现象，影响用户体验。\n\n* 浏览器不会在js执行的时候更新DOM，而是会把这些DOM操作存放在一个队列中，在js执行完之后按顺序一次性执行完毕，因此在js执行过程中用户一直在被阻塞。若js中存在很多DOM操作，就会不断地重绘或重排，影响页面性能。\n\n\n\n### DOM操作对页面性能的影响\n\n  `重排（Reflow）`的性能消耗比`重绘（Repaint）`的高很多。一个节点的重排很有可能导致子节点，甚至父节点以及同级节点的重排。在一些高性能的电脑上也许还没什么，但是如果reflow发生在一些手机上，那么这个过程是非常痛苦和耗电的。\n\n**触发重排的原因简单有以下几个：**\n\n* DOM元素的几何属性变化,以及dom的显示和隐藏(单指display,不包括visibility)\n* DOM树的结构变化\n* **获取某些属性或调用某些方法**\n* window的resize或者scroll\n* font-size的改变\n\n  浏览器在底层会进行一些优化，具体是指它会将多个DOM操作合并在一起，批量更新，但是第三点提到的操作则会中断该过程，造成额外的重排，以下方法属性会间接引起重排:\n\n* `clientHeight` `clientLeft` `clientTop` `clientWidth` `focus()` `getBoundingClientRect()` `getClientRects()` `innerText` `offsetHeight` `offsetLeft` `offsetParent` `offsetTop` `offsetWidth` `outerText, scrollByLines()` `scrollByPages()` `scrollHeight` `scrollIntoView()` `scrollIntoViewIfNeeded()` `scrollLeft` `scrollTop` `scrollWidth`\n* `height` `width`\n* `getBoundingClientRect()` `getClientRects()`\n* `computeCTM()` `getBBox()`\n* `getCharNumAtPosition()` `getComputedTextLength()` `getEndPositionOfChar()` `getExtentOfChar()` `getNumberOfChars()` `getRotationOfChar()` `getStartPositionOfChar()` `getSubStringLength()` `selectSubString()`\n* `instanceRoot`\n* `getComputedStyle()` `scrollBy()` `scrollTo()` `scrollX` `scrollY`\n`webkitConvertPointFromNodeToPage()` `webkitConvertPointFromPageToNode()`\n\n\n\n**触发重绘的原因：**\n* 只改变了元素的样式，并未改变元素大小、位置。\n* 一个元素的重排一定会影响到渲染树的变化，因此也一定会涉及到页面的重绘。\n\n  重绘和重排也有类似规律，触发它不会触发重排，但还是会触发渲染层的合并，性能开销同样不低。若页面动效不可避免的话，依靠重排来实现也是一个较好的方法\n\n\n### 优化（针对浏览器渲染）\n\n* **优化JavaScript的执行效率**\n\n* **降低样式计算的范围和复杂度**\n  * 减少需要执行样式计算的元素个数\n  * 保持class的简短\n\n  ```css\n  .box:nth-last-child(-n+1) .title {\n  }\n\n  //改善后\n  .final-box-title {\n  }\n  ```\n\n  CSS选择器效率从高到低的排序：\n  * id选择器 `#myid`\n  * 类选择器 `.myclassname`\n  * 标签选择器 `div,h1,p`\n  * 相邻选择器 `h1+p`\n  * 子选择器 `ul < li`\n  * 后代选择器 `li a`\n  * 通配符选择器 `*`\n  * 属性选择器 `a[rel=\"external\"]`\n  * 伪类选择器 `a:hover,li:nth-child`\n\n\n* **避免大规模、复杂的布局**\n * 尽量控制DOM的显示或隐藏，而不是删除或添加。\n * 尽量使用flexbox，flexbox布局性能消耗会少于旧的布局模型（相对/绝对/浮动）。\n * 避免让浏览器陷入'读写读写'循环，在循环外部做变量储存，一次性操作DOM。\n * 使用class设计样式，不要使用style，每一次赋值都会重新渲染页面。\n\n\n* **简化绘制的复杂度、减少绘制区域**\n\n\n* **优先使用渲染层合并属性、控制层数量**\n  使用transform/opacity实现动画效果，会跳过渲染流程的布局和绘制环节，只做渲染层的合并。\n\n\n* **对用户输入事件/滚动事件等处理函数去抖动（移动设备）**\n  使用由浏览器专门为动画提供的API - requestAnimationFrame()\n\n### 参考文档\n\n[【渲染原理】浏览器渲染原理的个人整理](http://www.cnblogs.com/mfoonirlee/p/6903876.html \"【渲染原理】浏览器渲染原理的个人整理\")\n[深度剖析浏览器渲染性能原理，你到底知道多少？](http://www.jianshu.com/p/a32b890c29b1 \"深度剖析浏览器渲染性能原理，你到底知道多少？\")\n[高频 dom 操作和页面性能优化探索](http://web.jobbole.com/92320/ \"高频 dom 操作和页面性能优化探索\")\n\n\n","slug":"optimize-browser-rendering","published":1,"updated":"2017-09-08T06:53:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oda001kuo2ejost5zxv","content":"<p>为了保证页面的渲染效果，简单了解下浏览器是如何处理HTML/JavaScript/CSS的。<br><a id=\"more\"></a></p>\n<hr>\n<h3 id=\"页面渲染过程（以Chrome为例）\"><a href=\"#页面渲染过程（以Chrome为例）\" class=\"headerlink\" title=\"页面渲染过程（以Chrome为例）\"></a>页面渲染过程（以Chrome为例）</h3><p>  一个页面更新时，渲染过程大致如下：</p>\n<p>  <img src=\"/img/browser-render/Image1.png\" alt=\"browser-render\"></p>\n<ul>\n<li><code>JavaScript</code> 为了实现动画效果，用js对DOM元素操作等。</li>\n<li><code>Style</code> 计算样式，如果元素的样式有改变，在这一步重新计算样式，并匹配到对应的DOM上。</li>\n<li><code>Layout</code> 根据上一步的DOM样式规则，重新进行布局（重排）。</li>\n<li><code>Paint</code> 在多个渲染层上，对新的布局重新绘制（重绘）。</li>\n<li><p><code>Composite</code> 将绘制好的多个渲染层合并，显示到屏幕上。</p>\n<p>网页生成时，至少会 <code>渲染 （Layout+Paint）</code>一次。用户访问过程中，会不断地<code>重排（reflow）</code>和<code>重绘（repaint）</code>，页面重绘的速度要比页面重排的速度快。</p>\n</li>\n<li><p><code>重排（reflow）</code> 因为元素的规模尺寸，布局，隐藏等改变而需要浏览器重新计算页面元素位置和几何结构（geometries）的进程。</p>\n</li>\n<li><p><code>重绘（repaint）</code> 一些元素需要更新属性，这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。</p>\n<p>实际场景下，大概会有三种常见的渲染流程（也即是Layout和Paint步骤是可避免的）：</p>\n<p><img src=\"/img/browser-render/Image2.png\" alt=\"browser-render\"></p>\n</li>\n</ul>\n<h3 id=\"核心问题\"><a href=\"#核心问题\" class=\"headerlink\" title=\"核心问题\"></a>核心问题</h3><ul>\n<li><p>大多数设备的刷新频率是<code>60次/秒</code>，也就说是浏览器对每一帧画面的渲染工作要在<code>16ms内</code>完成，超出这个时间，页面的渲染就会出现卡顿现象，影响用户体验。</p>\n</li>\n<li><p>浏览器不会在js执行的时候更新DOM，而是会把这些DOM操作存放在一个队列中，在js执行完之后按顺序一次性执行完毕，因此在js执行过程中用户一直在被阻塞。若js中存在很多DOM操作，就会不断地重绘或重排，影响页面性能。</p>\n</li>\n</ul>\n<h3 id=\"DOM操作对页面性能的影响\"><a href=\"#DOM操作对页面性能的影响\" class=\"headerlink\" title=\"DOM操作对页面性能的影响\"></a>DOM操作对页面性能的影响</h3><p>  <code>重排（Reflow）</code>的性能消耗比<code>重绘（Repaint）</code>的高很多。一个节点的重排很有可能导致子节点，甚至父节点以及同级节点的重排。在一些高性能的电脑上也许还没什么，但是如果reflow发生在一些手机上，那么这个过程是非常痛苦和耗电的。</p>\n<p><strong>触发重排的原因简单有以下几个：</strong></p>\n<ul>\n<li>DOM元素的几何属性变化,以及dom的显示和隐藏(单指display,不包括visibility)</li>\n<li>DOM树的结构变化</li>\n<li><strong>获取某些属性或调用某些方法</strong></li>\n<li>window的resize或者scroll</li>\n<li><p>font-size的改变</p>\n<p>浏览器在底层会进行一些优化，具体是指它会将多个DOM操作合并在一起，批量更新，但是第三点提到的操作则会中断该过程，造成额外的重排，以下方法属性会间接引起重排:</p>\n</li>\n<li><p><code>clientHeight</code> <code>clientLeft</code> <code>clientTop</code> <code>clientWidth</code> <code>focus()</code> <code>getBoundingClientRect()</code> <code>getClientRects()</code> <code>innerText</code> <code>offsetHeight</code> <code>offsetLeft</code> <code>offsetParent</code> <code>offsetTop</code> <code>offsetWidth</code> <code>outerText, scrollByLines()</code> <code>scrollByPages()</code> <code>scrollHeight</code> <code>scrollIntoView()</code> <code>scrollIntoViewIfNeeded()</code> <code>scrollLeft</code> <code>scrollTop</code> <code>scrollWidth</code></p>\n</li>\n<li><code>height</code> <code>width</code></li>\n<li><code>getBoundingClientRect()</code> <code>getClientRects()</code></li>\n<li><code>computeCTM()</code> <code>getBBox()</code></li>\n<li><code>getCharNumAtPosition()</code> <code>getComputedTextLength()</code> <code>getEndPositionOfChar()</code> <code>getExtentOfChar()</code> <code>getNumberOfChars()</code> <code>getRotationOfChar()</code> <code>getStartPositionOfChar()</code> <code>getSubStringLength()</code> <code>selectSubString()</code></li>\n<li><code>instanceRoot</code></li>\n<li><code>getComputedStyle()</code> <code>scrollBy()</code> <code>scrollTo()</code> <code>scrollX</code> <code>scrollY</code><br><code>webkitConvertPointFromNodeToPage()</code> <code>webkitConvertPointFromPageToNode()</code></li>\n</ul>\n<p><strong>触发重绘的原因：</strong></p>\n<ul>\n<li>只改变了元素的样式，并未改变元素大小、位置。</li>\n<li><p>一个元素的重排一定会影响到渲染树的变化，因此也一定会涉及到页面的重绘。</p>\n<p>重绘和重排也有类似规律，触发它不会触发重排，但还是会触发渲染层的合并，性能开销同样不低。若页面动效不可避免的话，依靠重排来实现也是一个较好的方法</p>\n</li>\n</ul>\n<h3 id=\"优化（针对浏览器渲染）\"><a href=\"#优化（针对浏览器渲染）\" class=\"headerlink\" title=\"优化（针对浏览器渲染）\"></a>优化（针对浏览器渲染）</h3><ul>\n<li><p><strong>优化JavaScript的执行效率</strong></p>\n</li>\n<li><p><strong>降低样式计算的范围和复杂度</strong></p>\n<ul>\n<li>减少需要执行样式计算的元素个数</li>\n<li>保持class的简短</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box</span><span class=\"selector-pseudo\">:nth-last-child(-n+1)</span> <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//改善后</span><br><span class=\"line\"><span class=\"selector-class\">.final-box-title</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>CSS选择器效率从高到低的排序：</p>\n<ul>\n<li>id选择器 <code>#myid</code></li>\n<li>类选择器 <code>.myclassname</code></li>\n<li>标签选择器 <code>div,h1,p</code></li>\n<li>相邻选择器 <code>h1+p</code></li>\n<li>子选择器 <code>ul &lt; li</code></li>\n<li>后代选择器 <code>li a</code></li>\n<li>通配符选择器 <code>*</code></li>\n<li>属性选择器 <code>a[rel=&quot;external&quot;]</code></li>\n<li>伪类选择器 <code>a:hover,li:nth-child</code></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>避免大规模、复杂的布局</strong><ul>\n<li>尽量控制DOM的显示或隐藏，而不是删除或添加。</li>\n<li>尽量使用flexbox，flexbox布局性能消耗会少于旧的布局模型（相对/绝对/浮动）。</li>\n<li>避免让浏览器陷入’读写读写’循环，在循环外部做变量储存，一次性操作DOM。</li>\n<li>使用class设计样式，不要使用style，每一次赋值都会重新渲染页面。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>简化绘制的复杂度、减少绘制区域</strong></li>\n</ul>\n<ul>\n<li><strong>优先使用渲染层合并属性、控制层数量</strong><br>使用transform/opacity实现动画效果，会跳过渲染流程的布局和绘制环节，只做渲染层的合并。</li>\n</ul>\n<ul>\n<li><strong>对用户输入事件/滚动事件等处理函数去抖动（移动设备）</strong><br>使用由浏览器专门为动画提供的API - requestAnimationFrame()</li>\n</ul>\n<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3><p><a href=\"http://www.cnblogs.com/mfoonirlee/p/6903876.html\" title=\"【渲染原理】浏览器渲染原理的个人整理\" target=\"_blank\" rel=\"noopener\">【渲染原理】浏览器渲染原理的个人整理</a><br><a href=\"http://www.jianshu.com/p/a32b890c29b1\" title=\"深度剖析浏览器渲染性能原理，你到底知道多少？\" target=\"_blank\" rel=\"noopener\">深度剖析浏览器渲染性能原理，你到底知道多少？</a><br><a href=\"http://web.jobbole.com/92320/\" title=\"高频 dom 操作和页面性能优化探索\" target=\"_blank\" rel=\"noopener\">高频 dom 操作和页面性能优化探索</a></p>\n","site":{"data":{}},"excerpt":"<p>为了保证页面的渲染效果，简单了解下浏览器是如何处理HTML/JavaScript/CSS的。<br>","more":"</p>\n<hr>\n<h3 id=\"页面渲染过程（以Chrome为例）\"><a href=\"#页面渲染过程（以Chrome为例）\" class=\"headerlink\" title=\"页面渲染过程（以Chrome为例）\"></a>页面渲染过程（以Chrome为例）</h3><p>  一个页面更新时，渲染过程大致如下：</p>\n<p>  <img src=\"/img/browser-render/Image1.png\" alt=\"browser-render\"></p>\n<ul>\n<li><code>JavaScript</code> 为了实现动画效果，用js对DOM元素操作等。</li>\n<li><code>Style</code> 计算样式，如果元素的样式有改变，在这一步重新计算样式，并匹配到对应的DOM上。</li>\n<li><code>Layout</code> 根据上一步的DOM样式规则，重新进行布局（重排）。</li>\n<li><code>Paint</code> 在多个渲染层上，对新的布局重新绘制（重绘）。</li>\n<li><p><code>Composite</code> 将绘制好的多个渲染层合并，显示到屏幕上。</p>\n<p>网页生成时，至少会 <code>渲染 （Layout+Paint）</code>一次。用户访问过程中，会不断地<code>重排（reflow）</code>和<code>重绘（repaint）</code>，页面重绘的速度要比页面重排的速度快。</p>\n</li>\n<li><p><code>重排（reflow）</code> 因为元素的规模尺寸，布局，隐藏等改变而需要浏览器重新计算页面元素位置和几何结构（geometries）的进程。</p>\n</li>\n<li><p><code>重绘（repaint）</code> 一些元素需要更新属性，这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。</p>\n<p>实际场景下，大概会有三种常见的渲染流程（也即是Layout和Paint步骤是可避免的）：</p>\n<p><img src=\"/img/browser-render/Image2.png\" alt=\"browser-render\"></p>\n</li>\n</ul>\n<h3 id=\"核心问题\"><a href=\"#核心问题\" class=\"headerlink\" title=\"核心问题\"></a>核心问题</h3><ul>\n<li><p>大多数设备的刷新频率是<code>60次/秒</code>，也就说是浏览器对每一帧画面的渲染工作要在<code>16ms内</code>完成，超出这个时间，页面的渲染就会出现卡顿现象，影响用户体验。</p>\n</li>\n<li><p>浏览器不会在js执行的时候更新DOM，而是会把这些DOM操作存放在一个队列中，在js执行完之后按顺序一次性执行完毕，因此在js执行过程中用户一直在被阻塞。若js中存在很多DOM操作，就会不断地重绘或重排，影响页面性能。</p>\n</li>\n</ul>\n<h3 id=\"DOM操作对页面性能的影响\"><a href=\"#DOM操作对页面性能的影响\" class=\"headerlink\" title=\"DOM操作对页面性能的影响\"></a>DOM操作对页面性能的影响</h3><p>  <code>重排（Reflow）</code>的性能消耗比<code>重绘（Repaint）</code>的高很多。一个节点的重排很有可能导致子节点，甚至父节点以及同级节点的重排。在一些高性能的电脑上也许还没什么，但是如果reflow发生在一些手机上，那么这个过程是非常痛苦和耗电的。</p>\n<p><strong>触发重排的原因简单有以下几个：</strong></p>\n<ul>\n<li>DOM元素的几何属性变化,以及dom的显示和隐藏(单指display,不包括visibility)</li>\n<li>DOM树的结构变化</li>\n<li><strong>获取某些属性或调用某些方法</strong></li>\n<li>window的resize或者scroll</li>\n<li><p>font-size的改变</p>\n<p>浏览器在底层会进行一些优化，具体是指它会将多个DOM操作合并在一起，批量更新，但是第三点提到的操作则会中断该过程，造成额外的重排，以下方法属性会间接引起重排:</p>\n</li>\n<li><p><code>clientHeight</code> <code>clientLeft</code> <code>clientTop</code> <code>clientWidth</code> <code>focus()</code> <code>getBoundingClientRect()</code> <code>getClientRects()</code> <code>innerText</code> <code>offsetHeight</code> <code>offsetLeft</code> <code>offsetParent</code> <code>offsetTop</code> <code>offsetWidth</code> <code>outerText, scrollByLines()</code> <code>scrollByPages()</code> <code>scrollHeight</code> <code>scrollIntoView()</code> <code>scrollIntoViewIfNeeded()</code> <code>scrollLeft</code> <code>scrollTop</code> <code>scrollWidth</code></p>\n</li>\n<li><code>height</code> <code>width</code></li>\n<li><code>getBoundingClientRect()</code> <code>getClientRects()</code></li>\n<li><code>computeCTM()</code> <code>getBBox()</code></li>\n<li><code>getCharNumAtPosition()</code> <code>getComputedTextLength()</code> <code>getEndPositionOfChar()</code> <code>getExtentOfChar()</code> <code>getNumberOfChars()</code> <code>getRotationOfChar()</code> <code>getStartPositionOfChar()</code> <code>getSubStringLength()</code> <code>selectSubString()</code></li>\n<li><code>instanceRoot</code></li>\n<li><code>getComputedStyle()</code> <code>scrollBy()</code> <code>scrollTo()</code> <code>scrollX</code> <code>scrollY</code><br><code>webkitConvertPointFromNodeToPage()</code> <code>webkitConvertPointFromPageToNode()</code></li>\n</ul>\n<p><strong>触发重绘的原因：</strong></p>\n<ul>\n<li>只改变了元素的样式，并未改变元素大小、位置。</li>\n<li><p>一个元素的重排一定会影响到渲染树的变化，因此也一定会涉及到页面的重绘。</p>\n<p>重绘和重排也有类似规律，触发它不会触发重排，但还是会触发渲染层的合并，性能开销同样不低。若页面动效不可避免的话，依靠重排来实现也是一个较好的方法</p>\n</li>\n</ul>\n<h3 id=\"优化（针对浏览器渲染）\"><a href=\"#优化（针对浏览器渲染）\" class=\"headerlink\" title=\"优化（针对浏览器渲染）\"></a>优化（针对浏览器渲染）</h3><ul>\n<li><p><strong>优化JavaScript的执行效率</strong></p>\n</li>\n<li><p><strong>降低样式计算的范围和复杂度</strong></p>\n<ul>\n<li>减少需要执行样式计算的元素个数</li>\n<li>保持class的简短</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.box</span><span class=\"selector-pseudo\">:nth-last-child(-n+1)</span> <span class=\"selector-class\">.title</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//改善后</span><br><span class=\"line\"><span class=\"selector-class\">.final-box-title</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>CSS选择器效率从高到低的排序：</p>\n<ul>\n<li>id选择器 <code>#myid</code></li>\n<li>类选择器 <code>.myclassname</code></li>\n<li>标签选择器 <code>div,h1,p</code></li>\n<li>相邻选择器 <code>h1+p</code></li>\n<li>子选择器 <code>ul &lt; li</code></li>\n<li>后代选择器 <code>li a</code></li>\n<li>通配符选择器 <code>*</code></li>\n<li>属性选择器 <code>a[rel=&quot;external&quot;]</code></li>\n<li>伪类选择器 <code>a:hover,li:nth-child</code></li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>避免大规模、复杂的布局</strong><ul>\n<li>尽量控制DOM的显示或隐藏，而不是删除或添加。</li>\n<li>尽量使用flexbox，flexbox布局性能消耗会少于旧的布局模型（相对/绝对/浮动）。</li>\n<li>避免让浏览器陷入’读写读写’循环，在循环外部做变量储存，一次性操作DOM。</li>\n<li>使用class设计样式，不要使用style，每一次赋值都会重新渲染页面。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><strong>简化绘制的复杂度、减少绘制区域</strong></li>\n</ul>\n<ul>\n<li><strong>优先使用渲染层合并属性、控制层数量</strong><br>使用transform/opacity实现动画效果，会跳过渲染流程的布局和绘制环节，只做渲染层的合并。</li>\n</ul>\n<ul>\n<li><strong>对用户输入事件/滚动事件等处理函数去抖动（移动设备）</strong><br>使用由浏览器专门为动画提供的API - requestAnimationFrame()</li>\n</ul>\n<h3 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h3><p><a href=\"http://www.cnblogs.com/mfoonirlee/p/6903876.html\" title=\"【渲染原理】浏览器渲染原理的个人整理\" target=\"_blank\" rel=\"noopener\">【渲染原理】浏览器渲染原理的个人整理</a><br><a href=\"http://www.jianshu.com/p/a32b890c29b1\" title=\"深度剖析浏览器渲染性能原理，你到底知道多少？\" target=\"_blank\" rel=\"noopener\">深度剖析浏览器渲染性能原理，你到底知道多少？</a><br><a href=\"http://web.jobbole.com/92320/\" title=\"高频 dom 操作和页面性能优化探索\" target=\"_blank\" rel=\"noopener\">高频 dom 操作和页面性能优化探索</a></p>"},{"title":"npm的基本使用","date":"2017-09-08T06:34:36.000Z","_content":"##### 安装\n\n`npm是和Node.js一起发布的，只要安装了Node.js，npm也安装好了，可以从Node.js的下载页下载对应操作系统的安装包安装即可。 安装好后，执行如下命令，检查是否安装成功。`\n\n<!--more-->\n\n```bash\n$ node -v\nv8.2.1\n$ npm -v\n5.3.0\n```\n`\n但是由于npm自身的更新频率比Node.js高很多，所以通过上面的命令安装的npm可能不是最新版本，可以通过下面的命令单独更新npm\n`\n\n```bash\n$ npm install npm@latest -g\n```\n\n##### 在本地模式下安装包\n\n`在本地模式下安装，需要使用package.json文件，所以先创建：`\n\n```bash\n$ npm init\npackage name: (project)\nversion: (1.0.0)\ndescription: Demo of package.json\nentry point: (index.js)\ntest command:\ngit repository:\nkeywords:\nauthor:\nlicense: (ISC)\n```\n\n`一直敲击回车键，就可以创建package.json文件在根目录下。`\n```\n{\n  \"name\": \"project\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}\n```\n`main表示程序的入口文件，scripts指定运行脚本命令缩写。如果想了解更多，可以去查阅package.json相关文档。`\n\n##### 安装模块\n\n`\n使用npm install会读取package.json文件来安装模块。安装的模块分为两类\ndependencies和devDependencies，分别对应生产环境需要的安装包和开发环境需要的安装包。\n同样在安装模块的时候，可以通过指定参数来修改package.json文件，如\n`\n```bash\n$ npm install <package_name> --save\n$ npm install <package_name> --save-dev\n```\n##### 更新模块\n```\n$ npm update\n```\n##### 卸载模块\n```\n$ npm uninstall <package_name>\n```\n`\n如果要在卸载模块的同时，也将他从package.json文件中移除，可以添加跟安装时候一样的参数，例如:`\n```bash\n$ npm uninstall --save lodash\n```\n##### [npm配置](https://docs.npmjs.com/misc/config)\n```\n在使用npm时，我们可以根据个人的需要，指定很多配置信息。npm的配置信息加载优先级如下(从高到低)\n```\n\n    命令行参\n    环境变量\n    npmrc文件\n    项目级别的npmrc文件(/path/to/my/project/.npmrc)\n    用户级别的npmrc文件（~/.npmrc）\n    全局的npmrc文件($PREFIX/etc/npmrc)\n    npm内置的npmrc文件(/path/to/npm/npmrc)\n`查看配置`\n```bash\n$ npm config list -l\n```\n##### 配置npm源\n```\n当我们使用默认配置从npm官网下载模块时，由于网络的因素，会导致我们的下载速度特别慢。所以，我们可以配置一些国内的镜像来加快我们的下载速度。在这里，我推荐使用淘宝的npm镜像, 具体使用方式如下:\n```\n\n`临时使用, 安装包的时候通过--registry参数即可`\n```bash\n$ npm install express-generator --registry https://registry.npm.taobao.org\n```\n`全局使用`\n```bash\n$ npm config set registry https://registry.npm.taobao.org\n// 配置后可通过下面方式来验证是否成功\nnpm config get registry\n// 或\nnpm info express\n```\n`使用cnpm使用`\n\n```bash\n// 安装cnpm\nnpm install -g cnpm --registry=https://registry.npm.taobao.org\n// 使用cnpm安装包\ncnpm install express\n```\n##### 别名\n```\nnpm i – 安装包\nnpm i -g – 安装包到全局下\nnpm un – 删除本地下包\nnpm up – 更新包\nnpm t – 运行测试\nnpm ls – 罗列已经安装包\nnpm ll or npm la – 罗列包时显示额外信息\n```\n`也可以一次安装多个包`\n```bash\n$ npm i vue-resource vue-router vuex bootstrap --save\n```\n`\n如果想知道其余npm命令，可以运行npm help\n`\n##### 版本管理器\n\n`\n版本管理器可以在一台主机上控制多个版本的node，比如n,nvm。\n`","source":"_posts/npm.md","raw":"---\ntitle: npm的基本使用\ndate: 2017-09-08 14:34:36\ntags:\n- tool\n---\n##### 安装\n\n`npm是和Node.js一起发布的，只要安装了Node.js，npm也安装好了，可以从Node.js的下载页下载对应操作系统的安装包安装即可。 安装好后，执行如下命令，检查是否安装成功。`\n\n<!--more-->\n\n```bash\n$ node -v\nv8.2.1\n$ npm -v\n5.3.0\n```\n`\n但是由于npm自身的更新频率比Node.js高很多，所以通过上面的命令安装的npm可能不是最新版本，可以通过下面的命令单独更新npm\n`\n\n```bash\n$ npm install npm@latest -g\n```\n\n##### 在本地模式下安装包\n\n`在本地模式下安装，需要使用package.json文件，所以先创建：`\n\n```bash\n$ npm init\npackage name: (project)\nversion: (1.0.0)\ndescription: Demo of package.json\nentry point: (index.js)\ntest command:\ngit repository:\nkeywords:\nauthor:\nlicense: (ISC)\n```\n\n`一直敲击回车键，就可以创建package.json文件在根目录下。`\n```\n{\n  \"name\": \"project\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}\n```\n`main表示程序的入口文件，scripts指定运行脚本命令缩写。如果想了解更多，可以去查阅package.json相关文档。`\n\n##### 安装模块\n\n`\n使用npm install会读取package.json文件来安装模块。安装的模块分为两类\ndependencies和devDependencies，分别对应生产环境需要的安装包和开发环境需要的安装包。\n同样在安装模块的时候，可以通过指定参数来修改package.json文件，如\n`\n```bash\n$ npm install <package_name> --save\n$ npm install <package_name> --save-dev\n```\n##### 更新模块\n```\n$ npm update\n```\n##### 卸载模块\n```\n$ npm uninstall <package_name>\n```\n`\n如果要在卸载模块的同时，也将他从package.json文件中移除，可以添加跟安装时候一样的参数，例如:`\n```bash\n$ npm uninstall --save lodash\n```\n##### [npm配置](https://docs.npmjs.com/misc/config)\n```\n在使用npm时，我们可以根据个人的需要，指定很多配置信息。npm的配置信息加载优先级如下(从高到低)\n```\n\n    命令行参\n    环境变量\n    npmrc文件\n    项目级别的npmrc文件(/path/to/my/project/.npmrc)\n    用户级别的npmrc文件（~/.npmrc）\n    全局的npmrc文件($PREFIX/etc/npmrc)\n    npm内置的npmrc文件(/path/to/npm/npmrc)\n`查看配置`\n```bash\n$ npm config list -l\n```\n##### 配置npm源\n```\n当我们使用默认配置从npm官网下载模块时，由于网络的因素，会导致我们的下载速度特别慢。所以，我们可以配置一些国内的镜像来加快我们的下载速度。在这里，我推荐使用淘宝的npm镜像, 具体使用方式如下:\n```\n\n`临时使用, 安装包的时候通过--registry参数即可`\n```bash\n$ npm install express-generator --registry https://registry.npm.taobao.org\n```\n`全局使用`\n```bash\n$ npm config set registry https://registry.npm.taobao.org\n// 配置后可通过下面方式来验证是否成功\nnpm config get registry\n// 或\nnpm info express\n```\n`使用cnpm使用`\n\n```bash\n// 安装cnpm\nnpm install -g cnpm --registry=https://registry.npm.taobao.org\n// 使用cnpm安装包\ncnpm install express\n```\n##### 别名\n```\nnpm i – 安装包\nnpm i -g – 安装包到全局下\nnpm un – 删除本地下包\nnpm up – 更新包\nnpm t – 运行测试\nnpm ls – 罗列已经安装包\nnpm ll or npm la – 罗列包时显示额外信息\n```\n`也可以一次安装多个包`\n```bash\n$ npm i vue-resource vue-router vuex bootstrap --save\n```\n`\n如果想知道其余npm命令，可以运行npm help\n`\n##### 版本管理器\n\n`\n版本管理器可以在一台主机上控制多个版本的node，比如n,nvm。\n`","slug":"npm","published":1,"updated":"2017-12-01T07:50:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84odj001muo2e0gsr8pbi","content":"<h5 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h5><p><code>npm是和Node.js一起发布的，只要安装了Node.js，npm也安装好了，可以从Node.js的下载页下载对应操作系统的安装包安装即可。 安装好后，执行如下命令，检查是否安装成功。</code></p>\n<a id=\"more\"></a>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node -v</span><br><span class=\"line\">v8.2.1</span><br><span class=\"line\">$ npm -v</span><br><span class=\"line\">5.3.0</span><br></pre></td></tr></table></figure>\n<p><code>但是由于npm自身的更新频率比Node.js高很多，所以通过上面的命令安装的npm可能不是最新版本，可以通过下面的命令单独更新npm</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install npm@latest -g</span><br></pre></td></tr></table></figure>\n<h5 id=\"在本地模式下安装包\"><a href=\"#在本地模式下安装包\" class=\"headerlink\" title=\"在本地模式下安装包\"></a>在本地模式下安装包</h5><p><code>在本地模式下安装，需要使用package.json文件，所以先创建：</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm init</span><br><span class=\"line\">package name: (project)</span><br><span class=\"line\">version: (1.0.0)</span><br><span class=\"line\">description: Demo of package.json</span><br><span class=\"line\">entry point: (index.js)</span><br><span class=\"line\"><span class=\"built_in\">test</span> <span class=\"built_in\">command</span>:</span><br><span class=\"line\">git repository:</span><br><span class=\"line\">keywords:</span><br><span class=\"line\">author:</span><br><span class=\"line\">license: (ISC)</span><br></pre></td></tr></table></figure>\n<p><code>一直敲击回车键，就可以创建package.json文件在根目录下。</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;project&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;author&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>main表示程序的入口文件，scripts指定运行脚本命令缩写。如果想了解更多，可以去查阅package.json相关文档。</code></p>\n<h5 id=\"安装模块\"><a href=\"#安装模块\" class=\"headerlink\" title=\"安装模块\"></a>安装模块</h5><p><code>使用npm install会读取package.json文件来安装模块。安装的模块分为两类\ndependencies和devDependencies，分别对应生产环境需要的安装包和开发环境需要的安装包。\n同样在安装模块的时候，可以通过指定参数来修改package.json文件，如</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install &lt;package_name&gt; --save</span><br><span class=\"line\">$ npm install &lt;package_name&gt; --save-dev</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"更新模块\"><a href=\"#更新模块\" class=\"headerlink\" title=\"更新模块\"></a>更新模块</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm update</span><br></pre></td></tr></table></figure>\n<h5 id=\"卸载模块\"><a href=\"#卸载模块\" class=\"headerlink\" title=\"卸载模块\"></a>卸载模块</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm uninstall &lt;package_name&gt;</span><br></pre></td></tr></table></figure>\n<p><code>如果要在卸载模块的同时，也将他从package.json文件中移除，可以添加跟安装时候一样的参数，例如:</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm uninstall --save lodash</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"npm配置\"><a href=\"#npm配置\" class=\"headerlink\" title=\"npm配置\"></a><a href=\"https://docs.npmjs.com/misc/config\" target=\"_blank\" rel=\"noopener\">npm配置</a></h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在使用npm时，我们可以根据个人的需要，指定很多配置信息。npm的配置信息加载优先级如下(从高到低)</span><br></pre></td></tr></table></figure>\n<pre><code>命令行参\n环境变量\nnpmrc文件\n项目级别的npmrc文件(/path/to/my/project/.npmrc)\n用户级别的npmrc文件（~/.npmrc）\n全局的npmrc文件($PREFIX/etc/npmrc)\nnpm内置的npmrc文件(/path/to/npm/npmrc)\n</code></pre><p><code>查看配置</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm config list -l</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"配置npm源\"><a href=\"#配置npm源\" class=\"headerlink\" title=\"配置npm源\"></a>配置npm源</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当我们使用默认配置从npm官网下载模块时，由于网络的因素，会导致我们的下载速度特别慢。所以，我们可以配置一些国内的镜像来加快我们的下载速度。在这里，我推荐使用淘宝的npm镜像, 具体使用方式如下:</span><br></pre></td></tr></table></figure>\n<p><code>临时使用, 安装包的时候通过--registry参数即可</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install express-generator --registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>\n<p><code>全局使用</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm config <span class=\"built_in\">set</span> registry https://registry.npm.taobao.org</span><br><span class=\"line\">// 配置后可通过下面方式来验证是否成功</span><br><span class=\"line\">npm config get registry</span><br><span class=\"line\">// 或</span><br><span class=\"line\">npm info express</span><br></pre></td></tr></table></figure></p>\n<p><code>使用cnpm使用</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 安装cnpm</span><br><span class=\"line\">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class=\"line\">// 使用cnpm安装包</span><br><span class=\"line\">cnpm install express</span><br></pre></td></tr></table></figure>\n<h5 id=\"别名\"><a href=\"#别名\" class=\"headerlink\" title=\"别名\"></a>别名</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i – 安装包</span><br><span class=\"line\">npm i -g – 安装包到全局下</span><br><span class=\"line\">npm un – 删除本地下包</span><br><span class=\"line\">npm up – 更新包</span><br><span class=\"line\">npm t – 运行测试</span><br><span class=\"line\">npm ls – 罗列已经安装包</span><br><span class=\"line\">npm ll or npm la – 罗列包时显示额外信息</span><br></pre></td></tr></table></figure>\n<p><code>也可以一次安装多个包</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm i vue-resource vue-router vuex bootstrap --save</span><br></pre></td></tr></table></figure></p>\n<p><code>如果想知道其余npm命令，可以运行npm help</code></p>\n<h5 id=\"版本管理器\"><a href=\"#版本管理器\" class=\"headerlink\" title=\"版本管理器\"></a>版本管理器</h5><p><code>版本管理器可以在一台主机上控制多个版本的node，比如n,nvm。</code></p>\n","site":{"data":{}},"excerpt":"<h5 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h5><p><code>npm是和Node.js一起发布的，只要安装了Node.js，npm也安装好了，可以从Node.js的下载页下载对应操作系统的安装包安装即可。 安装好后，执行如下命令，检查是否安装成功。</code></p>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node -v</span><br><span class=\"line\">v8.2.1</span><br><span class=\"line\">$ npm -v</span><br><span class=\"line\">5.3.0</span><br></pre></td></tr></table></figure>\n<p><code>但是由于npm自身的更新频率比Node.js高很多，所以通过上面的命令安装的npm可能不是最新版本，可以通过下面的命令单独更新npm</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install npm@latest -g</span><br></pre></td></tr></table></figure>\n<h5 id=\"在本地模式下安装包\"><a href=\"#在本地模式下安装包\" class=\"headerlink\" title=\"在本地模式下安装包\"></a>在本地模式下安装包</h5><p><code>在本地模式下安装，需要使用package.json文件，所以先创建：</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm init</span><br><span class=\"line\">package name: (project)</span><br><span class=\"line\">version: (1.0.0)</span><br><span class=\"line\">description: Demo of package.json</span><br><span class=\"line\">entry point: (index.js)</span><br><span class=\"line\"><span class=\"built_in\">test</span> <span class=\"built_in\">command</span>:</span><br><span class=\"line\">git repository:</span><br><span class=\"line\">keywords:</span><br><span class=\"line\">author:</span><br><span class=\"line\">license: (ISC)</span><br></pre></td></tr></table></figure>\n<p><code>一直敲击回车键，就可以创建package.json文件在根目录下。</code><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;project&quot;,</span><br><span class=\"line\">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class=\"line\">  &quot;scripts&quot;: &#123;</span><br><span class=\"line\">    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;author&quot;: &quot;&quot;,</span><br><span class=\"line\">  &quot;license&quot;: &quot;ISC&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>main表示程序的入口文件，scripts指定运行脚本命令缩写。如果想了解更多，可以去查阅package.json相关文档。</code></p>\n<h5 id=\"安装模块\"><a href=\"#安装模块\" class=\"headerlink\" title=\"安装模块\"></a>安装模块</h5><p><code>使用npm install会读取package.json文件来安装模块。安装的模块分为两类\ndependencies和devDependencies，分别对应生产环境需要的安装包和开发环境需要的安装包。\n同样在安装模块的时候，可以通过指定参数来修改package.json文件，如</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install &lt;package_name&gt; --save</span><br><span class=\"line\">$ npm install &lt;package_name&gt; --save-dev</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"更新模块\"><a href=\"#更新模块\" class=\"headerlink\" title=\"更新模块\"></a>更新模块</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm update</span><br></pre></td></tr></table></figure>\n<h5 id=\"卸载模块\"><a href=\"#卸载模块\" class=\"headerlink\" title=\"卸载模块\"></a>卸载模块</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm uninstall &lt;package_name&gt;</span><br></pre></td></tr></table></figure>\n<p><code>如果要在卸载模块的同时，也将他从package.json文件中移除，可以添加跟安装时候一样的参数，例如:</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm uninstall --save lodash</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"npm配置\"><a href=\"#npm配置\" class=\"headerlink\" title=\"npm配置\"></a><a href=\"https://docs.npmjs.com/misc/config\" target=\"_blank\" rel=\"noopener\">npm配置</a></h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在使用npm时，我们可以根据个人的需要，指定很多配置信息。npm的配置信息加载优先级如下(从高到低)</span><br></pre></td></tr></table></figure>\n<pre><code>命令行参\n环境变量\nnpmrc文件\n项目级别的npmrc文件(/path/to/my/project/.npmrc)\n用户级别的npmrc文件（~/.npmrc）\n全局的npmrc文件($PREFIX/etc/npmrc)\nnpm内置的npmrc文件(/path/to/npm/npmrc)\n</code></pre><p><code>查看配置</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm config list -l</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"配置npm源\"><a href=\"#配置npm源\" class=\"headerlink\" title=\"配置npm源\"></a>配置npm源</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当我们使用默认配置从npm官网下载模块时，由于网络的因素，会导致我们的下载速度特别慢。所以，我们可以配置一些国内的镜像来加快我们的下载速度。在这里，我推荐使用淘宝的npm镜像, 具体使用方式如下:</span><br></pre></td></tr></table></figure>\n<p><code>临时使用, 安装包的时候通过--registry参数即可</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install express-generator --registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>\n<p><code>全局使用</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm config <span class=\"built_in\">set</span> registry https://registry.npm.taobao.org</span><br><span class=\"line\">// 配置后可通过下面方式来验证是否成功</span><br><span class=\"line\">npm config get registry</span><br><span class=\"line\">// 或</span><br><span class=\"line\">npm info express</span><br></pre></td></tr></table></figure></p>\n<p><code>使用cnpm使用</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 安装cnpm</span><br><span class=\"line\">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class=\"line\">// 使用cnpm安装包</span><br><span class=\"line\">cnpm install express</span><br></pre></td></tr></table></figure>\n<h5 id=\"别名\"><a href=\"#别名\" class=\"headerlink\" title=\"别名\"></a>别名</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i – 安装包</span><br><span class=\"line\">npm i -g – 安装包到全局下</span><br><span class=\"line\">npm un – 删除本地下包</span><br><span class=\"line\">npm up – 更新包</span><br><span class=\"line\">npm t – 运行测试</span><br><span class=\"line\">npm ls – 罗列已经安装包</span><br><span class=\"line\">npm ll or npm la – 罗列包时显示额外信息</span><br></pre></td></tr></table></figure>\n<p><code>也可以一次安装多个包</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm i vue-resource vue-router vuex bootstrap --save</span><br></pre></td></tr></table></figure></p>\n<p><code>如果想知道其余npm命令，可以运行npm help</code></p>\n<h5 id=\"版本管理器\"><a href=\"#版本管理器\" class=\"headerlink\" title=\"版本管理器\"></a>版本管理器</h5><p><code>版本管理器可以在一台主机上控制多个版本的node，比如n,nvm。</code></p>"},{"title":"Puppeteer 入门","date":"2018-03-15T16:00:00.000Z","_content":"\n某一天，我在一个微信群里看到有人在讨论如何自动填写第三方网站的表单。  \n然后有人推荐用 Puppeteer。我没听说过这个东西，所以就去查了一下和大概看了下它的 API 并运行了一些 Demo。  \n这里简单梳理一下 Puppeteer 的相关知识。\n\n<!-- more -->\n\n## Puppeteer 是什么？\n\n> Puppeteer 是一个 Node.js 库。它通过浏览器的 DevTools 协议，提供一些高级的 API 去控制无界面（headless）的 Chrome 或者 Chromium 以实现各种功能。它也能被配置成一个完整的 Chrome 或 Chromium。\n\nPuppeteer 的 Github 项目地址：https://github.com/GoogleChrome/puppeteer\n\n## Puppeteer 能做什么？\n\n- 生成页面截图或 PDF；\n- 爬取 SPA （单页应用）的数据并生成预渲染页面；\n- 自动提交表单、UI 自动化测试和模拟键盘输入等等；\n- 创建一个最新的自动化测试环境。使用最新的 JavaScript 和浏览器特性，直接在最新版本的 Chrome 中运行测试。\n- 捕捉你网站的数据加载过程，帮助诊断性能问题。\n\n## 入门\n\n### 安装\n\n```shell\nnpm i --save puppeteer\n# or \"yarn add puppeteer\"\n```\n\n需要注意的是，在安装 puppeteer 的时候，会下载一个最新版本的 Chromium 以保证 API 的正常使用。最新的 Windows 版本大小在 120Mb 左右。  \n不过也可以通过配置跳过 Chromium 下载这一步。具体看 [Environment variables](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#environment-variables)\n\n### 使用\n\n> 注意：使用 Puppeteer 最少需要 Node v6.4.0 版本。为了使用 async/await 特性，建议使用 Node v7.6.0 或更高版本。\n\n**基本操作**\n\n```javascript\nconst puppeteer = require('puppeteer');\n\n(async () => {\n  // 启动浏览器\n  const browser = await puppeteer.launch({\n    // 这里关闭 headless 模式，启动时会打开 Chromium。方便我们查看执行过程。\n    headless: false,\n  });\n  // 打开一个新的空白页面\n  const page = await browser.newPage();\n\n  // 设置窗口大小，不设置的话，默认是 800x600\n  await page.setViewport({\n    width: 1920,\n    height: 1080,\n  });\n\n  // 进行其他操作\n  // ...\n\n  // 关闭页面\n  await browser.close();\n})();\n```\n\n**打开某一个网站**\n\n```javascript\nawait page.goto('https://www.jd.com', {\n  // 配置项\n  waitUntil: 'networkidle0', // 在网络空闲时，也就是没有正在请求的链接时，继续执行\n});\n```\n\n**生成截图**\n\n```javascript\nawait page.screenshot({\n  path: 'jd.png', // 在根目录下生成一张截图\n  fullPage: true // 默认只截取第一屏的页面，设置 fullPage 后可以截取整一个页面\n});\n```\n\n**保存为 PDF**\n\n```javascript\n// 保存为 A4 纸张大小的 PDF 文件。\nawait page.pdf({\n  path: 'jd.pdf',\n  format: 'A4'\n});\n```\n\n**执行脚本**\n\n```javascript\n// 获取页面窗口信息\nconst dimensions = await page.evaluate(() => {\n  return {\n    width: document.documentElement.clientWidth,\n    height: document.documentElement.clientHeight,\n    deviceScaleFactor: window.devicePixelRatio\n  };\n});\n\nconsole.log('Dimensions:', dimensions);\n\n// 获取 body 里面的 HTML 代码\n// 查询 body 元素并创建 bodyHandle\nconst bodyHandle = await page.$('body');\n// 把 bodyHandle 作为参数传入 evaluate\nconst html = await page.evaluate(body => body.innerHTML, bodyHandle);\n// 销毁 bodyHandle\nawait bodyHandle.dispose();\n\nconsole.log('HTML:', html);\n```\n\n这里的 `page.$` 类似于 `document.querySelector`，而 `page.$$` 对应 `document.querySelectorAll`。\n\n**自动提交表单**\n\n打开京东首页，输入搜索关键词，回车进行搜索\n\n```javascript\n// 地址栏输入网址\nawait page.goto('https://www.jd.com/', {\n  waitUntil: 'networkidle0', // 等待网络状态为空闲的时候才继续执行\n});\n\n// 将输入焦点定位到搜索框，然后输入关键字\n// await page.click('#key');\nawait page.focus('#key');\nawait page.keyword.type('Javascript高级程序设计', {\n  delay: 100, // 控制每个字母输入的间隔时间\n});\n\n// 输入搜索关键字。\nawait page.type('#key', 'Javascript高级程序设计', {\n  delay: 100, \n});\n// 上面两种输入关键字的方法任选一种即可。\n\n// 回车\nawait page.keyboard.press('Enter');\n```\n\n**模拟移动端设备**\n\n```javascript\nconst puppeteer = require('puppeteer');\nconst devices = require('puppeteer/DeviceDescriptors');\nconst iPhone = devices['iPhone 6'];\npuppeteer.launch().then(async browser => {\n  const page = await browser.newPage();\n  await page.emulate(iPhone);\n  await page.goto('https://m.jd.com');\n  // other actions...\n  await browser.close();\n});\n```\n\n[DeviceDescriptors](https://github.com/GoogleChrome/puppeteer/blob/master/DeviceDescriptors.js) 是 puppeteer 自带的移动端设备配置，里面包含了常见的移动设备。\n\n## 参考资料\n\n1. [Puppeteer README.md](https://github.com/GoogleChrome/puppeteer)\n2. [无头浏览器 Puppeteer 初探](https://github.com/ProtoTeam/blog/blob/master/201710/2.md)","source":"_posts/puppeteer-getting-started.md","raw":"---\ntitle: Puppeteer 入门\ndate: 2018-03-16\ntags: \n - javascript\n---\n\n某一天，我在一个微信群里看到有人在讨论如何自动填写第三方网站的表单。  \n然后有人推荐用 Puppeteer。我没听说过这个东西，所以就去查了一下和大概看了下它的 API 并运行了一些 Demo。  \n这里简单梳理一下 Puppeteer 的相关知识。\n\n<!-- more -->\n\n## Puppeteer 是什么？\n\n> Puppeteer 是一个 Node.js 库。它通过浏览器的 DevTools 协议，提供一些高级的 API 去控制无界面（headless）的 Chrome 或者 Chromium 以实现各种功能。它也能被配置成一个完整的 Chrome 或 Chromium。\n\nPuppeteer 的 Github 项目地址：https://github.com/GoogleChrome/puppeteer\n\n## Puppeteer 能做什么？\n\n- 生成页面截图或 PDF；\n- 爬取 SPA （单页应用）的数据并生成预渲染页面；\n- 自动提交表单、UI 自动化测试和模拟键盘输入等等；\n- 创建一个最新的自动化测试环境。使用最新的 JavaScript 和浏览器特性，直接在最新版本的 Chrome 中运行测试。\n- 捕捉你网站的数据加载过程，帮助诊断性能问题。\n\n## 入门\n\n### 安装\n\n```shell\nnpm i --save puppeteer\n# or \"yarn add puppeteer\"\n```\n\n需要注意的是，在安装 puppeteer 的时候，会下载一个最新版本的 Chromium 以保证 API 的正常使用。最新的 Windows 版本大小在 120Mb 左右。  \n不过也可以通过配置跳过 Chromium 下载这一步。具体看 [Environment variables](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#environment-variables)\n\n### 使用\n\n> 注意：使用 Puppeteer 最少需要 Node v6.4.0 版本。为了使用 async/await 特性，建议使用 Node v7.6.0 或更高版本。\n\n**基本操作**\n\n```javascript\nconst puppeteer = require('puppeteer');\n\n(async () => {\n  // 启动浏览器\n  const browser = await puppeteer.launch({\n    // 这里关闭 headless 模式，启动时会打开 Chromium。方便我们查看执行过程。\n    headless: false,\n  });\n  // 打开一个新的空白页面\n  const page = await browser.newPage();\n\n  // 设置窗口大小，不设置的话，默认是 800x600\n  await page.setViewport({\n    width: 1920,\n    height: 1080,\n  });\n\n  // 进行其他操作\n  // ...\n\n  // 关闭页面\n  await browser.close();\n})();\n```\n\n**打开某一个网站**\n\n```javascript\nawait page.goto('https://www.jd.com', {\n  // 配置项\n  waitUntil: 'networkidle0', // 在网络空闲时，也就是没有正在请求的链接时，继续执行\n});\n```\n\n**生成截图**\n\n```javascript\nawait page.screenshot({\n  path: 'jd.png', // 在根目录下生成一张截图\n  fullPage: true // 默认只截取第一屏的页面，设置 fullPage 后可以截取整一个页面\n});\n```\n\n**保存为 PDF**\n\n```javascript\n// 保存为 A4 纸张大小的 PDF 文件。\nawait page.pdf({\n  path: 'jd.pdf',\n  format: 'A4'\n});\n```\n\n**执行脚本**\n\n```javascript\n// 获取页面窗口信息\nconst dimensions = await page.evaluate(() => {\n  return {\n    width: document.documentElement.clientWidth,\n    height: document.documentElement.clientHeight,\n    deviceScaleFactor: window.devicePixelRatio\n  };\n});\n\nconsole.log('Dimensions:', dimensions);\n\n// 获取 body 里面的 HTML 代码\n// 查询 body 元素并创建 bodyHandle\nconst bodyHandle = await page.$('body');\n// 把 bodyHandle 作为参数传入 evaluate\nconst html = await page.evaluate(body => body.innerHTML, bodyHandle);\n// 销毁 bodyHandle\nawait bodyHandle.dispose();\n\nconsole.log('HTML:', html);\n```\n\n这里的 `page.$` 类似于 `document.querySelector`，而 `page.$$` 对应 `document.querySelectorAll`。\n\n**自动提交表单**\n\n打开京东首页，输入搜索关键词，回车进行搜索\n\n```javascript\n// 地址栏输入网址\nawait page.goto('https://www.jd.com/', {\n  waitUntil: 'networkidle0', // 等待网络状态为空闲的时候才继续执行\n});\n\n// 将输入焦点定位到搜索框，然后输入关键字\n// await page.click('#key');\nawait page.focus('#key');\nawait page.keyword.type('Javascript高级程序设计', {\n  delay: 100, // 控制每个字母输入的间隔时间\n});\n\n// 输入搜索关键字。\nawait page.type('#key', 'Javascript高级程序设计', {\n  delay: 100, \n});\n// 上面两种输入关键字的方法任选一种即可。\n\n// 回车\nawait page.keyboard.press('Enter');\n```\n\n**模拟移动端设备**\n\n```javascript\nconst puppeteer = require('puppeteer');\nconst devices = require('puppeteer/DeviceDescriptors');\nconst iPhone = devices['iPhone 6'];\npuppeteer.launch().then(async browser => {\n  const page = await browser.newPage();\n  await page.emulate(iPhone);\n  await page.goto('https://m.jd.com');\n  // other actions...\n  await browser.close();\n});\n```\n\n[DeviceDescriptors](https://github.com/GoogleChrome/puppeteer/blob/master/DeviceDescriptors.js) 是 puppeteer 自带的移动端设备配置，里面包含了常见的移动设备。\n\n## 参考资料\n\n1. [Puppeteer README.md](https://github.com/GoogleChrome/puppeteer)\n2. [无头浏览器 Puppeteer 初探](https://github.com/ProtoTeam/blog/blob/master/201710/2.md)","slug":"puppeteer-getting-started","published":1,"updated":"2018-03-17T03:42:49.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84odm001ouo2emlwr50j1","content":"<p>某一天，我在一个微信群里看到有人在讨论如何自动填写第三方网站的表单。<br>然后有人推荐用 Puppeteer。我没听说过这个东西，所以就去查了一下和大概看了下它的 API 并运行了一些 Demo。<br>这里简单梳理一下 Puppeteer 的相关知识。</p>\n<a id=\"more\"></a>\n<h2 id=\"Puppeteer-是什么？\"><a href=\"#Puppeteer-是什么？\" class=\"headerlink\" title=\"Puppeteer 是什么？\"></a>Puppeteer 是什么？</h2><blockquote>\n<p>Puppeteer 是一个 Node.js 库。它通过浏览器的 DevTools 协议，提供一些高级的 API 去控制无界面（headless）的 Chrome 或者 Chromium 以实现各种功能。它也能被配置成一个完整的 Chrome 或 Chromium。</p>\n</blockquote>\n<p>Puppeteer 的 Github 项目地址：<a href=\"https://github.com/GoogleChrome/puppeteer\" target=\"_blank\" rel=\"noopener\">https://github.com/GoogleChrome/puppeteer</a></p>\n<h2 id=\"Puppeteer-能做什么？\"><a href=\"#Puppeteer-能做什么？\" class=\"headerlink\" title=\"Puppeteer 能做什么？\"></a>Puppeteer 能做什么？</h2><ul>\n<li>生成页面截图或 PDF；</li>\n<li>爬取 SPA （单页应用）的数据并生成预渲染页面；</li>\n<li>自动提交表单、UI 自动化测试和模拟键盘输入等等；</li>\n<li>创建一个最新的自动化测试环境。使用最新的 JavaScript 和浏览器特性，直接在最新版本的 Chrome 中运行测试。</li>\n<li>捕捉你网站的数据加载过程，帮助诊断性能问题。</li>\n</ul>\n<h2 id=\"入门\"><a href=\"#入门\" class=\"headerlink\" title=\"入门\"></a>入门</h2><h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save puppeteer</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> or <span class=\"string\">\"yarn add puppeteer\"</span></span></span><br></pre></td></tr></table></figure>\n<p>需要注意的是，在安装 puppeteer 的时候，会下载一个最新版本的 Chromium 以保证 API 的正常使用。最新的 Windows 版本大小在 120Mb 左右。<br>不过也可以通过配置跳过 Chromium 下载这一步。具体看 <a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#environment-variables\" target=\"_blank\" rel=\"noopener\">Environment variables</a></p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><blockquote>\n<p>注意：使用 Puppeteer 最少需要 Node v6.4.0 版本。为了使用 async/await 特性，建议使用 Node v7.6.0 或更高版本。</p>\n</blockquote>\n<p><strong>基本操作</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里关闭 headless 模式，启动时会打开 Chromium。方便我们查看执行过程。</span></span><br><span class=\"line\">    headless: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个新的空白页面</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 设置窗口大小，不设置的话，默认是 800x600</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.setViewport(&#123;</span><br><span class=\"line\">    width: <span class=\"number\">1920</span>,</span><br><span class=\"line\">    height: <span class=\"number\">1080</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 进行其他操作</span></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 关闭页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.close();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p><strong>打开某一个网站</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://www.jd.com'</span>, &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 配置项</span></span><br><span class=\"line\">  waitUntil: <span class=\"string\">'networkidle0'</span>, <span class=\"comment\">// 在网络空闲时，也就是没有正在请求的链接时，继续执行</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><strong>生成截图</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">await</span> page.screenshot(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">'jd.png'</span>, <span class=\"comment\">// 在根目录下生成一张截图</span></span><br><span class=\"line\">  fullPage: <span class=\"literal\">true</span> <span class=\"comment\">// 默认只截取第一屏的页面，设置 fullPage 后可以截取整一个页面</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><strong>保存为 PDF</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 保存为 A4 纸张大小的 PDF 文件。</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.pdf(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">'jd.pdf'</span>,</span><br><span class=\"line\">  format: <span class=\"string\">'A4'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><strong>执行脚本</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取页面窗口信息</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> dimensions = <span class=\"keyword\">await</span> page.evaluate(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    width: <span class=\"built_in\">document</span>.documentElement.clientWidth,</span><br><span class=\"line\">    height: <span class=\"built_in\">document</span>.documentElement.clientHeight,</span><br><span class=\"line\">    deviceScaleFactor: <span class=\"built_in\">window</span>.devicePixelRatio</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'Dimensions:'</span>, dimensions);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取 body 里面的 HTML 代码</span></span><br><span class=\"line\"><span class=\"comment\">// 查询 body 元素并创建 bodyHandle</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyHandle = <span class=\"keyword\">await</span> page.$(<span class=\"string\">'body'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 把 bodyHandle 作为参数传入 evaluate</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> html = <span class=\"keyword\">await</span> page.evaluate(<span class=\"function\"><span class=\"params\">body</span> =&gt;</span> body.innerHTML, bodyHandle);</span><br><span class=\"line\"><span class=\"comment\">// 销毁 bodyHandle</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> bodyHandle.dispose();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'HTML:'</span>, html);</span><br></pre></td></tr></table></figure>\n<p>这里的 <code>page.$</code> 类似于 <code>document.querySelector</code>，而 <code>page.$$</code> 对应 <code>document.querySelectorAll</code>。</p>\n<p><strong>自动提交表单</strong></p>\n<p>打开京东首页，输入搜索关键词，回车进行搜索</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 地址栏输入网址</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://www.jd.com/'</span>, &#123;</span><br><span class=\"line\">  waitUntil: <span class=\"string\">'networkidle0'</span>, <span class=\"comment\">// 等待网络状态为空闲的时候才继续执行</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将输入焦点定位到搜索框，然后输入关键字</span></span><br><span class=\"line\"><span class=\"comment\">// await page.click('#key');</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.focus(<span class=\"string\">'#key'</span>);</span><br><span class=\"line\"><span class=\"keyword\">await</span> page.keyword.type(<span class=\"string\">'Javascript高级程序设计'</span>, &#123;</span><br><span class=\"line\">  delay: <span class=\"number\">100</span>, <span class=\"comment\">// 控制每个字母输入的间隔时间</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输入搜索关键字。</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.type(<span class=\"string\">'#key'</span>, <span class=\"string\">'Javascript高级程序设计'</span>, &#123;</span><br><span class=\"line\">  delay: <span class=\"number\">100</span>, </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 上面两种输入关键字的方法任选一种即可。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 回车</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.keyboard.press(<span class=\"string\">'Enter'</span>);</span><br></pre></td></tr></table></figure>\n<p><strong>模拟移动端设备</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> devices = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer/DeviceDescriptors'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> iPhone = devices[<span class=\"string\">'iPhone 6'</span>];</span><br><span class=\"line\">puppeteer.launch().then(<span class=\"keyword\">async</span> browser =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.emulate(iPhone);</span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://m.jd.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// other actions...</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.close();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/DeviceDescriptors.js\" target=\"_blank\" rel=\"noopener\">DeviceDescriptors</a> 是 puppeteer 自带的移动端设备配置，里面包含了常见的移动设备。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li><a href=\"https://github.com/GoogleChrome/puppeteer\" target=\"_blank\" rel=\"noopener\">Puppeteer README.md</a></li>\n<li><a href=\"https://github.com/ProtoTeam/blog/blob/master/201710/2.md\" target=\"_blank\" rel=\"noopener\">无头浏览器 Puppeteer 初探</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>某一天，我在一个微信群里看到有人在讨论如何自动填写第三方网站的表单。<br>然后有人推荐用 Puppeteer。我没听说过这个东西，所以就去查了一下和大概看了下它的 API 并运行了一些 Demo。<br>这里简单梳理一下 Puppeteer 的相关知识。</p>","more":"<h2 id=\"Puppeteer-是什么？\"><a href=\"#Puppeteer-是什么？\" class=\"headerlink\" title=\"Puppeteer 是什么？\"></a>Puppeteer 是什么？</h2><blockquote>\n<p>Puppeteer 是一个 Node.js 库。它通过浏览器的 DevTools 协议，提供一些高级的 API 去控制无界面（headless）的 Chrome 或者 Chromium 以实现各种功能。它也能被配置成一个完整的 Chrome 或 Chromium。</p>\n</blockquote>\n<p>Puppeteer 的 Github 项目地址：<a href=\"https://github.com/GoogleChrome/puppeteer\" target=\"_blank\" rel=\"noopener\">https://github.com/GoogleChrome/puppeteer</a></p>\n<h2 id=\"Puppeteer-能做什么？\"><a href=\"#Puppeteer-能做什么？\" class=\"headerlink\" title=\"Puppeteer 能做什么？\"></a>Puppeteer 能做什么？</h2><ul>\n<li>生成页面截图或 PDF；</li>\n<li>爬取 SPA （单页应用）的数据并生成预渲染页面；</li>\n<li>自动提交表单、UI 自动化测试和模拟键盘输入等等；</li>\n<li>创建一个最新的自动化测试环境。使用最新的 JavaScript 和浏览器特性，直接在最新版本的 Chrome 中运行测试。</li>\n<li>捕捉你网站的数据加载过程，帮助诊断性能问题。</li>\n</ul>\n<h2 id=\"入门\"><a href=\"#入门\" class=\"headerlink\" title=\"入门\"></a>入门</h2><h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save puppeteer</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> or <span class=\"string\">\"yarn add puppeteer\"</span></span></span><br></pre></td></tr></table></figure>\n<p>需要注意的是，在安装 puppeteer 的时候，会下载一个最新版本的 Chromium 以保证 API 的正常使用。最新的 Windows 版本大小在 120Mb 左右。<br>不过也可以通过配置跳过 Chromium 下载这一步。具体看 <a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#environment-variables\" target=\"_blank\" rel=\"noopener\">Environment variables</a></p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><blockquote>\n<p>注意：使用 Puppeteer 最少需要 Node v6.4.0 版本。为了使用 async/await 特性，建议使用 Node v7.6.0 或更高版本。</p>\n</blockquote>\n<p><strong>基本操作</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 启动浏览器</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> browser = <span class=\"keyword\">await</span> puppeteer.launch(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里关闭 headless 模式，启动时会打开 Chromium。方便我们查看执行过程。</span></span><br><span class=\"line\">    headless: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"comment\">// 打开一个新的空白页面</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 设置窗口大小，不设置的话，默认是 800x600</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.setViewport(&#123;</span><br><span class=\"line\">    width: <span class=\"number\">1920</span>,</span><br><span class=\"line\">    height: <span class=\"number\">1080</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 进行其他操作</span></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 关闭页面</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.close();</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<p><strong>打开某一个网站</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://www.jd.com'</span>, &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 配置项</span></span><br><span class=\"line\">  waitUntil: <span class=\"string\">'networkidle0'</span>, <span class=\"comment\">// 在网络空闲时，也就是没有正在请求的链接时，继续执行</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><strong>生成截图</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">await</span> page.screenshot(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">'jd.png'</span>, <span class=\"comment\">// 在根目录下生成一张截图</span></span><br><span class=\"line\">  fullPage: <span class=\"literal\">true</span> <span class=\"comment\">// 默认只截取第一屏的页面，设置 fullPage 后可以截取整一个页面</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><strong>保存为 PDF</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 保存为 A4 纸张大小的 PDF 文件。</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.pdf(&#123;</span><br><span class=\"line\">  path: <span class=\"string\">'jd.pdf'</span>,</span><br><span class=\"line\">  format: <span class=\"string\">'A4'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><strong>执行脚本</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取页面窗口信息</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> dimensions = <span class=\"keyword\">await</span> page.evaluate(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    width: <span class=\"built_in\">document</span>.documentElement.clientWidth,</span><br><span class=\"line\">    height: <span class=\"built_in\">document</span>.documentElement.clientHeight,</span><br><span class=\"line\">    deviceScaleFactor: <span class=\"built_in\">window</span>.devicePixelRatio</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'Dimensions:'</span>, dimensions);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 获取 body 里面的 HTML 代码</span></span><br><span class=\"line\"><span class=\"comment\">// 查询 body 元素并创建 bodyHandle</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> bodyHandle = <span class=\"keyword\">await</span> page.$(<span class=\"string\">'body'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 把 bodyHandle 作为参数传入 evaluate</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> html = <span class=\"keyword\">await</span> page.evaluate(<span class=\"function\"><span class=\"params\">body</span> =&gt;</span> body.innerHTML, bodyHandle);</span><br><span class=\"line\"><span class=\"comment\">// 销毁 bodyHandle</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> bodyHandle.dispose();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'HTML:'</span>, html);</span><br></pre></td></tr></table></figure>\n<p>这里的 <code>page.$</code> 类似于 <code>document.querySelector</code>，而 <code>page.$$</code> 对应 <code>document.querySelectorAll</code>。</p>\n<p><strong>自动提交表单</strong></p>\n<p>打开京东首页，输入搜索关键词，回车进行搜索</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 地址栏输入网址</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://www.jd.com/'</span>, &#123;</span><br><span class=\"line\">  waitUntil: <span class=\"string\">'networkidle0'</span>, <span class=\"comment\">// 等待网络状态为空闲的时候才继续执行</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将输入焦点定位到搜索框，然后输入关键字</span></span><br><span class=\"line\"><span class=\"comment\">// await page.click('#key');</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.focus(<span class=\"string\">'#key'</span>);</span><br><span class=\"line\"><span class=\"keyword\">await</span> page.keyword.type(<span class=\"string\">'Javascript高级程序设计'</span>, &#123;</span><br><span class=\"line\">  delay: <span class=\"number\">100</span>, <span class=\"comment\">// 控制每个字母输入的间隔时间</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输入搜索关键字。</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.type(<span class=\"string\">'#key'</span>, <span class=\"string\">'Javascript高级程序设计'</span>, &#123;</span><br><span class=\"line\">  delay: <span class=\"number\">100</span>, </span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 上面两种输入关键字的方法任选一种即可。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 回车</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> page.keyboard.press(<span class=\"string\">'Enter'</span>);</span><br></pre></td></tr></table></figure>\n<p><strong>模拟移动端设备</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> puppeteer = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> devices = <span class=\"built_in\">require</span>(<span class=\"string\">'puppeteer/DeviceDescriptors'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> iPhone = devices[<span class=\"string\">'iPhone 6'</span>];</span><br><span class=\"line\">puppeteer.launch().then(<span class=\"keyword\">async</span> browser =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> page = <span class=\"keyword\">await</span> browser.newPage();</span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.emulate(iPhone);</span><br><span class=\"line\">  <span class=\"keyword\">await</span> page.goto(<span class=\"string\">'https://m.jd.com'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// other actions...</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> browser.close();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/GoogleChrome/puppeteer/blob/master/DeviceDescriptors.js\" target=\"_blank\" rel=\"noopener\">DeviceDescriptors</a> 是 puppeteer 自带的移动端设备配置，里面包含了常见的移动设备。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li><a href=\"https://github.com/GoogleChrome/puppeteer\" target=\"_blank\" rel=\"noopener\">Puppeteer README.md</a></li>\n<li><a href=\"https://github.com/ProtoTeam/blog/blob/master/201710/2.md\" target=\"_blank\" rel=\"noopener\">无头浏览器 Puppeteer 初探</a></li>\n</ol>"},{"title":"require.js 的一些常见问题","date":"2017-09-21T16:00:00.000Z","_content":"\n这篇文章，主要是写 `require.js` 在使用过程中的一些常见的问题。  \n部分问题会结合源代码进行分析说明。\n\n<!-- more -->\n\n### require 和 requirejs 这两个全局函数是完全相同的\n\n阅读 `require.js` 的源代码可以发现。\n\n```javascript\n// line 10\nvar requirejs, require, define;\n\n// line 1864\nreq = requirejs = function (deps, callback, errback, optional) {\n  // ...\n}\n\n// line 1821 - 1823\nif (!require) {\n  require = req;\n}\n```\n\n加载完 `require.js` 之后，可以执行以下代码简单测试一下：\n```javascript\nconsole.log(require === requirejs); // 输出：true\n```\n\n### require.config 是可以添加或覆盖原有 config 的\n\n```javascript\n// code 1\nrequirejs.config({\n  paths: {\n    mod: './mod',\n  }\n});\n\n// code 2\nrequirejs.config({\n  paths: {\n    mod2: './mod2',\n  }\n});\n\n// code 3\nrequirejs.config({\n  paths: {\n    mod: './mod2',\n  }\n});\n```\n\n同时执行 code 1 和 code 2，那么 mod 和 mod2 都有效。  \n同时执行 code 1 和 code 3 的话，那么最后一个 mod 有效。  \n\n具体实现逻辑可以看下 `require.js` 的源代码 1282 行的 `configure` 函数。\n\n\n### 符合某些规则的依赖模块名，会忽略 paths 和 baseUrl 的配置\n\n```javascript\nrequire.config({\n  baseUrl: './js',\n  paths: {\n    mod: '../modules',\n  },\n});\n\nrequire(['mod/main.js', 'http://example.com/test', 'mod/main?a=1', '/mod/main']);\n```\n\n上面四种模块名，会忽略配置。具体可以看下源代码：\n\n```javascript\n// line 1644 - 1649\nif (req.jsExtRegExp.test(moduleName)) {\n  //Just a plain path, not module name lookup, so just return it.\n  //Add extension if it is included. This is a bit wonky, only non-.js things pass\n  //an extension, this method probably needs to be reworked.\n  url = moduleName + (ext || '');\n}\n\n// line 1828\nreq.jsExtRegExp = /^\\/|:|\\?|\\.js$/;\n```\n\n上面正则匹配的是，以 `/` 开头，或中间有 `:` 或 `?`，或以 `.js` 结尾的字符串。  \n匹配成功的话，则直接 url 等于你传入的模块名，如果没有后缀再加一个后缀。  \n不会去处理其他设置（baseUrl 和 paths）的规则。\n\n\n### 依赖模块的加载和执行顺序是不确定的\n\n如下两个模块，代码执行的先后顺序是不确定的。\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(function () {\n  console.log('moduleB');\n});\n\n// main.js\ndefine(['moduleA.js', 'moduleB.js'], function () {\n  console.log('main');\n});\n```\n多刷新几次可以发现，moduleA 和 moduleB 的输出顺序是不确定的。\n\n\n### 依赖模块什么情况下会重复加载\n\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(['moduleA'], function () {\n  console.log('moduleB');\n});\n\n// main.js\ndefine(['moduleA', 'moduleB'], function () {\n  console.log('main');\n});\n```\n这种写法，最后 `moduleA.js` 只会加载一次，**不会**重复加载。  \n但是需要注意的是，依赖的模块名必须一样，有没有后缀必须统一。  \n如下这种写法，一个有后缀，一个没有后缀。**会**导致重复加载。\n\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(['moduleA'], function () {\n  console.log('moduleB');\n});\n\n// main.js\n// 注意这里的后缀\ndefine(['moduleA.js', 'moduleB'], function () {\n  console.log('main');\n});\n``` \n\n### 模块内如何正确的使用 require 函数\n\n```javascript\n// 错误的加载方式\ndefine(function () {\n  // 没有注入 require 函数时，默认使用的是全局注册的 require 函数。\n  // 这种带中括号的加载方式，不能正确返回模块对象。只能以回调的方式拿到模块对象。\n  // require() 返回的是一个函数，具体可以看 require.js 源代码 1764 行到 1798 行。\n  var wx = require(['https://res.wx.qq.com/open/js/jweixin-1.2.0.js']);\n  var fn = require();\n\n  console.log(wx === fn); // 输出：true\n});\n\n// 正确的加载方式\ndefine(function () {\n  require(['https://res.wx.qq.com/open/js/jweixin-1.2.0.js'], function (wx) {\n    console.log(wx);\n  });\n});\n\n// 更好的加载方式\ndefine(function (require) {\n  var wx = require('https://res.wx.qq.com/open/js/jweixin-1.2.0.js');\n  console.log(wx);\n});\n\n// 或者\ndefine(['https://res.wx.qq.com/open/js/jweixin-1.2.0.js'], function (wx) {\n  console.log(wx);\n});\n```\n\n但是需要注意的是，最后两种方式的写法不能混着用。也就是前置依赖和 `require` 不能混用。  \n具体可以查看源代码 2080 行：\n\n```javascript\n// line 2080\nif (!deps && isFunction(callback)) {\n  deps = [];\n  //Remove comments from the callback string,\n  //look for require calls, and pull them into the dependencies,\n  //but only if there are function args.\n  if (callback.length) {\n  // 后面省略...\n```\n使用 `require` 的前提是没有前置依赖，并且函数参数要大于 0。\n\n\n### 依赖模块代码总是在其他代码之前加载\n\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(function () {\n  console.log('moduleB');\n});\n\n// 依赖模块总是会被优先加载。\ndefine(function (require) {\n  console.log('main');\n  var A = require('moduleA');\n  var B = require('moduleB');\n});\n\n// 这部分代码等同于\ndefine(function (require) {\n  var A, B;\n  var tempA = require('moduleA');\n  var tempB = require('moduleB');\n  console.log('main');\n  A = tempA;\n  B = tempB;\n});\n\n// 最后输出：（模块 A 和 B 的输出顺序不确定）\n// moduleA\n// moduleB\n// main\n```\n\n---\n相关链接：\n\nrequire.js 源代码：https://github.com/requirejs/requirejs\n","source":"_posts/requirejs-qa.md","raw":"---\ntitle: require.js 的一些常见问题\ndate: 2017-09-22\ntags:\n - javascript\n---\n\n这篇文章，主要是写 `require.js` 在使用过程中的一些常见的问题。  \n部分问题会结合源代码进行分析说明。\n\n<!-- more -->\n\n### require 和 requirejs 这两个全局函数是完全相同的\n\n阅读 `require.js` 的源代码可以发现。\n\n```javascript\n// line 10\nvar requirejs, require, define;\n\n// line 1864\nreq = requirejs = function (deps, callback, errback, optional) {\n  // ...\n}\n\n// line 1821 - 1823\nif (!require) {\n  require = req;\n}\n```\n\n加载完 `require.js` 之后，可以执行以下代码简单测试一下：\n```javascript\nconsole.log(require === requirejs); // 输出：true\n```\n\n### require.config 是可以添加或覆盖原有 config 的\n\n```javascript\n// code 1\nrequirejs.config({\n  paths: {\n    mod: './mod',\n  }\n});\n\n// code 2\nrequirejs.config({\n  paths: {\n    mod2: './mod2',\n  }\n});\n\n// code 3\nrequirejs.config({\n  paths: {\n    mod: './mod2',\n  }\n});\n```\n\n同时执行 code 1 和 code 2，那么 mod 和 mod2 都有效。  \n同时执行 code 1 和 code 3 的话，那么最后一个 mod 有效。  \n\n具体实现逻辑可以看下 `require.js` 的源代码 1282 行的 `configure` 函数。\n\n\n### 符合某些规则的依赖模块名，会忽略 paths 和 baseUrl 的配置\n\n```javascript\nrequire.config({\n  baseUrl: './js',\n  paths: {\n    mod: '../modules',\n  },\n});\n\nrequire(['mod/main.js', 'http://example.com/test', 'mod/main?a=1', '/mod/main']);\n```\n\n上面四种模块名，会忽略配置。具体可以看下源代码：\n\n```javascript\n// line 1644 - 1649\nif (req.jsExtRegExp.test(moduleName)) {\n  //Just a plain path, not module name lookup, so just return it.\n  //Add extension if it is included. This is a bit wonky, only non-.js things pass\n  //an extension, this method probably needs to be reworked.\n  url = moduleName + (ext || '');\n}\n\n// line 1828\nreq.jsExtRegExp = /^\\/|:|\\?|\\.js$/;\n```\n\n上面正则匹配的是，以 `/` 开头，或中间有 `:` 或 `?`，或以 `.js` 结尾的字符串。  \n匹配成功的话，则直接 url 等于你传入的模块名，如果没有后缀再加一个后缀。  \n不会去处理其他设置（baseUrl 和 paths）的规则。\n\n\n### 依赖模块的加载和执行顺序是不确定的\n\n如下两个模块，代码执行的先后顺序是不确定的。\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(function () {\n  console.log('moduleB');\n});\n\n// main.js\ndefine(['moduleA.js', 'moduleB.js'], function () {\n  console.log('main');\n});\n```\n多刷新几次可以发现，moduleA 和 moduleB 的输出顺序是不确定的。\n\n\n### 依赖模块什么情况下会重复加载\n\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(['moduleA'], function () {\n  console.log('moduleB');\n});\n\n// main.js\ndefine(['moduleA', 'moduleB'], function () {\n  console.log('main');\n});\n```\n这种写法，最后 `moduleA.js` 只会加载一次，**不会**重复加载。  \n但是需要注意的是，依赖的模块名必须一样，有没有后缀必须统一。  \n如下这种写法，一个有后缀，一个没有后缀。**会**导致重复加载。\n\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(['moduleA'], function () {\n  console.log('moduleB');\n});\n\n// main.js\n// 注意这里的后缀\ndefine(['moduleA.js', 'moduleB'], function () {\n  console.log('main');\n});\n``` \n\n### 模块内如何正确的使用 require 函数\n\n```javascript\n// 错误的加载方式\ndefine(function () {\n  // 没有注入 require 函数时，默认使用的是全局注册的 require 函数。\n  // 这种带中括号的加载方式，不能正确返回模块对象。只能以回调的方式拿到模块对象。\n  // require() 返回的是一个函数，具体可以看 require.js 源代码 1764 行到 1798 行。\n  var wx = require(['https://res.wx.qq.com/open/js/jweixin-1.2.0.js']);\n  var fn = require();\n\n  console.log(wx === fn); // 输出：true\n});\n\n// 正确的加载方式\ndefine(function () {\n  require(['https://res.wx.qq.com/open/js/jweixin-1.2.0.js'], function (wx) {\n    console.log(wx);\n  });\n});\n\n// 更好的加载方式\ndefine(function (require) {\n  var wx = require('https://res.wx.qq.com/open/js/jweixin-1.2.0.js');\n  console.log(wx);\n});\n\n// 或者\ndefine(['https://res.wx.qq.com/open/js/jweixin-1.2.0.js'], function (wx) {\n  console.log(wx);\n});\n```\n\n但是需要注意的是，最后两种方式的写法不能混着用。也就是前置依赖和 `require` 不能混用。  \n具体可以查看源代码 2080 行：\n\n```javascript\n// line 2080\nif (!deps && isFunction(callback)) {\n  deps = [];\n  //Remove comments from the callback string,\n  //look for require calls, and pull them into the dependencies,\n  //but only if there are function args.\n  if (callback.length) {\n  // 后面省略...\n```\n使用 `require` 的前提是没有前置依赖，并且函数参数要大于 0。\n\n\n### 依赖模块代码总是在其他代码之前加载\n\n```javascript\n// moduleA.js\ndefine(function () {\n  console.log('moduleA');\n});\n\n// moduleB.js\ndefine(function () {\n  console.log('moduleB');\n});\n\n// 依赖模块总是会被优先加载。\ndefine(function (require) {\n  console.log('main');\n  var A = require('moduleA');\n  var B = require('moduleB');\n});\n\n// 这部分代码等同于\ndefine(function (require) {\n  var A, B;\n  var tempA = require('moduleA');\n  var tempB = require('moduleB');\n  console.log('main');\n  A = tempA;\n  B = tempB;\n});\n\n// 最后输出：（模块 A 和 B 的输出顺序不确定）\n// moduleA\n// moduleB\n// main\n```\n\n---\n相关链接：\n\nrequire.js 源代码：https://github.com/requirejs/requirejs\n","slug":"requirejs-qa","published":1,"updated":"2017-11-17T08:34:12.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84odt001ruo2eupnf2fta","content":"<p>这篇文章，主要是写 <code>require.js</code> 在使用过程中的一些常见的问题。<br>部分问题会结合源代码进行分析说明。</p>\n<a id=\"more\"></a>\n<h3 id=\"require-和-requirejs-这两个全局函数是完全相同的\"><a href=\"#require-和-requirejs-这两个全局函数是完全相同的\" class=\"headerlink\" title=\"require 和 requirejs 这两个全局函数是完全相同的\"></a>require 和 requirejs 这两个全局函数是完全相同的</h3><p>阅读 <code>require.js</code> 的源代码可以发现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// line 10</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> requirejs, <span class=\"built_in\">require</span>, define;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// line 1864</span></span><br><span class=\"line\">req = requirejs = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">deps, callback, errback, optional</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// line 1821 - 1823</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">require</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">require</span> = req;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>加载完 <code>require.js</code> 之后，可以执行以下代码简单测试一下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">require</span> === requirejs); <span class=\"comment\">// 输出：true</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"require-config-是可以添加或覆盖原有-config-的\"><a href=\"#require-config-是可以添加或覆盖原有-config-的\" class=\"headerlink\" title=\"require.config 是可以添加或覆盖原有 config 的\"></a>require.config 是可以添加或覆盖原有 config 的</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// code 1</span></span><br><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod: <span class=\"string\">'./mod'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// code 2</span></span><br><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod2: <span class=\"string\">'./mod2'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// code 3</span></span><br><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod: <span class=\"string\">'./mod2'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>同时执行 code 1 和 code 2，那么 mod 和 mod2 都有效。<br>同时执行 code 1 和 code 3 的话，那么最后一个 mod 有效。  </p>\n<p>具体实现逻辑可以看下 <code>require.js</code> 的源代码 1282 行的 <code>configure</code> 函数。</p>\n<h3 id=\"符合某些规则的依赖模块名，会忽略-paths-和-baseUrl-的配置\"><a href=\"#符合某些规则的依赖模块名，会忽略-paths-和-baseUrl-的配置\" class=\"headerlink\" title=\"符合某些规则的依赖模块名，会忽略 paths 和 baseUrl 的配置\"></a>符合某些规则的依赖模块名，会忽略 paths 和 baseUrl 的配置</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>.config(&#123;</span><br><span class=\"line\">  baseUrl: <span class=\"string\">'./js'</span>,</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod: <span class=\"string\">'../modules'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'mod/main.js'</span>, <span class=\"string\">'http://example.com/test'</span>, <span class=\"string\">'mod/main?a=1'</span>, <span class=\"string\">'/mod/main'</span>]);</span><br></pre></td></tr></table></figure>\n<p>上面四种模块名，会忽略配置。具体可以看下源代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// line 1644 - 1649</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (req.jsExtRegExp.test(moduleName)) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//Just a plain path, not module name lookup, so just return it.</span></span><br><span class=\"line\">  <span class=\"comment\">//Add extension if it is included. This is a bit wonky, only non-.js things pass</span></span><br><span class=\"line\">  <span class=\"comment\">//an extension, this method probably needs to be reworked.</span></span><br><span class=\"line\">  url = moduleName + (ext || <span class=\"string\">''</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// line 1828</span></span><br><span class=\"line\">req.jsExtRegExp = <span class=\"regexp\">/^\\/|:|\\?|\\.js$/</span>;</span><br></pre></td></tr></table></figure>\n<p>上面正则匹配的是，以 <code>/</code> 开头，或中间有 <code>:</code> 或 <code>?</code>，或以 <code>.js</code> 结尾的字符串。<br>匹配成功的话，则直接 url 等于你传入的模块名，如果没有后缀再加一个后缀。<br>不会去处理其他设置（baseUrl 和 paths）的规则。</p>\n<h3 id=\"依赖模块的加载和执行顺序是不确定的\"><a href=\"#依赖模块的加载和执行顺序是不确定的\" class=\"headerlink\" title=\"依赖模块的加载和执行顺序是不确定的\"></a>依赖模块的加载和执行顺序是不确定的</h3><p>如下两个模块，代码执行的先后顺序是不确定的。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA.js'</span>, <span class=\"string\">'moduleB.js'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>多刷新几次可以发现，moduleA 和 moduleB 的输出顺序是不确定的。</p>\n<h3 id=\"依赖模块什么情况下会重复加载\"><a href=\"#依赖模块什么情况下会重复加载\" class=\"headerlink\" title=\"依赖模块什么情况下会重复加载\"></a>依赖模块什么情况下会重复加载</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA'</span>, <span class=\"string\">'moduleB'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这种写法，最后 <code>moduleA.js</code> 只会加载一次，<strong>不会</strong>重复加载。<br>但是需要注意的是，依赖的模块名必须一样，有没有后缀必须统一。<br>如下这种写法，一个有后缀，一个没有后缀。<strong>会</strong>导致重复加载。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"comment\">// 注意这里的后缀</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA.js'</span>, <span class=\"string\">'moduleB'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">` </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 模块内如何正确的使用 require 函数</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"comment\">// 错误的加载方式</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 没有注入 require 函数时，默认使用的是全局注册的 require 函数。</span></span><br><span class=\"line\">  <span class=\"comment\">// 这种带中括号的加载方式，不能正确返回模块对象。只能以回调的方式拿到模块对象。</span></span><br><span class=\"line\">  <span class=\"comment\">// require() 返回的是一个函数，具体可以看 require.js 源代码 1764 行到 1798 行。</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> wx = <span class=\"built_in\">require</span>([<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fn = <span class=\"built_in\">require</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(wx === fn); <span class=\"comment\">// 输出：true</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 正确的加载方式</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">require</span>([<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">wx</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(wx);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更好的加载方式</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> wx = <span class=\"built_in\">require</span>(<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(wx);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">define([<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">wx</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(wx);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>但是需要注意的是，最后两种方式的写法不能混着用。也就是前置依赖和 <code>require</code> 不能混用。<br>具体可以查看源代码 2080 行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// line 2080</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!deps &amp;&amp; isFunction(callback)) &#123;</span><br><span class=\"line\">  deps = [];</span><br><span class=\"line\">  <span class=\"comment\">//Remove comments from the callback string,</span></span><br><span class=\"line\">  <span class=\"comment\">//look for require calls, and pull them into the dependencies,</span></span><br><span class=\"line\">  <span class=\"comment\">//but only if there are function args.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callback.length) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 后面省略...</span></span><br></pre></td></tr></table></figure>\n<p>使用 <code>require</code> 的前提是没有前置依赖，并且函数参数要大于 0。</p>\n<h3 id=\"依赖模块代码总是在其他代码之前加载\"><a href=\"#依赖模块代码总是在其他代码之前加载\" class=\"headerlink\" title=\"依赖模块代码总是在其他代码之前加载\"></a>依赖模块代码总是在其他代码之前加载</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 依赖模块总是会被优先加载。</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> A = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> B = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这部分代码等同于</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> A, B;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempA = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempB = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">  A = tempA;</span><br><span class=\"line\">  B = tempB;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 最后输出：（模块 A 和 B 的输出顺序不确定）</span></span><br><span class=\"line\"><span class=\"comment\">// moduleA</span></span><br><span class=\"line\"><span class=\"comment\">// moduleB</span></span><br><span class=\"line\"><span class=\"comment\">// main</span></span><br></pre></td></tr></table></figure>\n<hr>\n<p>相关链接：</p>\n<p>require.js 源代码：<a href=\"https://github.com/requirejs/requirejs\" target=\"_blank\" rel=\"noopener\">https://github.com/requirejs/requirejs</a></p>\n","site":{"data":{}},"excerpt":"<p>这篇文章，主要是写 <code>require.js</code> 在使用过程中的一些常见的问题。<br>部分问题会结合源代码进行分析说明。</p>","more":"<h3 id=\"require-和-requirejs-这两个全局函数是完全相同的\"><a href=\"#require-和-requirejs-这两个全局函数是完全相同的\" class=\"headerlink\" title=\"require 和 requirejs 这两个全局函数是完全相同的\"></a>require 和 requirejs 这两个全局函数是完全相同的</h3><p>阅读 <code>require.js</code> 的源代码可以发现。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// line 10</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> requirejs, <span class=\"built_in\">require</span>, define;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// line 1864</span></span><br><span class=\"line\">req = requirejs = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">deps, callback, errback, optional</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// line 1821 - 1823</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">require</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">require</span> = req;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>加载完 <code>require.js</code> 之后，可以执行以下代码简单测试一下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">require</span> === requirejs); <span class=\"comment\">// 输出：true</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"require-config-是可以添加或覆盖原有-config-的\"><a href=\"#require-config-是可以添加或覆盖原有-config-的\" class=\"headerlink\" title=\"require.config 是可以添加或覆盖原有 config 的\"></a>require.config 是可以添加或覆盖原有 config 的</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// code 1</span></span><br><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod: <span class=\"string\">'./mod'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// code 2</span></span><br><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod2: <span class=\"string\">'./mod2'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// code 3</span></span><br><span class=\"line\">requirejs.config(&#123;</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod: <span class=\"string\">'./mod2'</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>同时执行 code 1 和 code 2，那么 mod 和 mod2 都有效。<br>同时执行 code 1 和 code 3 的话，那么最后一个 mod 有效。  </p>\n<p>具体实现逻辑可以看下 <code>require.js</code> 的源代码 1282 行的 <code>configure</code> 函数。</p>\n<h3 id=\"符合某些规则的依赖模块名，会忽略-paths-和-baseUrl-的配置\"><a href=\"#符合某些规则的依赖模块名，会忽略-paths-和-baseUrl-的配置\" class=\"headerlink\" title=\"符合某些规则的依赖模块名，会忽略 paths 和 baseUrl 的配置\"></a>符合某些规则的依赖模块名，会忽略 paths 和 baseUrl 的配置</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>.config(&#123;</span><br><span class=\"line\">  baseUrl: <span class=\"string\">'./js'</span>,</span><br><span class=\"line\">  paths: &#123;</span><br><span class=\"line\">    mod: <span class=\"string\">'../modules'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'mod/main.js'</span>, <span class=\"string\">'http://example.com/test'</span>, <span class=\"string\">'mod/main?a=1'</span>, <span class=\"string\">'/mod/main'</span>]);</span><br></pre></td></tr></table></figure>\n<p>上面四种模块名，会忽略配置。具体可以看下源代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// line 1644 - 1649</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (req.jsExtRegExp.test(moduleName)) &#123;</span><br><span class=\"line\">  <span class=\"comment\">//Just a plain path, not module name lookup, so just return it.</span></span><br><span class=\"line\">  <span class=\"comment\">//Add extension if it is included. This is a bit wonky, only non-.js things pass</span></span><br><span class=\"line\">  <span class=\"comment\">//an extension, this method probably needs to be reworked.</span></span><br><span class=\"line\">  url = moduleName + (ext || <span class=\"string\">''</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// line 1828</span></span><br><span class=\"line\">req.jsExtRegExp = <span class=\"regexp\">/^\\/|:|\\?|\\.js$/</span>;</span><br></pre></td></tr></table></figure>\n<p>上面正则匹配的是，以 <code>/</code> 开头，或中间有 <code>:</code> 或 <code>?</code>，或以 <code>.js</code> 结尾的字符串。<br>匹配成功的话，则直接 url 等于你传入的模块名，如果没有后缀再加一个后缀。<br>不会去处理其他设置（baseUrl 和 paths）的规则。</p>\n<h3 id=\"依赖模块的加载和执行顺序是不确定的\"><a href=\"#依赖模块的加载和执行顺序是不确定的\" class=\"headerlink\" title=\"依赖模块的加载和执行顺序是不确定的\"></a>依赖模块的加载和执行顺序是不确定的</h3><p>如下两个模块，代码执行的先后顺序是不确定的。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA.js'</span>, <span class=\"string\">'moduleB.js'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>多刷新几次可以发现，moduleA 和 moduleB 的输出顺序是不确定的。</p>\n<h3 id=\"依赖模块什么情况下会重复加载\"><a href=\"#依赖模块什么情况下会重复加载\" class=\"headerlink\" title=\"依赖模块什么情况下会重复加载\"></a>依赖模块什么情况下会重复加载</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA'</span>, <span class=\"string\">'moduleB'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这种写法，最后 <code>moduleA.js</code> 只会加载一次，<strong>不会</strong>重复加载。<br>但是需要注意的是，依赖的模块名必须一样，有没有后缀必须统一。<br>如下这种写法，一个有后缀，一个没有后缀。<strong>会</strong>导致重复加载。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// main.js</span></span><br><span class=\"line\"><span class=\"comment\">// 注意这里的后缀</span></span><br><span class=\"line\">define([<span class=\"string\">'moduleA.js'</span>, <span class=\"string\">'moduleB'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">` </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### 模块内如何正确的使用 require 函数</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"comment\">// 错误的加载方式</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 没有注入 require 函数时，默认使用的是全局注册的 require 函数。</span></span><br><span class=\"line\">  <span class=\"comment\">// 这种带中括号的加载方式，不能正确返回模块对象。只能以回调的方式拿到模块对象。</span></span><br><span class=\"line\">  <span class=\"comment\">// require() 返回的是一个函数，具体可以看 require.js 源代码 1764 行到 1798 行。</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> wx = <span class=\"built_in\">require</span>([<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fn = <span class=\"built_in\">require</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(wx === fn); <span class=\"comment\">// 输出：true</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 正确的加载方式</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">require</span>([<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">wx</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(wx);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更好的加载方式</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> wx = <span class=\"built_in\">require</span>(<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(wx);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">define([<span class=\"string\">'https://res.wx.qq.com/open/js/jweixin-1.2.0.js'</span>], <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">wx</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(wx);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>但是需要注意的是，最后两种方式的写法不能混着用。也就是前置依赖和 <code>require</code> 不能混用。<br>具体可以查看源代码 2080 行：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// line 2080</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!deps &amp;&amp; isFunction(callback)) &#123;</span><br><span class=\"line\">  deps = [];</span><br><span class=\"line\">  <span class=\"comment\">//Remove comments from the callback string,</span></span><br><span class=\"line\">  <span class=\"comment\">//look for require calls, and pull them into the dependencies,</span></span><br><span class=\"line\">  <span class=\"comment\">//but only if there are function args.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callback.length) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 后面省略...</span></span><br></pre></td></tr></table></figure>\n<p>使用 <code>require</code> 的前提是没有前置依赖，并且函数参数要大于 0。</p>\n<h3 id=\"依赖模块代码总是在其他代码之前加载\"><a href=\"#依赖模块代码总是在其他代码之前加载\" class=\"headerlink\" title=\"依赖模块代码总是在其他代码之前加载\"></a>依赖模块代码总是在其他代码之前加载</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moduleA.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// moduleB.js</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 依赖模块总是会被优先加载。</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> A = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> B = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这部分代码等同于</span></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">require</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> A, B;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempA = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleA'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempB = <span class=\"built_in\">require</span>(<span class=\"string\">'moduleB'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'main'</span>);</span><br><span class=\"line\">  A = tempA;</span><br><span class=\"line\">  B = tempB;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 最后输出：（模块 A 和 B 的输出顺序不确定）</span></span><br><span class=\"line\"><span class=\"comment\">// moduleA</span></span><br><span class=\"line\"><span class=\"comment\">// moduleB</span></span><br><span class=\"line\"><span class=\"comment\">// main</span></span><br></pre></td></tr></table></figure>\n<hr>\n<p>相关链接：</p>\n<p>require.js 源代码：<a href=\"https://github.com/requirejs/requirejs\" target=\"_blank\" rel=\"noopener\">https://github.com/requirejs/requirejs</a></p>"},{"title":"review account","date":"2017-12-28T16:00:00.000Z","_content":"\n 内含主要实现功能，静态资源目录，技术及建议与优化\n<!--more-->\n\n  ## 主要实现功能\n\n  [登录](https://account.bozhong.com/ \"登录\")\n  [注册](https://account.bozhong.com/register/index \"注册\")\n  [重置密码](https://account.bozhong.bzdev.net/auth/resetpwd?redirect_uri=)\n  [找回密码](https://account.bozhong.com/register/findpwd)\n\n  ## 静态资源目录(source.seedit.com)\n\n  account\n    |- css\n    |- img\n    |- js\n\n  \n  ## 技术\n\n  |- 后端实现PHP\n  |- 前端页面自适应使用@media\n  |- jQuery 框架\n  |- seajs\n\n\n  ## 建议与优化\n\n  1.页面采用@media方式实现网页自适应，而2个终端代码差异较大，导致1个页面上承载着2个终端的代码，建议使用模板形式，如 handlebarser 模板引擎\n  ```html\n  <!--index.phtml 22行~105行-->\n  <div class=\"register\" id=\"register\">\n    ...\n  </div>\n\n  <div class=\"register-mobile common-slider page\" id=\"register-mobile\">\n    ...\n  </div>\n  ```\n  2.移动端修改密码页面空白内容多,响应式样式没有处理好，适用PC端的样式在移动端并没有重定义\n\n  找回/修改密码页\n  <img src=\"/img/reviwe-source-account/IMG_9790.PNG\" alt=\"account\" />\n  \n  3.页面使用静态内联样式，这种样式不利于后期维护，所以要尽量避免\n\n```html\n    <!--application\\views\\register\\findpwd.phtml 29行-->\n    <label class=\"type pwd_find\" for=\"pwd_find\" style=\"min-width: 90px;display: inline-block;\">用户名&nbsp;&#47;&nbsp;邮箱</label>\n ```\n\n  4.无效的样式，例如定义了无效的属性，页面二次开发或改版，旧类名不用的没有及时删除，导致样式表代码冗杂，可利用第三方工具或模块进行检测剔除\n\n \n ```CSS\n /*account_v3.css 600 ~ 602行*/\n  #refresh_loginCaptcha{\n    margin-left: 18px;\n    padding-bottom: -10px;\n    display: inline-block;\n    cursor: pointer;\n    vertical-align: super;\n  }\n ```\n\n 5.account_v4.js/account_v3.js/account_pwd.js 文件 dom元素操作频繁，可以用变量存储\n\n 6.account_v4.js 文件 75~101行 代码优化\n\n ```js\n if (data.error_code === 0) {\n    var time = 60;\n    sent = true;\n    alert('验证码已发送，请查收~');\n    if (isMobile) {\n      $('#JS_send_captcha').attr('disabled', 'disabled').html('重新发送(<span id=\"JS_resend_m\">60</span>)');\n      var interval = setInterval(function () {\n        if (time > 0) {\n          time--\n          $('#JS_resend_m').text(time);\n        } else {\n          clearInterval(interval);\n          $('#JS_send_captcha').removeAttr('disabled').text('获取验证码');\n          sent = false;\n        }\n      }, 1000);\n    } else {\n      $('#JS_btn_captcha').attr('disabled', 'disabled').html('重新发送(<span id=\"JS_resend\">60</span>)');\n      captchaObj.disable();\n      var interval = setInterval(function () {\n        if (time > 0) {\n          time--\n          $('#JS_resend').text(time);\n        } else {\n          clearInterval(interval);\n          $('#JS_btn_captcha').removeAttr('disabled').text('获取验证码');\n          captchaObj.enable();\n          sent = false;\n        }\n      }, 1000);\n    }\n  } else {\n    alert(data.error_message);\n  }\n\n  ```\n 优化:\n\n  ```js\n    if (data.error_code === 0) {\n      var time = 60;\n      var $captcha = isMobile ? $('#JS_send_captcha') : $('#JS_btn_captcha');\n      var resend = isMobile ? 'JS_resend_m' : 'JS_resend';\n\n      sent = true;\n      alert('验证码已发送，请查收~');\n\n      if (!isMobile) captchaObj.disable();\n      $captcha.attr('disabled', 'disabled').html('重新发送(<span id=\"'+resend+'\">60</span>)');\n\n      var interval = setInterval(function () {\n        if (time > 0) {\n            time--\n            $('#'+ resend).text(time);\n          } else {\n            clearInterval(interval);\n            $captcha.removeAttr('disabled').text('获取验证码');\n            if (!isMobile) captchaObj.enable();\n            sent = false;\n          }\n      }, 1000);\n    } else {\n      alert(data.error_message);\n    }\n  ```\n  7.account_resetpwd.js 文件 307~327行 代码优化\n\n  ```js\n    var reUrl = new Url(window.location.href); \n    if (/Mobile/.test(navigator.userAgent)) {\n        if(reUrl.getParam('redirect_uri')) {\n            window.location.href=reUrl.getParam('redirect_uri');\n        } else if(/office/.test(reUrl)) {\n            window.location.href = 'http://m.office.bzdev.net';\n        } else if(/online/.test(reUrl)) {\n            window.location.href = 'http://m.online.seedit.cc';\n        } else {\n            window.location.href = 'http://m.bozhong.com';\n        }\n    }else{\n        if(reUrl.getParam('redirect_uri')) {\n            window.location.href=reUrl.getParam('redirect_uri');\n        } else if(/office/.test(reUrl)) {\n            window.location.href = 'http://www.office.bzdev.net';\n        } else if(/online/.test(reUrl)) {\n            window.location.href = 'http://www.online.seedit.cc';\n        } else {\n            window.location.href = 'http://www.bozhong.com';\n        }\n    }\n  ```\n  优化:\n\n  ```js\n  var reUrl = new Url(window.location.href);\n  var i;\n  var firstHost = /Mobile/.test(navigator.userAgent) ? 'm.' : 'www.';\n  var hostname = {\n    office : 'office.bzdev.net',\n    online : 'online.seedit.cc',\n    bozhong : 'bozhong.com'\n  }\n  if (reUrl.getParam('redirect_uri')) return window.location.href=reUrl.getParam('redirect_uri');\n  for(i in hostname){\n    if (location.href.match(hostname[i]))  window.location.href= 'https://'+ firstHost + hostname[i];\n  }\n  ```\n\n\n工具\n\nhttp://jigsaw.w3.org/css-validator/ \nhttps://github.com/switer/DoverJS\n\n\n","source":"_posts/reviwe-source-account.md","raw":"---\ntitle: review account  \ndate: 2017-12-29\ntags:\n - javascript\n - review\n---\n\n 内含主要实现功能，静态资源目录，技术及建议与优化\n<!--more-->\n\n  ## 主要实现功能\n\n  [登录](https://account.bozhong.com/ \"登录\")\n  [注册](https://account.bozhong.com/register/index \"注册\")\n  [重置密码](https://account.bozhong.bzdev.net/auth/resetpwd?redirect_uri=)\n  [找回密码](https://account.bozhong.com/register/findpwd)\n\n  ## 静态资源目录(source.seedit.com)\n\n  account\n    |- css\n    |- img\n    |- js\n\n  \n  ## 技术\n\n  |- 后端实现PHP\n  |- 前端页面自适应使用@media\n  |- jQuery 框架\n  |- seajs\n\n\n  ## 建议与优化\n\n  1.页面采用@media方式实现网页自适应，而2个终端代码差异较大，导致1个页面上承载着2个终端的代码，建议使用模板形式，如 handlebarser 模板引擎\n  ```html\n  <!--index.phtml 22行~105行-->\n  <div class=\"register\" id=\"register\">\n    ...\n  </div>\n\n  <div class=\"register-mobile common-slider page\" id=\"register-mobile\">\n    ...\n  </div>\n  ```\n  2.移动端修改密码页面空白内容多,响应式样式没有处理好，适用PC端的样式在移动端并没有重定义\n\n  找回/修改密码页\n  <img src=\"/img/reviwe-source-account/IMG_9790.PNG\" alt=\"account\" />\n  \n  3.页面使用静态内联样式，这种样式不利于后期维护，所以要尽量避免\n\n```html\n    <!--application\\views\\register\\findpwd.phtml 29行-->\n    <label class=\"type pwd_find\" for=\"pwd_find\" style=\"min-width: 90px;display: inline-block;\">用户名&nbsp;&#47;&nbsp;邮箱</label>\n ```\n\n  4.无效的样式，例如定义了无效的属性，页面二次开发或改版，旧类名不用的没有及时删除，导致样式表代码冗杂，可利用第三方工具或模块进行检测剔除\n\n \n ```CSS\n /*account_v3.css 600 ~ 602行*/\n  #refresh_loginCaptcha{\n    margin-left: 18px;\n    padding-bottom: -10px;\n    display: inline-block;\n    cursor: pointer;\n    vertical-align: super;\n  }\n ```\n\n 5.account_v4.js/account_v3.js/account_pwd.js 文件 dom元素操作频繁，可以用变量存储\n\n 6.account_v4.js 文件 75~101行 代码优化\n\n ```js\n if (data.error_code === 0) {\n    var time = 60;\n    sent = true;\n    alert('验证码已发送，请查收~');\n    if (isMobile) {\n      $('#JS_send_captcha').attr('disabled', 'disabled').html('重新发送(<span id=\"JS_resend_m\">60</span>)');\n      var interval = setInterval(function () {\n        if (time > 0) {\n          time--\n          $('#JS_resend_m').text(time);\n        } else {\n          clearInterval(interval);\n          $('#JS_send_captcha').removeAttr('disabled').text('获取验证码');\n          sent = false;\n        }\n      }, 1000);\n    } else {\n      $('#JS_btn_captcha').attr('disabled', 'disabled').html('重新发送(<span id=\"JS_resend\">60</span>)');\n      captchaObj.disable();\n      var interval = setInterval(function () {\n        if (time > 0) {\n          time--\n          $('#JS_resend').text(time);\n        } else {\n          clearInterval(interval);\n          $('#JS_btn_captcha').removeAttr('disabled').text('获取验证码');\n          captchaObj.enable();\n          sent = false;\n        }\n      }, 1000);\n    }\n  } else {\n    alert(data.error_message);\n  }\n\n  ```\n 优化:\n\n  ```js\n    if (data.error_code === 0) {\n      var time = 60;\n      var $captcha = isMobile ? $('#JS_send_captcha') : $('#JS_btn_captcha');\n      var resend = isMobile ? 'JS_resend_m' : 'JS_resend';\n\n      sent = true;\n      alert('验证码已发送，请查收~');\n\n      if (!isMobile) captchaObj.disable();\n      $captcha.attr('disabled', 'disabled').html('重新发送(<span id=\"'+resend+'\">60</span>)');\n\n      var interval = setInterval(function () {\n        if (time > 0) {\n            time--\n            $('#'+ resend).text(time);\n          } else {\n            clearInterval(interval);\n            $captcha.removeAttr('disabled').text('获取验证码');\n            if (!isMobile) captchaObj.enable();\n            sent = false;\n          }\n      }, 1000);\n    } else {\n      alert(data.error_message);\n    }\n  ```\n  7.account_resetpwd.js 文件 307~327行 代码优化\n\n  ```js\n    var reUrl = new Url(window.location.href); \n    if (/Mobile/.test(navigator.userAgent)) {\n        if(reUrl.getParam('redirect_uri')) {\n            window.location.href=reUrl.getParam('redirect_uri');\n        } else if(/office/.test(reUrl)) {\n            window.location.href = 'http://m.office.bzdev.net';\n        } else if(/online/.test(reUrl)) {\n            window.location.href = 'http://m.online.seedit.cc';\n        } else {\n            window.location.href = 'http://m.bozhong.com';\n        }\n    }else{\n        if(reUrl.getParam('redirect_uri')) {\n            window.location.href=reUrl.getParam('redirect_uri');\n        } else if(/office/.test(reUrl)) {\n            window.location.href = 'http://www.office.bzdev.net';\n        } else if(/online/.test(reUrl)) {\n            window.location.href = 'http://www.online.seedit.cc';\n        } else {\n            window.location.href = 'http://www.bozhong.com';\n        }\n    }\n  ```\n  优化:\n\n  ```js\n  var reUrl = new Url(window.location.href);\n  var i;\n  var firstHost = /Mobile/.test(navigator.userAgent) ? 'm.' : 'www.';\n  var hostname = {\n    office : 'office.bzdev.net',\n    online : 'online.seedit.cc',\n    bozhong : 'bozhong.com'\n  }\n  if (reUrl.getParam('redirect_uri')) return window.location.href=reUrl.getParam('redirect_uri');\n  for(i in hostname){\n    if (location.href.match(hostname[i]))  window.location.href= 'https://'+ firstHost + hostname[i];\n  }\n  ```\n\n\n工具\n\nhttp://jigsaw.w3.org/css-validator/ \nhttps://github.com/switer/DoverJS\n\n\n","slug":"reviwe-source-account","published":1,"updated":"2018-03-02T05:42:04.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84odw001tuo2es2uep84s","content":"<p> 内含主要实现功能，静态资源目录，技术及建议与优化<br><a id=\"more\"></a></p>\n<h2 id=\"主要实现功能\"><a href=\"#主要实现功能\" class=\"headerlink\" title=\"主要实现功能\"></a>主要实现功能</h2><p>  <a href=\"https://account.bozhong.com/\" title=\"登录\" target=\"_blank\" rel=\"noopener\">登录</a><br>  <a href=\"https://account.bozhong.com/register/index\" title=\"注册\" target=\"_blank\" rel=\"noopener\">注册</a><br>  <a href=\"https://account.bozhong.bzdev.net/auth/resetpwd?redirect_uri=\" target=\"_blank\" rel=\"noopener\">重置密码</a><br>  <a href=\"https://account.bozhong.com/register/findpwd\" target=\"_blank\" rel=\"noopener\">找回密码</a></p>\n<h2 id=\"静态资源目录-source-seedit-com\"><a href=\"#静态资源目录-source-seedit-com\" class=\"headerlink\" title=\"静态资源目录(source.seedit.com)\"></a>静态资源目录(source.seedit.com)</h2><p>  account<br>    |- css<br>    |- img<br>    |- js</p>\n<h2 id=\"技术\"><a href=\"#技术\" class=\"headerlink\" title=\"技术\"></a>技术</h2><p>  |- 后端实现PHP<br>  |- 前端页面自适应使用@media<br>  |- jQuery 框架<br>  |- seajs</p>\n<h2 id=\"建议与优化\"><a href=\"#建议与优化\" class=\"headerlink\" title=\"建议与优化\"></a>建议与优化</h2><p>  1.页面采用@media方式实现网页自适应，而2个终端代码差异较大，导致1个页面上承载着2个终端的代码，建议使用模板形式，如 handlebarser 模板引擎<br>  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--index.phtml 22行~105行--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"register\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"register\"</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"register-mobile common-slider page\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"register-mobile\"</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>  2.移动端修改密码页面空白内容多,响应式样式没有处理好，适用PC端的样式在移动端并没有重定义</p>\n<p>  找回/修改密码页<br>  <img src=\"/img/reviwe-source-account/IMG_9790.PNG\" alt=\"account\"></p>\n<p>  3.页面使用静态内联样式，这种样式不利于后期维护，所以要尽量避免</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--application\\views\\register\\findpwd.phtml 29行--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"type pwd_find\"</span> <span class=\"attr\">for</span>=<span class=\"string\">\"pwd_find\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"min-width: 90px;display: inline-block;\"</span>&gt;</span>用户名&amp;nbsp;&amp;#47;&amp;nbsp;邮箱<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>  4.无效的样式，例如定义了无效的属性，页面二次开发或改版，旧类名不用的没有及时删除，导致样式表代码冗杂，可利用第三方工具或模块进行检测剔除</p>\n <figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*account_v3.css 600 ~ 602行*/</span></span><br><span class=\"line\"> <span class=\"selector-id\">#refresh_loginCaptcha</span>&#123;</span><br><span class=\"line\">   <span class=\"attribute\">margin-left</span>: <span class=\"number\">18px</span>;</span><br><span class=\"line\">   <span class=\"attribute\">padding-bottom</span>: -<span class=\"number\">10px</span>;</span><br><span class=\"line\">   <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">   <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">   <span class=\"attribute\">vertical-align</span>: super;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p> 5.account_v4.js/account_v3.js/account_pwd.js 文件 dom元素操作频繁，可以用变量存储</p>\n<p> 6.account_v4.js 文件 75~101行 代码优化</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (data.error_code === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> time = <span class=\"number\">60</span>;</span><br><span class=\"line\">   sent = <span class=\"literal\">true</span>;</span><br><span class=\"line\">   alert(<span class=\"string\">'验证码已发送，请查收~'</span>);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (isMobile) &#123;</span><br><span class=\"line\">     $(<span class=\"string\">'#JS_send_captcha'</span>).attr(<span class=\"string\">'disabled'</span>, <span class=\"string\">'disabled'</span>).html(<span class=\"string\">'重新发送(&lt;span id=\"JS_resend_m\"&gt;60&lt;/span&gt;)'</span>);</span><br><span class=\"line\">     <span class=\"keyword\">var</span> interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (time &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         time--</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_resend_m'</span>).text(time);</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         clearInterval(interval);</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_send_captcha'</span>).removeAttr(<span class=\"string\">'disabled'</span>).text(<span class=\"string\">'获取验证码'</span>);</span><br><span class=\"line\">         sent = <span class=\"literal\">false</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     $(<span class=\"string\">'#JS_btn_captcha'</span>).attr(<span class=\"string\">'disabled'</span>, <span class=\"string\">'disabled'</span>).html(<span class=\"string\">'重新发送(&lt;span id=\"JS_resend\"&gt;60&lt;/span&gt;)'</span>);</span><br><span class=\"line\">     captchaObj.disable();</span><br><span class=\"line\">     <span class=\"keyword\">var</span> interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (time &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         time--</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_resend'</span>).text(time);</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         clearInterval(interval);</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_btn_captcha'</span>).removeAttr(<span class=\"string\">'disabled'</span>).text(<span class=\"string\">'获取验证码'</span>);</span><br><span class=\"line\">         captchaObj.enable();</span><br><span class=\"line\">         sent = <span class=\"literal\">false</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">   alert(data.error_message);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p> 优化:</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (data.error_code === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> time = <span class=\"number\">60</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $captcha = isMobile ? $(<span class=\"string\">'#JS_send_captcha'</span>) : $(<span class=\"string\">'#JS_btn_captcha'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> resend = isMobile ? <span class=\"string\">'JS_resend_m'</span> : <span class=\"string\">'JS_resend'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  sent = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  alert(<span class=\"string\">'验证码已发送，请查收~'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!isMobile) captchaObj.disable();</span><br><span class=\"line\">  $captcha.attr(<span class=\"string\">'disabled'</span>, <span class=\"string\">'disabled'</span>).html(<span class=\"string\">'重新发送(&lt;span id=\"'</span>+resend+<span class=\"string\">'\"&gt;60&lt;/span&gt;)'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (time &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        time--</span><br><span class=\"line\">        $(<span class=\"string\">'#'</span>+ resend).text(time);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        clearInterval(interval);</span><br><span class=\"line\">        $captcha.removeAttr(<span class=\"string\">'disabled'</span>).text(<span class=\"string\">'获取验证码'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isMobile) captchaObj.enable();</span><br><span class=\"line\">        sent = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  alert(data.error_message);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  7.account_resetpwd.js 文件 307~327行 代码优化</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reUrl = <span class=\"keyword\">new</span> Url(<span class=\"built_in\">window</span>.location.href); </span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"regexp\">/Mobile/</span>.test(navigator.userAgent)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(reUrl.getParam(<span class=\"string\">'redirect_uri'</span>)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href=reUrl.getParam(<span class=\"string\">'redirect_uri'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/office/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://m.office.bzdev.net'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/online/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://m.online.seedit.cc'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://m.bozhong.com'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(reUrl.getParam(<span class=\"string\">'redirect_uri'</span>)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href=reUrl.getParam(<span class=\"string\">'redirect_uri'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/office/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://www.office.bzdev.net'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/online/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://www.online.seedit.cc'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://www.bozhong.com'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  优化:</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reUrl = <span class=\"keyword\">new</span> Url(<span class=\"built_in\">window</span>.location.href);</span><br><span class=\"line\"><span class=\"keyword\">var</span> i;</span><br><span class=\"line\"><span class=\"keyword\">var</span> firstHost = <span class=\"regexp\">/Mobile/</span>.test(navigator.userAgent) ? <span class=\"string\">'m.'</span> : <span class=\"string\">'www.'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> hostname = &#123;</span><br><span class=\"line\">  office : <span class=\"string\">'office.bzdev.net'</span>,</span><br><span class=\"line\">  online : <span class=\"string\">'online.seedit.cc'</span>,</span><br><span class=\"line\">  bozhong : <span class=\"string\">'bozhong.com'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (reUrl.getParam(<span class=\"string\">'redirect_uri'</span>)) <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.location.href=reUrl.getParam(<span class=\"string\">'redirect_uri'</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span>(i <span class=\"keyword\">in</span> hostname)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.href.match(hostname[i]))  <span class=\"built_in\">window</span>.location.href= <span class=\"string\">'https://'</span>+ firstHost + hostname[i];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>工具</p>\n<p><a href=\"http://jigsaw.w3.org/css-validator/\" target=\"_blank\" rel=\"noopener\">http://jigsaw.w3.org/css-validator/</a><br><a href=\"https://github.com/switer/DoverJS\" target=\"_blank\" rel=\"noopener\">https://github.com/switer/DoverJS</a></p>\n","site":{"data":{}},"excerpt":"<p> 内含主要实现功能，静态资源目录，技术及建议与优化<br>","more":"</p>\n<h2 id=\"主要实现功能\"><a href=\"#主要实现功能\" class=\"headerlink\" title=\"主要实现功能\"></a>主要实现功能</h2><p>  <a href=\"https://account.bozhong.com/\" title=\"登录\" target=\"_blank\" rel=\"noopener\">登录</a><br>  <a href=\"https://account.bozhong.com/register/index\" title=\"注册\" target=\"_blank\" rel=\"noopener\">注册</a><br>  <a href=\"https://account.bozhong.bzdev.net/auth/resetpwd?redirect_uri=\" target=\"_blank\" rel=\"noopener\">重置密码</a><br>  <a href=\"https://account.bozhong.com/register/findpwd\" target=\"_blank\" rel=\"noopener\">找回密码</a></p>\n<h2 id=\"静态资源目录-source-seedit-com\"><a href=\"#静态资源目录-source-seedit-com\" class=\"headerlink\" title=\"静态资源目录(source.seedit.com)\"></a>静态资源目录(source.seedit.com)</h2><p>  account<br>    |- css<br>    |- img<br>    |- js</p>\n<h2 id=\"技术\"><a href=\"#技术\" class=\"headerlink\" title=\"技术\"></a>技术</h2><p>  |- 后端实现PHP<br>  |- 前端页面自适应使用@media<br>  |- jQuery 框架<br>  |- seajs</p>\n<h2 id=\"建议与优化\"><a href=\"#建议与优化\" class=\"headerlink\" title=\"建议与优化\"></a>建议与优化</h2><p>  1.页面采用@media方式实现网页自适应，而2个终端代码差异较大，导致1个页面上承载着2个终端的代码，建议使用模板形式，如 handlebarser 模板引擎<br>  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--index.phtml 22行~105行--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"register\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"register\"</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"register-mobile common-slider page\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"register-mobile\"</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>  2.移动端修改密码页面空白内容多,响应式样式没有处理好，适用PC端的样式在移动端并没有重定义</p>\n<p>  找回/修改密码页<br>  <img src=\"/img/reviwe-source-account/IMG_9790.PNG\" alt=\"account\"></p>\n<p>  3.页面使用静态内联样式，这种样式不利于后期维护，所以要尽量避免</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--application\\views\\register\\findpwd.phtml 29行--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">class</span>=<span class=\"string\">\"type pwd_find\"</span> <span class=\"attr\">for</span>=<span class=\"string\">\"pwd_find\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"min-width: 90px;display: inline-block;\"</span>&gt;</span>用户名&amp;nbsp;&amp;#47;&amp;nbsp;邮箱<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>  4.无效的样式，例如定义了无效的属性，页面二次开发或改版，旧类名不用的没有及时删除，导致样式表代码冗杂，可利用第三方工具或模块进行检测剔除</p>\n <figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*account_v3.css 600 ~ 602行*/</span></span><br><span class=\"line\"> <span class=\"selector-id\">#refresh_loginCaptcha</span>&#123;</span><br><span class=\"line\">   <span class=\"attribute\">margin-left</span>: <span class=\"number\">18px</span>;</span><br><span class=\"line\">   <span class=\"attribute\">padding-bottom</span>: -<span class=\"number\">10px</span>;</span><br><span class=\"line\">   <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">   <span class=\"attribute\">cursor</span>: pointer;</span><br><span class=\"line\">   <span class=\"attribute\">vertical-align</span>: super;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p> 5.account_v4.js/account_v3.js/account_pwd.js 文件 dom元素操作频繁，可以用变量存储</p>\n<p> 6.account_v4.js 文件 75~101行 代码优化</p>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (data.error_code === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> time = <span class=\"number\">60</span>;</span><br><span class=\"line\">   sent = <span class=\"literal\">true</span>;</span><br><span class=\"line\">   alert(<span class=\"string\">'验证码已发送，请查收~'</span>);</span><br><span class=\"line\">   <span class=\"keyword\">if</span> (isMobile) &#123;</span><br><span class=\"line\">     $(<span class=\"string\">'#JS_send_captcha'</span>).attr(<span class=\"string\">'disabled'</span>, <span class=\"string\">'disabled'</span>).html(<span class=\"string\">'重新发送(&lt;span id=\"JS_resend_m\"&gt;60&lt;/span&gt;)'</span>);</span><br><span class=\"line\">     <span class=\"keyword\">var</span> interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (time &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         time--</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_resend_m'</span>).text(time);</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         clearInterval(interval);</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_send_captcha'</span>).removeAttr(<span class=\"string\">'disabled'</span>).text(<span class=\"string\">'获取验证码'</span>);</span><br><span class=\"line\">         sent = <span class=\"literal\">false</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">     $(<span class=\"string\">'#JS_btn_captcha'</span>).attr(<span class=\"string\">'disabled'</span>, <span class=\"string\">'disabled'</span>).html(<span class=\"string\">'重新发送(&lt;span id=\"JS_resend\"&gt;60&lt;/span&gt;)'</span>);</span><br><span class=\"line\">     captchaObj.disable();</span><br><span class=\"line\">     <span class=\"keyword\">var</span> interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (time &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         time--</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_resend'</span>).text(time);</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         clearInterval(interval);</span><br><span class=\"line\">         $(<span class=\"string\">'#JS_btn_captcha'</span>).removeAttr(<span class=\"string\">'disabled'</span>).text(<span class=\"string\">'获取验证码'</span>);</span><br><span class=\"line\">         captchaObj.enable();</span><br><span class=\"line\">         sent = <span class=\"literal\">false</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">   alert(data.error_message);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<p> 优化:</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (data.error_code === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> time = <span class=\"number\">60</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> $captcha = isMobile ? $(<span class=\"string\">'#JS_send_captcha'</span>) : $(<span class=\"string\">'#JS_btn_captcha'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> resend = isMobile ? <span class=\"string\">'JS_resend_m'</span> : <span class=\"string\">'JS_resend'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  sent = <span class=\"literal\">true</span>;</span><br><span class=\"line\">  alert(<span class=\"string\">'验证码已发送，请查收~'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!isMobile) captchaObj.disable();</span><br><span class=\"line\">  $captcha.attr(<span class=\"string\">'disabled'</span>, <span class=\"string\">'disabled'</span>).html(<span class=\"string\">'重新发送(&lt;span id=\"'</span>+resend+<span class=\"string\">'\"&gt;60&lt;/span&gt;)'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> interval = setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (time &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        time--</span><br><span class=\"line\">        $(<span class=\"string\">'#'</span>+ resend).text(time);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        clearInterval(interval);</span><br><span class=\"line\">        $captcha.removeAttr(<span class=\"string\">'disabled'</span>).text(<span class=\"string\">'获取验证码'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isMobile) captchaObj.enable();</span><br><span class=\"line\">        sent = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  alert(data.error_message);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  7.account_resetpwd.js 文件 307~327行 代码优化</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reUrl = <span class=\"keyword\">new</span> Url(<span class=\"built_in\">window</span>.location.href); </span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"regexp\">/Mobile/</span>.test(navigator.userAgent)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(reUrl.getParam(<span class=\"string\">'redirect_uri'</span>)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href=reUrl.getParam(<span class=\"string\">'redirect_uri'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/office/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://m.office.bzdev.net'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/online/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://m.online.seedit.cc'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://m.bozhong.com'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(reUrl.getParam(<span class=\"string\">'redirect_uri'</span>)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href=reUrl.getParam(<span class=\"string\">'redirect_uri'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/office/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://www.office.bzdev.net'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"regexp\">/online/</span>.test(reUrl)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://www.online.seedit.cc'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'http://www.bozhong.com'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  优化:</p>\n  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> reUrl = <span class=\"keyword\">new</span> Url(<span class=\"built_in\">window</span>.location.href);</span><br><span class=\"line\"><span class=\"keyword\">var</span> i;</span><br><span class=\"line\"><span class=\"keyword\">var</span> firstHost = <span class=\"regexp\">/Mobile/</span>.test(navigator.userAgent) ? <span class=\"string\">'m.'</span> : <span class=\"string\">'www.'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> hostname = &#123;</span><br><span class=\"line\">  office : <span class=\"string\">'office.bzdev.net'</span>,</span><br><span class=\"line\">  online : <span class=\"string\">'online.seedit.cc'</span>,</span><br><span class=\"line\">  bozhong : <span class=\"string\">'bozhong.com'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (reUrl.getParam(<span class=\"string\">'redirect_uri'</span>)) <span class=\"keyword\">return</span> <span class=\"built_in\">window</span>.location.href=reUrl.getParam(<span class=\"string\">'redirect_uri'</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span>(i <span class=\"keyword\">in</span> hostname)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (location.href.match(hostname[i]))  <span class=\"built_in\">window</span>.location.href= <span class=\"string\">'https://'</span>+ firstHost + hostname[i];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>工具</p>\n<p><a href=\"http://jigsaw.w3.org/css-validator/\" target=\"_blank\" rel=\"noopener\">http://jigsaw.w3.org/css-validator/</a><br><a href=\"https://github.com/switer/DoverJS\" target=\"_blank\" rel=\"noopener\">https://github.com/switer/DoverJS</a></p>"},{"title":"一些关于 canvas 的东西","date":"2017-12-06T16:00:00.000Z","_content":"\n因为最近在做的「萌贴纸」需求。需要用到一些 canvas 的 API 来实现相关的功能。  \n所以看了不少关于 canvas 的文章。  \n这里分享一下一些开发过程中比较常见的一些 API 和遇到的问题及其解决方法。\n\n<!-- more -->\n\n## 创建一个 canvas 对象\n\n```javascript\n  // 创建一个 canvas 标签\n  var canvas = document.createElement('canvas');\n  // 如果不设置宽高的话，默认为 300x150\n  canvas.width = 1000;\n  canvas.height = 600;\n  // 添加到 body 中\n  document.body.appendChild(canvas);\n  // 获取 canvas 2d 的 context 对象\n  var ctx = canvas.getContext('2d');\n```\n\n## 在 canvas 上绘制图像\n\n绘制图像可以用 `drawImage()` 方法，具体用法可以看 [CanvasRenderingContext2D.drawImage()](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage)。\n\n```javascript\nctx.drawImage(image, dx, dy);\nctx.drawImage(image, dx, dy, dWidth, dHeight);\n// 这里需要注意的是，9 个参数的时候，前两个是 sx sy，而不是 dx dy\nctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n```\n\n## canvas 坐标变换\n\n### 平移 translate\n```javascript\nctx.translate(x, y)\n```\ntranslate() 方法接受两个参数。x 是左右偏移量，y 是上下偏移量。\n\n### 旋转 rotate\n```javascript\nctx.rotate(angle)\n```\nrotate() 方法只接受一个参数。旋转的角度 angle，它是顺时针方向的，以弧度为单位的值。\n\n### 缩放 scale\n```javascript\nctx.scale(x, y)\n```\nscale() 方法接受两个参数。x 和 y 分别是横轴和纵轴的缩放因子。其缩放因子默认是 1，如果比 1 小是缩小，如果比 1 大则放大。  \n如果 x 为 -1，则为水平翻转；如果 y 为 -1 则为垂直翻转。  \n需要注意的是，这个翻转会连坐标系一起翻转。\n\n如图：\n\n![canvas scale()](https://ww4.sinaimg.cn/large/a15b4afegy1fm98692i3mj20qo0b43yr)\n\n### 变换 transform\n```javascript\nctx.transform(a, b, c, d, e, f)\n```\ntransform() 方法是对当前坐标系进行矩阵变换。\n\n```javascript\nctx.setTransform(a, b, c, d, e, f)\n```\nsetTransform() 方法重置变形矩阵。先将当前的矩阵重置为单位矩阵（即默认的坐标系），再用相同的参数调用 transform() 方法设置矩阵。\n具体看：[CanvasRenderingContext2D.setTransform()](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform)\n\n## 绘制经过变换的图片而不影响绘制图片前的数据\n\n这里需要了解两个方法：\n\n```javascript\nvoid CanvasRenderingContext2D.save() // 保存 canvas 状态\nvoid CanvasRenderingContext2D.restore() // 恢复 canvas 状态\n```\n\n例子如下：\n\n```javascript\nvar canvas = document.getElementById('canvas');\nvar ctx = canvas.getContext('2d');\nctx.save(); // 保存默认状态\n\nctx.fillStyle = 'green'; // 填充颜色设置为绿色\nctx.fillRect(10, 10, 100, 100); // 绘制一个 100x100 的矩形\n\nctx.restore(); // 恢复默认状态\nctx.fillRect(150, 75, 100, 100); // 此时绘制的矩形将会是默认的黑色\n```\n\n如图：  \n\n![使用 Canvas Save()](https://ww4.sinaimg.cn/large/a15b4afegy1fm96n5qr79j20b405k0sj)\n\n如果不使用 `save()` 和 `restore()`，则会是下面这个样子：\n\n![不使用 Canvas Save()](https://ww4.sinaimg.cn/large/a15b4afegy1fm96obtxajj20b405kt8i)\n\n## 图片跨域问题\n\n跨域使用图片的时候，会导致 canvas 被「污染」，一旦被「污染」。  \n就不能再读取 canvas 的数据。比如无法使用 `toBlob()`，`toDataURL()`，`getImageData()` 方法。  \n调用这些方法会抛出错误。具体参考 MDN: [启用了 CORS 的图片](https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image)。\n\n我们可以先将图片转成 base64，然后重新赋值到 image 中，再绘制到 canvas 中。就不会导致 canvas 被「污染」了。  \n例子如下：\n\n```javascript\nfunction imageToBase64(url, callback) {\n  var tempImage = new Image();\n  tempImage.crossOrigin = 'anonymous';\n  \n  tempImage.onload = function () {\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n    \n    canvas.width = this.width;\n    canvas.height = this.height;\n    context.drawImage(tempImage, 0, 0);\n    var imageDataUrl = canvas.toDataURL('image/png', 1.0);\n    callback(imageDataUrl);\n  };\n\n  // 这里加上时间戳是因为，移动端被缓存的图片无法重新除非 onload 事件。\n  // 即使用下面那个方法，也无法触发，所以只能加上随机字符串，让浏览器识别为新的链接。\n  tempImage.src = url + '?t=' + Date.now();\n  \n  // 确保已缓存的图片也能重新触发 onload 事件\n  if (tempImage.complete || typeof tempImage.complete === 'undefined') {\n    tempImage.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';\n    tempImage.src = src;\n  }\n}\n```\n\n## 参考资料\n\n1. [canvas 图像旋转与翻转姿势解锁](https://aotu.io/notes/2017/05/25/canvas-img-rotate-and-flip/index.html)\n2. [启用了 CORS 的图片](https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image)\n3. [浏览器的同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)\n","source":"_posts/something-about-canvas.md","raw":"---\ntitle: 一些关于 canvas 的东西\ndate: 2017-12-07\ntag: \n- javascript\n- canvas\n---\n\n因为最近在做的「萌贴纸」需求。需要用到一些 canvas 的 API 来实现相关的功能。  \n所以看了不少关于 canvas 的文章。  \n这里分享一下一些开发过程中比较常见的一些 API 和遇到的问题及其解决方法。\n\n<!-- more -->\n\n## 创建一个 canvas 对象\n\n```javascript\n  // 创建一个 canvas 标签\n  var canvas = document.createElement('canvas');\n  // 如果不设置宽高的话，默认为 300x150\n  canvas.width = 1000;\n  canvas.height = 600;\n  // 添加到 body 中\n  document.body.appendChild(canvas);\n  // 获取 canvas 2d 的 context 对象\n  var ctx = canvas.getContext('2d');\n```\n\n## 在 canvas 上绘制图像\n\n绘制图像可以用 `drawImage()` 方法，具体用法可以看 [CanvasRenderingContext2D.drawImage()](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage)。\n\n```javascript\nctx.drawImage(image, dx, dy);\nctx.drawImage(image, dx, dy, dWidth, dHeight);\n// 这里需要注意的是，9 个参数的时候，前两个是 sx sy，而不是 dx dy\nctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n```\n\n## canvas 坐标变换\n\n### 平移 translate\n```javascript\nctx.translate(x, y)\n```\ntranslate() 方法接受两个参数。x 是左右偏移量，y 是上下偏移量。\n\n### 旋转 rotate\n```javascript\nctx.rotate(angle)\n```\nrotate() 方法只接受一个参数。旋转的角度 angle，它是顺时针方向的，以弧度为单位的值。\n\n### 缩放 scale\n```javascript\nctx.scale(x, y)\n```\nscale() 方法接受两个参数。x 和 y 分别是横轴和纵轴的缩放因子。其缩放因子默认是 1，如果比 1 小是缩小，如果比 1 大则放大。  \n如果 x 为 -1，则为水平翻转；如果 y 为 -1 则为垂直翻转。  \n需要注意的是，这个翻转会连坐标系一起翻转。\n\n如图：\n\n![canvas scale()](https://ww4.sinaimg.cn/large/a15b4afegy1fm98692i3mj20qo0b43yr)\n\n### 变换 transform\n```javascript\nctx.transform(a, b, c, d, e, f)\n```\ntransform() 方法是对当前坐标系进行矩阵变换。\n\n```javascript\nctx.setTransform(a, b, c, d, e, f)\n```\nsetTransform() 方法重置变形矩阵。先将当前的矩阵重置为单位矩阵（即默认的坐标系），再用相同的参数调用 transform() 方法设置矩阵。\n具体看：[CanvasRenderingContext2D.setTransform()](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform)\n\n## 绘制经过变换的图片而不影响绘制图片前的数据\n\n这里需要了解两个方法：\n\n```javascript\nvoid CanvasRenderingContext2D.save() // 保存 canvas 状态\nvoid CanvasRenderingContext2D.restore() // 恢复 canvas 状态\n```\n\n例子如下：\n\n```javascript\nvar canvas = document.getElementById('canvas');\nvar ctx = canvas.getContext('2d');\nctx.save(); // 保存默认状态\n\nctx.fillStyle = 'green'; // 填充颜色设置为绿色\nctx.fillRect(10, 10, 100, 100); // 绘制一个 100x100 的矩形\n\nctx.restore(); // 恢复默认状态\nctx.fillRect(150, 75, 100, 100); // 此时绘制的矩形将会是默认的黑色\n```\n\n如图：  \n\n![使用 Canvas Save()](https://ww4.sinaimg.cn/large/a15b4afegy1fm96n5qr79j20b405k0sj)\n\n如果不使用 `save()` 和 `restore()`，则会是下面这个样子：\n\n![不使用 Canvas Save()](https://ww4.sinaimg.cn/large/a15b4afegy1fm96obtxajj20b405kt8i)\n\n## 图片跨域问题\n\n跨域使用图片的时候，会导致 canvas 被「污染」，一旦被「污染」。  \n就不能再读取 canvas 的数据。比如无法使用 `toBlob()`，`toDataURL()`，`getImageData()` 方法。  \n调用这些方法会抛出错误。具体参考 MDN: [启用了 CORS 的图片](https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image)。\n\n我们可以先将图片转成 base64，然后重新赋值到 image 中，再绘制到 canvas 中。就不会导致 canvas 被「污染」了。  \n例子如下：\n\n```javascript\nfunction imageToBase64(url, callback) {\n  var tempImage = new Image();\n  tempImage.crossOrigin = 'anonymous';\n  \n  tempImage.onload = function () {\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n    \n    canvas.width = this.width;\n    canvas.height = this.height;\n    context.drawImage(tempImage, 0, 0);\n    var imageDataUrl = canvas.toDataURL('image/png', 1.0);\n    callback(imageDataUrl);\n  };\n\n  // 这里加上时间戳是因为，移动端被缓存的图片无法重新除非 onload 事件。\n  // 即使用下面那个方法，也无法触发，所以只能加上随机字符串，让浏览器识别为新的链接。\n  tempImage.src = url + '?t=' + Date.now();\n  \n  // 确保已缓存的图片也能重新触发 onload 事件\n  if (tempImage.complete || typeof tempImage.complete === 'undefined') {\n    tempImage.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';\n    tempImage.src = src;\n  }\n}\n```\n\n## 参考资料\n\n1. [canvas 图像旋转与翻转姿势解锁](https://aotu.io/notes/2017/05/25/canvas-img-rotate-and-flip/index.html)\n2. [启用了 CORS 的图片](https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image)\n3. [浏览器的同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)\n","slug":"something-about-canvas","published":1,"updated":"2017-12-15T06:28:26.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oe3001wuo2ekerp2nkj","content":"<p>因为最近在做的「萌贴纸」需求。需要用到一些 canvas 的 API 来实现相关的功能。<br>所以看了不少关于 canvas 的文章。<br>这里分享一下一些开发过程中比较常见的一些 API 和遇到的问题及其解决方法。</p>\n<a id=\"more\"></a>\n<h2 id=\"创建一个-canvas-对象\"><a href=\"#创建一个-canvas-对象\" class=\"headerlink\" title=\"创建一个 canvas 对象\"></a>创建一个 canvas 对象</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建一个 canvas 标签</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 如果不设置宽高的话，默认为 300x150</span></span><br><span class=\"line\">canvas.width = <span class=\"number\">1000</span>;</span><br><span class=\"line\">canvas.height = <span class=\"number\">600</span>;</span><br><span class=\"line\"><span class=\"comment\">// 添加到 body 中</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(canvas);</span><br><span class=\"line\"><span class=\"comment\">// 获取 canvas 2d 的 context 对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"在-canvas-上绘制图像\"><a href=\"#在-canvas-上绘制图像\" class=\"headerlink\" title=\"在 canvas 上绘制图像\"></a>在 canvas 上绘制图像</h2><p>绘制图像可以用 <code>drawImage()</code> 方法，具体用法可以看 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage\" target=\"_blank\" rel=\"noopener\">CanvasRenderingContext2D.drawImage()</a>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.drawImage(image, dx, dy);</span><br><span class=\"line\">ctx.drawImage(image, dx, dy, dWidth, dHeight);</span><br><span class=\"line\"><span class=\"comment\">// 这里需要注意的是，9 个参数的时候，前两个是 sx sy，而不是 dx dy</span></span><br><span class=\"line\">ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);</span><br></pre></td></tr></table></figure>\n<h2 id=\"canvas-坐标变换\"><a href=\"#canvas-坐标变换\" class=\"headerlink\" title=\"canvas 坐标变换\"></a>canvas 坐标变换</h2><h3 id=\"平移-translate\"><a href=\"#平移-translate\" class=\"headerlink\" title=\"平移 translate\"></a>平移 translate</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.translate(x, y)</span><br></pre></td></tr></table></figure>\n<p>translate() 方法接受两个参数。x 是左右偏移量，y 是上下偏移量。</p>\n<h3 id=\"旋转-rotate\"><a href=\"#旋转-rotate\" class=\"headerlink\" title=\"旋转 rotate\"></a>旋转 rotate</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.rotate(angle)</span><br></pre></td></tr></table></figure>\n<p>rotate() 方法只接受一个参数。旋转的角度 angle，它是顺时针方向的，以弧度为单位的值。</p>\n<h3 id=\"缩放-scale\"><a href=\"#缩放-scale\" class=\"headerlink\" title=\"缩放 scale\"></a>缩放 scale</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.scale(x, y)</span><br></pre></td></tr></table></figure>\n<p>scale() 方法接受两个参数。x 和 y 分别是横轴和纵轴的缩放因子。其缩放因子默认是 1，如果比 1 小是缩小，如果比 1 大则放大。<br>如果 x 为 -1，则为水平翻转；如果 y 为 -1 则为垂直翻转。<br>需要注意的是，这个翻转会连坐标系一起翻转。</p>\n<p>如图：</p>\n<p><img src=\"https://ww4.sinaimg.cn/large/a15b4afegy1fm98692i3mj20qo0b43yr\" alt=\"canvas scale()\"></p>\n<h3 id=\"变换-transform\"><a href=\"#变换-transform\" class=\"headerlink\" title=\"变换 transform\"></a>变换 transform</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.transform(a, b, c, d, e, f)</span><br></pre></td></tr></table></figure>\n<p>transform() 方法是对当前坐标系进行矩阵变换。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.setTransform(a, b, c, d, e, f)</span><br></pre></td></tr></table></figure>\n<p>setTransform() 方法重置变形矩阵。先将当前的矩阵重置为单位矩阵（即默认的坐标系），再用相同的参数调用 transform() 方法设置矩阵。<br>具体看：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform\" target=\"_blank\" rel=\"noopener\">CanvasRenderingContext2D.setTransform()</a></p>\n<h2 id=\"绘制经过变换的图片而不影响绘制图片前的数据\"><a href=\"#绘制经过变换的图片而不影响绘制图片前的数据\" class=\"headerlink\" title=\"绘制经过变换的图片而不影响绘制图片前的数据\"></a>绘制经过变换的图片而不影响绘制图片前的数据</h2><p>这里需要了解两个方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> CanvasRenderingContext2D.save() <span class=\"comment\">// 保存 canvas 状态</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> CanvasRenderingContext2D.restore() <span class=\"comment\">// 恢复 canvas 状态</span></span><br></pre></td></tr></table></figure>\n<p>例子如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">ctx.save(); <span class=\"comment\">// 保存默认状态</span></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">'green'</span>; <span class=\"comment\">// 填充颜色设置为绿色</span></span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>); <span class=\"comment\">// 绘制一个 100x100 的矩形</span></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.restore(); <span class=\"comment\">// 恢复默认状态</span></span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">150</span>, <span class=\"number\">75</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>); <span class=\"comment\">// 此时绘制的矩形将会是默认的黑色</span></span><br></pre></td></tr></table></figure>\n<p>如图：  </p>\n<p><img src=\"https://ww4.sinaimg.cn/large/a15b4afegy1fm96n5qr79j20b405k0sj\" alt=\"使用 Canvas Save()\"></p>\n<p>如果不使用 <code>save()</code> 和 <code>restore()</code>，则会是下面这个样子：</p>\n<p><img src=\"https://ww4.sinaimg.cn/large/a15b4afegy1fm96obtxajj20b405kt8i\" alt=\"不使用 Canvas Save()\"></p>\n<h2 id=\"图片跨域问题\"><a href=\"#图片跨域问题\" class=\"headerlink\" title=\"图片跨域问题\"></a>图片跨域问题</h2><p>跨域使用图片的时候，会导致 canvas 被「污染」，一旦被「污染」。<br>就不能再读取 canvas 的数据。比如无法使用 <code>toBlob()</code>，<code>toDataURL()</code>，<code>getImageData()</code> 方法。<br>调用这些方法会抛出错误。具体参考 MDN: <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image\" target=\"_blank\" rel=\"noopener\">启用了 CORS 的图片</a>。</p>\n<p>我们可以先将图片转成 base64，然后重新赋值到 image 中，再绘制到 canvas 中。就不会导致 canvas 被「污染」了。<br>例子如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">imageToBase64</span>(<span class=\"params\">url, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempImage = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">  tempImage.crossOrigin = <span class=\"string\">'anonymous'</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  tempImage.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    canvas.width = <span class=\"keyword\">this</span>.width;</span><br><span class=\"line\">    canvas.height = <span class=\"keyword\">this</span>.height;</span><br><span class=\"line\">    context.drawImage(tempImage, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imageDataUrl = canvas.toDataURL(<span class=\"string\">'image/png'</span>, <span class=\"number\">1.0</span>);</span><br><span class=\"line\">    callback(imageDataUrl);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 这里加上时间戳是因为，移动端被缓存的图片无法重新除非 onload 事件。</span></span><br><span class=\"line\">  <span class=\"comment\">// 即使用下面那个方法，也无法触发，所以只能加上随机字符串，让浏览器识别为新的链接。</span></span><br><span class=\"line\">  tempImage.src = url + <span class=\"string\">'?t='</span> + <span class=\"built_in\">Date</span>.now();</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 确保已缓存的图片也能重新触发 onload 事件</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (tempImage.complete || <span class=\"keyword\">typeof</span> tempImage.complete === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    tempImage.src = <span class=\"string\">'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='</span>;</span><br><span class=\"line\">    tempImage.src = src;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li><a href=\"https://aotu.io/notes/2017/05/25/canvas-img-rotate-and-flip/index.html\" target=\"_blank\" rel=\"noopener\">canvas 图像旋转与翻转姿势解锁</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image\" target=\"_blank\" rel=\"noopener\">启用了 CORS 的图片</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy\" target=\"_blank\" rel=\"noopener\">浏览器的同源策略</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>因为最近在做的「萌贴纸」需求。需要用到一些 canvas 的 API 来实现相关的功能。<br>所以看了不少关于 canvas 的文章。<br>这里分享一下一些开发过程中比较常见的一些 API 和遇到的问题及其解决方法。</p>","more":"<h2 id=\"创建一个-canvas-对象\"><a href=\"#创建一个-canvas-对象\" class=\"headerlink\" title=\"创建一个 canvas 对象\"></a>创建一个 canvas 对象</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建一个 canvas 标签</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\"><span class=\"comment\">// 如果不设置宽高的话，默认为 300x150</span></span><br><span class=\"line\">canvas.width = <span class=\"number\">1000</span>;</span><br><span class=\"line\">canvas.height = <span class=\"number\">600</span>;</span><br><span class=\"line\"><span class=\"comment\">// 添加到 body 中</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(canvas);</span><br><span class=\"line\"><span class=\"comment\">// 获取 canvas 2d 的 context 对象</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"在-canvas-上绘制图像\"><a href=\"#在-canvas-上绘制图像\" class=\"headerlink\" title=\"在 canvas 上绘制图像\"></a>在 canvas 上绘制图像</h2><p>绘制图像可以用 <code>drawImage()</code> 方法，具体用法可以看 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage\" target=\"_blank\" rel=\"noopener\">CanvasRenderingContext2D.drawImage()</a>。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.drawImage(image, dx, dy);</span><br><span class=\"line\">ctx.drawImage(image, dx, dy, dWidth, dHeight);</span><br><span class=\"line\"><span class=\"comment\">// 这里需要注意的是，9 个参数的时候，前两个是 sx sy，而不是 dx dy</span></span><br><span class=\"line\">ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);</span><br></pre></td></tr></table></figure>\n<h2 id=\"canvas-坐标变换\"><a href=\"#canvas-坐标变换\" class=\"headerlink\" title=\"canvas 坐标变换\"></a>canvas 坐标变换</h2><h3 id=\"平移-translate\"><a href=\"#平移-translate\" class=\"headerlink\" title=\"平移 translate\"></a>平移 translate</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.translate(x, y)</span><br></pre></td></tr></table></figure>\n<p>translate() 方法接受两个参数。x 是左右偏移量，y 是上下偏移量。</p>\n<h3 id=\"旋转-rotate\"><a href=\"#旋转-rotate\" class=\"headerlink\" title=\"旋转 rotate\"></a>旋转 rotate</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.rotate(angle)</span><br></pre></td></tr></table></figure>\n<p>rotate() 方法只接受一个参数。旋转的角度 angle，它是顺时针方向的，以弧度为单位的值。</p>\n<h3 id=\"缩放-scale\"><a href=\"#缩放-scale\" class=\"headerlink\" title=\"缩放 scale\"></a>缩放 scale</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.scale(x, y)</span><br></pre></td></tr></table></figure>\n<p>scale() 方法接受两个参数。x 和 y 分别是横轴和纵轴的缩放因子。其缩放因子默认是 1，如果比 1 小是缩小，如果比 1 大则放大。<br>如果 x 为 -1，则为水平翻转；如果 y 为 -1 则为垂直翻转。<br>需要注意的是，这个翻转会连坐标系一起翻转。</p>\n<p>如图：</p>\n<p><img src=\"https://ww4.sinaimg.cn/large/a15b4afegy1fm98692i3mj20qo0b43yr\" alt=\"canvas scale()\"></p>\n<h3 id=\"变换-transform\"><a href=\"#变换-transform\" class=\"headerlink\" title=\"变换 transform\"></a>变换 transform</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.transform(a, b, c, d, e, f)</span><br></pre></td></tr></table></figure>\n<p>transform() 方法是对当前坐标系进行矩阵变换。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.setTransform(a, b, c, d, e, f)</span><br></pre></td></tr></table></figure>\n<p>setTransform() 方法重置变形矩阵。先将当前的矩阵重置为单位矩阵（即默认的坐标系），再用相同的参数调用 transform() 方法设置矩阵。<br>具体看：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/setTransform\" target=\"_blank\" rel=\"noopener\">CanvasRenderingContext2D.setTransform()</a></p>\n<h2 id=\"绘制经过变换的图片而不影响绘制图片前的数据\"><a href=\"#绘制经过变换的图片而不影响绘制图片前的数据\" class=\"headerlink\" title=\"绘制经过变换的图片而不影响绘制图片前的数据\"></a>绘制经过变换的图片而不影响绘制图片前的数据</h2><p>这里需要了解两个方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> CanvasRenderingContext2D.save() <span class=\"comment\">// 保存 canvas 状态</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> CanvasRenderingContext2D.restore() <span class=\"comment\">// 恢复 canvas 状态</span></span><br></pre></td></tr></table></figure>\n<p>例子如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">ctx.save(); <span class=\"comment\">// 保存默认状态</span></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.fillStyle = <span class=\"string\">'green'</span>; <span class=\"comment\">// 填充颜色设置为绿色</span></span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>); <span class=\"comment\">// 绘制一个 100x100 的矩形</span></span><br><span class=\"line\"></span><br><span class=\"line\">ctx.restore(); <span class=\"comment\">// 恢复默认状态</span></span><br><span class=\"line\">ctx.fillRect(<span class=\"number\">150</span>, <span class=\"number\">75</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>); <span class=\"comment\">// 此时绘制的矩形将会是默认的黑色</span></span><br></pre></td></tr></table></figure>\n<p>如图：  </p>\n<p><img src=\"https://ww4.sinaimg.cn/large/a15b4afegy1fm96n5qr79j20b405k0sj\" alt=\"使用 Canvas Save()\"></p>\n<p>如果不使用 <code>save()</code> 和 <code>restore()</code>，则会是下面这个样子：</p>\n<p><img src=\"https://ww4.sinaimg.cn/large/a15b4afegy1fm96obtxajj20b405kt8i\" alt=\"不使用 Canvas Save()\"></p>\n<h2 id=\"图片跨域问题\"><a href=\"#图片跨域问题\" class=\"headerlink\" title=\"图片跨域问题\"></a>图片跨域问题</h2><p>跨域使用图片的时候，会导致 canvas 被「污染」，一旦被「污染」。<br>就不能再读取 canvas 的数据。比如无法使用 <code>toBlob()</code>，<code>toDataURL()</code>，<code>getImageData()</code> 方法。<br>调用这些方法会抛出错误。具体参考 MDN: <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image\" target=\"_blank\" rel=\"noopener\">启用了 CORS 的图片</a>。</p>\n<p>我们可以先将图片转成 base64，然后重新赋值到 image 中，再绘制到 canvas 中。就不会导致 canvas 被「污染」了。<br>例子如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">imageToBase64</span>(<span class=\"params\">url, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tempImage = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">  tempImage.crossOrigin = <span class=\"string\">'anonymous'</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  tempImage.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    canvas.width = <span class=\"keyword\">this</span>.width;</span><br><span class=\"line\">    canvas.height = <span class=\"keyword\">this</span>.height;</span><br><span class=\"line\">    context.drawImage(tempImage, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> imageDataUrl = canvas.toDataURL(<span class=\"string\">'image/png'</span>, <span class=\"number\">1.0</span>);</span><br><span class=\"line\">    callback(imageDataUrl);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 这里加上时间戳是因为，移动端被缓存的图片无法重新除非 onload 事件。</span></span><br><span class=\"line\">  <span class=\"comment\">// 即使用下面那个方法，也无法触发，所以只能加上随机字符串，让浏览器识别为新的链接。</span></span><br><span class=\"line\">  tempImage.src = url + <span class=\"string\">'?t='</span> + <span class=\"built_in\">Date</span>.now();</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 确保已缓存的图片也能重新触发 onload 事件</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (tempImage.complete || <span class=\"keyword\">typeof</span> tempImage.complete === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    tempImage.src = <span class=\"string\">'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='</span>;</span><br><span class=\"line\">    tempImage.src = src;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li><a href=\"https://aotu.io/notes/2017/05/25/canvas-img-rotate-and-flip/index.html\" target=\"_blank\" rel=\"noopener\">canvas 图像旋转与翻转姿势解锁</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image\" target=\"_blank\" rel=\"noopener\">启用了 CORS 的图片</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy\" target=\"_blank\" rel=\"noopener\">浏览器的同源策略</a></li>\n</ol>"},{"title":"review-试管助手","date":"2017-11-16T07:04:13.000Z","_content":"[试管助手](http://source.bozhong.com/shiguan/201505/index.html \"试管助手\")\n<!--more-->\n\n---\n### 整体\n* 空格缩进引号不统一等代码风格问题;\n* 页面内大多数都是 `==`;\n* 对DOM的操作多，选择器层级较多，包括css和js;\n\n```js\n  // 127 ~ 132行\n  $('.result .tab .item,.profile .tab .item').css('width','33.33%');\n  $('.profile .tab .item').eq(3).hide();\n  $('.result .tab').each(function(){\n    $(this).find('.item').eq(3).hide()//攻略服务器挂了故隐藏\n    $(this).find('.item').eq(4).hide()\n  })\n\n  //1859 ~ 1871行\n  if(stu ==true){\n    $('.cost-list .plan li').eq(index).closest(\".li-main\").siblings(\"h2\").find(\".day-num\").text(d);\n    $('.process .plan .val,.cost-list .plan .val').text( plan[0].name+'(推荐)');\n    if(t == plan[0].name){\n      ...\n    }\n  }\n```\n\n### 细节\n\n* ** 封面样式问题 **\n\n  原：为让页面内容垂直居中用js获取浏览器高度后写入dom，导致进入页面时会闪一下\n\n  ![assistant](/img/source-ivf-assistant/image.png)\n\n  建议：\n  1.隐藏页面，高度写入完后再显示\n  2.这层只是封面，进入表单后会整个隐藏，可以直接用css定位/flex布局;\n\n* ** openThread() **\n\n  变量 `urlVal` 重复声明，逻辑里面有多余的消耗；\n\n  ```js\n  // 原 90 ~ 103行\n  var openThread = function(tid,url){\n    var tidThread = {\n      type:'readThread',\n      tid:tid\n    }\n    var urlVal = url;\n    var threadTid =  JSON.stringify(tidThread);\n    if( iosAPP_REG == true && crazyV>=420){\n      var urlVal = 'fkzr://'+encodeURIComponent(threadTid);\n    }else if( androidAPP_REG == true && crazyV>=420){\n      var urlVal = 'fkzr://'+encodeURIComponent(threadTid);\n    }\n    return urlVal;\n  };\n\n  // 优化\n  var openThread = function(tid, url) {\n    if (!iosAPP_REG && !androidAPP_REG && crazyV < 420) return url;\n    var tidThread = JSON.stringify({\n      type: 'readThread',\n      tid: tid\n    });\n    return 'fkzr://' + encodeURIComponent(threadTid);\n  }\n  ```\n\n* ** 双重否定 **\n\n  双重否定意义不大 一般情况下 `!!a === a`，如果有特殊情况加注释特殊处理比较好\n\n  ```js\n  // 原\n  var ivfId = !!realIvf && !!realIvf.id? realIvf.id : 0;\n  // 等同\n  var ivfId = realIvf && realIvf.id? realIvf.id : 0;\n\n  // 原 2171 ~ 2172 行\n  var p = !!curPage ?  curPage : 1;\n  var stor = !!stor ? stor : '';\n  // 等同\n  var p = curPage || 1;\n  var stor = stor || '';\n  ```\n\n* ** 字符串拼接 **\n\n  建议先组成数组，join()拼接成字符串，性能方面优于 `+=`\n  不用对首位进行额外处理，更好理解\n\n  ```js\n  // 原 1820 ~ 1920 行\n  var savePlan  ='';\n  ...\n  for( i  in plan){\n    var planName = plan[i].name;\n    savePlan+=','+planName;\n  }\n  ...\n  localStorage.setItem('cupai_plan', savePlan.replace(',',''));\n\n  // 优化\n  var savePlan = [];\n  for (i in plan) {\n    var planName = plan[i].name;\n    savePlan.push(planName);\n  }\n  savePlan = savePlan.join(',');\n  localStorage.setItem('cupai_plan', savePlan);\n  ```\n\n* ** 表单字符串判断 **\n\n  建议去除首尾空白字符，如使用$.trim()\n  ↓↓↓ 当输入11位手机号时可以提交，空白字符同样满足，同理用于验证名字留言等\n\n  ![assistant](/img/source-ivf-assistant/image2.png)\n\n  ```js\n  // 原 2147 ~ 2151行\n  if (v.length == 11) {\n    ...\n  } else {\n    ...\n  }\n\n  // 优化\n  if ($.trim(v).length === 11) {\n    ...\n  } else {\n    ...\n  }\n  ```\n\n* ** 重复代码 **\n\n  优化可读性，能提取出来的代码尽可能封装。\n\n  ```js\n  // 1687 ~ 1697 行\n  var plan = localStorage.getItem('cupai_plan').split(',');\n  var realPlan = localStorage.getItem('real_plan') ? localStorage.getItem('real_plan') :'';\n  var successRate = localStorage.getItem('success_rate') ? localStorage.getItem('success_rate') : '';\n  var predictCost = localStorage.getItem('predict_cost') ?  localStorage.getItem('predict_cost') : '';\n  var scheduleDays =  localStorage.getItem('schedule_days') ? localStorage.getItem('schedule_days') : '';\n  var oneRate = localStorage.getItem('one_success_rate') ? localStorage.getItem('one_success_rate') : '';\n  var twoRate =localStorage.getItem('two_success_rate') ? localStorage.getItem('two_success_rate') : '';\n  var threeRate = localStorage.getItem('three_success_rate') ? localStorage.getItem('three_success_rate') : '';\n  var fivfTech = localStorage.getItem('fivf_Tech') ? localStorage.getItem('fivf_Tech') : '' ;\n  var ivfTech =localStorage.getItem('ivf_tech') ? localStorage.getItem('ivf_tech') : '' ;\n\n  // 优化：例如 1687 ~ 1697 行\n  var keys = {\n    plan: 'cupai_plan',\n    realPlan: 'real_plan',\n    successRate: 'success_rate',\n    predictCost: 'predict_cost',\n    scheduleDays: 'schedule_days',\n    oneRate: 'one_success_rate',\n    twoRate: 'two_success_rate',\n    threeRate: 'three_success_rate',\n    fivfTech: 'fivf_Tech',\n    ivfTech: 'ivf_tech',\n  }\n  var data = {};\n  for (key in keys) {\n    if (key === 'plan') {\n      data[key] = localStorage.getItem(keys[key]).split(',');\n      continue;\n    }\n    data[key] = localStorage.getItem(keys[key]) || '';\n  }\n  ```\n\n  结果一致的判断写在一起\n\n  ```js\n  // 2448 ~ 2468行\n  if(hashName.replace(\"profile\",\"\") == ''){\n    userStu = true\n    /*if(!!localStorage.getItem('success_rate')){\n      window.location.href = '//'+host+'/shiguan/201505/index.html#profile11';\n    }*/\n  }else if(hashName.replace(\"profile\",\"\")<=9 && hashName.replace(\"profile\",\"\")>0 ){\n    window.location.hash = !!localStorage.getItem('success_rate') ? '#profile11' : '#cover';\n  }else if(hashName.replace(\"profile\",\"\") ==11){\n    if( localStorage.getItem('success_rate') == null){\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone;\n    }\n  }else if(hashName.replace(\"profile\",\"\") ==12){\n    if(!isLogin){\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone;\n    }\n  }else if(hashName.replace(\"profile\",\"\") ==10){\n    if(!isLogin){\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone;\n    }else{\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone+'#profile11';\n    }\n  }\n\n  // 优化\n  var num = hashName.replace('profile', '');\n  var url = '//' + host + '/shiguan/201505/index.html' + UrlFrom + UrlPhone;\n  if (!num) {\n    userStu = true;\n  } else if (num <= 9 && num > 0) {\n    window.location.hash = localStorage.getItem('success_rate') ? '#profile11' : '#cover';\n  } else if ((/^(12|10)$/.test(num) && !isLogin) || (num === 11 && !localStorage.getItem('success_rate'))) {\n    window.location.href = url;\n  } else if (num === 10) {\n    window.location.href =  url + '#profile11';\n  }\n  ```","source":"_posts/source-ivf-assistant.md","raw":"---\ntitle: review-试管助手\ndate: 2017-11-16 15:04:13\ntags:\n - javascript\n - review\n---\n[试管助手](http://source.bozhong.com/shiguan/201505/index.html \"试管助手\")\n<!--more-->\n\n---\n### 整体\n* 空格缩进引号不统一等代码风格问题;\n* 页面内大多数都是 `==`;\n* 对DOM的操作多，选择器层级较多，包括css和js;\n\n```js\n  // 127 ~ 132行\n  $('.result .tab .item,.profile .tab .item').css('width','33.33%');\n  $('.profile .tab .item').eq(3).hide();\n  $('.result .tab').each(function(){\n    $(this).find('.item').eq(3).hide()//攻略服务器挂了故隐藏\n    $(this).find('.item').eq(4).hide()\n  })\n\n  //1859 ~ 1871行\n  if(stu ==true){\n    $('.cost-list .plan li').eq(index).closest(\".li-main\").siblings(\"h2\").find(\".day-num\").text(d);\n    $('.process .plan .val,.cost-list .plan .val').text( plan[0].name+'(推荐)');\n    if(t == plan[0].name){\n      ...\n    }\n  }\n```\n\n### 细节\n\n* ** 封面样式问题 **\n\n  原：为让页面内容垂直居中用js获取浏览器高度后写入dom，导致进入页面时会闪一下\n\n  ![assistant](/img/source-ivf-assistant/image.png)\n\n  建议：\n  1.隐藏页面，高度写入完后再显示\n  2.这层只是封面，进入表单后会整个隐藏，可以直接用css定位/flex布局;\n\n* ** openThread() **\n\n  变量 `urlVal` 重复声明，逻辑里面有多余的消耗；\n\n  ```js\n  // 原 90 ~ 103行\n  var openThread = function(tid,url){\n    var tidThread = {\n      type:'readThread',\n      tid:tid\n    }\n    var urlVal = url;\n    var threadTid =  JSON.stringify(tidThread);\n    if( iosAPP_REG == true && crazyV>=420){\n      var urlVal = 'fkzr://'+encodeURIComponent(threadTid);\n    }else if( androidAPP_REG == true && crazyV>=420){\n      var urlVal = 'fkzr://'+encodeURIComponent(threadTid);\n    }\n    return urlVal;\n  };\n\n  // 优化\n  var openThread = function(tid, url) {\n    if (!iosAPP_REG && !androidAPP_REG && crazyV < 420) return url;\n    var tidThread = JSON.stringify({\n      type: 'readThread',\n      tid: tid\n    });\n    return 'fkzr://' + encodeURIComponent(threadTid);\n  }\n  ```\n\n* ** 双重否定 **\n\n  双重否定意义不大 一般情况下 `!!a === a`，如果有特殊情况加注释特殊处理比较好\n\n  ```js\n  // 原\n  var ivfId = !!realIvf && !!realIvf.id? realIvf.id : 0;\n  // 等同\n  var ivfId = realIvf && realIvf.id? realIvf.id : 0;\n\n  // 原 2171 ~ 2172 行\n  var p = !!curPage ?  curPage : 1;\n  var stor = !!stor ? stor : '';\n  // 等同\n  var p = curPage || 1;\n  var stor = stor || '';\n  ```\n\n* ** 字符串拼接 **\n\n  建议先组成数组，join()拼接成字符串，性能方面优于 `+=`\n  不用对首位进行额外处理，更好理解\n\n  ```js\n  // 原 1820 ~ 1920 行\n  var savePlan  ='';\n  ...\n  for( i  in plan){\n    var planName = plan[i].name;\n    savePlan+=','+planName;\n  }\n  ...\n  localStorage.setItem('cupai_plan', savePlan.replace(',',''));\n\n  // 优化\n  var savePlan = [];\n  for (i in plan) {\n    var planName = plan[i].name;\n    savePlan.push(planName);\n  }\n  savePlan = savePlan.join(',');\n  localStorage.setItem('cupai_plan', savePlan);\n  ```\n\n* ** 表单字符串判断 **\n\n  建议去除首尾空白字符，如使用$.trim()\n  ↓↓↓ 当输入11位手机号时可以提交，空白字符同样满足，同理用于验证名字留言等\n\n  ![assistant](/img/source-ivf-assistant/image2.png)\n\n  ```js\n  // 原 2147 ~ 2151行\n  if (v.length == 11) {\n    ...\n  } else {\n    ...\n  }\n\n  // 优化\n  if ($.trim(v).length === 11) {\n    ...\n  } else {\n    ...\n  }\n  ```\n\n* ** 重复代码 **\n\n  优化可读性，能提取出来的代码尽可能封装。\n\n  ```js\n  // 1687 ~ 1697 行\n  var plan = localStorage.getItem('cupai_plan').split(',');\n  var realPlan = localStorage.getItem('real_plan') ? localStorage.getItem('real_plan') :'';\n  var successRate = localStorage.getItem('success_rate') ? localStorage.getItem('success_rate') : '';\n  var predictCost = localStorage.getItem('predict_cost') ?  localStorage.getItem('predict_cost') : '';\n  var scheduleDays =  localStorage.getItem('schedule_days') ? localStorage.getItem('schedule_days') : '';\n  var oneRate = localStorage.getItem('one_success_rate') ? localStorage.getItem('one_success_rate') : '';\n  var twoRate =localStorage.getItem('two_success_rate') ? localStorage.getItem('two_success_rate') : '';\n  var threeRate = localStorage.getItem('three_success_rate') ? localStorage.getItem('three_success_rate') : '';\n  var fivfTech = localStorage.getItem('fivf_Tech') ? localStorage.getItem('fivf_Tech') : '' ;\n  var ivfTech =localStorage.getItem('ivf_tech') ? localStorage.getItem('ivf_tech') : '' ;\n\n  // 优化：例如 1687 ~ 1697 行\n  var keys = {\n    plan: 'cupai_plan',\n    realPlan: 'real_plan',\n    successRate: 'success_rate',\n    predictCost: 'predict_cost',\n    scheduleDays: 'schedule_days',\n    oneRate: 'one_success_rate',\n    twoRate: 'two_success_rate',\n    threeRate: 'three_success_rate',\n    fivfTech: 'fivf_Tech',\n    ivfTech: 'ivf_tech',\n  }\n  var data = {};\n  for (key in keys) {\n    if (key === 'plan') {\n      data[key] = localStorage.getItem(keys[key]).split(',');\n      continue;\n    }\n    data[key] = localStorage.getItem(keys[key]) || '';\n  }\n  ```\n\n  结果一致的判断写在一起\n\n  ```js\n  // 2448 ~ 2468行\n  if(hashName.replace(\"profile\",\"\") == ''){\n    userStu = true\n    /*if(!!localStorage.getItem('success_rate')){\n      window.location.href = '//'+host+'/shiguan/201505/index.html#profile11';\n    }*/\n  }else if(hashName.replace(\"profile\",\"\")<=9 && hashName.replace(\"profile\",\"\")>0 ){\n    window.location.hash = !!localStorage.getItem('success_rate') ? '#profile11' : '#cover';\n  }else if(hashName.replace(\"profile\",\"\") ==11){\n    if( localStorage.getItem('success_rate') == null){\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone;\n    }\n  }else if(hashName.replace(\"profile\",\"\") ==12){\n    if(!isLogin){\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone;\n    }\n  }else if(hashName.replace(\"profile\",\"\") ==10){\n    if(!isLogin){\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone;\n    }else{\n      window.location.href = '//'+host+'/shiguan/201505/index.html'+UrlFrom + UrlPhone+'#profile11';\n    }\n  }\n\n  // 优化\n  var num = hashName.replace('profile', '');\n  var url = '//' + host + '/shiguan/201505/index.html' + UrlFrom + UrlPhone;\n  if (!num) {\n    userStu = true;\n  } else if (num <= 9 && num > 0) {\n    window.location.hash = localStorage.getItem('success_rate') ? '#profile11' : '#cover';\n  } else if ((/^(12|10)$/.test(num) && !isLogin) || (num === 11 && !localStorage.getItem('success_rate'))) {\n    window.location.href = url;\n  } else if (num === 10) {\n    window.location.href =  url + '#profile11';\n  }\n  ```","slug":"source-ivf-assistant","published":1,"updated":"2017-11-17T08:45:46.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oe9001yuo2eo1tldbc6","content":"<p><a href=\"http://source.bozhong.com/shiguan/201505/index.html\" title=\"试管助手\" target=\"_blank\" rel=\"noopener\">试管助手</a><br><a id=\"more\"></a></p>\n<hr>\n<h3 id=\"整体\"><a href=\"#整体\" class=\"headerlink\" title=\"整体\"></a>整体</h3><ul>\n<li>空格缩进引号不统一等代码风格问题;</li>\n<li>页面内大多数都是 <code>==</code>;</li>\n<li>对DOM的操作多，选择器层级较多，包括css和js;</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 127 ~ 132行</span></span><br><span class=\"line\">$(<span class=\"string\">'.result .tab .item,.profile .tab .item'</span>).css(<span class=\"string\">'width'</span>,<span class=\"string\">'33.33%'</span>);</span><br><span class=\"line\">$(<span class=\"string\">'.profile .tab .item'</span>).eq(<span class=\"number\">3</span>).hide();</span><br><span class=\"line\">$(<span class=\"string\">'.result .tab'</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  $(<span class=\"keyword\">this</span>).find(<span class=\"string\">'.item'</span>).eq(<span class=\"number\">3</span>).hide()<span class=\"comment\">//攻略服务器挂了故隐藏</span></span><br><span class=\"line\">  $(<span class=\"keyword\">this</span>).find(<span class=\"string\">'.item'</span>).eq(<span class=\"number\">4</span>).hide()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//1859 ~ 1871行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(stu ==<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">  $(<span class=\"string\">'.cost-list .plan li'</span>).eq(index).closest(<span class=\"string\">\".li-main\"</span>).siblings(<span class=\"string\">\"h2\"</span>).find(<span class=\"string\">\".day-num\"</span>).text(d);</span><br><span class=\"line\">  $(<span class=\"string\">'.process .plan .val,.cost-list .plan .val'</span>).text( plan[<span class=\"number\">0</span>].name+<span class=\"string\">'(推荐)'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(t == plan[<span class=\"number\">0</span>].name)&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"细节\"><a href=\"#细节\" class=\"headerlink\" title=\"细节\"></a>细节</h3><ul>\n<li><p><strong> 封面样式问题 </strong></p>\n<p>原：为让页面内容垂直居中用js获取浏览器高度后写入dom，导致进入页面时会闪一下</p>\n<p><img src=\"/img/source-ivf-assistant/image.png\" alt=\"assistant\"></p>\n<p>建议：<br>1.隐藏页面，高度写入完后再显示<br>2.这层只是封面，进入表单后会整个隐藏，可以直接用css定位/flex布局;</p>\n</li>\n<li><p><strong> openThread() </strong></p>\n<p>变量 <code>urlVal</code> 重复声明，逻辑里面有多余的消耗；</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原 90 ~ 103行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> openThread = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tid,url</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tidThread = &#123;</span><br><span class=\"line\">    type:<span class=\"string\">'readThread'</span>,</span><br><span class=\"line\">    tid:tid</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> urlVal = url;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> threadTid =  <span class=\"built_in\">JSON</span>.stringify(tidThread);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( iosAPP_REG == <span class=\"literal\">true</span> &amp;&amp; crazyV&gt;=<span class=\"number\">420</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> urlVal = <span class=\"string\">'fkzr://'</span>+<span class=\"built_in\">encodeURIComponent</span>(threadTid);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>( androidAPP_REG == <span class=\"literal\">true</span> &amp;&amp; crazyV&gt;=<span class=\"number\">420</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> urlVal = <span class=\"string\">'fkzr://'</span>+<span class=\"built_in\">encodeURIComponent</span>(threadTid);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> urlVal;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> openThread = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tid, url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!iosAPP_REG &amp;&amp; !androidAPP_REG &amp;&amp; crazyV &lt; <span class=\"number\">420</span>) <span class=\"keyword\">return</span> url;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tidThread = <span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">    type: <span class=\"string\">'readThread'</span>,</span><br><span class=\"line\">    tid: tid</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'fkzr://'</span> + <span class=\"built_in\">encodeURIComponent</span>(threadTid);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 双重否定 </strong></p>\n<p>双重否定意义不大 一般情况下 <code>!!a === a</code>，如果有特殊情况加注释特殊处理比较好</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ivfId = !!realIvf &amp;&amp; !!realIvf.id? realIvf.id : <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">// 等同</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ivfId = realIvf &amp;&amp; realIvf.id? realIvf.id : <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 原 2171 ~ 2172 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = !!curPage ?  curPage : <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> stor = !!stor ? stor : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"comment\">// 等同</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = curPage || <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> stor = stor || <span class=\"string\">''</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 字符串拼接 </strong></p>\n<p>建议先组成数组，join()拼接成字符串，性能方面优于 <code>+=</code><br>不用对首位进行额外处理，更好理解</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原 1820 ~ 1920 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> savePlan  =<span class=\"string\">''</span>;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">for</span>( i  <span class=\"keyword\">in</span> plan)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> planName = plan[i].name;</span><br><span class=\"line\">  savePlan+=<span class=\"string\">','</span>+planName;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\">localStorage.setItem(<span class=\"string\">'cupai_plan'</span>, savePlan.replace(<span class=\"string\">','</span>,<span class=\"string\">''</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> savePlan = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (i <span class=\"keyword\">in</span> plan) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> planName = plan[i].name;</span><br><span class=\"line\">  savePlan.push(planName);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">savePlan = savePlan.join(<span class=\"string\">','</span>);</span><br><span class=\"line\">localStorage.setItem(<span class=\"string\">'cupai_plan'</span>, savePlan);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 表单字符串判断 </strong></p>\n<p>建议去除首尾空白字符，如使用$.trim()<br>↓↓↓ 当输入11位手机号时可以提交，空白字符同样满足，同理用于验证名字留言等</p>\n<p><img src=\"/img/source-ivf-assistant/image2.png\" alt=\"assistant\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原 2147 ~ 2151行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (v.length == <span class=\"number\">11</span>) &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ($.trim(v).length === <span class=\"number\">11</span>) &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 重复代码 </strong></p>\n<p>优化可读性，能提取出来的代码尽可能封装。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1687 ~ 1697 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> plan = localStorage.getItem(<span class=\"string\">'cupai_plan'</span>).split(<span class=\"string\">','</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> realPlan = localStorage.getItem(<span class=\"string\">'real_plan'</span>) ? localStorage.getItem(<span class=\"string\">'real_plan'</span>) :<span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> successRate = localStorage.getItem(<span class=\"string\">'success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> predictCost = localStorage.getItem(<span class=\"string\">'predict_cost'</span>) ?  localStorage.getItem(<span class=\"string\">'predict_cost'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> scheduleDays =  localStorage.getItem(<span class=\"string\">'schedule_days'</span>) ? localStorage.getItem(<span class=\"string\">'schedule_days'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> oneRate = localStorage.getItem(<span class=\"string\">'one_success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'one_success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> twoRate =localStorage.getItem(<span class=\"string\">'two_success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'two_success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> threeRate = localStorage.getItem(<span class=\"string\">'three_success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'three_success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> fivfTech = localStorage.getItem(<span class=\"string\">'fivf_Tech'</span>) ? localStorage.getItem(<span class=\"string\">'fivf_Tech'</span>) : <span class=\"string\">''</span> ;</span><br><span class=\"line\"><span class=\"keyword\">var</span> ivfTech =localStorage.getItem(<span class=\"string\">'ivf_tech'</span>) ? localStorage.getItem(<span class=\"string\">'ivf_tech'</span>) : <span class=\"string\">''</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化：例如 1687 ~ 1697 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> keys = &#123;</span><br><span class=\"line\">  plan: <span class=\"string\">'cupai_plan'</span>,</span><br><span class=\"line\">  realPlan: <span class=\"string\">'real_plan'</span>,</span><br><span class=\"line\">  successRate: <span class=\"string\">'success_rate'</span>,</span><br><span class=\"line\">  predictCost: <span class=\"string\">'predict_cost'</span>,</span><br><span class=\"line\">  scheduleDays: <span class=\"string\">'schedule_days'</span>,</span><br><span class=\"line\">  oneRate: <span class=\"string\">'one_success_rate'</span>,</span><br><span class=\"line\">  twoRate: <span class=\"string\">'two_success_rate'</span>,</span><br><span class=\"line\">  threeRate: <span class=\"string\">'three_success_rate'</span>,</span><br><span class=\"line\">  fivfTech: <span class=\"string\">'fivf_Tech'</span>,</span><br><span class=\"line\">  ivfTech: <span class=\"string\">'ivf_tech'</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (key <span class=\"keyword\">in</span> keys) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (key === <span class=\"string\">'plan'</span>) &#123;</span><br><span class=\"line\">    data[key] = localStorage.getItem(keys[key]).split(<span class=\"string\">','</span>);</span><br><span class=\"line\">    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  data[key] = localStorage.getItem(keys[key]) || <span class=\"string\">''</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>结果一致的判断写在一起</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 2448 ~ 2468行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) == <span class=\"string\">''</span>)&#123;</span><br><span class=\"line\">  userStu = <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\">/*if(!!localStorage.getItem('success_rate'))&#123;</span></span><br><span class=\"line\"><span class=\"comment\">    window.location.href = '//'+host+'/shiguan/201505/index.html#profile11';</span></span><br><span class=\"line\"><span class=\"comment\">  &#125;*/</span></span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>)&lt;=<span class=\"number\">9</span> &amp;&amp; hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>)&gt;<span class=\"number\">0</span> )&#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.hash = !!localStorage.getItem(<span class=\"string\">'success_rate'</span>) ? <span class=\"string\">'#profile11'</span> : <span class=\"string\">'#cover'</span>;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) ==<span class=\"number\">11</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( localStorage.getItem(<span class=\"string\">'success_rate'</span>) == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) ==<span class=\"number\">12</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!isLogin)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) ==<span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!isLogin)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone+<span class=\"string\">'#profile11'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> num = hashName.replace(<span class=\"string\">'profile'</span>, <span class=\"string\">''</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"string\">'//'</span> + host + <span class=\"string\">'/shiguan/201505/index.html'</span> + UrlFrom + UrlPhone;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!num) &#123;</span><br><span class=\"line\">  userStu = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num &lt;= <span class=\"number\">9</span> &amp;&amp; num &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.hash = localStorage.getItem(<span class=\"string\">'success_rate'</span>) ? <span class=\"string\">'#profile11'</span> : <span class=\"string\">'#cover'</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((<span class=\"regexp\">/^(12|10)$/</span>.test(num) &amp;&amp; !isLogin) || (num === <span class=\"number\">11</span> &amp;&amp; !localStorage.getItem(<span class=\"string\">'success_rate'</span>))) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.href = url;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num === <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.href =  url + <span class=\"string\">'#profile11'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><a href=\"http://source.bozhong.com/shiguan/201505/index.html\" title=\"试管助手\" target=\"_blank\" rel=\"noopener\">试管助手</a><br>","more":"</p>\n<hr>\n<h3 id=\"整体\"><a href=\"#整体\" class=\"headerlink\" title=\"整体\"></a>整体</h3><ul>\n<li>空格缩进引号不统一等代码风格问题;</li>\n<li>页面内大多数都是 <code>==</code>;</li>\n<li>对DOM的操作多，选择器层级较多，包括css和js;</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 127 ~ 132行</span></span><br><span class=\"line\">$(<span class=\"string\">'.result .tab .item,.profile .tab .item'</span>).css(<span class=\"string\">'width'</span>,<span class=\"string\">'33.33%'</span>);</span><br><span class=\"line\">$(<span class=\"string\">'.profile .tab .item'</span>).eq(<span class=\"number\">3</span>).hide();</span><br><span class=\"line\">$(<span class=\"string\">'.result .tab'</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  $(<span class=\"keyword\">this</span>).find(<span class=\"string\">'.item'</span>).eq(<span class=\"number\">3</span>).hide()<span class=\"comment\">//攻略服务器挂了故隐藏</span></span><br><span class=\"line\">  $(<span class=\"keyword\">this</span>).find(<span class=\"string\">'.item'</span>).eq(<span class=\"number\">4</span>).hide()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//1859 ~ 1871行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(stu ==<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">  $(<span class=\"string\">'.cost-list .plan li'</span>).eq(index).closest(<span class=\"string\">\".li-main\"</span>).siblings(<span class=\"string\">\"h2\"</span>).find(<span class=\"string\">\".day-num\"</span>).text(d);</span><br><span class=\"line\">  $(<span class=\"string\">'.process .plan .val,.cost-list .plan .val'</span>).text( plan[<span class=\"number\">0</span>].name+<span class=\"string\">'(推荐)'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(t == plan[<span class=\"number\">0</span>].name)&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"细节\"><a href=\"#细节\" class=\"headerlink\" title=\"细节\"></a>细节</h3><ul>\n<li><p><strong> 封面样式问题 </strong></p>\n<p>原：为让页面内容垂直居中用js获取浏览器高度后写入dom，导致进入页面时会闪一下</p>\n<p><img src=\"/img/source-ivf-assistant/image.png\" alt=\"assistant\"></p>\n<p>建议：<br>1.隐藏页面，高度写入完后再显示<br>2.这层只是封面，进入表单后会整个隐藏，可以直接用css定位/flex布局;</p>\n</li>\n<li><p><strong> openThread() </strong></p>\n<p>变量 <code>urlVal</code> 重复声明，逻辑里面有多余的消耗；</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原 90 ~ 103行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> openThread = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tid,url</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tidThread = &#123;</span><br><span class=\"line\">    type:<span class=\"string\">'readThread'</span>,</span><br><span class=\"line\">    tid:tid</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> urlVal = url;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> threadTid =  <span class=\"built_in\">JSON</span>.stringify(tidThread);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( iosAPP_REG == <span class=\"literal\">true</span> &amp;&amp; crazyV&gt;=<span class=\"number\">420</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> urlVal = <span class=\"string\">'fkzr://'</span>+<span class=\"built_in\">encodeURIComponent</span>(threadTid);</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>( androidAPP_REG == <span class=\"literal\">true</span> &amp;&amp; crazyV&gt;=<span class=\"number\">420</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> urlVal = <span class=\"string\">'fkzr://'</span>+<span class=\"built_in\">encodeURIComponent</span>(threadTid);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> urlVal;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> openThread = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">tid, url</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!iosAPP_REG &amp;&amp; !androidAPP_REG &amp;&amp; crazyV &lt; <span class=\"number\">420</span>) <span class=\"keyword\">return</span> url;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tidThread = <span class=\"built_in\">JSON</span>.stringify(&#123;</span><br><span class=\"line\">    type: <span class=\"string\">'readThread'</span>,</span><br><span class=\"line\">    tid: tid</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'fkzr://'</span> + <span class=\"built_in\">encodeURIComponent</span>(threadTid);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 双重否定 </strong></p>\n<p>双重否定意义不大 一般情况下 <code>!!a === a</code>，如果有特殊情况加注释特殊处理比较好</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ivfId = !!realIvf &amp;&amp; !!realIvf.id? realIvf.id : <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">// 等同</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> ivfId = realIvf &amp;&amp; realIvf.id? realIvf.id : <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 原 2171 ~ 2172 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = !!curPage ?  curPage : <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> stor = !!stor ? stor : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"comment\">// 等同</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = curPage || <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> stor = stor || <span class=\"string\">''</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 字符串拼接 </strong></p>\n<p>建议先组成数组，join()拼接成字符串，性能方面优于 <code>+=</code><br>不用对首位进行额外处理，更好理解</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原 1820 ~ 1920 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> savePlan  =<span class=\"string\">''</span>;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">for</span>( i  <span class=\"keyword\">in</span> plan)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> planName = plan[i].name;</span><br><span class=\"line\">  savePlan+=<span class=\"string\">','</span>+planName;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\">localStorage.setItem(<span class=\"string\">'cupai_plan'</span>, savePlan.replace(<span class=\"string\">','</span>,<span class=\"string\">''</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> savePlan = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (i <span class=\"keyword\">in</span> plan) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> planName = plan[i].name;</span><br><span class=\"line\">  savePlan.push(planName);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">savePlan = savePlan.join(<span class=\"string\">','</span>);</span><br><span class=\"line\">localStorage.setItem(<span class=\"string\">'cupai_plan'</span>, savePlan);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 表单字符串判断 </strong></p>\n<p>建议去除首尾空白字符，如使用$.trim()<br>↓↓↓ 当输入11位手机号时可以提交，空白字符同样满足，同理用于验证名字留言等</p>\n<p><img src=\"/img/source-ivf-assistant/image2.png\" alt=\"assistant\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 原 2147 ~ 2151行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (v.length == <span class=\"number\">11</span>) &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ($.trim(v).length === <span class=\"number\">11</span>) &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong> 重复代码 </strong></p>\n<p>优化可读性，能提取出来的代码尽可能封装。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1687 ~ 1697 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> plan = localStorage.getItem(<span class=\"string\">'cupai_plan'</span>).split(<span class=\"string\">','</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> realPlan = localStorage.getItem(<span class=\"string\">'real_plan'</span>) ? localStorage.getItem(<span class=\"string\">'real_plan'</span>) :<span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> successRate = localStorage.getItem(<span class=\"string\">'success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> predictCost = localStorage.getItem(<span class=\"string\">'predict_cost'</span>) ?  localStorage.getItem(<span class=\"string\">'predict_cost'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> scheduleDays =  localStorage.getItem(<span class=\"string\">'schedule_days'</span>) ? localStorage.getItem(<span class=\"string\">'schedule_days'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> oneRate = localStorage.getItem(<span class=\"string\">'one_success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'one_success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> twoRate =localStorage.getItem(<span class=\"string\">'two_success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'two_success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> threeRate = localStorage.getItem(<span class=\"string\">'three_success_rate'</span>) ? localStorage.getItem(<span class=\"string\">'three_success_rate'</span>) : <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> fivfTech = localStorage.getItem(<span class=\"string\">'fivf_Tech'</span>) ? localStorage.getItem(<span class=\"string\">'fivf_Tech'</span>) : <span class=\"string\">''</span> ;</span><br><span class=\"line\"><span class=\"keyword\">var</span> ivfTech =localStorage.getItem(<span class=\"string\">'ivf_tech'</span>) ? localStorage.getItem(<span class=\"string\">'ivf_tech'</span>) : <span class=\"string\">''</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化：例如 1687 ~ 1697 行</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> keys = &#123;</span><br><span class=\"line\">  plan: <span class=\"string\">'cupai_plan'</span>,</span><br><span class=\"line\">  realPlan: <span class=\"string\">'real_plan'</span>,</span><br><span class=\"line\">  successRate: <span class=\"string\">'success_rate'</span>,</span><br><span class=\"line\">  predictCost: <span class=\"string\">'predict_cost'</span>,</span><br><span class=\"line\">  scheduleDays: <span class=\"string\">'schedule_days'</span>,</span><br><span class=\"line\">  oneRate: <span class=\"string\">'one_success_rate'</span>,</span><br><span class=\"line\">  twoRate: <span class=\"string\">'two_success_rate'</span>,</span><br><span class=\"line\">  threeRate: <span class=\"string\">'three_success_rate'</span>,</span><br><span class=\"line\">  fivfTech: <span class=\"string\">'fivf_Tech'</span>,</span><br><span class=\"line\">  ivfTech: <span class=\"string\">'ivf_tech'</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (key <span class=\"keyword\">in</span> keys) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (key === <span class=\"string\">'plan'</span>) &#123;</span><br><span class=\"line\">    data[key] = localStorage.getItem(keys[key]).split(<span class=\"string\">','</span>);</span><br><span class=\"line\">    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  data[key] = localStorage.getItem(keys[key]) || <span class=\"string\">''</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>结果一致的判断写在一起</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 2448 ~ 2468行</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) == <span class=\"string\">''</span>)&#123;</span><br><span class=\"line\">  userStu = <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\">/*if(!!localStorage.getItem('success_rate'))&#123;</span></span><br><span class=\"line\"><span class=\"comment\">    window.location.href = '//'+host+'/shiguan/201505/index.html#profile11';</span></span><br><span class=\"line\"><span class=\"comment\">  &#125;*/</span></span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>)&lt;=<span class=\"number\">9</span> &amp;&amp; hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>)&gt;<span class=\"number\">0</span> )&#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.hash = !!localStorage.getItem(<span class=\"string\">'success_rate'</span>) ? <span class=\"string\">'#profile11'</span> : <span class=\"string\">'#cover'</span>;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) ==<span class=\"number\">11</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( localStorage.getItem(<span class=\"string\">'success_rate'</span>) == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) ==<span class=\"number\">12</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!isLogin)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(hashName.replace(<span class=\"string\">\"profile\"</span>,<span class=\"string\">\"\"</span>) ==<span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!isLogin)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">window</span>.location.href = <span class=\"string\">'//'</span>+host+<span class=\"string\">'/shiguan/201505/index.html'</span>+UrlFrom + UrlPhone+<span class=\"string\">'#profile11'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 优化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> num = hashName.replace(<span class=\"string\">'profile'</span>, <span class=\"string\">''</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> url = <span class=\"string\">'//'</span> + host + <span class=\"string\">'/shiguan/201505/index.html'</span> + UrlFrom + UrlPhone;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!num) &#123;</span><br><span class=\"line\">  userStu = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num &lt;= <span class=\"number\">9</span> &amp;&amp; num &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.hash = localStorage.getItem(<span class=\"string\">'success_rate'</span>) ? <span class=\"string\">'#profile11'</span> : <span class=\"string\">'#cover'</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((<span class=\"regexp\">/^(12|10)$/</span>.test(num) &amp;&amp; !isLogin) || (num === <span class=\"number\">11</span> &amp;&amp; !localStorage.getItem(<span class=\"string\">'success_rate'</span>))) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.href = url;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num === <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.location.href =  url + <span class=\"string\">'#profile11'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>"},{"title":"移动端图片压缩上传","date":"2017-10-20T04:53:01.000Z","_content":"\n在移动端压缩图片并且上传主要用到filereader、canvas 以及 formdata 这三个h5的api。逻辑并不难。整个过程就是：\n\n-   用户使用input file上传图片的时候，用filereader读取用户上传的图片数据（base64格式）\n\n-   把图片数据传入img对象，然后将img绘制到canvas上，再调用canvas.toDataURL对图片进行压缩\\`\n\n-   获取到压缩后的base64格式图片数据，转成二进制塞入formdata，再通过XmlHttpRequest提交formdata。\n\n<!-- more -->\n\n### 基础知识\n\n#### FormData\n\n`通过FormData对象可以组装一组用 XMLHttpRequest发送请求的键/值对。它可以更灵活方便的发送表单数据，因为可以独立于表单使用。如果你把表单的编码类型设置为multipart/form-data ，则通过FormData传输的数据格式和表单通过submit() 方法传输的数据格式相同。`\n\n#### base64\n\n`Base64是一种基于64个可打印字符来表示二进制数据的表示方法。 由于2的6次方等于64，所以每6个位元为一个单元，对应某个可打印字符。 三个字节有24个位元，对应于4个Base64单元，即3个字节可表示4个可打印字符。`\n\n#### FileReader对象\n\nFileReader 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。\nFileReader也就是将本地文件转换成base64格式的dataUrl。\n\n### 获取图片数据\n\n先是获取图片数据，也就是监听input file的change事件，然后获取到上传的文件对象files，\n如果是图片就实例化一个filereader，以base64格式读取上传的文件数据，判断数据长度，调用compress方法进行压缩进行上传。\n\n### 压缩图片\n\n上面做完图片数据的获取后，就可以做compress压缩图片的方法了。而压缩图片也并不是直接把图片绘制到canvas再调用一下toDataURL就行的。\n在IOS中，canvas绘制图片是有两个限制的：\n首先是图片的大小，如果图片的大小超过两百万像素，图片也是无法绘制到canvas上的，调用drawImage的时候不会报错，但是你用toDataURL获取图片数据的时候获取到的是空的图片数据。\n再者就是canvas的大小有限制，如果canvas的大小大于大概五百万像素（即宽高乘积）的时候，不仅图片画不出来，其他什么东西也都是画不出来的。\n应对第一种限制，处理办法就是瓦片绘制了。瓦片绘制，也就是将图片分割成多块绘制到canvas上，我代码里的做法是把图片分割成100万像素一块的大小，再绘制到canvas上。\n而应对第二种限制，设的上限是四百万像素，如果图片大于四百万像素就压缩到小于四百万像素。四百万像素的图片应该够了，算起来宽高都有2000X2000了。\n如此一来就解决了IOS上的两种限制了。\n除了上面所述的限制，还有两个坑，一个就是canvas的toDataURL是只能压缩jpg的，当用户上传的图片是png的话，就需要转成jpg，也就是统一用canvas.toDataURL('image/jpeg', 0.1) ， 类型统一设成jpeg，而压缩比就自己控制了。\n另一个就是如果是png转jpg，绘制到canvas上的时候，canvas存在透明区域的话，当转成jpg的时候透明区域会变成黑色，因为canvas的透明像素默认为rgba(0,0,0,0)，所以转成jpg就变成rgba(0,0,0,1)了，也就是透明背景会变成了黑色。解决办法就是绘制之前在canvas上铺一层白色的底色。\n\n```javascript\nuploader.prototype.compress = function(file){\n  var _this = this;\n  var reader = new FileReader();\n  var t;\n  _this.beforeCompress();\n  if(!!_this.compressProgress){\n      var i = 15;\n      _this.compressProgress(i);\n      t = setInterval(function(){\n          if(i<95){\n              var num = parseInt(Math.random()*8+1);\n              i += num*num;\n              _this.compressProgress(i);\n          } else {\n              window.clearInterval(t)\n          }\n      },50)\n  }\n  reader.readAsDataURL(file);\n  reader.onload = function(){\n    var result = this.result;\n    var img = new Image();\n    var canvas = document.createElement(\"canvas\");\n    var tCanvas = document.createElement(\"canvas\");\n    img.src = result;\n    img.addEventListener(\"load\",function(){\n        var initSize = img.src.length //测试输出原尺寸\n        var width = img.width;\n        var height = img.height;\n        //图片压缩到四百万像素以下，canvas限制五百万像素以下\n        var ratio = width*height/4000000;\n        if(ratio > 1){\n            ratio = Math.sqrt(ratio);\n            width /=ratio;\n            height /=ratio;\n        } else {\n            ratio = 1;\n        }\n        canvas.width = width;\n        canvas.height = height;\n        var ctx = canvas.getContext('2d');\n        //格式需要转jpg，铺一层底色避免png的透明区域变黑\n        ctx.fillStyle = \"#fff\";\n        ctx.fillRect(0,0,canvas.width,canvas.height);\n        //如果图片像素大于100w则分割绘制\n        var count = width * height/1000000;\n        if(count>1){\n            count = ~~(Math.sqrt(count)+1) //计算分割成多少块\n            //计算每一块宽高\n            var nw = ~~(width/count);\n            var nh = ~~(height/count);\n            var tctx = tCanvas.getContext('2d');\n            tCanvas.width = nw;\n            tCanvas.height = nh;\n\n            for(var i = 0;i < count; i++){\n                for(var j = 0;j<count;j++){\n                    tctx.drawImage(img,i*nw*ratio,j*nh*ratio,nw*ratio,nh*ratio,0,0,nw,nh);\n                    ctx.drawImage(tCanvas,i*nw,j*nh,nw,nh);\n                }\n            }\n        } else {\n            ctx.drawImage(img,0,0,width,height);\n        }\n        //进行压缩\n        var ndata = canvas.toDataURL('image/jpeg',_this.compressRatio);\n```\n###  图片上传\n使用ajax中的xhr监听上传进度\n```javascript\n$.ajax({\n  url: _this.api,\n  type: 'POST',\n  data: {\n    file: ndata.replace(\"data:image/jpeg;base64,\",\"\").replace(\"data:image/png;base64,\",\"\"),\n    content_type: \"image/jpeg\",\n    class:'user'\n  },\n  xhrFields: {\n    withCredetials: true\n  },\n  xhr: function(){\n    var xhr = $.ajaxSettings.xhr();\n    if(!!_this.progress){\n      if (xhr.upload) {\n        if(ua.match(/Android 4.2.1/)){\n            _this.progress('上传中..');\n        }\n        xhr.upload.addEventListener('progress', function(event) {\n            var percent = 0;\n            var position = event.loaded || event.position;\n            var total = event.total;\n            if (event.lengthComputable) {\n                percent = Math.ceil(position / total * 100);\n                _this.progress(percent);\n            }\n        }, false);\n      }\n    }\n    return xhr;\n  },\n  // processData: false, // 告诉jQuery不要去处理发送的数据\n  // contentType: false, // 告诉jQuery不要去设置Content-Type请求头\n  success: function(data) {\n  },\n  error:function(data){\n  }\n});\n```\n### 相关链接\n\n[移动端图片上传的实践](https://qiutc.me/post/uploading-image-file-in-mobile-fe.html)\n[移动端H5实现图片上传](https://segmentfault.com/a/1190000010034177)\n","source":"_posts/upload.md","raw":"---\ntitle: 移动端图片压缩上传\ndate: 2017-10-20 12:53:01\ntags:\n - javascript\n - review\n---\n\n在移动端压缩图片并且上传主要用到filereader、canvas 以及 formdata 这三个h5的api。逻辑并不难。整个过程就是：\n\n-   用户使用input file上传图片的时候，用filereader读取用户上传的图片数据（base64格式）\n\n-   把图片数据传入img对象，然后将img绘制到canvas上，再调用canvas.toDataURL对图片进行压缩\\`\n\n-   获取到压缩后的base64格式图片数据，转成二进制塞入formdata，再通过XmlHttpRequest提交formdata。\n\n<!-- more -->\n\n### 基础知识\n\n#### FormData\n\n`通过FormData对象可以组装一组用 XMLHttpRequest发送请求的键/值对。它可以更灵活方便的发送表单数据，因为可以独立于表单使用。如果你把表单的编码类型设置为multipart/form-data ，则通过FormData传输的数据格式和表单通过submit() 方法传输的数据格式相同。`\n\n#### base64\n\n`Base64是一种基于64个可打印字符来表示二进制数据的表示方法。 由于2的6次方等于64，所以每6个位元为一个单元，对应某个可打印字符。 三个字节有24个位元，对应于4个Base64单元，即3个字节可表示4个可打印字符。`\n\n#### FileReader对象\n\nFileReader 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。\nFileReader也就是将本地文件转换成base64格式的dataUrl。\n\n### 获取图片数据\n\n先是获取图片数据，也就是监听input file的change事件，然后获取到上传的文件对象files，\n如果是图片就实例化一个filereader，以base64格式读取上传的文件数据，判断数据长度，调用compress方法进行压缩进行上传。\n\n### 压缩图片\n\n上面做完图片数据的获取后，就可以做compress压缩图片的方法了。而压缩图片也并不是直接把图片绘制到canvas再调用一下toDataURL就行的。\n在IOS中，canvas绘制图片是有两个限制的：\n首先是图片的大小，如果图片的大小超过两百万像素，图片也是无法绘制到canvas上的，调用drawImage的时候不会报错，但是你用toDataURL获取图片数据的时候获取到的是空的图片数据。\n再者就是canvas的大小有限制，如果canvas的大小大于大概五百万像素（即宽高乘积）的时候，不仅图片画不出来，其他什么东西也都是画不出来的。\n应对第一种限制，处理办法就是瓦片绘制了。瓦片绘制，也就是将图片分割成多块绘制到canvas上，我代码里的做法是把图片分割成100万像素一块的大小，再绘制到canvas上。\n而应对第二种限制，设的上限是四百万像素，如果图片大于四百万像素就压缩到小于四百万像素。四百万像素的图片应该够了，算起来宽高都有2000X2000了。\n如此一来就解决了IOS上的两种限制了。\n除了上面所述的限制，还有两个坑，一个就是canvas的toDataURL是只能压缩jpg的，当用户上传的图片是png的话，就需要转成jpg，也就是统一用canvas.toDataURL('image/jpeg', 0.1) ， 类型统一设成jpeg，而压缩比就自己控制了。\n另一个就是如果是png转jpg，绘制到canvas上的时候，canvas存在透明区域的话，当转成jpg的时候透明区域会变成黑色，因为canvas的透明像素默认为rgba(0,0,0,0)，所以转成jpg就变成rgba(0,0,0,1)了，也就是透明背景会变成了黑色。解决办法就是绘制之前在canvas上铺一层白色的底色。\n\n```javascript\nuploader.prototype.compress = function(file){\n  var _this = this;\n  var reader = new FileReader();\n  var t;\n  _this.beforeCompress();\n  if(!!_this.compressProgress){\n      var i = 15;\n      _this.compressProgress(i);\n      t = setInterval(function(){\n          if(i<95){\n              var num = parseInt(Math.random()*8+1);\n              i += num*num;\n              _this.compressProgress(i);\n          } else {\n              window.clearInterval(t)\n          }\n      },50)\n  }\n  reader.readAsDataURL(file);\n  reader.onload = function(){\n    var result = this.result;\n    var img = new Image();\n    var canvas = document.createElement(\"canvas\");\n    var tCanvas = document.createElement(\"canvas\");\n    img.src = result;\n    img.addEventListener(\"load\",function(){\n        var initSize = img.src.length //测试输出原尺寸\n        var width = img.width;\n        var height = img.height;\n        //图片压缩到四百万像素以下，canvas限制五百万像素以下\n        var ratio = width*height/4000000;\n        if(ratio > 1){\n            ratio = Math.sqrt(ratio);\n            width /=ratio;\n            height /=ratio;\n        } else {\n            ratio = 1;\n        }\n        canvas.width = width;\n        canvas.height = height;\n        var ctx = canvas.getContext('2d');\n        //格式需要转jpg，铺一层底色避免png的透明区域变黑\n        ctx.fillStyle = \"#fff\";\n        ctx.fillRect(0,0,canvas.width,canvas.height);\n        //如果图片像素大于100w则分割绘制\n        var count = width * height/1000000;\n        if(count>1){\n            count = ~~(Math.sqrt(count)+1) //计算分割成多少块\n            //计算每一块宽高\n            var nw = ~~(width/count);\n            var nh = ~~(height/count);\n            var tctx = tCanvas.getContext('2d');\n            tCanvas.width = nw;\n            tCanvas.height = nh;\n\n            for(var i = 0;i < count; i++){\n                for(var j = 0;j<count;j++){\n                    tctx.drawImage(img,i*nw*ratio,j*nh*ratio,nw*ratio,nh*ratio,0,0,nw,nh);\n                    ctx.drawImage(tCanvas,i*nw,j*nh,nw,nh);\n                }\n            }\n        } else {\n            ctx.drawImage(img,0,0,width,height);\n        }\n        //进行压缩\n        var ndata = canvas.toDataURL('image/jpeg',_this.compressRatio);\n```\n###  图片上传\n使用ajax中的xhr监听上传进度\n```javascript\n$.ajax({\n  url: _this.api,\n  type: 'POST',\n  data: {\n    file: ndata.replace(\"data:image/jpeg;base64,\",\"\").replace(\"data:image/png;base64,\",\"\"),\n    content_type: \"image/jpeg\",\n    class:'user'\n  },\n  xhrFields: {\n    withCredetials: true\n  },\n  xhr: function(){\n    var xhr = $.ajaxSettings.xhr();\n    if(!!_this.progress){\n      if (xhr.upload) {\n        if(ua.match(/Android 4.2.1/)){\n            _this.progress('上传中..');\n        }\n        xhr.upload.addEventListener('progress', function(event) {\n            var percent = 0;\n            var position = event.loaded || event.position;\n            var total = event.total;\n            if (event.lengthComputable) {\n                percent = Math.ceil(position / total * 100);\n                _this.progress(percent);\n            }\n        }, false);\n      }\n    }\n    return xhr;\n  },\n  // processData: false, // 告诉jQuery不要去处理发送的数据\n  // contentType: false, // 告诉jQuery不要去设置Content-Type请求头\n  success: function(data) {\n  },\n  error:function(data){\n  }\n});\n```\n### 相关链接\n\n[移动端图片上传的实践](https://qiutc.me/post/uploading-image-file-in-mobile-fe.html)\n[移动端H5实现图片上传](https://segmentfault.com/a/1190000010034177)\n","slug":"upload","published":1,"updated":"2017-10-27T10:42:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oee0021uo2ewetf0p4h","content":"<p>在移动端压缩图片并且上传主要用到filereader、canvas 以及 formdata 这三个h5的api。逻辑并不难。整个过程就是：</p>\n<ul>\n<li><p>用户使用input file上传图片的时候，用filereader读取用户上传的图片数据（base64格式）</p>\n</li>\n<li><p>把图片数据传入img对象，然后将img绘制到canvas上，再调用canvas.toDataURL对图片进行压缩`</p>\n</li>\n<li><p>获取到压缩后的base64格式图片数据，转成二进制塞入formdata，再通过XmlHttpRequest提交formdata。</p>\n</li>\n</ul>\n<a id=\"more\"></a>\n<h3 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h3><h4 id=\"FormData\"><a href=\"#FormData\" class=\"headerlink\" title=\"FormData\"></a>FormData</h4><p><code>通过FormData对象可以组装一组用 XMLHttpRequest发送请求的键/值对。它可以更灵活方便的发送表单数据，因为可以独立于表单使用。如果你把表单的编码类型设置为multipart/form-data ，则通过FormData传输的数据格式和表单通过submit() 方法传输的数据格式相同。</code></p>\n<h4 id=\"base64\"><a href=\"#base64\" class=\"headerlink\" title=\"base64\"></a>base64</h4><p><code>Base64是一种基于64个可打印字符来表示二进制数据的表示方法。 由于2的6次方等于64，所以每6个位元为一个单元，对应某个可打印字符。 三个字节有24个位元，对应于4个Base64单元，即3个字节可表示4个可打印字符。</code></p>\n<h4 id=\"FileReader对象\"><a href=\"#FileReader对象\" class=\"headerlink\" title=\"FileReader对象\"></a>FileReader对象</h4><p>FileReader 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。<br>FileReader也就是将本地文件转换成base64格式的dataUrl。</p>\n<h3 id=\"获取图片数据\"><a href=\"#获取图片数据\" class=\"headerlink\" title=\"获取图片数据\"></a>获取图片数据</h3><p>先是获取图片数据，也就是监听input file的change事件，然后获取到上传的文件对象files，<br>如果是图片就实例化一个filereader，以base64格式读取上传的文件数据，判断数据长度，调用compress方法进行压缩进行上传。</p>\n<h3 id=\"压缩图片\"><a href=\"#压缩图片\" class=\"headerlink\" title=\"压缩图片\"></a>压缩图片</h3><p>上面做完图片数据的获取后，就可以做compress压缩图片的方法了。而压缩图片也并不是直接把图片绘制到canvas再调用一下toDataURL就行的。<br>在IOS中，canvas绘制图片是有两个限制的：<br>首先是图片的大小，如果图片的大小超过两百万像素，图片也是无法绘制到canvas上的，调用drawImage的时候不会报错，但是你用toDataURL获取图片数据的时候获取到的是空的图片数据。<br>再者就是canvas的大小有限制，如果canvas的大小大于大概五百万像素（即宽高乘积）的时候，不仅图片画不出来，其他什么东西也都是画不出来的。<br>应对第一种限制，处理办法就是瓦片绘制了。瓦片绘制，也就是将图片分割成多块绘制到canvas上，我代码里的做法是把图片分割成100万像素一块的大小，再绘制到canvas上。<br>而应对第二种限制，设的上限是四百万像素，如果图片大于四百万像素就压缩到小于四百万像素。四百万像素的图片应该够了，算起来宽高都有2000X2000了。<br>如此一来就解决了IOS上的两种限制了。<br>除了上面所述的限制，还有两个坑，一个就是canvas的toDataURL是只能压缩jpg的，当用户上传的图片是png的话，就需要转成jpg，也就是统一用canvas.toDataURL(‘image/jpeg’, 0.1) ， 类型统一设成jpeg，而压缩比就自己控制了。<br>另一个就是如果是png转jpg，绘制到canvas上的时候，canvas存在透明区域的话，当转成jpg的时候透明区域会变成黑色，因为canvas的透明像素默认为rgba(0,0,0,0)，所以转成jpg就变成rgba(0,0,0,1)了，也就是透明背景会变成了黑色。解决办法就是绘制之前在canvas上铺一层白色的底色。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uploader.prototype.compress = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">file</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> t;</span><br><span class=\"line\">  _this.beforeCompress();</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!!_this.compressProgress)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> i = <span class=\"number\">15</span>;</span><br><span class=\"line\">      _this.compressProgress(i);</span><br><span class=\"line\">      t = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(i&lt;<span class=\"number\">95</span>)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> num = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">8</span>+<span class=\"number\">1</span>);</span><br><span class=\"line\">              i += num*num;</span><br><span class=\"line\">              _this.compressProgress(i);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"built_in\">window</span>.clearInterval(t)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;,<span class=\"number\">50</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  reader.readAsDataURL(file);</span><br><span class=\"line\">  reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"keyword\">this</span>.result;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tCanvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    img.src = result;</span><br><span class=\"line\">    img.addEventListener(<span class=\"string\">\"load\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> initSize = img.src.length <span class=\"comment\">//测试输出原尺寸</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> width = img.width;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> height = img.height;</span><br><span class=\"line\">        <span class=\"comment\">//图片压缩到四百万像素以下，canvas限制五百万像素以下</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> ratio = width*height/<span class=\"number\">4000000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ratio &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            ratio = <span class=\"built_in\">Math</span>.sqrt(ratio);</span><br><span class=\"line\">            width /=ratio;</span><br><span class=\"line\">            height /=ratio;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ratio = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        canvas.width = width;</span><br><span class=\"line\">        canvas.height = height;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">        <span class=\"comment\">//格式需要转jpg，铺一层底色避免png的透明区域变黑</span></span><br><span class=\"line\">        ctx.fillStyle = <span class=\"string\">\"#fff\"</span>;</span><br><span class=\"line\">        ctx.fillRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,canvas.width,canvas.height);</span><br><span class=\"line\">        <span class=\"comment\">//如果图片像素大于100w则分割绘制</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> count = width * height/<span class=\"number\">1000000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count&gt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            count = ~~(<span class=\"built_in\">Math</span>.sqrt(count)+<span class=\"number\">1</span>) <span class=\"comment\">//计算分割成多少块</span></span><br><span class=\"line\">            <span class=\"comment\">//计算每一块宽高</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> nw = ~~(width/count);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> nh = ~~(height/count);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> tctx = tCanvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">            tCanvas.width = nw;</span><br><span class=\"line\">            tCanvas.height = nh;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;i &lt; count; i++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>;j&lt;count;j++)&#123;</span><br><span class=\"line\">                    tctx.drawImage(img,i*nw*ratio,j*nh*ratio,nw*ratio,nh*ratio,<span class=\"number\">0</span>,<span class=\"number\">0</span>,nw,nh);</span><br><span class=\"line\">                    ctx.drawImage(tCanvas,i*nw,j*nh,nw,nh);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ctx.drawImage(img,<span class=\"number\">0</span>,<span class=\"number\">0</span>,width,height);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//进行压缩</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> ndata = canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>,_this.compressRatio);</span><br></pre></td></tr></table></figure>\n<h3 id=\"图片上传\"><a href=\"#图片上传\" class=\"headerlink\" title=\"图片上传\"></a>图片上传</h3><p>使用ajax中的xhr监听上传进度<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">  url: _this.api,</span><br><span class=\"line\">  type: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    file: ndata.replace(<span class=\"string\">\"data:image/jpeg;base64,\"</span>,<span class=\"string\">\"\"</span>).replace(<span class=\"string\">\"data:image/png;base64,\"</span>,<span class=\"string\">\"\"</span>),</span><br><span class=\"line\">    content_type: <span class=\"string\">\"image/jpeg\"</span>,</span><br><span class=\"line\">    class:'user'</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  xhrFields: &#123;</span><br><span class=\"line\">    withCredetials: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  xhr: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr = $.ajaxSettings.xhr();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!!_this.progress)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (xhr.upload) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ua.match(<span class=\"regexp\">/Android 4.2.1/</span>))&#123;</span><br><span class=\"line\">            _this.progress(<span class=\"string\">'上传中..'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        xhr.upload.addEventListener(<span class=\"string\">'progress'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> percent = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> position = event.loaded || event.position;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> total = event.total;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (event.lengthComputable) &#123;</span><br><span class=\"line\">                percent = <span class=\"built_in\">Math</span>.ceil(position / total * <span class=\"number\">100</span>);</span><br><span class=\"line\">                _this.progress(percent);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xhr;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// processData: false, // 告诉jQuery不要去处理发送的数据</span></span><br><span class=\"line\">  <span class=\"comment\">// contentType: false, // 告诉jQuery不要去设置Content-Type请求头</span></span><br><span class=\"line\">  success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"相关链接\"><a href=\"#相关链接\" class=\"headerlink\" title=\"相关链接\"></a>相关链接</h3><p><a href=\"https://qiutc.me/post/uploading-image-file-in-mobile-fe.html\" target=\"_blank\" rel=\"noopener\">移动端图片上传的实践</a><br><a href=\"https://segmentfault.com/a/1190000010034177\" target=\"_blank\" rel=\"noopener\">移动端H5实现图片上传</a></p>\n","site":{"data":{}},"excerpt":"<p>在移动端压缩图片并且上传主要用到filereader、canvas 以及 formdata 这三个h5的api。逻辑并不难。整个过程就是：</p>\n<ul>\n<li><p>用户使用input file上传图片的时候，用filereader读取用户上传的图片数据（base64格式）</p>\n</li>\n<li><p>把图片数据传入img对象，然后将img绘制到canvas上，再调用canvas.toDataURL对图片进行压缩`</p>\n</li>\n<li><p>获取到压缩后的base64格式图片数据，转成二进制塞入formdata，再通过XmlHttpRequest提交formdata。</p>\n</li>\n</ul>","more":"<h3 id=\"基础知识\"><a href=\"#基础知识\" class=\"headerlink\" title=\"基础知识\"></a>基础知识</h3><h4 id=\"FormData\"><a href=\"#FormData\" class=\"headerlink\" title=\"FormData\"></a>FormData</h4><p><code>通过FormData对象可以组装一组用 XMLHttpRequest发送请求的键/值对。它可以更灵活方便的发送表单数据，因为可以独立于表单使用。如果你把表单的编码类型设置为multipart/form-data ，则通过FormData传输的数据格式和表单通过submit() 方法传输的数据格式相同。</code></p>\n<h4 id=\"base64\"><a href=\"#base64\" class=\"headerlink\" title=\"base64\"></a>base64</h4><p><code>Base64是一种基于64个可打印字符来表示二进制数据的表示方法。 由于2的6次方等于64，所以每6个位元为一个单元，对应某个可打印字符。 三个字节有24个位元，对应于4个Base64单元，即3个字节可表示4个可打印字符。</code></p>\n<h4 id=\"FileReader对象\"><a href=\"#FileReader对象\" class=\"headerlink\" title=\"FileReader对象\"></a>FileReader对象</h4><p>FileReader 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。<br>FileReader也就是将本地文件转换成base64格式的dataUrl。</p>\n<h3 id=\"获取图片数据\"><a href=\"#获取图片数据\" class=\"headerlink\" title=\"获取图片数据\"></a>获取图片数据</h3><p>先是获取图片数据，也就是监听input file的change事件，然后获取到上传的文件对象files，<br>如果是图片就实例化一个filereader，以base64格式读取上传的文件数据，判断数据长度，调用compress方法进行压缩进行上传。</p>\n<h3 id=\"压缩图片\"><a href=\"#压缩图片\" class=\"headerlink\" title=\"压缩图片\"></a>压缩图片</h3><p>上面做完图片数据的获取后，就可以做compress压缩图片的方法了。而压缩图片也并不是直接把图片绘制到canvas再调用一下toDataURL就行的。<br>在IOS中，canvas绘制图片是有两个限制的：<br>首先是图片的大小，如果图片的大小超过两百万像素，图片也是无法绘制到canvas上的，调用drawImage的时候不会报错，但是你用toDataURL获取图片数据的时候获取到的是空的图片数据。<br>再者就是canvas的大小有限制，如果canvas的大小大于大概五百万像素（即宽高乘积）的时候，不仅图片画不出来，其他什么东西也都是画不出来的。<br>应对第一种限制，处理办法就是瓦片绘制了。瓦片绘制，也就是将图片分割成多块绘制到canvas上，我代码里的做法是把图片分割成100万像素一块的大小，再绘制到canvas上。<br>而应对第二种限制，设的上限是四百万像素，如果图片大于四百万像素就压缩到小于四百万像素。四百万像素的图片应该够了，算起来宽高都有2000X2000了。<br>如此一来就解决了IOS上的两种限制了。<br>除了上面所述的限制，还有两个坑，一个就是canvas的toDataURL是只能压缩jpg的，当用户上传的图片是png的话，就需要转成jpg，也就是统一用canvas.toDataURL(‘image/jpeg’, 0.1) ， 类型统一设成jpeg，而压缩比就自己控制了。<br>另一个就是如果是png转jpg，绘制到canvas上的时候，canvas存在透明区域的话，当转成jpg的时候透明区域会变成黑色，因为canvas的透明像素默认为rgba(0,0,0,0)，所以转成jpg就变成rgba(0,0,0,1)了，也就是透明背景会变成了黑色。解决办法就是绘制之前在canvas上铺一层白色的底色。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uploader.prototype.compress = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">file</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> t;</span><br><span class=\"line\">  _this.beforeCompress();</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!!_this.compressProgress)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> i = <span class=\"number\">15</span>;</span><br><span class=\"line\">      _this.compressProgress(i);</span><br><span class=\"line\">      t = setInterval(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(i&lt;<span class=\"number\">95</span>)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">var</span> num = <span class=\"built_in\">parseInt</span>(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">8</span>+<span class=\"number\">1</span>);</span><br><span class=\"line\">              i += num*num;</span><br><span class=\"line\">              _this.compressProgress(i);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"built_in\">window</span>.clearInterval(t)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;,<span class=\"number\">50</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  reader.readAsDataURL(file);</span><br><span class=\"line\">  reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"keyword\">this</span>.result;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> tCanvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</span><br><span class=\"line\">    img.src = result;</span><br><span class=\"line\">    img.addEventListener(<span class=\"string\">\"load\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> initSize = img.src.length <span class=\"comment\">//测试输出原尺寸</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> width = img.width;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> height = img.height;</span><br><span class=\"line\">        <span class=\"comment\">//图片压缩到四百万像素以下，canvas限制五百万像素以下</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> ratio = width*height/<span class=\"number\">4000000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ratio &gt; <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            ratio = <span class=\"built_in\">Math</span>.sqrt(ratio);</span><br><span class=\"line\">            width /=ratio;</span><br><span class=\"line\">            height /=ratio;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ratio = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        canvas.width = width;</span><br><span class=\"line\">        canvas.height = height;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">        <span class=\"comment\">//格式需要转jpg，铺一层底色避免png的透明区域变黑</span></span><br><span class=\"line\">        ctx.fillStyle = <span class=\"string\">\"#fff\"</span>;</span><br><span class=\"line\">        ctx.fillRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,canvas.width,canvas.height);</span><br><span class=\"line\">        <span class=\"comment\">//如果图片像素大于100w则分割绘制</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> count = width * height/<span class=\"number\">1000000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count&gt;<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">            count = ~~(<span class=\"built_in\">Math</span>.sqrt(count)+<span class=\"number\">1</span>) <span class=\"comment\">//计算分割成多少块</span></span><br><span class=\"line\">            <span class=\"comment\">//计算每一块宽高</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> nw = ~~(width/count);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> nh = ~~(height/count);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> tctx = tCanvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">            tCanvas.width = nw;</span><br><span class=\"line\">            tCanvas.height = nh;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;i &lt; count; i++)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>;j&lt;count;j++)&#123;</span><br><span class=\"line\">                    tctx.drawImage(img,i*nw*ratio,j*nh*ratio,nw*ratio,nh*ratio,<span class=\"number\">0</span>,<span class=\"number\">0</span>,nw,nh);</span><br><span class=\"line\">                    ctx.drawImage(tCanvas,i*nw,j*nh,nw,nh);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ctx.drawImage(img,<span class=\"number\">0</span>,<span class=\"number\">0</span>,width,height);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//进行压缩</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> ndata = canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>,_this.compressRatio);</span><br></pre></td></tr></table></figure>\n<h3 id=\"图片上传\"><a href=\"#图片上传\" class=\"headerlink\" title=\"图片上传\"></a>图片上传</h3><p>使用ajax中的xhr监听上传进度<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">  url: _this.api,</span><br><span class=\"line\">  type: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    file: ndata.replace(<span class=\"string\">\"data:image/jpeg;base64,\"</span>,<span class=\"string\">\"\"</span>).replace(<span class=\"string\">\"data:image/png;base64,\"</span>,<span class=\"string\">\"\"</span>),</span><br><span class=\"line\">    content_type: <span class=\"string\">\"image/jpeg\"</span>,</span><br><span class=\"line\">    class:'user'</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  xhrFields: &#123;</span><br><span class=\"line\">    withCredetials: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  xhr: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr = $.ajaxSettings.xhr();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!!_this.progress)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (xhr.upload) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(ua.match(<span class=\"regexp\">/Android 4.2.1/</span>))&#123;</span><br><span class=\"line\">            _this.progress(<span class=\"string\">'上传中..'</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        xhr.upload.addEventListener(<span class=\"string\">'progress'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> percent = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> position = event.loaded || event.position;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> total = event.total;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (event.lengthComputable) &#123;</span><br><span class=\"line\">                percent = <span class=\"built_in\">Math</span>.ceil(position / total * <span class=\"number\">100</span>);</span><br><span class=\"line\">                _this.progress(percent);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> xhr;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// processData: false, // 告诉jQuery不要去处理发送的数据</span></span><br><span class=\"line\">  <span class=\"comment\">// contentType: false, // 告诉jQuery不要去设置Content-Type请求头</span></span><br><span class=\"line\">  success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"相关链接\"><a href=\"#相关链接\" class=\"headerlink\" title=\"相关链接\"></a>相关链接</h3><p><a href=\"https://qiutc.me/post/uploading-image-file-in-mobile-fe.html\" target=\"_blank\" rel=\"noopener\">移动端图片上传的实践</a><br><a href=\"https://segmentfault.com/a/1190000010034177\" target=\"_blank\" rel=\"noopener\">移动端H5实现图片上传</a></p>"},{"title":"健康项目review","date":"2017-09-09T16:00:00.000Z","_content":"\n## 两个主题\n\n阿里健康项目的__`《review过程》`__，及遇到的__`《坑》`__\n<!--more-->\n\n\n## review过程\n\n> 一看__`根目录结构`__\n> 二看__`README.md、package.json`__,\n> 三看__`代码架构`__（即源码子目录及代码思维）\n\n\n### 根目录结构\n\n```directory\n﹀ project\n  ﹥ build\n  ﹥ dist\n  ﹥ src\n     ------------\n     package.json\n     README.md\n-----------------\n     HISTORY.md\n```\n+ （目录）build 构建脚本文件(webpack，build)\n+ （目录）dist 发布文件\n+ （目录）src 开发文件（即项目源文件）\n+ （文件）package.json 配置文件\n+ （文件）README.md 项目信息（介绍说明、使用方式等）\n\n### README.md\n\n一个项目的介绍说明，使用方式等（开源项目会比较多具体内容）\n\n### package.json\n\n一个项目的配置情况\n\n```json\n{\n  \"name\": \"health\",\n  \"description\": \"阿里大健康项目\",\n  \"version\": \"2.0\",\n  \"scripts\": {\n    \"dev\": \"cross-env NODE_ENV=development webpack-dev-server --config build/webpack.dev.conf.js --hot --host 192.168.80.106 --port 8000\",\n    \"build\": \"node build/build.js\",\n  },\n  \"dependencies\": {\n    \"vue\": \"^2.3.3\",\n    \"vue-router\": \"^2.5.3\",\n    \"vuex\": \"^2.3.1\",\n    \"axios\": \"^0.16.2\",\n    \"hammerjs\": \"^2.0.8\",\n    \"echarts\": \"^3.6.1\",\n    \"vue-lazyload\": \"^1.0.6\",\n    \"vuex-router-sync\": \"^4.2.0\",\n    \"qs\": \"^6.4.0\"\n  },\n  \"devDependencies\": {}\n}\n\n```\n\n## 代码架构\n\n一个好的源码项目都是从合理、简单易懂的目录开始\n\n### 根目录\n\n```directory\n﹀ src\n  ﹥ assets（js、css、img）\n  ﹥ components（searchbar，remind，upload）\n  ﹥ directive（touch）\n  ﹥ filters（日期格式化）\n  ﹥ page\n  ﹥ plugins（toast，alert，confirm,loading）\n  ﹥ vuex\n     ------------\n     app.vue（index.vue）\n     main.js（index.js）\n     index.html\n     ------------\n     example.vue\n     example.js\n     example.html\n     ------------\n     vendor.js\n\n-----------------\n  ﹥ icons\n  ﹥ mixins\n```\n\n### page\n```directory\n﹀ page\n  ﹥ bbs\n     ﹥ components\n        home.vue\n        riji.vue\n        thread.vue\n  ﹥ home\n  ﹥ ovulate\n  ﹥ period\n  ﹥ temperature\n  ﹥ ultrasound\n  ﹥ example\n```\n\n### vuex\n\n<img src=\"/img/vue-ali-health/vuex.png\" alt=\"vuex\" />\n\n#### 1.0\n```directory\n﹀ vuex（1.0）\n  ﹥ home（首页）\n      index.js（state, actions, mutations）\n      getters.js\n  ﹥ bbs（社区）\n  ﹥ ovulate（试纸）\n  ﹥ period（日历）\n  ﹥ temperature（体温）\n  ﹥ ultrasound（B超）\n  ﹥ example\n     store.js（state, mutaions）\n     actions.js\n     getters.js\n```\n\n#### 2.0\n```directory\n﹀ vuex\n  ﹥ home（首页）（标准）\n      index.js（state）\n      actions.js\n      getters.js\n      mutations.js\n  ﹥ bbs（社区）（扩展）\n      ﹥ actions\n          digest.js\n          group.js\n          search.js\n          thread.js\n          riji.js\n          index.js\n      index.js\n      getters.js\n      mutations.js\n```\n\n\n## 代码\n\n### 接口url统一\n\n#### 1.0\n```js\n// actions.js\nconst = getThreads({ commit, rootState }, options = {}) => {\n  // 第一点：actions里面含有逻辑操作\n  commit('SetThreads', {\n    rerender: options.rerender,\n  });\n  axios\n    // 第二点：接口url不集中\n    .get(`//api.${rootState.domain}/resuful/threads.json`)\n    .then((res) => {\n      // 第三点：每次回调都需要判断是否为0\n      if (res.data.error_code === 0) {\n        commit('SetThread', res.data.data);\n        if (options.callback) {\n          options.callback();\n        }\n      } else {\n        commit('Alert', res.data.error_message);\n      }\n    })\n    .catch((err) => {\n      // 第四点：部分需求在网络异常的情况，还是可以继续往下执行\n    });\n}\n```\n\n```js\n// mutaions.js\nconst SetThreads = (state, data) => {\n  if (data.rerender) {\n    state.threads = [];\n    state.threadTotal = 0;\n  } else {\n    state.threads = data.list;\n    state.threadTotal = data.total;\n  }\n};\n```\n\n#### 2.0\n\n\n```js\n// actions.js\nimport apiurl from './apiurl';\nimport apitool from './apitool';\n// 第一点：外部自己判断是否清空操作 CleanThread();\nconst = getThreads({ commit, rootState }, ops) => {\n  const options = apitool.requestBeforeHandler(ops);\n  axios\n    // 第二点：接口url集中管理\n    .get(apiurl.threads)\n    .then((res) => {\n      // 第三点：统一回调处理\n      apitool.requestHandler(res, (data) => {\n        commit('SetThread', data);\n        options.success(data);\n      }, () => {\n        commit('Alert', data.error_message);\n      });\n      // 第三点：统一回调处理\n      apitool.requestHandler(res, options.success, options.error);\n      // 请求无论成功与否都需要继续往下执行\n      options.complate();\n    })\n    .catch((err) => {\n      // 第四点，通过 requestBeforeHandler 方式处理统一事件\n      options.complate();\n    });\n}\n```\n\n```js\n// mutaions.js\nconst SetThreads = (state, data) => {\n  state.threads = data.list;\n  state.threadsTotal = data.total;\n};\nconst CleanThreads = (state) => {\n  state.threads = [];\n  state.threadsTotal = 0;\n};\n```\n\n```js\n// apiUrl.js\nconst domain = window.location.href.match(/^(http|https):\\/\\/(\\w+)\\.([^\\/]+)\\//)[3];\nexport default {\n  // 用户信息\n  user: `//api.${domain}/resuful/user.json`,\n  // 帖子\n  threads: `//api.${domain}/resuful/threads.json`,\n  // 获取相关配置\n  config: `//api.${domain}/resuful/config.json`,\n  // 数据同步接口\n  sync: `//api.${domain}/resuful/sync.json`,\n};\n```\n\n### 按需加载\n\n```js\nconst bbs = require('./page/bbs/index.vue');\nconst index = require('./page/index.vue');\n\nconst bbs = () => import('./page/bbs/index.vue');\nconst index = () => import('./page/index.vue');\n```\n\n\n### 标题与登录\n\n```js\nimport store from './vuex/store';\nconst router = new VueRouter({\n  routes: [\n    {\n      path: '/index',\n      component: index,\n      name: 'index',\n      meta: {\n        title: '聚合页',\n      },\n    },\n    {\n      path: '/bbs',\n      component: bbs,\n      name: 'bbs',\n      meta: {\n        title: '社区',\n      },\n    },\n    {\n      path: '*',\n      redirect: '/index',\n      redirect: '/404',\n    },\n  ],\n});\nrouter.beforeEach((to, from, next) => {\n  // 设置标题\n  if (to.meta.title) {\n    document.title = to.meta.title;\n  }\n  if (store.state.isLogin) {\n    return next();\n  }\n  store.dispatch('submitLogin', {\n    success() {\n      // do something\n      next();\n    },\n    error() {\n      // do error something or next()\n    },\n  });\n});\n```\n\n### 多页面多路由\n\n由单页面多路由改为多页面多路由\n\n一开始，一些demo的展示，放在项目里面，导致打包的时候多了一些无用的demo代码在里面。\n这时候就需要抽取代码独立出demo页面。\n\n\n#### 1.0\n\n\n```js\n// build/webpack.base.conf.js\nmodule.exports = {\n  entry: {\n    vendor: './src/vendor',\n    index: [\n      './src/main.js',\n    ],\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'src/index.html',\n      chunks: ['vendor', 'manifest', 'index'],\n    }),\n  ]\n}\n```\n\n<!--(demo: button, icon, plugin, color)-->\n```js\n// src/main.js\nconst router = new VueRouter({\n  routes: [\n    {\n      path: '/demo',\n      component: demo,\n      name: 'demo',\n      meta: {\n        title: 'demo',\n      },\n    },\n  ],\n});\n```\n\n#### 2.0\n\n```js\n// build/webpack.base.conf.js\nmodule.exports = {\n  entry: {\n    vendor: './src/vendor',\n    index: [\n      './src/main.js',\n    ],\n    example: './src/example',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'src/index.html',\n      chunks: ['vendor', 'manifest', 'index'],\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'example.html',\n      template: 'src/example.html',\n      chunks: ['vendor', 'manifest', 'example'],\n    }),\n  ]\n}\n```\n\n### 路由缓存问题\n\n每次返回上一页时都能够回到原来浏览的位置\n\n#### 保存浏览记录\n\n```js\n// mutations\nconst UpdatePosition = (state, data = {}) {\n  state.position[data.key] = data.value;\n},\n```\n\n#### js入口文件\n```js\n// src/main.js\nconst router = new VueRouter({\n  // scrollBehavior 淘宝app里面无效\n  scrollBehavior(to, from, savedPosition) {\n    return savedPosition;\n  },\n  routes: [\n    {\n      path: '/index',\n      component: index,\n      name: 'index',\n      meta: {\n        title: '聚合页',\n        keepAlive: true,\n      },\n    },\n    {\n      path: '/bbs',\n      component: bbs,\n      name: 'bbs',\n      meta: {\n        title: '社区',\n        keepAlive: true,\n      },\n      children: [\n        {\n          path: '',\n          component: bbsIndex,\n          name: 'bbsIndex',\n          meta: {\n            title: '姐妹讨论圈',\n            keepAlive: true,\n          },\n        },\n        {\n          path: 'thread/:tid',\n          component: bbsThread,\n          name: 'bbsThread',\n          meta: {\n            title: '帖子详情',\n            keepAlive: true,\n          },\n        },\n      ],\n    },\n    {\n      path: '*',\n      redirect: '/index',\n    },\n  ],\n});\n```\n\n#### vue入口文件\n\n```html\n// src/app.vue\n<template>\n  <div id=\"app\">\n    <keep-alive>\n      <router-view v-if=\"$route.meta.keepAlive\"></router-view>\n    </keep-alive>\n    <router-view v-if=\"!$route.meta.keepAlive\"></router-view>\n  </div>    \n</template>\n<script>\nexport default {\n  methods: {\n    updatePosition(path, scrollTop) {\n      this.UpdatePosition({\n        key: path,\n        value: scrollTop,\n      });\n    },\n  },\n  mounted() {\n    const self = this;\n    // 滚动定位\n    self.handler = () => {\n      if (self.routeName.match(/(index|bbsIndex|bbsThread)/)) {\n        self.updatePosition(self.routeName, document.body.scrollTop);\n      }\n    };\n  },\n  watch: {\n    routeName(routeName) {\n      // 路由定位监听\n      if (routeName.match(/index|bbsIndex|bbsThread/)) {\n        setTimeout(() => {\n          document.removeEventListener('scroll', self.handler, false);\n          document.addEventListener('scroll', self.handler, false);\n        }, 1000);\n      }\n      // 路由定位清除\n      if (routeName === 'indexBeiyun' || routeName === 'indexMenses') {\n        self.updatePosition('bbsIndex', 0);\n        self.updatePosition('bbsThread', 0);\n        self.updatePosition('bbsRiji', 0);\n      } else if (routeName.match(/bbsIndex/)) {\n        self.updatePosition('bbsThread', 0);\n      }\n    },\n  },\n  beforeDestroy () {\n    document.removeEventListener('scroll', this.handler, false);\n  },\n};\n</script>\n```\n\n#### 各个模块脚本\n```js\n// src/page/home/index.vue\nexport default {\n  activated() {\n    document.body.scrollTop = this.position.index;\n  },\n}\n\n// src/page/bbs/index.vue\nexport default {\n  activated() {\n    document.body.scrollTop = this.position.bbs;\n  },\n}\n\n// src/page/bbs/thread.vue\nexport default {\n  activated() {\n    document.body.scrollTop = this.position.bbsThread;\n  },\n}\n```\n\n### 路由跳转问题\n\n#### 提交后返回原路由\n\n原来的跳转流程，多次返回才能回到首页\n\n+ 首页（点击B超测排）（push route）\n+ B超测排（点击填写报告）（push route）\n+ B超报告页（点击保存）（push route）\n+ B超测排（左上角返回）\n\n优化后的跳转流程，一次返回直接回到首页\n\n+ 首页（点击B超测排）（push route）\n+ B超测排（点击填写报告）（push route）\n+ B超报告页（点击保存）（go(-1)）\n\n#### 提交后去到新路由\n\n原来的跳转流程，多次返回才能回到首页\n\n+ 首页（点击发帖）（push route）\n+ 发帖页（点击发送）（push route）\n+ 群组选择页（点击发布）（push route）\n+ 帖子详情页（左上角返回）\n\n优化后的跳转流程，一次返回直接回到首页\n\n步骤一：\n\n+ 首页（点击发帖）（push route）\n+ 发帖页（点击发送）（push route）\n+ 群组选择页（点击发布）（go(-1)）\n\n步骤二：\n\n+ 首页（点击发帖）（push route）\n+ 发帖页（replace route）\n\n步骤三：\n\n+ 首页（点击发帖）（push route）\n+ 帖子详情页（左上角返回）\n\n```js\n// src/page/bbs/select_group.vue\n// 发帖后，保留发帖tid\npostThread({\n  success(data) {\n    self.SetPostTid(data.tid);\n    self.$route.go(-1);\n  },\n});\n```\n\n```js\n// src/page/bbs/post.vue\n// 发帖页发现存在发帖tid，立即跳转到帖子页\nif (this.postTid) {\n  this.$route.replace(this.getRoute(`/bbs/thread/${this.postTid}`), () => {\n    self.CleanPostTid();\n  });\n}\n```\n\n### 后续\n\n+ 统计\n+ 目录：icons，mixins\n+ 打包：build优化\n+ 考虑转场动画","source":"_posts/vue-ali-health.md","raw":"---\ntitle: 健康项目review\ndate: 2017-09-10\ntags:\n - vue\n - javascript\n - review\n---\n\n## 两个主题\n\n阿里健康项目的__`《review过程》`__，及遇到的__`《坑》`__\n<!--more-->\n\n\n## review过程\n\n> 一看__`根目录结构`__\n> 二看__`README.md、package.json`__,\n> 三看__`代码架构`__（即源码子目录及代码思维）\n\n\n### 根目录结构\n\n```directory\n﹀ project\n  ﹥ build\n  ﹥ dist\n  ﹥ src\n     ------------\n     package.json\n     README.md\n-----------------\n     HISTORY.md\n```\n+ （目录）build 构建脚本文件(webpack，build)\n+ （目录）dist 发布文件\n+ （目录）src 开发文件（即项目源文件）\n+ （文件）package.json 配置文件\n+ （文件）README.md 项目信息（介绍说明、使用方式等）\n\n### README.md\n\n一个项目的介绍说明，使用方式等（开源项目会比较多具体内容）\n\n### package.json\n\n一个项目的配置情况\n\n```json\n{\n  \"name\": \"health\",\n  \"description\": \"阿里大健康项目\",\n  \"version\": \"2.0\",\n  \"scripts\": {\n    \"dev\": \"cross-env NODE_ENV=development webpack-dev-server --config build/webpack.dev.conf.js --hot --host 192.168.80.106 --port 8000\",\n    \"build\": \"node build/build.js\",\n  },\n  \"dependencies\": {\n    \"vue\": \"^2.3.3\",\n    \"vue-router\": \"^2.5.3\",\n    \"vuex\": \"^2.3.1\",\n    \"axios\": \"^0.16.2\",\n    \"hammerjs\": \"^2.0.8\",\n    \"echarts\": \"^3.6.1\",\n    \"vue-lazyload\": \"^1.0.6\",\n    \"vuex-router-sync\": \"^4.2.0\",\n    \"qs\": \"^6.4.0\"\n  },\n  \"devDependencies\": {}\n}\n\n```\n\n## 代码架构\n\n一个好的源码项目都是从合理、简单易懂的目录开始\n\n### 根目录\n\n```directory\n﹀ src\n  ﹥ assets（js、css、img）\n  ﹥ components（searchbar，remind，upload）\n  ﹥ directive（touch）\n  ﹥ filters（日期格式化）\n  ﹥ page\n  ﹥ plugins（toast，alert，confirm,loading）\n  ﹥ vuex\n     ------------\n     app.vue（index.vue）\n     main.js（index.js）\n     index.html\n     ------------\n     example.vue\n     example.js\n     example.html\n     ------------\n     vendor.js\n\n-----------------\n  ﹥ icons\n  ﹥ mixins\n```\n\n### page\n```directory\n﹀ page\n  ﹥ bbs\n     ﹥ components\n        home.vue\n        riji.vue\n        thread.vue\n  ﹥ home\n  ﹥ ovulate\n  ﹥ period\n  ﹥ temperature\n  ﹥ ultrasound\n  ﹥ example\n```\n\n### vuex\n\n<img src=\"/img/vue-ali-health/vuex.png\" alt=\"vuex\" />\n\n#### 1.0\n```directory\n﹀ vuex（1.0）\n  ﹥ home（首页）\n      index.js（state, actions, mutations）\n      getters.js\n  ﹥ bbs（社区）\n  ﹥ ovulate（试纸）\n  ﹥ period（日历）\n  ﹥ temperature（体温）\n  ﹥ ultrasound（B超）\n  ﹥ example\n     store.js（state, mutaions）\n     actions.js\n     getters.js\n```\n\n#### 2.0\n```directory\n﹀ vuex\n  ﹥ home（首页）（标准）\n      index.js（state）\n      actions.js\n      getters.js\n      mutations.js\n  ﹥ bbs（社区）（扩展）\n      ﹥ actions\n          digest.js\n          group.js\n          search.js\n          thread.js\n          riji.js\n          index.js\n      index.js\n      getters.js\n      mutations.js\n```\n\n\n## 代码\n\n### 接口url统一\n\n#### 1.0\n```js\n// actions.js\nconst = getThreads({ commit, rootState }, options = {}) => {\n  // 第一点：actions里面含有逻辑操作\n  commit('SetThreads', {\n    rerender: options.rerender,\n  });\n  axios\n    // 第二点：接口url不集中\n    .get(`//api.${rootState.domain}/resuful/threads.json`)\n    .then((res) => {\n      // 第三点：每次回调都需要判断是否为0\n      if (res.data.error_code === 0) {\n        commit('SetThread', res.data.data);\n        if (options.callback) {\n          options.callback();\n        }\n      } else {\n        commit('Alert', res.data.error_message);\n      }\n    })\n    .catch((err) => {\n      // 第四点：部分需求在网络异常的情况，还是可以继续往下执行\n    });\n}\n```\n\n```js\n// mutaions.js\nconst SetThreads = (state, data) => {\n  if (data.rerender) {\n    state.threads = [];\n    state.threadTotal = 0;\n  } else {\n    state.threads = data.list;\n    state.threadTotal = data.total;\n  }\n};\n```\n\n#### 2.0\n\n\n```js\n// actions.js\nimport apiurl from './apiurl';\nimport apitool from './apitool';\n// 第一点：外部自己判断是否清空操作 CleanThread();\nconst = getThreads({ commit, rootState }, ops) => {\n  const options = apitool.requestBeforeHandler(ops);\n  axios\n    // 第二点：接口url集中管理\n    .get(apiurl.threads)\n    .then((res) => {\n      // 第三点：统一回调处理\n      apitool.requestHandler(res, (data) => {\n        commit('SetThread', data);\n        options.success(data);\n      }, () => {\n        commit('Alert', data.error_message);\n      });\n      // 第三点：统一回调处理\n      apitool.requestHandler(res, options.success, options.error);\n      // 请求无论成功与否都需要继续往下执行\n      options.complate();\n    })\n    .catch((err) => {\n      // 第四点，通过 requestBeforeHandler 方式处理统一事件\n      options.complate();\n    });\n}\n```\n\n```js\n// mutaions.js\nconst SetThreads = (state, data) => {\n  state.threads = data.list;\n  state.threadsTotal = data.total;\n};\nconst CleanThreads = (state) => {\n  state.threads = [];\n  state.threadsTotal = 0;\n};\n```\n\n```js\n// apiUrl.js\nconst domain = window.location.href.match(/^(http|https):\\/\\/(\\w+)\\.([^\\/]+)\\//)[3];\nexport default {\n  // 用户信息\n  user: `//api.${domain}/resuful/user.json`,\n  // 帖子\n  threads: `//api.${domain}/resuful/threads.json`,\n  // 获取相关配置\n  config: `//api.${domain}/resuful/config.json`,\n  // 数据同步接口\n  sync: `//api.${domain}/resuful/sync.json`,\n};\n```\n\n### 按需加载\n\n```js\nconst bbs = require('./page/bbs/index.vue');\nconst index = require('./page/index.vue');\n\nconst bbs = () => import('./page/bbs/index.vue');\nconst index = () => import('./page/index.vue');\n```\n\n\n### 标题与登录\n\n```js\nimport store from './vuex/store';\nconst router = new VueRouter({\n  routes: [\n    {\n      path: '/index',\n      component: index,\n      name: 'index',\n      meta: {\n        title: '聚合页',\n      },\n    },\n    {\n      path: '/bbs',\n      component: bbs,\n      name: 'bbs',\n      meta: {\n        title: '社区',\n      },\n    },\n    {\n      path: '*',\n      redirect: '/index',\n      redirect: '/404',\n    },\n  ],\n});\nrouter.beforeEach((to, from, next) => {\n  // 设置标题\n  if (to.meta.title) {\n    document.title = to.meta.title;\n  }\n  if (store.state.isLogin) {\n    return next();\n  }\n  store.dispatch('submitLogin', {\n    success() {\n      // do something\n      next();\n    },\n    error() {\n      // do error something or next()\n    },\n  });\n});\n```\n\n### 多页面多路由\n\n由单页面多路由改为多页面多路由\n\n一开始，一些demo的展示，放在项目里面，导致打包的时候多了一些无用的demo代码在里面。\n这时候就需要抽取代码独立出demo页面。\n\n\n#### 1.0\n\n\n```js\n// build/webpack.base.conf.js\nmodule.exports = {\n  entry: {\n    vendor: './src/vendor',\n    index: [\n      './src/main.js',\n    ],\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'src/index.html',\n      chunks: ['vendor', 'manifest', 'index'],\n    }),\n  ]\n}\n```\n\n<!--(demo: button, icon, plugin, color)-->\n```js\n// src/main.js\nconst router = new VueRouter({\n  routes: [\n    {\n      path: '/demo',\n      component: demo,\n      name: 'demo',\n      meta: {\n        title: 'demo',\n      },\n    },\n  ],\n});\n```\n\n#### 2.0\n\n```js\n// build/webpack.base.conf.js\nmodule.exports = {\n  entry: {\n    vendor: './src/vendor',\n    index: [\n      './src/main.js',\n    ],\n    example: './src/example',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'src/index.html',\n      chunks: ['vendor', 'manifest', 'index'],\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'example.html',\n      template: 'src/example.html',\n      chunks: ['vendor', 'manifest', 'example'],\n    }),\n  ]\n}\n```\n\n### 路由缓存问题\n\n每次返回上一页时都能够回到原来浏览的位置\n\n#### 保存浏览记录\n\n```js\n// mutations\nconst UpdatePosition = (state, data = {}) {\n  state.position[data.key] = data.value;\n},\n```\n\n#### js入口文件\n```js\n// src/main.js\nconst router = new VueRouter({\n  // scrollBehavior 淘宝app里面无效\n  scrollBehavior(to, from, savedPosition) {\n    return savedPosition;\n  },\n  routes: [\n    {\n      path: '/index',\n      component: index,\n      name: 'index',\n      meta: {\n        title: '聚合页',\n        keepAlive: true,\n      },\n    },\n    {\n      path: '/bbs',\n      component: bbs,\n      name: 'bbs',\n      meta: {\n        title: '社区',\n        keepAlive: true,\n      },\n      children: [\n        {\n          path: '',\n          component: bbsIndex,\n          name: 'bbsIndex',\n          meta: {\n            title: '姐妹讨论圈',\n            keepAlive: true,\n          },\n        },\n        {\n          path: 'thread/:tid',\n          component: bbsThread,\n          name: 'bbsThread',\n          meta: {\n            title: '帖子详情',\n            keepAlive: true,\n          },\n        },\n      ],\n    },\n    {\n      path: '*',\n      redirect: '/index',\n    },\n  ],\n});\n```\n\n#### vue入口文件\n\n```html\n// src/app.vue\n<template>\n  <div id=\"app\">\n    <keep-alive>\n      <router-view v-if=\"$route.meta.keepAlive\"></router-view>\n    </keep-alive>\n    <router-view v-if=\"!$route.meta.keepAlive\"></router-view>\n  </div>    \n</template>\n<script>\nexport default {\n  methods: {\n    updatePosition(path, scrollTop) {\n      this.UpdatePosition({\n        key: path,\n        value: scrollTop,\n      });\n    },\n  },\n  mounted() {\n    const self = this;\n    // 滚动定位\n    self.handler = () => {\n      if (self.routeName.match(/(index|bbsIndex|bbsThread)/)) {\n        self.updatePosition(self.routeName, document.body.scrollTop);\n      }\n    };\n  },\n  watch: {\n    routeName(routeName) {\n      // 路由定位监听\n      if (routeName.match(/index|bbsIndex|bbsThread/)) {\n        setTimeout(() => {\n          document.removeEventListener('scroll', self.handler, false);\n          document.addEventListener('scroll', self.handler, false);\n        }, 1000);\n      }\n      // 路由定位清除\n      if (routeName === 'indexBeiyun' || routeName === 'indexMenses') {\n        self.updatePosition('bbsIndex', 0);\n        self.updatePosition('bbsThread', 0);\n        self.updatePosition('bbsRiji', 0);\n      } else if (routeName.match(/bbsIndex/)) {\n        self.updatePosition('bbsThread', 0);\n      }\n    },\n  },\n  beforeDestroy () {\n    document.removeEventListener('scroll', this.handler, false);\n  },\n};\n</script>\n```\n\n#### 各个模块脚本\n```js\n// src/page/home/index.vue\nexport default {\n  activated() {\n    document.body.scrollTop = this.position.index;\n  },\n}\n\n// src/page/bbs/index.vue\nexport default {\n  activated() {\n    document.body.scrollTop = this.position.bbs;\n  },\n}\n\n// src/page/bbs/thread.vue\nexport default {\n  activated() {\n    document.body.scrollTop = this.position.bbsThread;\n  },\n}\n```\n\n### 路由跳转问题\n\n#### 提交后返回原路由\n\n原来的跳转流程，多次返回才能回到首页\n\n+ 首页（点击B超测排）（push route）\n+ B超测排（点击填写报告）（push route）\n+ B超报告页（点击保存）（push route）\n+ B超测排（左上角返回）\n\n优化后的跳转流程，一次返回直接回到首页\n\n+ 首页（点击B超测排）（push route）\n+ B超测排（点击填写报告）（push route）\n+ B超报告页（点击保存）（go(-1)）\n\n#### 提交后去到新路由\n\n原来的跳转流程，多次返回才能回到首页\n\n+ 首页（点击发帖）（push route）\n+ 发帖页（点击发送）（push route）\n+ 群组选择页（点击发布）（push route）\n+ 帖子详情页（左上角返回）\n\n优化后的跳转流程，一次返回直接回到首页\n\n步骤一：\n\n+ 首页（点击发帖）（push route）\n+ 发帖页（点击发送）（push route）\n+ 群组选择页（点击发布）（go(-1)）\n\n步骤二：\n\n+ 首页（点击发帖）（push route）\n+ 发帖页（replace route）\n\n步骤三：\n\n+ 首页（点击发帖）（push route）\n+ 帖子详情页（左上角返回）\n\n```js\n// src/page/bbs/select_group.vue\n// 发帖后，保留发帖tid\npostThread({\n  success(data) {\n    self.SetPostTid(data.tid);\n    self.$route.go(-1);\n  },\n});\n```\n\n```js\n// src/page/bbs/post.vue\n// 发帖页发现存在发帖tid，立即跳转到帖子页\nif (this.postTid) {\n  this.$route.replace(this.getRoute(`/bbs/thread/${this.postTid}`), () => {\n    self.CleanPostTid();\n  });\n}\n```\n\n### 后续\n\n+ 统计\n+ 目录：icons，mixins\n+ 打包：build优化\n+ 考虑转场动画","slug":"vue-ali-health","published":1,"updated":"2017-09-19T09:53:41.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oei0022uo2e934fm1ep","content":"<h2 id=\"两个主题\"><a href=\"#两个主题\" class=\"headerlink\" title=\"两个主题\"></a>两个主题</h2><p>阿里健康项目的<strong><code>《review过程》</code></strong>，及遇到的<strong><code>《坑》</code></strong><br><a id=\"more\"></a></p>\n<h2 id=\"review过程\"><a href=\"#review过程\" class=\"headerlink\" title=\"review过程\"></a>review过程</h2><blockquote>\n<p>一看<strong><code>根目录结构</code></strong><br>二看<strong><code>README.md、package.json</code></strong>,<br>三看<strong><code>代码架构</code></strong>（即源码子目录及代码思维）</p>\n</blockquote>\n<h3 id=\"根目录结构\"><a href=\"#根目录结构\" class=\"headerlink\" title=\"根目录结构\"></a>根目录结构</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ project</span><br><span class=\"line\">  ﹥ build</span><br><span class=\"line\">  ﹥ dist</span><br><span class=\"line\">  ﹥ src</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     package.json</span><br><span class=\"line\">     README.md</span><br><span class=\"line\">-----------------</span><br><span class=\"line\">     HISTORY.md</span><br></pre></td></tr></table></figure>\n<ul>\n<li>（目录）build 构建脚本文件(webpack，build)</li>\n<li>（目录）dist 发布文件</li>\n<li>（目录）src 开发文件（即项目源文件）</li>\n<li>（文件）package.json 配置文件</li>\n<li>（文件）README.md 项目信息（介绍说明、使用方式等）</li>\n</ul>\n<h3 id=\"README-md\"><a href=\"#README-md\" class=\"headerlink\" title=\"README.md\"></a>README.md</h3><p>一个项目的介绍说明，使用方式等（开源项目会比较多具体内容）</p>\n<h3 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h3><p>一个项目的配置情况</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"health\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"阿里大健康项目\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"2.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server --config build/webpack.dev.conf.js --hot --host 192.168.80.106 --port 8000\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"node build/build.js\"</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"dependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"vue\"</span>: <span class=\"string\">\"^2.3.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vue-router\"</span>: <span class=\"string\">\"^2.5.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vuex\"</span>: <span class=\"string\">\"^2.3.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"axios\"</span>: <span class=\"string\">\"^0.16.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"hammerjs\"</span>: <span class=\"string\">\"^2.0.8\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"echarts\"</span>: <span class=\"string\">\"^3.6.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vue-lazyload\"</span>: <span class=\"string\">\"^1.0.6\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vuex-router-sync\"</span>: <span class=\"string\">\"^4.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"qs\"</span>: <span class=\"string\">\"^6.4.0\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"devDependencies\"</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"代码架构\"><a href=\"#代码架构\" class=\"headerlink\" title=\"代码架构\"></a>代码架构</h2><p>一个好的源码项目都是从合理、简单易懂的目录开始</p>\n<h3 id=\"根目录\"><a href=\"#根目录\" class=\"headerlink\" title=\"根目录\"></a>根目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ src</span><br><span class=\"line\">  ﹥ assets（js、css、img）</span><br><span class=\"line\">  ﹥ components（searchbar，remind，upload）</span><br><span class=\"line\">  ﹥ directive（touch）</span><br><span class=\"line\">  ﹥ filters（日期格式化）</span><br><span class=\"line\">  ﹥ page</span><br><span class=\"line\">  ﹥ plugins（toast，alert，confirm,loading）</span><br><span class=\"line\">  ﹥ vuex</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     app.vue（index.vue）</span><br><span class=\"line\">     main.js（index.js）</span><br><span class=\"line\">     index.html</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     example.vue</span><br><span class=\"line\">     example.js</span><br><span class=\"line\">     example.html</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     vendor.js</span><br><span class=\"line\"></span><br><span class=\"line\">-----------------</span><br><span class=\"line\">  ﹥ icons</span><br><span class=\"line\">  ﹥ mixins</span><br></pre></td></tr></table></figure>\n<h3 id=\"page\"><a href=\"#page\" class=\"headerlink\" title=\"page\"></a>page</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ page</span><br><span class=\"line\">  ﹥ bbs</span><br><span class=\"line\">     ﹥ components</span><br><span class=\"line\">        home.vue</span><br><span class=\"line\">        riji.vue</span><br><span class=\"line\">        thread.vue</span><br><span class=\"line\">  ﹥ home</span><br><span class=\"line\">  ﹥ ovulate</span><br><span class=\"line\">  ﹥ period</span><br><span class=\"line\">  ﹥ temperature</span><br><span class=\"line\">  ﹥ ultrasound</span><br><span class=\"line\">  ﹥ example</span><br></pre></td></tr></table></figure>\n<h3 id=\"vuex\"><a href=\"#vuex\" class=\"headerlink\" title=\"vuex\"></a>vuex</h3><p><img src=\"/img/vue-ali-health/vuex.png\" alt=\"vuex\"></p>\n<h4 id=\"1-0\"><a href=\"#1-0\" class=\"headerlink\" title=\"1.0\"></a>1.0</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ vuex（1.0）</span><br><span class=\"line\">  ﹥ home（首页）</span><br><span class=\"line\">      index.js（state, actions, mutations）</span><br><span class=\"line\">      getters.js</span><br><span class=\"line\">  ﹥ bbs（社区）</span><br><span class=\"line\">  ﹥ ovulate（试纸）</span><br><span class=\"line\">  ﹥ period（日历）</span><br><span class=\"line\">  ﹥ temperature（体温）</span><br><span class=\"line\">  ﹥ ultrasound（B超）</span><br><span class=\"line\">  ﹥ example</span><br><span class=\"line\">     store.js（state, mutaions）</span><br><span class=\"line\">     actions.js</span><br><span class=\"line\">     getters.js</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-0\"><a href=\"#2-0\" class=\"headerlink\" title=\"2.0\"></a>2.0</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ vuex</span><br><span class=\"line\">  ﹥ home（首页）（标准）</span><br><span class=\"line\">      index.js（state）</span><br><span class=\"line\">      actions.js</span><br><span class=\"line\">      getters.js</span><br><span class=\"line\">      mutations.js</span><br><span class=\"line\">  ﹥ bbs（社区）（扩展）</span><br><span class=\"line\">      ﹥ actions</span><br><span class=\"line\">          digest.js</span><br><span class=\"line\">          group.js</span><br><span class=\"line\">          search.js</span><br><span class=\"line\">          thread.js</span><br><span class=\"line\">          riji.js</span><br><span class=\"line\">          index.js</span><br><span class=\"line\">      index.js</span><br><span class=\"line\">      getters.js</span><br><span class=\"line\">      mutations.js</span><br></pre></td></tr></table></figure>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"接口url统一\"><a href=\"#接口url统一\" class=\"headerlink\" title=\"接口url统一\"></a>接口url统一</h3><h4 id=\"1-0-1\"><a href=\"#1-0-1\" class=\"headerlink\" title=\"1.0\"></a>1.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// actions.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> = getThreads(&#123; commit, rootState &#125;, options = &#123;&#125;) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 第一点：actions里面含有逻辑操作</span></span><br><span class=\"line\">  commit(<span class=\"string\">'SetThreads'</span>, &#123;</span><br><span class=\"line\">    rerender: options.rerender,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  axios</span><br><span class=\"line\">    <span class=\"comment\">// 第二点：接口url不集中</span></span><br><span class=\"line\">    .get(<span class=\"string\">`//api.<span class=\"subst\">$&#123;rootState.domain&#125;</span>/resuful/threads.json`</span>)</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第三点：每次回调都需要判断是否为0</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (res.data.error_code === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'SetThread'</span>, res.data.data);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (options.callback) &#123;</span><br><span class=\"line\">          options.callback();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'Alert'</span>, res.data.error_message);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第四点：部分需求在网络异常的情况，还是可以继续往下执行</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mutaions.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> SetThreads = <span class=\"function\">(<span class=\"params\">state, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data.rerender) &#123;</span><br><span class=\"line\">    state.threads = [];</span><br><span class=\"line\">    state.threadTotal = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    state.threads = data.list;</span><br><span class=\"line\">    state.threadTotal = data.total;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-0-1\"><a href=\"#2-0-1\" class=\"headerlink\" title=\"2.0\"></a>2.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// actions.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> apiurl <span class=\"keyword\">from</span> <span class=\"string\">'./apiurl'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> apitool <span class=\"keyword\">from</span> <span class=\"string\">'./apitool'</span>;</span><br><span class=\"line\"><span class=\"comment\">// 第一点：外部自己判断是否清空操作 CleanThread();</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> = getThreads(&#123; commit, rootState &#125;, ops) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = apitool.requestBeforeHandler(ops);</span><br><span class=\"line\">  axios</span><br><span class=\"line\">    <span class=\"comment\">// 第二点：接口url集中管理</span></span><br><span class=\"line\">    .get(apiurl.threads)</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第三点：统一回调处理</span></span><br><span class=\"line\">      apitool.requestHandler(res, (data) =&gt; &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'SetThread'</span>, data);</span><br><span class=\"line\">        options.success(data);</span><br><span class=\"line\">      &#125;, () =&gt; &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'Alert'</span>, data.error_message);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"comment\">// 第三点：统一回调处理</span></span><br><span class=\"line\">      apitool.requestHandler(res, options.success, options.error);</span><br><span class=\"line\">      <span class=\"comment\">// 请求无论成功与否都需要继续往下执行</span></span><br><span class=\"line\">      options.complate();</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第四点，通过 requestBeforeHandler 方式处理统一事件</span></span><br><span class=\"line\">      options.complate();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mutaions.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> SetThreads = <span class=\"function\">(<span class=\"params\">state, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  state.threads = data.list;</span><br><span class=\"line\">  state.threadsTotal = data.total;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> CleanThreads = <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  state.threads = [];</span><br><span class=\"line\">  state.threadsTotal = <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// apiUrl.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> domain = <span class=\"built_in\">window</span>.location.href.match(<span class=\"regexp\">/^(http|https):\\/\\/(\\w+)\\.([^\\/]+)\\//</span>)[<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 用户信息</span></span><br><span class=\"line\">  user: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/user.json`</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 帖子</span></span><br><span class=\"line\">  threads: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/threads.json`</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 获取相关配置</span></span><br><span class=\"line\">  config: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/config.json`</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 数据同步接口</span></span><br><span class=\"line\">  sync: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/sync.json`</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"按需加载\"><a href=\"#按需加载\" class=\"headerlink\" title=\"按需加载\"></a>按需加载</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bbs = <span class=\"built_in\">require</span>(<span class=\"string\">'./page/bbs/index.vue'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> index = <span class=\"built_in\">require</span>(<span class=\"string\">'./page/index.vue'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> bbs = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'./page/bbs/index.vue'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> index = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'./page/index.vue'</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"标题与登录\"><a href=\"#标题与登录\" class=\"headerlink\" title=\"标题与登录\"></a>标题与登录</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">'./vuex/store'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">      component: index,</span><br><span class=\"line\">      name: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'聚合页'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/bbs'</span>,</span><br><span class=\"line\">      component: bbs,</span><br><span class=\"line\">      name: <span class=\"string\">'bbs'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'社区'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">      redirect: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">      redirect: <span class=\"string\">'/404'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.beforeEach(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 设置标题</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (to.meta.title) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = to.meta.title;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (store.state.isLogin) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  store.dispatch(<span class=\"string\">'submitLogin'</span>, &#123;</span><br><span class=\"line\">    success() &#123;</span><br><span class=\"line\">      <span class=\"comment\">// do something</span></span><br><span class=\"line\">      next();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    error() &#123;</span><br><span class=\"line\">      <span class=\"comment\">// do error something or next()</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"多页面多路由\"><a href=\"#多页面多路由\" class=\"headerlink\" title=\"多页面多路由\"></a>多页面多路由</h3><p>由单页面多路由改为多页面多路由</p>\n<p>一开始，一些demo的展示，放在项目里面，导致打包的时候多了一些无用的demo代码在里面。<br>这时候就需要抽取代码独立出demo页面。</p>\n<h4 id=\"1-0-2\"><a href=\"#1-0-2\" class=\"headerlink\" title=\"1.0\"></a>1.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    vendor: <span class=\"string\">'./src/vendor'</span>,</span><br><span class=\"line\">    index: [</span><br><span class=\"line\">      <span class=\"string\">'./src/main.js'</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'src/index.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span>, <span class=\"string\">'index'</span>],</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<!--(demo: button, icon, plugin, color)-->\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/main.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/demo'</span>,</span><br><span class=\"line\">      component: demo,</span><br><span class=\"line\">      name: <span class=\"string\">'demo'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'demo'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-0-2\"><a href=\"#2-0-2\" class=\"headerlink\" title=\"2.0\"></a>2.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    vendor: <span class=\"string\">'./src/vendor'</span>,</span><br><span class=\"line\">    index: [</span><br><span class=\"line\">      <span class=\"string\">'./src/main.js'</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    example: <span class=\"string\">'./src/example'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'src/index.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span>, <span class=\"string\">'index'</span>],</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'example.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'src/example.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span>, <span class=\"string\">'example'</span>],</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由缓存问题\"><a href=\"#路由缓存问题\" class=\"headerlink\" title=\"路由缓存问题\"></a>路由缓存问题</h3><p>每次返回上一页时都能够回到原来浏览的位置</p>\n<h4 id=\"保存浏览记录\"><a href=\"#保存浏览记录\" class=\"headerlink\" title=\"保存浏览记录\"></a>保存浏览记录</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mutations</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> UpdatePosition = (state, data = &#123;&#125;) &#123;</span><br><span class=\"line\">  state.position[data.key] = data.value;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h4 id=\"js入口文件\"><a href=\"#js入口文件\" class=\"headerlink\" title=\"js入口文件\"></a>js入口文件</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/main.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  <span class=\"comment\">// scrollBehavior 淘宝app里面无效</span></span><br><span class=\"line\">  scrollBehavior(to, <span class=\"keyword\">from</span>, savedPosition) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> savedPosition;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">      component: index,</span><br><span class=\"line\">      name: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'聚合页'</span>,</span><br><span class=\"line\">        keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/bbs'</span>,</span><br><span class=\"line\">      component: bbs,</span><br><span class=\"line\">      name: <span class=\"string\">'bbs'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'社区'</span>,</span><br><span class=\"line\">        keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          path: <span class=\"string\">''</span>,</span><br><span class=\"line\">          component: bbsIndex,</span><br><span class=\"line\">          name: <span class=\"string\">'bbsIndex'</span>,</span><br><span class=\"line\">          meta: &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'姐妹讨论圈'</span>,</span><br><span class=\"line\">            keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          path: <span class=\"string\">'thread/:tid'</span>,</span><br><span class=\"line\">          component: bbsThread,</span><br><span class=\"line\">          name: <span class=\"string\">'bbsThread'</span>,</span><br><span class=\"line\">          meta: &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'帖子详情'</span>,</span><br><span class=\"line\">            keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">      redirect: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"vue入口文件\"><a href=\"#vue入口文件\" class=\"headerlink\" title=\"vue入口文件\"></a>vue入口文件</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// src/app.vue</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"app\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">keep-alive</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">router-view</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"$route.meta.keepAlive\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">router-view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">keep-alive</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">router-view</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"!$route.meta.keepAlive\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">router-view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">  methods: &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">    updatePosition(path, scrollTop) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">this</span>.UpdatePosition(&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">        key: path,</span></span><br><span class=\"line\"><span class=\"undefined\">        value: scrollTop,</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;);</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  mounted() &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> self = <span class=\"keyword\">this</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 滚动定位</span></span></span><br><span class=\"line\"><span class=\"javascript\">    self.handler = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (self.routeName.match(<span class=\"regexp\">/(index|bbsIndex|bbsThread)/</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(self.routeName, <span class=\"built_in\">document</span>.body.scrollTop);</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  watch: &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">    routeName(routeName) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 路由定位监听</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (routeName.match(<span class=\"regexp\">/index|bbsIndex|bbsThread/</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.removeEventListener(<span class=\"string\">'scroll'</span>, self.handler, <span class=\"literal\">false</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'scroll'</span>, self.handler, <span class=\"literal\">false</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;, 1000);</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 路由定位清除</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (routeName === <span class=\"string\">'indexBeiyun'</span> || routeName === <span class=\"string\">'indexMenses'</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsIndex'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsThread'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsRiji'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (routeName.match(<span class=\"regexp\">/bbsIndex/</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsThread'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  beforeDestroy () &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.removeEventListener(<span class=\"string\">'scroll'</span>, <span class=\"keyword\">this</span>.handler, <span class=\"literal\">false</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">&#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"各个模块脚本\"><a href=\"#各个模块脚本\" class=\"headerlink\" title=\"各个模块脚本\"></a>各个模块脚本</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/page/home/index.vue</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  activated() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.scrollTop = <span class=\"keyword\">this</span>.position.index;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// src/page/bbs/index.vue</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  activated() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.scrollTop = <span class=\"keyword\">this</span>.position.bbs;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// src/page/bbs/thread.vue</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  activated() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.scrollTop = <span class=\"keyword\">this</span>.position.bbsThread;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由跳转问题\"><a href=\"#路由跳转问题\" class=\"headerlink\" title=\"路由跳转问题\"></a>路由跳转问题</h3><h4 id=\"提交后返回原路由\"><a href=\"#提交后返回原路由\" class=\"headerlink\" title=\"提交后返回原路由\"></a>提交后返回原路由</h4><p>原来的跳转流程，多次返回才能回到首页</p>\n<ul>\n<li>首页（点击B超测排）（push route）</li>\n<li>B超测排（点击填写报告）（push route）</li>\n<li>B超报告页（点击保存）（push route）</li>\n<li>B超测排（左上角返回）</li>\n</ul>\n<p>优化后的跳转流程，一次返回直接回到首页</p>\n<ul>\n<li>首页（点击B超测排）（push route）</li>\n<li>B超测排（点击填写报告）（push route）</li>\n<li>B超报告页（点击保存）（go(-1)）</li>\n</ul>\n<h4 id=\"提交后去到新路由\"><a href=\"#提交后去到新路由\" class=\"headerlink\" title=\"提交后去到新路由\"></a>提交后去到新路由</h4><p>原来的跳转流程，多次返回才能回到首页</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>发帖页（点击发送）（push route）</li>\n<li>群组选择页（点击发布）（push route）</li>\n<li>帖子详情页（左上角返回）</li>\n</ul>\n<p>优化后的跳转流程，一次返回直接回到首页</p>\n<p>步骤一：</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>发帖页（点击发送）（push route）</li>\n<li>群组选择页（点击发布）（go(-1)）</li>\n</ul>\n<p>步骤二：</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>发帖页（replace route）</li>\n</ul>\n<p>步骤三：</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>帖子详情页（左上角返回）</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/page/bbs/select_group.vue</span></span><br><span class=\"line\"><span class=\"comment\">// 发帖后，保留发帖tid</span></span><br><span class=\"line\">postThread(&#123;</span><br><span class=\"line\">  success(data) &#123;</span><br><span class=\"line\">    self.SetPostTid(data.tid);</span><br><span class=\"line\">    self.$route.go(<span class=\"number\">-1</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/page/bbs/post.vue</span></span><br><span class=\"line\"><span class=\"comment\">// 发帖页发现存在发帖tid，立即跳转到帖子页</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.postTid) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.$route.replace(<span class=\"keyword\">this</span>.getRoute(<span class=\"string\">`/bbs/thread/<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.postTid&#125;</span>`</span>), () =&gt; &#123;</span><br><span class=\"line\">    self.CleanPostTid();</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"后续\"><a href=\"#后续\" class=\"headerlink\" title=\"后续\"></a>后续</h3><ul>\n<li>统计</li>\n<li>目录：icons，mixins</li>\n<li>打包：build优化</li>\n<li>考虑转场动画</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"两个主题\"><a href=\"#两个主题\" class=\"headerlink\" title=\"两个主题\"></a>两个主题</h2><p>阿里健康项目的<strong><code>《review过程》</code></strong>，及遇到的<strong><code>《坑》</code></strong><br>","more":"</p>\n<h2 id=\"review过程\"><a href=\"#review过程\" class=\"headerlink\" title=\"review过程\"></a>review过程</h2><blockquote>\n<p>一看<strong><code>根目录结构</code></strong><br>二看<strong><code>README.md、package.json</code></strong>,<br>三看<strong><code>代码架构</code></strong>（即源码子目录及代码思维）</p>\n</blockquote>\n<h3 id=\"根目录结构\"><a href=\"#根目录结构\" class=\"headerlink\" title=\"根目录结构\"></a>根目录结构</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ project</span><br><span class=\"line\">  ﹥ build</span><br><span class=\"line\">  ﹥ dist</span><br><span class=\"line\">  ﹥ src</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     package.json</span><br><span class=\"line\">     README.md</span><br><span class=\"line\">-----------------</span><br><span class=\"line\">     HISTORY.md</span><br></pre></td></tr></table></figure>\n<ul>\n<li>（目录）build 构建脚本文件(webpack，build)</li>\n<li>（目录）dist 发布文件</li>\n<li>（目录）src 开发文件（即项目源文件）</li>\n<li>（文件）package.json 配置文件</li>\n<li>（文件）README.md 项目信息（介绍说明、使用方式等）</li>\n</ul>\n<h3 id=\"README-md\"><a href=\"#README-md\" class=\"headerlink\" title=\"README.md\"></a>README.md</h3><p>一个项目的介绍说明，使用方式等（开源项目会比较多具体内容）</p>\n<h3 id=\"package-json\"><a href=\"#package-json\" class=\"headerlink\" title=\"package.json\"></a>package.json</h3><p>一个项目的配置情况</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"health\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"阿里大健康项目\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"2.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"dev\"</span>: <span class=\"string\">\"cross-env NODE_ENV=development webpack-dev-server --config build/webpack.dev.conf.js --hot --host 192.168.80.106 --port 8000\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"build\"</span>: <span class=\"string\">\"node build/build.js\"</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"dependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"vue\"</span>: <span class=\"string\">\"^2.3.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vue-router\"</span>: <span class=\"string\">\"^2.5.3\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vuex\"</span>: <span class=\"string\">\"^2.3.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"axios\"</span>: <span class=\"string\">\"^0.16.2\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"hammerjs\"</span>: <span class=\"string\">\"^2.0.8\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"echarts\"</span>: <span class=\"string\">\"^3.6.1\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vue-lazyload\"</span>: <span class=\"string\">\"^1.0.6\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"vuex-router-sync\"</span>: <span class=\"string\">\"^4.2.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"qs\"</span>: <span class=\"string\">\"^6.4.0\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"devDependencies\"</span>: &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"代码架构\"><a href=\"#代码架构\" class=\"headerlink\" title=\"代码架构\"></a>代码架构</h2><p>一个好的源码项目都是从合理、简单易懂的目录开始</p>\n<h3 id=\"根目录\"><a href=\"#根目录\" class=\"headerlink\" title=\"根目录\"></a>根目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ src</span><br><span class=\"line\">  ﹥ assets（js、css、img）</span><br><span class=\"line\">  ﹥ components（searchbar，remind，upload）</span><br><span class=\"line\">  ﹥ directive（touch）</span><br><span class=\"line\">  ﹥ filters（日期格式化）</span><br><span class=\"line\">  ﹥ page</span><br><span class=\"line\">  ﹥ plugins（toast，alert，confirm,loading）</span><br><span class=\"line\">  ﹥ vuex</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     app.vue（index.vue）</span><br><span class=\"line\">     main.js（index.js）</span><br><span class=\"line\">     index.html</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     example.vue</span><br><span class=\"line\">     example.js</span><br><span class=\"line\">     example.html</span><br><span class=\"line\">     ------------</span><br><span class=\"line\">     vendor.js</span><br><span class=\"line\"></span><br><span class=\"line\">-----------------</span><br><span class=\"line\">  ﹥ icons</span><br><span class=\"line\">  ﹥ mixins</span><br></pre></td></tr></table></figure>\n<h3 id=\"page\"><a href=\"#page\" class=\"headerlink\" title=\"page\"></a>page</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ page</span><br><span class=\"line\">  ﹥ bbs</span><br><span class=\"line\">     ﹥ components</span><br><span class=\"line\">        home.vue</span><br><span class=\"line\">        riji.vue</span><br><span class=\"line\">        thread.vue</span><br><span class=\"line\">  ﹥ home</span><br><span class=\"line\">  ﹥ ovulate</span><br><span class=\"line\">  ﹥ period</span><br><span class=\"line\">  ﹥ temperature</span><br><span class=\"line\">  ﹥ ultrasound</span><br><span class=\"line\">  ﹥ example</span><br></pre></td></tr></table></figure>\n<h3 id=\"vuex\"><a href=\"#vuex\" class=\"headerlink\" title=\"vuex\"></a>vuex</h3><p><img src=\"/img/vue-ali-health/vuex.png\" alt=\"vuex\"></p>\n<h4 id=\"1-0\"><a href=\"#1-0\" class=\"headerlink\" title=\"1.0\"></a>1.0</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ vuex（1.0）</span><br><span class=\"line\">  ﹥ home（首页）</span><br><span class=\"line\">      index.js（state, actions, mutations）</span><br><span class=\"line\">      getters.js</span><br><span class=\"line\">  ﹥ bbs（社区）</span><br><span class=\"line\">  ﹥ ovulate（试纸）</span><br><span class=\"line\">  ﹥ period（日历）</span><br><span class=\"line\">  ﹥ temperature（体温）</span><br><span class=\"line\">  ﹥ ultrasound（B超）</span><br><span class=\"line\">  ﹥ example</span><br><span class=\"line\">     store.js（state, mutaions）</span><br><span class=\"line\">     actions.js</span><br><span class=\"line\">     getters.js</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-0\"><a href=\"#2-0\" class=\"headerlink\" title=\"2.0\"></a>2.0</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">﹀ vuex</span><br><span class=\"line\">  ﹥ home（首页）（标准）</span><br><span class=\"line\">      index.js（state）</span><br><span class=\"line\">      actions.js</span><br><span class=\"line\">      getters.js</span><br><span class=\"line\">      mutations.js</span><br><span class=\"line\">  ﹥ bbs（社区）（扩展）</span><br><span class=\"line\">      ﹥ actions</span><br><span class=\"line\">          digest.js</span><br><span class=\"line\">          group.js</span><br><span class=\"line\">          search.js</span><br><span class=\"line\">          thread.js</span><br><span class=\"line\">          riji.js</span><br><span class=\"line\">          index.js</span><br><span class=\"line\">      index.js</span><br><span class=\"line\">      getters.js</span><br><span class=\"line\">      mutations.js</span><br></pre></td></tr></table></figure>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"接口url统一\"><a href=\"#接口url统一\" class=\"headerlink\" title=\"接口url统一\"></a>接口url统一</h3><h4 id=\"1-0-1\"><a href=\"#1-0-1\" class=\"headerlink\" title=\"1.0\"></a>1.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// actions.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> = getThreads(&#123; commit, rootState &#125;, options = &#123;&#125;) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 第一点：actions里面含有逻辑操作</span></span><br><span class=\"line\">  commit(<span class=\"string\">'SetThreads'</span>, &#123;</span><br><span class=\"line\">    rerender: options.rerender,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  axios</span><br><span class=\"line\">    <span class=\"comment\">// 第二点：接口url不集中</span></span><br><span class=\"line\">    .get(<span class=\"string\">`//api.<span class=\"subst\">$&#123;rootState.domain&#125;</span>/resuful/threads.json`</span>)</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第三点：每次回调都需要判断是否为0</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (res.data.error_code === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'SetThread'</span>, res.data.data);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (options.callback) &#123;</span><br><span class=\"line\">          options.callback();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'Alert'</span>, res.data.error_message);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第四点：部分需求在网络异常的情况，还是可以继续往下执行</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mutaions.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> SetThreads = <span class=\"function\">(<span class=\"params\">state, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data.rerender) &#123;</span><br><span class=\"line\">    state.threads = [];</span><br><span class=\"line\">    state.threadTotal = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    state.threads = data.list;</span><br><span class=\"line\">    state.threadTotal = data.total;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-0-1\"><a href=\"#2-0-1\" class=\"headerlink\" title=\"2.0\"></a>2.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// actions.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> apiurl <span class=\"keyword\">from</span> <span class=\"string\">'./apiurl'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> apitool <span class=\"keyword\">from</span> <span class=\"string\">'./apitool'</span>;</span><br><span class=\"line\"><span class=\"comment\">// 第一点：外部自己判断是否清空操作 CleanThread();</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> = getThreads(&#123; commit, rootState &#125;, ops) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> options = apitool.requestBeforeHandler(ops);</span><br><span class=\"line\">  axios</span><br><span class=\"line\">    <span class=\"comment\">// 第二点：接口url集中管理</span></span><br><span class=\"line\">    .get(apiurl.threads)</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第三点：统一回调处理</span></span><br><span class=\"line\">      apitool.requestHandler(res, (data) =&gt; &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'SetThread'</span>, data);</span><br><span class=\"line\">        options.success(data);</span><br><span class=\"line\">      &#125;, () =&gt; &#123;</span><br><span class=\"line\">        commit(<span class=\"string\">'Alert'</span>, data.error_message);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"comment\">// 第三点：统一回调处理</span></span><br><span class=\"line\">      apitool.requestHandler(res, options.success, options.error);</span><br><span class=\"line\">      <span class=\"comment\">// 请求无论成功与否都需要继续往下执行</span></span><br><span class=\"line\">      options.complate();</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 第四点，通过 requestBeforeHandler 方式处理统一事件</span></span><br><span class=\"line\">      options.complate();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mutaions.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> SetThreads = <span class=\"function\">(<span class=\"params\">state, data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  state.threads = data.list;</span><br><span class=\"line\">  state.threadsTotal = data.total;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> CleanThreads = <span class=\"function\">(<span class=\"params\">state</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  state.threads = [];</span><br><span class=\"line\">  state.threadsTotal = <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// apiUrl.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> domain = <span class=\"built_in\">window</span>.location.href.match(<span class=\"regexp\">/^(http|https):\\/\\/(\\w+)\\.([^\\/]+)\\//</span>)[<span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 用户信息</span></span><br><span class=\"line\">  user: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/user.json`</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 帖子</span></span><br><span class=\"line\">  threads: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/threads.json`</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 获取相关配置</span></span><br><span class=\"line\">  config: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/config.json`</span>,</span><br><span class=\"line\">  <span class=\"comment\">// 数据同步接口</span></span><br><span class=\"line\">  sync: <span class=\"string\">`//api.<span class=\"subst\">$&#123;domain&#125;</span>/resuful/sync.json`</span>,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"按需加载\"><a href=\"#按需加载\" class=\"headerlink\" title=\"按需加载\"></a>按需加载</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> bbs = <span class=\"built_in\">require</span>(<span class=\"string\">'./page/bbs/index.vue'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> index = <span class=\"built_in\">require</span>(<span class=\"string\">'./page/index.vue'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> bbs = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'./page/bbs/index.vue'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> index = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">'./page/index.vue'</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"标题与登录\"><a href=\"#标题与登录\" class=\"headerlink\" title=\"标题与登录\"></a>标题与登录</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">'./vuex/store'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">      component: index,</span><br><span class=\"line\">      name: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'聚合页'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/bbs'</span>,</span><br><span class=\"line\">      component: bbs,</span><br><span class=\"line\">      name: <span class=\"string\">'bbs'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'社区'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">      redirect: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">      redirect: <span class=\"string\">'/404'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">router.beforeEach(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 设置标题</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (to.meta.title) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = to.meta.title;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (store.state.isLogin) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> next();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  store.dispatch(<span class=\"string\">'submitLogin'</span>, &#123;</span><br><span class=\"line\">    success() &#123;</span><br><span class=\"line\">      <span class=\"comment\">// do something</span></span><br><span class=\"line\">      next();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    error() &#123;</span><br><span class=\"line\">      <span class=\"comment\">// do error something or next()</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"多页面多路由\"><a href=\"#多页面多路由\" class=\"headerlink\" title=\"多页面多路由\"></a>多页面多路由</h3><p>由单页面多路由改为多页面多路由</p>\n<p>一开始，一些demo的展示，放在项目里面，导致打包的时候多了一些无用的demo代码在里面。<br>这时候就需要抽取代码独立出demo页面。</p>\n<h4 id=\"1-0-2\"><a href=\"#1-0-2\" class=\"headerlink\" title=\"1.0\"></a>1.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    vendor: <span class=\"string\">'./src/vendor'</span>,</span><br><span class=\"line\">    index: [</span><br><span class=\"line\">      <span class=\"string\">'./src/main.js'</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'src/index.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span>, <span class=\"string\">'index'</span>],</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<!--(demo: button, icon, plugin, color)-->\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/main.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/demo'</span>,</span><br><span class=\"line\">      component: demo,</span><br><span class=\"line\">      name: <span class=\"string\">'demo'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'demo'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-0-2\"><a href=\"#2-0-2\" class=\"headerlink\" title=\"2.0\"></a>2.0</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.base.conf.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    vendor: <span class=\"string\">'./src/vendor'</span>,</span><br><span class=\"line\">    index: [</span><br><span class=\"line\">      <span class=\"string\">'./src/main.js'</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    example: <span class=\"string\">'./src/example'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'src/index.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span>, <span class=\"string\">'index'</span>],</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'example.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'src/example.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'vendor'</span>, <span class=\"string\">'manifest'</span>, <span class=\"string\">'example'</span>],</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由缓存问题\"><a href=\"#路由缓存问题\" class=\"headerlink\" title=\"路由缓存问题\"></a>路由缓存问题</h3><p>每次返回上一页时都能够回到原来浏览的位置</p>\n<h4 id=\"保存浏览记录\"><a href=\"#保存浏览记录\" class=\"headerlink\" title=\"保存浏览记录\"></a>保存浏览记录</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mutations</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> UpdatePosition = (state, data = &#123;&#125;) &#123;</span><br><span class=\"line\">  state.position[data.key] = data.value;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h4 id=\"js入口文件\"><a href=\"#js入口文件\" class=\"headerlink\" title=\"js入口文件\"></a>js入口文件</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/main.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> VueRouter(&#123;</span><br><span class=\"line\">  <span class=\"comment\">// scrollBehavior 淘宝app里面无效</span></span><br><span class=\"line\">  scrollBehavior(to, <span class=\"keyword\">from</span>, savedPosition) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> savedPosition;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">      component: index,</span><br><span class=\"line\">      name: <span class=\"string\">'index'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'聚合页'</span>,</span><br><span class=\"line\">        keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'/bbs'</span>,</span><br><span class=\"line\">      component: bbs,</span><br><span class=\"line\">      name: <span class=\"string\">'bbs'</span>,</span><br><span class=\"line\">      meta: &#123;</span><br><span class=\"line\">        title: <span class=\"string\">'社区'</span>,</span><br><span class=\"line\">        keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          path: <span class=\"string\">''</span>,</span><br><span class=\"line\">          component: bbsIndex,</span><br><span class=\"line\">          name: <span class=\"string\">'bbsIndex'</span>,</span><br><span class=\"line\">          meta: &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'姐妹讨论圈'</span>,</span><br><span class=\"line\">            keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          path: <span class=\"string\">'thread/:tid'</span>,</span><br><span class=\"line\">          component: bbsThread,</span><br><span class=\"line\">          name: <span class=\"string\">'bbsThread'</span>,</span><br><span class=\"line\">          meta: &#123;</span><br><span class=\"line\">            title: <span class=\"string\">'帖子详情'</span>,</span><br><span class=\"line\">            keepAlive: <span class=\"literal\">true</span>,</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: <span class=\"string\">'*'</span>,</span><br><span class=\"line\">      redirect: <span class=\"string\">'/index'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"vue入口文件\"><a href=\"#vue入口文件\" class=\"headerlink\" title=\"vue入口文件\"></a>vue入口文件</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// src/app.vue</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"app\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">keep-alive</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">router-view</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"$route.meta.keepAlive\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">router-view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">keep-alive</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">router-view</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"!$route.meta.keepAlive\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">router-view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">  methods: &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">    updatePosition(path, scrollTop) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">this</span>.UpdatePosition(&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">        key: path,</span></span><br><span class=\"line\"><span class=\"undefined\">        value: scrollTop,</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;);</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  mounted() &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">const</span> self = <span class=\"keyword\">this</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 滚动定位</span></span></span><br><span class=\"line\"><span class=\"javascript\">    self.handler = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (self.routeName.match(<span class=\"regexp\">/(index|bbsIndex|bbsThread)/</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(self.routeName, <span class=\"built_in\">document</span>.body.scrollTop);</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  watch: &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">    routeName(routeName) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 路由定位监听</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (routeName.match(<span class=\"regexp\">/index|bbsIndex|bbsThread/</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.removeEventListener(<span class=\"string\">'scroll'</span>, self.handler, <span class=\"literal\">false</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">          <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'scroll'</span>, self.handler, <span class=\"literal\">false</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;, 1000);</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"comment\">// 路由定位清除</span></span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"keyword\">if</span> (routeName === <span class=\"string\">'indexBeiyun'</span> || routeName === <span class=\"string\">'indexMenses'</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsIndex'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsThread'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsRiji'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (routeName.match(<span class=\"regexp\">/bbsIndex/</span>)) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        self.updatePosition(<span class=\"string\">'bbsThread'</span>, <span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">  beforeDestroy () &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.removeEventListener(<span class=\"string\">'scroll'</span>, <span class=\"keyword\">this</span>.handler, <span class=\"literal\">false</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">  &#125;,</span></span><br><span class=\"line\"><span class=\"undefined\">&#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"各个模块脚本\"><a href=\"#各个模块脚本\" class=\"headerlink\" title=\"各个模块脚本\"></a>各个模块脚本</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/page/home/index.vue</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  activated() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.scrollTop = <span class=\"keyword\">this</span>.position.index;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// src/page/bbs/index.vue</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  activated() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.scrollTop = <span class=\"keyword\">this</span>.position.bbs;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// src/page/bbs/thread.vue</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  activated() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.scrollTop = <span class=\"keyword\">this</span>.position.bbsThread;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由跳转问题\"><a href=\"#路由跳转问题\" class=\"headerlink\" title=\"路由跳转问题\"></a>路由跳转问题</h3><h4 id=\"提交后返回原路由\"><a href=\"#提交后返回原路由\" class=\"headerlink\" title=\"提交后返回原路由\"></a>提交后返回原路由</h4><p>原来的跳转流程，多次返回才能回到首页</p>\n<ul>\n<li>首页（点击B超测排）（push route）</li>\n<li>B超测排（点击填写报告）（push route）</li>\n<li>B超报告页（点击保存）（push route）</li>\n<li>B超测排（左上角返回）</li>\n</ul>\n<p>优化后的跳转流程，一次返回直接回到首页</p>\n<ul>\n<li>首页（点击B超测排）（push route）</li>\n<li>B超测排（点击填写报告）（push route）</li>\n<li>B超报告页（点击保存）（go(-1)）</li>\n</ul>\n<h4 id=\"提交后去到新路由\"><a href=\"#提交后去到新路由\" class=\"headerlink\" title=\"提交后去到新路由\"></a>提交后去到新路由</h4><p>原来的跳转流程，多次返回才能回到首页</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>发帖页（点击发送）（push route）</li>\n<li>群组选择页（点击发布）（push route）</li>\n<li>帖子详情页（左上角返回）</li>\n</ul>\n<p>优化后的跳转流程，一次返回直接回到首页</p>\n<p>步骤一：</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>发帖页（点击发送）（push route）</li>\n<li>群组选择页（点击发布）（go(-1)）</li>\n</ul>\n<p>步骤二：</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>发帖页（replace route）</li>\n</ul>\n<p>步骤三：</p>\n<ul>\n<li>首页（点击发帖）（push route）</li>\n<li>帖子详情页（左上角返回）</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/page/bbs/select_group.vue</span></span><br><span class=\"line\"><span class=\"comment\">// 发帖后，保留发帖tid</span></span><br><span class=\"line\">postThread(&#123;</span><br><span class=\"line\">  success(data) &#123;</span><br><span class=\"line\">    self.SetPostTid(data.tid);</span><br><span class=\"line\">    self.$route.go(<span class=\"number\">-1</span>);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/page/bbs/post.vue</span></span><br><span class=\"line\"><span class=\"comment\">// 发帖页发现存在发帖tid，立即跳转到帖子页</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.postTid) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.$route.replace(<span class=\"keyword\">this</span>.getRoute(<span class=\"string\">`/bbs/thread/<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.postTid&#125;</span>`</span>), () =&gt; &#123;</span><br><span class=\"line\">    self.CleanPostTid();</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"后续\"><a href=\"#后续\" class=\"headerlink\" title=\"后续\"></a>后续</h3><ul>\n<li>统计</li>\n<li>目录：icons，mixins</li>\n<li>打包：build优化</li>\n<li>考虑转场动画</li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oem0024uo2epnu3l400","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 10.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 10","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oer0026uo2eb7apqul8","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2016-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 11.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2016-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 11","published":1,"updated":"2018-03-17T15:35:49.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oev0029uo2ec15y8p59","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 12.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 12","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84of2002buo2eysqvqoax","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2015-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 14.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2015-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 14","published":1,"updated":"2018-03-17T15:35:52.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84of5002duo2e3rd7kp3c","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 13.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 13","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84of8002fuo2eoejygle5","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 16.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 16","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofa002guo2eczghsrcc","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 15.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 15","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofg002iuo2el0ujhbqs","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 17.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 17","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofi002kuo2e2rr1ct1q","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 18.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 18","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofn002nuo2e5k6hosyy","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2014-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 19.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2014-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 19","published":1,"updated":"2018-03-17T15:35:55.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofp002puo2ecvl2yqbg","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 2.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 2","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofu002suo2eicfarti1","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 21.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 21","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ofx002uuo2efxxltkgr","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 20.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 20","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84og1002wuo2eio5xqn8y","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 23.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 23","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84og3002yuo2euv3bj74q","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 22.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 22","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogd0030uo2elcbdj0k5","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 24.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 24","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogg0033uo2e7gk2attz","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 25.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 25","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogj0035uo2eo464rrz7","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 26.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 26","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogn0038uo2e9225i5rg","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 27.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 27","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogp003auo2ekios6uzz","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 28.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 28","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogr003duo2elm8ogyfl","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 3.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 3","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogu003fuo2ezwqyxz0e","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 29.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 29","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogx003iuo2e8zokqm29","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 30.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 30","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ogy003kuo2e7m3xssfz","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 31.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 31","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oh4003nuo2e7rntchf9","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 33.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 33","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oh6003puo2erc64d0mv","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 35.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 35","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oh9003suo2e6zxsriw9","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 32.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 32","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ohc003uuo2ejtkatv13","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 34.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 34","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ohf003xuo2eokmi3nsr","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 36.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 36","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ohj003zuo2ezv3syeto","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 6.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 6","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ohr0042uo2ephu9g76d","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 4.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 4","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ohu0044uo2exe4h5907","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 7.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 7","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oi40047uo2e0cllv15p","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 5.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 5","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oi80049uo2e84mr2ils","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 9.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 9","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oid004cuo2e59ufrvyu","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84oip004euo2e2rgfpd6n","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"},{"title":"Vue脚手架模拟接口数据","date":"2017-12-14T16:00:00.000Z","_content":"\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","source":"_posts/vue-demo-dev-server的副本 8.md","raw":"---\ntitle: Vue脚手架模拟接口数据\ndate: 2017-12-15\ntags:\n - javascript\n - vue\n---\n\n开发前期，接口未开发完，可以自己模拟数据或者接口代理\n<!-- more -->\n\n## 初始化项目\n\n```bash\nvue init webpack dev-server\n```\n\n## 脚手架自带静态服务器\n\nhttp://localhost:8080/README.md\nhttp://localhost:8080/package.json\nhttp://localhost:8080/src/main.js\n\n通过自带的静态服务器，我们可以自定义自己的json接口数据\n\n例如：\nhttp://localhost:8080/src/json/list.json\nhttp://localhost:8080/src/json/home.json\n\n## 插件式数据\n\n```js\n// build/webpack.dev.conf.js\n{\n  plugins: [\n    // https://github.com/ampedandwired/html-webpack-plugin\n    new HtmlWebpackPlugin({\n      filename: 'index.html',\n      template: 'index.html',\n      inject: true\n    }),\n    new HtmlWebpackPlugin({\n      filename: 'api/package.json',\n      template: 'package.json',\n      inject: false\n    }),\n  ]\n}\n```\n\n## 自定义服务器\n\n引入express，自定义带逻辑的接口数据\n\n### 初始化服务器配置\n\n```bash\nnpm install expresss --save-dev\n```\n\n创建服务器脚本文件\n```js\n// build/dev-server.js\nconst express = require('express');\nconst app = new express();\n\n// 跨域处理\napp.use(function (req, res, next) {\n  req.header('Access-Control-Allow-Origin', '*');\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\n\napp.get('/list.json', function (req, res, next) {\n  const list = [\n    {\n      name: '章三',\n      age: 11,\n    }\n  ];\n  res.json({\n    error_code: 0,\n    data: {\n      total: 30,\n      list: list,\n    },\n  });\n});\n\n// api not found.\napp.all('*', function (req, res) {\n  res.json({\n    error_code: 1000,\n    error_message: 'api not found.',\n  })\n});\n\napp.listen(8081, function () {\n  console.log('listen to 8081');\n});\n```\n\n访问http://localhost:8081/list.json得到\n\n```js\n{\n  error_code: 0,\n  data: {\n    total: 30,\n    list: [\n      {\n        name: '章三',\n        age: 11,\n      }\n    ],\n  }\n}\n```\n\n访问未知的http://localhost:8081/abc.json得到\n\n```js\n{\n  error_code: 1000,\n  error_message: 'api not found.'\n}\n```\n\n把原来的服务器地址代理到此新服务器\n\n```js\n// config/index.js\nmodule.exports = {\n  dev: {\n    proxyTable: {\n      '/proxy': {\n        target: 'http://127.0.0.1:8081',\n        pathRewrite: {\n          '^/proxy' : '/'\n        },\n        secure: false,\n      }\n    },\n  }\n}\n```\n\n地址变成\nhttp://localhost:8080/proxy/list.json\nhttp://localhost:8080/proxy/abc.json\n\n### 动态接口数据\n\n首先定义个js文件，js处理逻辑数据后输出\n\n```js\n// build/data/list.js\nmodule.exports = {\n  get: function (options = {}) {\n    const page = options.page || 1;\n    const limit = options.limit || 1;\n    return {\n      error_code: 0,\n      data: {\n        total: 30,\n        list: [\n          {\n            name: '章三',\n            age: 31,\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n静态js的请求处理\n\n```js\n// build/dev-server.js\nconst filejsList = reuqire('./data/list.js');\napp.get('/filejs/list.json', function (req, res, next) {\n  res.json(filejsList.get());\n});\n```\n\n动态js请求处理  \nrequire后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js\n\n```js\n// 动态更新内存中的js\nconst load = function(path){\n  if(require.resolve(path)){\n    delete require.cache[require.resolve(path)];\n    filejsList = require(path);\n  }\n};\nlet filejsList;\nload('./data/list');\napp.get('/filejs/list.json', function (req, res, next) {\n  // 每次都重新读取js文件（热更新）\n  load('./data/list');\n  res.json(filejsList.get());\n});\n```\n\n最后访问地址\nhttp://localhost:8080/proxy/filejs/list.json\n\n## 参考地址\n\n+ Express\nhttp://www.expressjs.com.cn/starter/hello-world.html\n+ Demo\nhttps://github.com/unclay/vue-demo/tree/master/dev-server\n","slug":"vue-demo-dev-server的副本 8","published":1,"updated":"2017-12-15T06:33:23.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjew84ois004huo2e8yyaq1u7","content":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br><a id=\"more\"></a></p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>开发前期，接口未开发完，可以自己模拟数据或者接口代理<br>","more":"</p>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue init webpack dev-server</span><br></pre></td></tr></table></figure>\n<h2 id=\"脚手架自带静态服务器\"><a href=\"#脚手架自带静态服务器\" class=\"headerlink\" title=\"脚手架自带静态服务器\"></a>脚手架自带静态服务器</h2><p><a href=\"http://localhost:8080/README.md\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/README.md</a><br><a href=\"http://localhost:8080/package.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/package.json</a><br><a href=\"http://localhost:8080/src/main.js\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/main.js</a></p>\n<p>通过自带的静态服务器，我们可以自定义自己的json接口数据</p>\n<p>例如：<br><a href=\"http://localhost:8080/src/json/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/list.json</a><br><a href=\"http://localhost:8080/src/json/home.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/src/json/home.json</a></p>\n<h2 id=\"插件式数据\"><a href=\"#插件式数据\" class=\"headerlink\" title=\"插件式数据\"></a>插件式数据</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/webpack.dev.conf.js</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'api/package.json'</span>,</span><br><span class=\"line\">      template: <span class=\"string\">'package.json'</span>,</span><br><span class=\"line\">      inject: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"自定义服务器\"><a href=\"#自定义服务器\" class=\"headerlink\" title=\"自定义服务器\"></a>自定义服务器</h2><p>引入express，自定义带逻辑的接口数据</p>\n<h3 id=\"初始化服务器配置\"><a href=\"#初始化服务器配置\" class=\"headerlink\" title=\"初始化服务器配置\"></a>初始化服务器配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install expresss --save-dev</span><br></pre></td></tr></table></figure>\n<p>创建服务器脚本文件<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> express();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 跨域处理</span></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  req.header(<span class=\"string\">'Access-Control-Allow-Origin'</span>, <span class=\"string\">'*'</span>);</span><br><span class=\"line\">  res.header(<span class=\"string\">'Access-Control-Allow-Methods'</span>, <span class=\"string\">'PUT, POST, GET, DELETE, OPTIONS'</span>);</span><br><span class=\"line\">  next();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.get(<span class=\"string\">'/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> list = [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">11</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ];</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      total: <span class=\"number\">30</span>,</span><br><span class=\"line\">      list: list,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// api not found.</span></span><br><span class=\"line\">app.all(<span class=\"string\">'*'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">  res.json(&#123;</span><br><span class=\"line\">    error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">    error_message: <span class=\"string\">'api not found.'</span>,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(<span class=\"number\">8081</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'listen to 8081'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>访问<a href=\"http://localhost:8081/list.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/list.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    total: <span class=\"number\">30</span>,</span><br><span class=\"line\">    list: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">        age: <span class=\"number\">11</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>访问未知的<a href=\"http://localhost:8081/abc.json得到\" target=\"_blank\" rel=\"noopener\">http://localhost:8081/abc.json得到</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  error_code: <span class=\"number\">1000</span>,</span><br><span class=\"line\">  error_message: <span class=\"string\">'api not found.'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把原来的服务器地址代理到此新服务器</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// config/index.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  dev: &#123;</span><br><span class=\"line\">    proxyTable: &#123;</span><br><span class=\"line\">      <span class=\"string\">'/proxy'</span>: &#123;</span><br><span class=\"line\">        target: <span class=\"string\">'http://127.0.0.1:8081'</span>,</span><br><span class=\"line\">        pathRewrite: &#123;</span><br><span class=\"line\">          <span class=\"string\">'^/proxy'</span> : <span class=\"string\">'/'</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        secure: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>地址变成<br><a href=\"http://localhost:8080/proxy/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/list.json</a><br><a href=\"http://localhost:8080/proxy/abc.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/abc.json</a></p>\n<h3 id=\"动态接口数据\"><a href=\"#动态接口数据\" class=\"headerlink\" title=\"动态接口数据\"></a>动态接口数据</h3><p>首先定义个js文件，js处理逻辑数据后输出</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/data/list.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> page = options.page || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> limit = options.limit || <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      error_code: <span class=\"number\">0</span>,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        total: <span class=\"number\">30</span>,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            name: <span class=\"string\">'章三'</span>,</span><br><span class=\"line\">            age: <span class=\"number\">31</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>静态js的请求处理</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// build/dev-server.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> filejsList = reuqire(<span class=\"string\">'./data/list.js'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>动态js请求处理<br>require后的数据存于内存中，无论怎么改js文件，获取的数据都是从内存中读取，需要动态更新内存中的js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 动态更新内存中的js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> load = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">path</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">require</span>.resolve(path))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> <span class=\"built_in\">require</span>.cache[<span class=\"built_in\">require</span>.resolve(path)];</span><br><span class=\"line\">    filejsList = <span class=\"built_in\">require</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> filejsList;</span><br><span class=\"line\">load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">app.get(<span class=\"string\">'/filejs/list.json'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 每次都重新读取js文件（热更新）</span></span><br><span class=\"line\">  load(<span class=\"string\">'./data/list'</span>);</span><br><span class=\"line\">  res.json(filejsList.get());</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>最后访问地址<br><a href=\"http://localhost:8080/proxy/filejs/list.json\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/proxy/filejs/list.json</a></p>\n<h2 id=\"参考地址\"><a href=\"#参考地址\" class=\"headerlink\" title=\"参考地址\"></a>参考地址</h2><ul>\n<li>Express<br><a href=\"http://www.expressjs.com.cn/starter/hello-world.html\" target=\"_blank\" rel=\"noopener\">http://www.expressjs.com.cn/starter/hello-world.html</a></li>\n<li>Demo<br><a href=\"https://github.com/unclay/vue-demo/tree/master/dev-server\" target=\"_blank\" rel=\"noopener\">https://github.com/unclay/vue-demo/tree/master/dev-server</a></li>\n</ul>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cjew84oac0000uo2eukrdnt51","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ob7000cuo2esr8ym1ie"},{"post_id":"cjew84oai0002uo2epzjiyunw","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84obl000iuo2esl2y8mf1"},{"post_id":"cjew84oan0005uo2eeyoj2kqs","tag_id":"cjew84obj000guo2evumdy63k","_id":"cjew84oc1000vuo2er8rvt2nx"},{"post_id":"cjew84oan0005uo2eeyoj2kqs","tag_id":"cjew84obs000nuo2e5tasmh9x","_id":"cjew84oc6000yuo2eztnp23ew"},{"post_id":"cjew84oby000tuo2e305j2iqu","tag_id":"cjew84obx000suo2eafzu2vax","_id":"cjew84oc90011uo2e9p6h1j6c"},{"post_id":"cjew84oat0007uo2ezzn1via7","tag_id":"cjew84obx000suo2eafzu2vax","_id":"cjew84ocd0013uo2ekzfq61zf"},{"post_id":"cjew84oc1000wuo2eczku5sr9","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ocp0016uo2e02aurgaj"},{"post_id":"cjew84oc60010uo2es68fkclb","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ocs0018uo2ekiqi5xlk"},{"post_id":"cjew84oay0009uo2ewr5t71dl","tag_id":"cjew84obx000suo2eafzu2vax","_id":"cjew84ocz001buo2e9mf0qvui"},{"post_id":"cjew84oc90012uo2eu72jvd6f","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84od2001duo2eirpzezlb"},{"post_id":"cjew84ock0015uo2edjvdpww0","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84od6001guo2ehwwq5nda"},{"post_id":"cjew84ob7000duo2e330xmrjg","tag_id":"cjew84obx000suo2eafzu2vax","_id":"cjew84od9001iuo2enpuyy72p"},{"post_id":"cjew84ocq0017uo2ecfe22ls9","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84odh001luo2ersez2qse"},{"post_id":"cjew84obh000fuo2ed75s5v66","tag_id":"cjew84obx000suo2eafzu2vax","_id":"cjew84odl001nuo2e6u1aax75"},{"post_id":"cjew84obl000juo2em3z8y83c","tag_id":"cjew84obx000suo2eafzu2vax","_id":"cjew84ods001quo2ebpb6wnmi"},{"post_id":"cjew84obt000ouo2e4yvyq05g","tag_id":"cjew84oda001juo2e0aqfcecx","_id":"cjew84odv001suo2ejifr3hy0"},{"post_id":"cjew84odm001ouo2emlwr50j1","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ody001vuo2e0vtn45r8"},{"post_id":"cjew84odt001ruo2eupnf2fta","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oe7001xuo2e1gvzo8gi"},{"post_id":"cjew84obv000quo2efhtudcws","tag_id":"cjew84odp001puo2ezflvdyqe","_id":"cjew84oec001zuo2eyf638cuz"},{"post_id":"cjew84ocx001auo2eas53ft7l","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oep0025uo2es8ry3imz"},{"post_id":"cjew84ocx001auo2eas53ft7l","tag_id":"cjew84ody001uuo2eo611iwhe","_id":"cjew84oet0027uo2e5c64pgua"},{"post_id":"cjew84ocx001auo2eas53ft7l","tag_id":"cjew84oed0020uo2eeexpwe98","_id":"cjew84of1002auo2ea1dpnncv"},{"post_id":"cjew84od3001fuo2erry2nt96","tag_id":"cjew84oda001juo2e0aqfcecx","_id":"cjew84of4002cuo2eoeuw18et"},{"post_id":"cjew84od6001huo2e6s2b5w02","tag_id":"cjew84oet0028uo2e21ddg9yh","_id":"cjew84ofi002juo2e8da3hf3t"},{"post_id":"cjew84od6001huo2e6s2b5w02","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ofl002luo2ed6pg9j7y"},{"post_id":"cjew84od6001huo2e6s2b5w02","tag_id":"cjew84of6002euo2e5lpof0im","_id":"cjew84ofo002ouo2ez00tylou"},{"post_id":"cjew84oda001kuo2ejost5zxv","tag_id":"cjew84off002huo2efup3jnwc","_id":"cjew84ofr002quo2erf8onzh0"},{"post_id":"cjew84odj001muo2e0gsr8pbi","tag_id":"cjew84odp001puo2ezflvdyqe","_id":"cjew84ofx002tuo2ehydbvzmj"},{"post_id":"cjew84odw001tuo2es2uep84s","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84og2002xuo2ey7u663jw"},{"post_id":"cjew84odw001tuo2es2uep84s","tag_id":"cjew84ofs002ruo2e8f9mkjht","_id":"cjew84ogd002zuo2eiis5dz5m"},{"post_id":"cjew84oe3001wuo2ekerp2nkj","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ogg0032uo2eskzqphps"},{"post_id":"cjew84oe3001wuo2ekerp2nkj","tag_id":"cjew84og0002vuo2e3x40s9mr","_id":"cjew84ogj0034uo2ea7l7wgrp"},{"post_id":"cjew84oe9001yuo2eo1tldbc6","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ogm0037uo2elxxueg1c"},{"post_id":"cjew84oe9001yuo2eo1tldbc6","tag_id":"cjew84ofs002ruo2e8f9mkjht","_id":"cjew84ogo0039uo2etccfgkc9"},{"post_id":"cjew84oee0021uo2ewetf0p4h","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ogq003cuo2e8ot61vwl"},{"post_id":"cjew84oee0021uo2ewetf0p4h","tag_id":"cjew84ofs002ruo2e8f9mkjht","_id":"cjew84ogu003euo2ewodm2rug"},{"post_id":"cjew84ogr003duo2elm8ogyfl","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ogx003huo2e625e4uon"},{"post_id":"cjew84ogr003duo2elm8ogyfl","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ogy003juo2e896jbm3s"},{"post_id":"cjew84ogu003fuo2ezwqyxz0e","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oh4003muo2e09os1rgm"},{"post_id":"cjew84ogu003fuo2ezwqyxz0e","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oh6003ouo2ee39j2eed"},{"post_id":"cjew84ogx003iuo2e8zokqm29","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oh9003ruo2ecc0wepqt"},{"post_id":"cjew84ogx003iuo2e8zokqm29","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ohc003tuo2eax05y1bu"},{"post_id":"cjew84oei0022uo2e934fm1ep","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ohe003wuo2e4ylnj322"},{"post_id":"cjew84oei0022uo2e934fm1ep","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ohj003yuo2ed44t6o07"},{"post_id":"cjew84oei0022uo2e934fm1ep","tag_id":"cjew84ofs002ruo2e8f9mkjht","_id":"cjew84ohq0041uo2e6lievtk5"},{"post_id":"cjew84ogy003kuo2e7m3xssfz","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ohu0043uo2eeahpc7qy"},{"post_id":"cjew84ogy003kuo2e7m3xssfz","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oi30046uo2eag25x8g8"},{"post_id":"cjew84oh4003nuo2e7rntchf9","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oi80048uo2ewprhnkgq"},{"post_id":"cjew84oh4003nuo2e7rntchf9","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oic004buo2elvygnadr"},{"post_id":"cjew84oem0024uo2epnu3l400","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oip004duo2e1vxmtdey"},{"post_id":"cjew84oem0024uo2epnu3l400","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ois004guo2eakwx2bkt"},{"post_id":"cjew84oh6003puo2erc64d0mv","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oit004iuo2eyug3obfv"},{"post_id":"cjew84oh6003puo2erc64d0mv","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oiv004kuo2ecyuwe6js"},{"post_id":"cjew84oh9003suo2e6zxsriw9","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oiv004luo2egh4m2iiu"},{"post_id":"cjew84oh9003suo2e6zxsriw9","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oix004nuo2e2hlqzj2n"},{"post_id":"cjew84oer0026uo2eb7apqul8","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oix004ouo2eyj122sce"},{"post_id":"cjew84oer0026uo2eb7apqul8","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oiy004quo2eltpnmwjz"},{"post_id":"cjew84ohc003uuo2ejtkatv13","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oiz004ruo2eelpg71pc"},{"post_id":"cjew84ohc003uuo2ejtkatv13","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oiz004tuo2e92r5pzst"},{"post_id":"cjew84ohf003xuo2eokmi3nsr","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj0004uuo2eum4psvuf"},{"post_id":"cjew84ohf003xuo2eokmi3nsr","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj0004wuo2e9tap0bsy"},{"post_id":"cjew84oev0029uo2ec15y8p59","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj1004xuo2ey1rktlnv"},{"post_id":"cjew84oev0029uo2ec15y8p59","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj1004zuo2embd1hlfm"},{"post_id":"cjew84ohj003zuo2ezv3syeto","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj10050uo2e0iirsxrk"},{"post_id":"cjew84ohj003zuo2ezv3syeto","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj20052uo2emezghdiv"},{"post_id":"cjew84ohr0042uo2ephu9g76d","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj20053uo2etjdqox9h"},{"post_id":"cjew84ohr0042uo2ephu9g76d","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj30055uo2edzwtp8dt"},{"post_id":"cjew84of2002buo2eysqvqoax","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj30056uo2eh87ofwaf"},{"post_id":"cjew84of2002buo2eysqvqoax","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj40058uo2e6p07agcw"},{"post_id":"cjew84ohu0044uo2exe4h5907","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj50059uo2evfcn6a1m"},{"post_id":"cjew84ohu0044uo2exe4h5907","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj6005buo2exu9cqnmr"},{"post_id":"cjew84oi40047uo2e0cllv15p","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj6005cuo2egqewvawy"},{"post_id":"cjew84oi40047uo2e0cllv15p","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj6005euo2ekuup8y8x"},{"post_id":"cjew84of5002duo2e3rd7kp3c","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj7005fuo2e1t5copx4"},{"post_id":"cjew84of5002duo2e3rd7kp3c","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj8005huo2e3ogsk6qj"},{"post_id":"cjew84oi80049uo2e84mr2ils","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj8005iuo2ew5c1i80t"},{"post_id":"cjew84oi80049uo2e84mr2ils","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj9005kuo2e6a2lbm40"},{"post_id":"cjew84oid004cuo2e59ufrvyu","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj9005luo2eb92l21dx"},{"post_id":"cjew84oid004cuo2e59ufrvyu","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj9005muo2egrr7etmo"},{"post_id":"cjew84of8002fuo2eoejygle5","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oj9005nuo2e8wxwcn74"},{"post_id":"cjew84of8002fuo2eoejygle5","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oj9005ouo2er1hyiefq"},{"post_id":"cjew84oip004euo2e2rgfpd6n","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oja005puo2eao2wtz2j"},{"post_id":"cjew84oip004euo2e2rgfpd6n","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oja005quo2ec2t3jcaa"},{"post_id":"cjew84ois004huo2e8yyaq1u7","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oja005ruo2ehj6t29va"},{"post_id":"cjew84ois004huo2e8yyaq1u7","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oja005suo2es50r9tan"},{"post_id":"cjew84ofa002guo2eczghsrcc","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oja005tuo2ey4i6cwpn"},{"post_id":"cjew84ofa002guo2eczghsrcc","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oja005uuo2e9zl8clmv"},{"post_id":"cjew84ofg002iuo2el0ujhbqs","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oja005vuo2e154cp40j"},{"post_id":"cjew84ofg002iuo2el0ujhbqs","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojb005wuo2efcbverye"},{"post_id":"cjew84ofi002kuo2e2rr1ct1q","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojb005xuo2e5i6fs7b6"},{"post_id":"cjew84ofi002kuo2e2rr1ct1q","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojb005yuo2ezmbfcl7e"},{"post_id":"cjew84ofn002nuo2e5k6hosyy","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojb005zuo2egg1hjcxu"},{"post_id":"cjew84ofn002nuo2e5k6hosyy","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojc0060uo2e0lytg139"},{"post_id":"cjew84ofp002puo2ecvl2yqbg","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojc0061uo2e0apoqgg6"},{"post_id":"cjew84ofp002puo2ecvl2yqbg","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojc0062uo2euwxjpw17"},{"post_id":"cjew84ofu002suo2eicfarti1","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojc0063uo2e6yuoxmg4"},{"post_id":"cjew84ofu002suo2eicfarti1","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojc0064uo2es85vocgv"},{"post_id":"cjew84ofx002uuo2efxxltkgr","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojc0065uo2eq9valf20"},{"post_id":"cjew84ofx002uuo2efxxltkgr","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojd0066uo2e55yzkt2g"},{"post_id":"cjew84og1002wuo2eio5xqn8y","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojd0067uo2ec2drzrg3"},{"post_id":"cjew84og1002wuo2eio5xqn8y","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojd0068uo2e4dkypjny"},{"post_id":"cjew84og3002yuo2euv3bj74q","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojd0069uo2e2daylf1e"},{"post_id":"cjew84og3002yuo2euv3bj74q","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oje006auo2ek9oixil6"},{"post_id":"cjew84ogd0030uo2elcbdj0k5","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oje006buo2emdf6cx1y"},{"post_id":"cjew84ogd0030uo2elcbdj0k5","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84oje006cuo2e9avlrseb"},{"post_id":"cjew84ogg0033uo2e7gk2attz","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84oje006duo2e8cah16mh"},{"post_id":"cjew84ogg0033uo2e7gk2attz","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojf006euo2eacqlcld8"},{"post_id":"cjew84ogj0035uo2eo464rrz7","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojf006fuo2e9ssfcldu"},{"post_id":"cjew84ogj0035uo2eo464rrz7","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojf006guo2ezdtpr9ai"},{"post_id":"cjew84ogn0038uo2e9225i5rg","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojg006huo2e84yd8vrj"},{"post_id":"cjew84ogn0038uo2e9225i5rg","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojg006iuo2e8vv0jqge"},{"post_id":"cjew84ogp003auo2ekios6uzz","tag_id":"cjew84oal0004uo2el55x93pc","_id":"cjew84ojg006juo2esmt5er4e"},{"post_id":"cjew84ogp003auo2ekios6uzz","tag_id":"cjew84ogq003buo2ex21m0k30","_id":"cjew84ojg006kuo2erk74jmft"}],"Tag":[{"name":"javascript","_id":"cjew84oal0004uo2el55x93pc"},{"name":"tutorial","_id":"cjew84obj000guo2evumdy63k"},{"name":"components","_id":"cjew84obs000nuo2e5tasmh9x"},{"name":"css","_id":"cjew84obx000suo2eafzu2vax"},{"name":"tutotial","_id":"cjew84oda001juo2e0aqfcecx"},{"name":"tool","_id":"cjew84odp001puo2ezflvdyqe"},{"name":"node","_id":"cjew84ody001uuo2eo611iwhe"},{"name":"express","_id":"cjew84oed0020uo2eeexpwe98"},{"name":"npm","_id":"cjew84oet0028uo2e21ddg9yh"},{"name":"Github","_id":"cjew84of6002euo2e5lpof0im"},{"name":"optimize","_id":"cjew84off002huo2efup3jnwc"},{"name":"review","_id":"cjew84ofs002ruo2e8f9mkjht"},{"name":"canvas","_id":"cjew84og0002vuo2e3x40s9mr"},{"name":"vue","_id":"cjew84ogq003buo2ex21m0k30"}]}}